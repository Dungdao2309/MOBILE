[1mdiff --git a/.gitignore b/.gitignore[m
[1mnew file mode 100644[m
[1mindex 0000000..aa724b7[m
[1m--- /dev/null[m
[1m+++ b/.gitignore[m
[36m@@ -0,0 +1,15 @@[m
[32m+[m[32m*.iml[m
[32m+[m[32m.gradle[m
[32m+[m[32m/local.properties[m
[32m+[m[32m/.idea/caches[m
[32m+[m[32m/.idea/libraries[m
[32m+[m[32m/.idea/modules.xml[m
[32m+[m[32m/.idea/workspace.xml[m
[32m+[m[32m/.idea/navEditor.xml[m
[32m+[m[32m/.idea/assetWizardSettings.xml[m
[32m+[m[32m.DS_Store[m
[32m+[m[32m/build[m
[32m+[m[32m/captures[m
[32m+[m[32m.externalNativeBuild[m
[32m+[m[32m.cxx[m
[32m+[m[32mlocal.properties[m
[1mdiff --git a/.idea/AndroidProjectSystem.xml b/.idea/AndroidProjectSystem.xml[m
[1mnew file mode 100644[m
[1mindex 0000000..4a53bee[m
[1m--- /dev/null[m
[1m+++ b/.idea/AndroidProjectSystem.xml[m
[36m@@ -0,0 +1,6 @@[m
[32m+[m[32m<?xml version="1.0" encoding="UTF-8"?>[m
[32m+[m[32m<project version="4">[m
[32m+[m[32m  <component name="AndroidProjectSystem">[m
[32m+[m[32m    <option name="providerId" value="com.android.tools.idea.GradleProjectSystem" />[m
[32m+[m[32m  </component>[m
[32m+[m[32m</project>[m
\ No newline at end of file[m
[1mdiff --git a/.idea/compiler.xml b/.idea/compiler.xml[m
[1mnew file mode 100644[m
[1mindex 0000000..b86273d[m
[1m--- /dev/null[m
[1m+++ b/.idea/compiler.xml[m
[36m@@ -0,0 +1,6 @@[m
[32m+[m[32m<?xml version="1.0" encoding="UTF-8"?>[m
[32m+[m[32m<project version="4">[m
[32m+[m[32m  <component name="CompilerConfiguration">[m
[32m+[m[32m    <bytecodeTargetLevel target="21" />[m
[32m+[m[32m  </component>[m
[32m+[m[32m</project>[m
\ No newline at end of file[m
[1mdiff --git a/.idea/deploymentTargetSelector.xml b/.idea/deploymentTargetSelector.xml[m
[1mnew file mode 100644[m
[1mindex 0000000..976bca3[m
[1m--- /dev/null[m
[1m+++ b/.idea/deploymentTargetSelector.xml[m
[36m@@ -0,0 +1,18 @@[m
[32m+[m[32m<?xml version="1.0" encoding="UTF-8"?>[m
[32m+[m[32m<project version="4">[m
[32m+[m[32m  <component name="deploymentTargetSelector">[m
[32m+[m[32m    <selectionStates>[m
[32m+[m[32m      <SelectionState runConfigName="app">[m
[32m+[m[32m        <option name="selectionMode" value="DROPDOWN" />[m
[32m+[m[32m        <DropdownSelection timestamp="2025-12-02T06:07:51.363888700Z">[m
[32m+[m[32m          <Target type="DEFAULT_BOOT">[m
[32m+[m[32m            <handle>[m
[32m+[m[32m              <DeviceId pluginId="LocalEmulator" identifier="path=C:\Users\ACER NITRO\.android\avd\Medium_Phone.avd" />[m
[32m+[m[32m            </handle>[m
[32m+[m[32m          </Target>[m
[32m+[m[32m        </DropdownSelection>[m
[32m+[m[32m        <DialogSelection />[m
[32m+[m[32m      </SelectionState>[m
[32m+[m[32m    </selectionStates>[m
[32m+[m[32m  </component>[m
[32m+[m[32m</project>[m
\ No newline at end of file[m
[1mdiff --git a/.idea/deviceManager.xml b/.idea/deviceManager.xml[m
[1mnew file mode 100644[m
[1mindex 0000000..91f9558[m
[1m--- /dev/null[m
[1m+++ b/.idea/deviceManager.xml[m
[36m@@ -0,0 +1,13 @@[m
[32m+[m[32m<?xml version="1.0" encoding="UTF-8"?>[m
[32m+[m[32m<project version="4">[m
[32m+[m[32m  <component name="DeviceTable">[m
[32m+[m[32m    <option name="columnSorters">[m
[32m+[m[32m      <list>[m
[32m+[m[32m        <ColumnSorterState>[m
[32m+[m[32m          <option name="column" value="Name" />[m
[32m+[m[32m          <option name="order" value="ASCENDING" />[m
[32m+[m[32m        </ColumnSorterState>[m
[32m+[m[32m      </list>[m
[32m+[m[32m    </option>[m
[32m+[m[32m  </component>[m
[32m+[m[32m</project>[m
\ No newline at end of file[m
[1mdiff --git a/.idea/dictionaries/project.xml b/.idea/dictionaries/project.xml[m
[1mnew file mode 100644[m
[1mindex 0000000..d8424ce[m
[1m--- /dev/null[m
[1m+++ b/.idea/dictionaries/project.xml[m
[36m@@ -0,0 +1,7 @@[m
[32m+[m[32m<component name="ProjectDictionaryState">[m
[32m+[m[32m  <dictionary name="project">[m
[32m+[m[32m    <words>[m
[32m+[m[32m      <w>xanh</w>[m
[32m+[m[32m    </words>[m
[32m+[m[32m  </dictionary>[m
[32m+[m[32m</component>[m
\ No newline at end of file[m
[1mdiff --git a/.idea/gradle.xml b/.idea/gradle.xml[m
[1mnew file mode 100644[m
[1mindex 0000000..3909897[m
[1m--- /dev/null[m
[1m+++ b/.idea/gradle.xml[m
[36m@@ -0,0 +1,20 @@[m
[32m+[m[32m<?xml version="1.0" encoding="UTF-8"?>[m
[32m+[m[32m<project version="4">[m
[32m+[m[32m  <component name="GradleMigrationSettings" migrationVersion="1" />[m
[32m+[m[32m  <component name="GradleSettings">[m
[32m+[m[32m    <option name="linkedExternalProjectsSettings">[m
[32m+[m[32m      <GradleProjectSettings>[m
[32m+[m[32m        <option name="testRunner" value="CHOOSE_PER_TEST" />[m
[32m+[m[32m        <option name="externalProjectPath" value="$PROJECT_DIR$" />[m
[32m+[m[32m        <option name="gradleJvm" value="#GRADLE_LOCAL_JAVA_HOME" />[m
[32m+[m[32m        <option name="modules">[m
[32m+[m[32m          <set>[m
[32m+[m[32m            <option value="$PROJECT_DIR$" />[m
[32m+[m[32m            <option value="$PROJECT_DIR$/app" />[m
[32m+[m[32m          </set>[m
[32m+[m[32m        </option>[m
[32m+[m[32m      </GradleProjectSettings>[m
[32m+[m[32m    </option>[m
[32m+[m[32m    <option name="offlineMode" value="true" />[m
[32m+[m[32m  </component>[m
[32m+[m[32m</project>[m
\ No newline at end of file[m
[1mdiff --git a/.idea/inspectionProfiles/Project_Default.xml b/.idea/inspectionProfiles/Project_Default.xml[m
[1mnew file mode 100644[m
[1mindex 0000000..7061a0d[m
[1m--- /dev/null[m
[1m+++ b/.idea/inspectionProfiles/Project_Default.xml[m
[36m@@ -0,0 +1,61 @@[m
[32m+[m[32m<component name="InspectionProjectProfileManager">[m
[32m+[m[32m  <profile version="1.0">[m
[32m+[m[32m    <option name="myName" value="Project Default" />[m
[32m+[m[32m    <inspection_tool class="ComposePreviewDimensionRespectsLimit" enabled="true" level="WARNING" enabled_by_default="true">[m
[32m+[m[32m      <option name="composableFile" value="true" />[m
[32m+[m[32m      <option name="previewFile" value="true" />[m
[32m+[m[32m    </inspection_tool>[m
[32m+[m[32m    <inspection_tool class="ComposePreviewMustBeTopLevelFunction" enabled="true" level="ERROR" enabled_by_default="true">[m
[32m+[m[32m      <option name="composableFile" value="true" />[m
[32m+[m[32m      <option name="previewFile" value="true" />[m
[32m+[m[32m    </inspection_tool>[m
[32m+[m[32m    <inspection_tool class="ComposePreviewNeedsComposableAnnotation" enabled="true" level="ERROR" enabled_by_default="true">[m
[32m+[m[32m      <option name="composableFile" value="true" />[m
[32m+[m[32m      <option name="previewFile" value="true" />[m
[32m+[m[32m    </inspection_tool>[m
[32m+[m[32m    <inspection_tool class="ComposePreviewNotSupportedInUnitTestFiles" enabled="true" level="ERROR" enabled_by_default="true">[m
[32m+[m[32m      <option name="composableFile" value="true" />[m
[32m+[m[32m      <option name="previewFile" value="true" />[m
[32m+[m[32m    </inspection_tool>[m
[32m+[m[32m    <inspection_tool class="GlancePreviewDimensionRespectsLimit" enabled="true" level="WARNING" enabled_by_default="true">[m
[32m+[m[32m      <option name="composableFile" value="true" />[m
[32m+[m[32m    </inspection_tool>[m
[32m+[m[32m    <inspection_tool class="GlancePreviewMustBeTopLevelFunction" enabled="true" level="ERROR" enabled_by_default="true">[m
[32m+[m[32m      <option name="composableFile" value="true" />[m
[32m+[m[32m    </inspection_tool>[m
[32m+[m[32m    <inspection_tool class="GlancePreviewNeedsComposableAnnotation" enabled="true" level="ERROR" enabled_by_default="true">[m
[32m+[m[32m      <option name="composableFile" value="true" />[m
[32m+[m[32m    </inspection_tool>[m
[32m+[m[32m    <inspection_tool class="GlancePreviewNotSupportedInUnitTestFiles" enabled="true" level="ERROR" enabled_by_default="true">[m
[32m+[m[32m      <option name="composableFile" value="true" />[m
[32m+[m[32m    </inspection_tool>[m
[32m+[m[32m    <inspection_tool class="PreviewAnnotationInFunctionWithParameters" enabled="true" level="ERROR" enabled_by_default="true">[m
[32m+[m[32m      <option name="composableFile" value="true" />[m
[32m+[m[32m      <option name="previewFile" value="true" />[m
[32m+[m[32m    </inspection_tool>[m
[32m+[m[32m    <inspection_tool class="PreviewApiLevelMustBeValid" enabled="true" level="ERROR" enabled_by_default="true">[m
[32m+[m[32m      <option name="composableFile" value="true" />[m
[32m+[m[32m      <option name="previewFile" value="true" />[m
[32m+[m[32m    </inspection_tool>[m
[32m+[m[32m    <inspection_tool class="PreviewDeviceShouldUseNewSpec" enabled="true" level="WEAK WARNING" enabled_by_default="true">[m
[32m+[m[32m      <option name="composableFile" value="true" />[m
[32m+[m[32m      <option name="previewFile" value="true" />[m
[32m+[m[32m    </inspection_tool>[m
[32m+[m[32m    <inspection_tool class="PreviewFontScaleMustBeGreaterThanZero" enabled="true" level="ERROR" enabled_by_default="true">[m
[32m+[m[32m      <option name="composableFile" value="true" />[m
[32m+[m[32m      <option name="previewFile" value="true" />[m
[32m+[m[32m    </inspection_tool>[m
[32m+[m[32m    <inspection_tool class="PreviewMultipleParameterProviders" enabled="true" level="ERROR" enabled_by_default="true">[m
[32m+[m[32m      <option name="composableFile" value="true" />[m
[32m+[m[32m      <option name="previewFile" value="true" />[m
[32m+[m[32m    </inspection_tool>[m
[32m+[m[32m    <inspection_tool class="PreviewParameterProviderOnFirstParameter" enabled="true" level="ERROR" enabled_by_default="true">[m
[32m+[m[32m      <option name="composableFile" value="true" />[m
[32m+[m[32m      <option name="previewFile" value="true" />[m
[32m+[m[32m    </inspection_tool>[m
[32m+[m[32m    <inspection_tool class="PreviewPickerAnnotation" enabled="true" level="ERROR" enabled_by_default="true">[m
[32m+[m[32m      <option name="composableFile" value="true" />[m
[32m+[m[32m      <option name="previewFile" value="true" />[m
[32m+[m[32m    </inspection_tool>[m
[32m+[m[32m  </profile>[m
[32m+[m[32m</component>[m
\ No newline at end of file[m
[1mdiff --git a/.idea/migrations.xml b/.idea/migrations.xml[m
[1mnew file mode 100644[m
[1mindex 0000000..f8051a6[m
[1m--- /dev/null[m
[1m+++ b/.idea/migrations.xml[m
[36m@@ -0,0 +1,10 @@[m
[32m+[m[32m<?xml version="1.0" encoding="UTF-8"?>[m
[32m+[m[32m<project version="4">[m
[32m+[m[32m  <component name="ProjectMigrations">[m
[32m+[m[32m    <option name="MigrateToGradleLocalJavaHome">[m
[32m+[m[32m      <set>[m
[32m+[m[32m        <option value="$PROJECT_DIR$" />[m
[32m+[m[32m      </set>[m
[32m+[m[32m    </option>[m
[32m+[m[32m  </component>[m
[32m+[m[32m</project>[m
\ No newline at end of file[m
[1mdiff --git a/.idea/misc.xml b/.idea/misc.xml[m
[1mnew file mode 100644[m
[1mindex 0000000..b2c751a[m
[1m--- /dev/null[m
[1m+++ b/.idea/misc.xml[m
[36m@@ -0,0 +1,9 @@[m
[32m+[m[32m<project version="4">[m
[32m+[m[32m  <component name="ExternalStorageConfigurationManager" enabled="true" />[m
[32m+[m[32m  <component name="ProjectRootManager" version="2" languageLevel="JDK_21" default="true" project-jdk-name="jbr-21" project-jdk-type="JavaSDK">[m
[32m+[m[32m    <output url="file://$PROJECT_DIR$/build/classes" />[m
[32m+[m[32m  </component>[m
[32m+[m[32m  <component name="ProjectType">[m
[32m+[m[32m    <option name="id" value="Android" />[m
[32m+[m[32m  </component>[m
[32m+[m[32m</project>[m
\ No newline at end of file[m
[1mdiff --git a/.idea/runConfigurations.xml b/.idea/runConfigurations.xml[m
[1mnew file mode 100644[m
[1mindex 0000000..16660f1[m
[1m--- /dev/null[m
[1m+++ b/.idea/runConfigurations.xml[m
[36m@@ -0,0 +1,17 @@[m
[32m+[m[32m<?xml version="1.0" encoding="UTF-8"?>[m
[32m+[m[32m<project version="4">[m
[32m+[m[32m  <component name="RunConfigurationProducerService">[m
[32m+[m[32m    <option name="ignoredProducers">[m
[32m+[m[32m      <set>[m
[32m+[m[32m        <option value="com.intellij.execution.junit.AbstractAllInDirectoryConfigurationProducer" />[m
[32m+[m[32m        <option value="com.intellij.execution.junit.AllInPackageConfigurationProducer" />[m
[32m+[m[32m        <option value="com.intellij.execution.junit.PatternConfigurationProducer" />[m
[32m+[m[32m        <option value="com.intellij.execution.junit.TestInClassConfigurationProducer" />[m
[32m+[m[32m        <option value="com.intellij.execution.junit.UniqueIdConfigurationProducer" />[m
[32m+[m[32m        <option value="com.intellij.execution.junit.testDiscovery.JUnitTestDiscoveryConfigurationProducer" />[m
[32m+[m[32m        <option value="org.jetbrains.kotlin.idea.junit.KotlinJUnitRunConfigurationProducer" />[m
[32m+[m[32m        <option value="org.jetbrains.kotlin.idea.junit.KotlinPatternConfigurationProducer" />[m
[32m+[m[32m      </set>[m
[32m+[m[32m    </option>[m
[32m+[m[32m  </component>[m
[32m+[m[32m</project>[m
\ No newline at end of file[m
[1mdiff --git a/.idea/vcs.xml b/.idea/vcs.xml[m
[1mnew file mode 100644[m
[1mindex 0000000..35eb1dd[m
[1m--- /dev/null[m
[1m+++ b/.idea/vcs.xml[m
[36m@@ -0,0 +1,6 @@[m
[32m+[m[32m<?xml version="1.0" encoding="UTF-8"?>[m
[32m+[m[32m<project version="4">[m
[32m+[m[32m  <component name="VcsDirectoryMappings">[m
[32m+[m[32m    <mapping directory="" vcs="Git" />[m
[32m+[m[32m  </component>[m
[32m+[m[32m</project>[m
\ No newline at end of file[m
[1mdiff --git a/.kotlin/errors/errors-1762852317999.log b/.kotlin/errors/errors-1762852317999.log[m
[1mnew file mode 100644[m
[1mindex 0000000..1219b50[m
[1m--- /dev/null[m
[1m+++ b/.kotlin/errors/errors-1762852317999.log[m
[36m@@ -0,0 +1,4 @@[m
[32m+[m[32mkotlin version: 2.0.21[m
[32m+[m[32merror message: The daemon has terminated unexpectedly on startup attempt #1 with error code: 0. The daemon process output:[m
[32m+[m[32m    1. Kotlin compile daemon is ready[m
[32m+[m
[1mdiff --git a/.kotlin/errors/errors-1762869118073.log b/.kotlin/errors/errors-1762869118073.log[m
[1mnew file mode 100644[m
[1mindex 0000000..1219b50[m
[1m--- /dev/null[m
[1m+++ b/.kotlin/errors/errors-1762869118073.log[m
[36m@@ -0,0 +1,4 @@[m
[32m+[m[32mkotlin version: 2.0.21[m
[32m+[m[32merror message: The daemon has terminated unexpectedly on startup attempt #1 with error code: 0. The daemon process output:[m
[32m+[m[32m    1. Kotlin compile daemon is ready[m
[32m+[m
[1mdiff --git a/.kotlin/errors/errors-1762923710109.log b/.kotlin/errors/errors-1762923710109.log[m
[1mnew file mode 100644[m
[1mindex 0000000..b3c68f8[m
[1m--- /dev/null[m
[1m+++ b/.kotlin/errors/errors-1762923710109.log[m
[36m@@ -0,0 +1,10 @@[m
[32m+[m[32mkotlin version: 2.0.21[m
[32m+[m[32merror message: The daemon has terminated unexpectedly on startup attempt #1 with error code: 0. The daemon process output:[m
[32m+[m[32m    1. Kotlin compile daemon is ready[m
[32m+[m
[32m+[m[32merror message: The daemon has terminated unexpectedly on startup attempt #2 with error code: 0. The daemon process output:[m
[32m+[m[32m    1. Kotlin compile daemon is ready[m
[32m+[m[32mProblems may have occurred during auto-selection of GC. The preferred GC is Parallel GC.[m
[32m+[m[32mIf the problems persist, try adding the JVM option to the Kotlin daemon JVM arguments: -XX:-UseParallelGC.[m
[32m+[m[32mGC auto-selection logic is disabled temporary for the next daemon startup.[m
[32m+[m
[1mdiff --git a/.kotlin/errors/errors-1763288364953.log b/.kotlin/errors/errors-1763288364953.log[m
[1mnew file mode 100644[m
[1mindex 0000000..1219b50[m
[1m--- /dev/null[m
[1m+++ b/.kotlin/errors/errors-1763288364953.log[m
[36m@@ -0,0 +1,4 @@[m
[32m+[m[32mkotlin version: 2.0.21[m
[32m+[m[32merror message: The daemon has terminated unexpectedly on startup attempt #1 with error code: 0. The daemon process output:[m
[32m+[m[32m    1. Kotlin compile daemon is ready[m
[32m+[m
[1mdiff --git a/.kotlin/errors/errors-1763386569450.log b/.kotlin/errors/errors-1763386569450.log[m
[1mnew file mode 100644[m
[1mindex 0000000..1219b50[m
[1m--- /dev/null[m
[1m+++ b/.kotlin/errors/errors-1763386569450.log[m
[36m@@ -0,0 +1,4 @@[m
[32m+[m[32mkotlin version: 2.0.21[m
[32m+[m[32merror message: The daemon has terminated unexpectedly on startup attempt #1 with error code: 0. The daemon process output:[m
[32m+[m[32m    1. Kotlin compile daemon is ready[m
[32m+[m
[1mdiff --git a/.kotlin/errors/errors-1763446790141.log b/.kotlin/errors/errors-1763446790141.log[m
[1mnew file mode 100644[m
[1mindex 0000000..1219b50[m
[1m--- /dev/null[m
[1m+++ b/.kotlin/errors/errors-1763446790141.log[m
[36m@@ -0,0 +1,4 @@[m
[32m+[m[32mkotlin version: 2.0.21[m
[32m+[m[32merror message: The daemon has terminated unexpectedly on startup attempt #1 with error code: 0. The daemon process output:[m
[32m+[m[32m    1. Kotlin compile daemon is ready[m
[32m+[m
[1mdiff --git a/.kotlin/errors/errors-1763461130693.log b/.kotlin/errors/errors-1763461130693.log[m
[1mnew file mode 100644[m
[1mindex 0000000..1219b50[m
[1m--- /dev/null[m
[1m+++ b/.kotlin/errors/errors-1763461130693.log[m
[36m@@ -0,0 +1,4 @@[m
[32m+[m[32mkotlin version: 2.0.21[m
[32m+[m[32merror message: The daemon has terminated unexpectedly on startup attempt #1 with error code: 0. The daemon process output:[m
[32m+[m[32m    1. Kotlin compile daemon is ready[m
[32m+[m
[1mdiff --git a/.kotlin/errors/errors-1763524437932.log b/.kotlin/errors/errors-1763524437932.log[m
[1mnew file mode 100644[m
[1mindex 0000000..df16c36[m
[1m--- /dev/null[m
[1m+++ b/.kotlin/errors/errors-1763524437932.log[m
[36m@@ -0,0 +1,57 @@[m
[32m+[m[32mkotlin version: 2.0.21[m
[32m+[m[32merror message: The daemon has terminated unexpectedly on startup attempt #1 with error code: 0. The daemon process output:[m
[32m+[m[32m    1. Kotlin compile daemon is ready[m
[32m+[m
[32m+[m[32merror message: The daemon has terminated unexpectedly on startup attempt #2 with error code: 0. The daemon process output:[m
[32m+[m[32m    1. Kotlin compile daemon is ready[m
[32m+[m[32mProblems may have occurred during auto-selection of GC. The preferred GC is Parallel GC.[m
[32m+[m[32mIf the problems persist, try adding the JVM option to the Kotlin daemon JVM arguments: -XX:-UseParallelGC.[m
[32m+[m[32mGC auto-selection logic is disabled temporary for the next daemon startup.[m
[32m+[m
[32m+[m[32merror message: The daemon has terminated unexpectedly on startup attempt #3 with error code: 0. The daemon process output:[m
[32m+[m[32m    1. Kotlin compile daemon is ready[m
[32m+[m
[32m+[m[32merror message: Failed connecting to the daemon in 4 retries[m
[32m+[m
[32m+[m[32merror message: Daemon compilation failed: Could not connect to Kotlin compile daemon[m
[32m+[m[32mjava.lang.RuntimeException: Could not connect to Kotlin compile daemon[m
[32m+[m	[32mat org.jetbrains.kotlin.compilerRunner.GradleKotlinCompilerWork.compileWithDaemon(GradleKotlinCompilerWork.kt:214)[m
[32m+[m	[32mat org.jetbrains.kotlin.compilerRunner.GradleKotlinCompilerWork.compileWithDaemonOrFallbackImpl(GradleKotlinCompilerWork.kt:159)[m
[32m+[m	[32mat org.jetbrains.kotlin.compilerRunner.GradleKotlinCompilerWork.run(GradleKotlinCompilerWork.kt:111)[m
[32m+[m	[32mat org.jetbrains.kotlin.compilerRunner.GradleCompilerRunnerWithWorkers$GradleKotlinCompilerWorkAction.execute(GradleCompilerRunnerWithWorkers.kt:76)[m
[32m+[m	[32mat org.gradle.workers.internal.DefaultWorkerServer.execute(DefaultWorkerServer.java:63)[m
[32m+[m	[32mat org.gradle.workers.internal.NoIsolationWorkerFactory$1$1.create(NoIsolationWorkerFactory.java:66)[m
[32m+[m	[32mat org.gradle.workers.internal.NoIsolationWorkerFactory$1$1.create(NoIsolationWorkerFactory.java:62)[m
[32m+[m	[32mat org.gradle.internal.classloader.ClassLoaderUtils.executeInClassloader(ClassLoaderUtils.java:100)[m
[32m+[m	[32mat org.gradle.workers.internal.NoIsolationWorkerFactory$1.lambda$execute$0(NoIsolationWorkerFactory.java:62)[m
[32m+[m	[32mat org.gradle.workers.internal.AbstractWorker$1.call(AbstractWorker.java:44)[m
[32m+[m	[32mat org.gradle.workers.internal.AbstractWorker$1.call(AbstractWorker.java:41)[m
[32m+[m	[32mat org.gradle.internal.operations.DefaultBuildOperationRunner$CallableBuildOperationWorker.execute(DefaultBuildOperationRunner.java:210)[m
[32m+[m	[32mat org.gradle.internal.operations.DefaultBuildOperationRunner$CallableBuildOperationWorker.execute(DefaultBuildOperationRunner.java:205)[m
[32m+[m	[32mat org.gradle.internal.operations.DefaultBuildOperationRunner$2.execute(DefaultBuildOperationRunner.java:67)[m
[32m+[m	[32mat org.gradle.internal.operations.DefaultBuildOperationRunner$2.execute(DefaultBuildOperationRunner.java:60)[m
[32m+[m	[32mat org.gradle.internal.operations.DefaultBuildOperationRunner.execute(DefaultBuildOperationRunner.java:167)[m
[32m+[m	[32mat org.gradle.internal.operations.DefaultBuildOperationRunner.execute(DefaultBuildOperationRunner.java:60)[m
[32m+[m	[32mat org.gradle.internal.operations.DefaultBuildOperationRunner.call(DefaultBuildOperationRunner.java:54)[m
[32m+[m	[32mat org.gradle.workers.internal.AbstractWorker.executeWrappedInBuildOperation(AbstractWorker.java:41)[m
[32m+[m	[32mat org.gradle.workers.internal.NoIsolationWorkerFactory$1.execute(NoIsolationWorkerFactory.java:59)[m
[32m+[m	[32mat org.gradle.workers.internal.DefaultWorkerExecutor.lambda$submitWork$0(DefaultWorkerExecutor.java:174)[m
[32m+[m	[32mat java.base/java.util.concurrent.FutureTask.run(Unknown Source)[m
[32m+[m	[32mat org.gradle.internal.work.DefaultConditionalExecutionQueue$ExecutionRunner.runExecution(DefaultConditionalExecutionQueue.java:194)[m
[32m+[m	[32mat org.gradle.internal.work.DefaultConditionalExecutionQueue$ExecutionRunner.access$700(DefaultConditionalExecutionQueue.java:127)[m
[32m+[m	[32mat org.gradle.internal.work.DefaultConditionalExecutionQueue$ExecutionRunner$1.run(DefaultConditionalExecutionQueue.java:169)[m
[32m+[m	[32mat org.gradle.internal.Factories$1.create(Factories.java:31)[m
[32m+[m	[32mat org.gradle.internal.work.DefaultWorkerLeaseService.withLocks(DefaultWorkerLeaseService.java:263)[m
[32m+[m	[32mat org.gradle.internal.work.DefaultWorkerLeaseService.runAsWorkerThread(DefaultWorkerLeaseService.java:127)[m
[32m+[m	[32mat org.gradle.internal.work.DefaultWorkerLeaseService.runAsWorkerThread(DefaultWorkerLeaseService.java:132)[m
[32m+[m	[32mat org.gradle.internal.work.DefaultConditionalExecutionQueue$ExecutionRunner.runBatch(DefaultConditionalExecutionQueue.java:164)[m
[32m+[m	[32mat org.gradle.internal.work.DefaultConditionalExecutionQueue$ExecutionRunner.run(DefaultConditionalExecutionQueue.java:133)[m
[32m+[m	[32mat java.base/java.util.concurrent.Executors$RunnableAdapter.call(Unknown Source)[m
[32m+[m	[32mat java.base/java.util.concurrent.FutureTask.run(Unknown Source)[m
[32m+[m	[32mat org.gradle.internal.concurrent.ExecutorPolicy$CatchAndRecordFailures.onExecute(ExecutorPolicy.java:64)[m
[32m+[m	[32mat org.gradle.internal.concurrent.AbstractManagedExecutor$1.run(AbstractManagedExecutor.java:48)[m
[32m+[m	[32mat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(Unknown Source)[m
[32m+[m	[32mat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(Unknown Source)[m
[32m+[m	[32mat java.base/java.lang.Thread.run(Unknown Source)[m
[32m+[m
[32m+[m
[1mdiff --git a/app/.gitignore b/app/.gitignore[m
[1mnew file mode 100644[m
[1mindex 0000000..42afabf[m
[1m--- /dev/null[m
[1m+++ b/app/.gitignore[m
[36m@@ -0,0 +1 @@[m
[32m+[m[32m/build[m
\ No newline at end of file[m
[1mdiff --git a/app/build.gradle.kts b/app/build.gradle.kts[m
[1mnew file mode 100644[m
[1mindex 0000000..fbf625f[m
[1m--- /dev/null[m
[1m+++ b/app/build.gradle.kts[m
[36m@@ -0,0 +1,122 @@[m
[32m+[m[32mplugins {[m
[32m+[m[32m    alias(libs.plugins.android.application)[m
[32m+[m[32m    alias(libs.plugins.kotlin.android)[m
[32m+[m[32m    alias(libs.plugins.kotlin.compose)[m
[32m+[m[32m    alias(libs.plugins.kotlin.kapt)[m
[32m+[m[32m    alias(libs.plugins.google.dagger.hilt)[m
[32m+[m[32m    alias(libs.plugins.kotlin.serialization)[m
[32m+[m[32m    id("com.google.gms.google-services")[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32mandroid {[m
[32m+[m[32m    namespace = "com.example.stushare"[m
[32m+[m[32m    compileSdk = 36[m
[32m+[m
[32m+[m[32m    defaultConfig {[m
[32m+[m[32m        applicationId = "com.example.stushare"[m
[32m+[m[32m        minSdk = 24[m
[32m+[m[32m        targetSdk = 36[m
[32m+[m[32m        versionCode = 1[m
[32m+[m[32m        versionName = "1.0"[m
[32m+[m
[32m+[m[32m        multiDexEnabled = true // ‚úÖ T·ªët[m
[32m+[m[32m        testInstrumentationRunner = "androidx.test.runner.AndroidJUnitRunner"[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    buildTypes {[m
[32m+[m[32m        release {[m
[32m+[m[32m            isMinifyEnabled = false[m
[32m+[m[32m            proguardFiles([m
[32m+[m[32m                getDefaultProguardFile("proguard-android-optimize.txt"),[m
[32m+[m[32m                "proguard-rules.pro"[m
[32m+[m[32m            )[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m    compileOptions {[m
[32m+[m[32m        sourceCompatibility = JavaVersion.VERSION_11[m
[32m+[m[32m        targetCompatibility = JavaVersion.VERSION_11[m
[32m+[m[32m    }[m
[32m+[m[32m    kotlinOptions {[m
[32m+[m[32m        jvmTarget = "11"[m
[32m+[m[32m    }[m
[32m+[m[32m    buildFeatures {[m
[32m+[m[32m        compose = true[m
[32m+[m[32m        buildConfig = true[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32mdependencies {[m
[32m+[m[32m    // --- Android & Google Play ---[m
[32m+[m[32m    implementation(libs.play.services.games)[m
[32m+[m[32m    implementation(libs.androidx.appcompat) // ‚úÖ ƒê√£ x√≥a d√≤ng tr√πng l·∫∑p[m
[32m+[m
[32m+[m[32m    // WorkManager[m
[32m+[m[32m    val work_version = "2.9.1"[m
[32m+[m[32m    implementation("androidx.work:work-runtime-ktx:$work_version")[m
[32m+[m
[32m+[m[32m    // --- Firebase (BOM qu·∫£n l√Ω version) ---[m
[32m+[m[32m    implementation(platform("com.google.firebase:firebase-bom:34.6.0"))[m
[32m+[m[32m    implementation("com.google.firebase:firebase-analytics")[m
[32m+[m[32m    implementation("com.google.firebase:firebase-firestore")[m
[32m+[m[32m    implementation("com.google.firebase:firebase-auth")[m
[32m+[m[32m    implementation("com.google.firebase:firebase-storage")[m
[32m+[m
[32m+[m[32m    // --- Core & UI ---[m
[32m+[m[32m    implementation(libs.androidx.core.ktx)[m
[32m+[m[32m    implementation(libs.androidx.lifecycle.runtime.ktx)[m
[32m+[m[32m    implementation(libs.androidx.activity.compose)[m
[32m+[m[32m    implementation(platform(libs.androidx.compose.bom))[m
[32m+[m[32m    implementation(libs.androidx.compose.ui)[m
[32m+[m[32m    implementation(libs.androidx.compose.ui.graphics)[m
[32m+[m[32m    implementation(libs.androidx.compose.ui.tooling.preview)[m
[32m+[m[32m    implementation(libs.androidx.compose.material3)[m
[32m+[m[32m    implementation(libs.androidx.compose.material3.windowSizeClass)[m
[32m+[m[32m    implementation(libs.material.icons.extended)[m
[32m+[m[32m    implementation(libs.coil.compose)[m
[32m+[m[32m    implementation(libs.androidx.media3.exoplayer)[m
[32m+[m[32m    implementation(libs.material.core)[m
[32m+[m
[32m+[m[32m    // DataStore (Gi·ªØ b·∫£n m·ªõi nh·∫•t 1.1.1, x√≥a b·∫£n c≈© 1.0.0)[m
[32m+[m[32m    implementation("androidx.datastore:datastore-preferences:1.1.1")[m
[32m+[m
[32m+[m[32m    // --- Serialization & Navigation ---[m
[32m+[m[32m    implementation(libs.kotlinx.serialization.json)[m
[32m+[m[32m    implementation(libs.navigation.compose)[m
[32m+[m
[32m+[m[32m    // --- DI (Hilt) ---[m
[32m+[m[32m    implementation(libs.hilt.android)[m
[32m+[m[32m    implementation(libs.hilt.navigation.compose)[m
[32m+[m[32m    kapt(libs.hilt.compiler)[m
[32m+[m
[32m+[m[32m    // --- Database (Room) ---[m
[32m+[m[32m    implementation(libs.room.runtime)[m
[32m+[m[32m    implementation(libs.room.ktx)[m
[32m+[m[32m    kapt(libs.room.compiler)[m
[32m+[m
[32m+[m[32m    // --- Network (Retrofit & Moshi) ---[m
[32m+[m[32m    implementation(libs.retrofit.core)[m
[32m+[m[32m    implementation(libs.retrofit.converter.moshi)[m
[32m+[m[32m    implementation(libs.okhttp.logging.interceptor)[m
[32m+[m[32m    implementation(libs.moshi.core)[m
[32m+[m[32m    implementation(libs.moshi.kotlin)[m
[32m+[m[32m    kapt(libs.moshi.kotlin.codegen)[m
[32m+[m
[32m+[m[32m    // --- Testing ---[m
[32m+[m[32m    testImplementation(libs.junit)[m
[32m+[m[32m    testImplementation(libs.kotlin.test.junit)[m
[32m+[m[32m    testImplementation(libs.kotlinx.coroutines.test)[m
[32m+[m[32m    testImplementation(libs.mockk)[m
[32m+[m[32m    testImplementation(libs.androidx.core.testing)[m
[32m+[m[32m    testImplementation(libs.androidx.arch.core.testing)[m
[32m+[m[32m    androidTestImplementation(libs.androidx.junit)[m
[32m+[m[32m    androidTestImplementation(libs.androidx.espresso.core)[m
[32m+[m[32m    androidTestImplementation(platform(libs.androidx.compose.bom))[m
[32m+[m[32m    androidTestImplementation(libs.androidx.compose.ui.test.junit4)[m
[32m+[m[32m    debugImplementation(libs.androidx.compose.ui.tooling)[m
[32m+[m[32m    debugImplementation(libs.androidx.compose.ui.test.manifest)[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m// C·∫•u h√¨nh Kapt[m
[32m+[m[32mkapt {[m
[32m+[m[32m    correctErrorTypes = true[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/google-services.json b/app/google-services.json[m
[1mnew file mode 100644[m
[1mindex 0000000..5491f9f[m
[1m--- /dev/null[m
[1m+++ b/app/google-services.json[m
[36m@@ -0,0 +1,29 @@[m
[32m+[m[32m{[m
[32m+[m[32m  "project_info": {[m
[32m+[m[32m    "project_number": "87446888050",[m
[32m+[m[32m    "project_id": "stushare-cf343",[m
[32m+[m[32m    "storage_bucket": "stushare-cf343.firebasestorage.app"[m
[32m+[m[32m  },[m
[32m+[m[32m  "client": [[m
[32m+[m[32m    {[m
[32m+[m[32m      "client_info": {[m
[32m+[m[32m        "mobilesdk_app_id": "1:87446888050:android:f5028dbbf1bedf12776ceb",[m
[32m+[m[32m        "android_client_info": {[m
[32m+[m[32m          "package_name": "com.example.stushare"[m
[32m+[m[32m        }[m
[32m+[m[32m      },[m
[32m+[m[32m      "oauth_client": [],[m
[32m+[m[32m      "api_key": [[m
[32m+[m[32m        {[m
[32m+[m[32m          "current_key": "AIzaSyAdN5VMuaF_7AOd22I1S54l22GhJx50DpE"[m
[32m+[m[32m        }[m
[32m+[m[32m      ],[m
[32m+[m[32m      "services": {[m
[32m+[m[32m        "appinvite_service": {[m
[32m+[m[32m          "other_platform_oauth_client": [][m
[32m+[m[32m        }[m
[32m+[m[32m      }[m
[32m+[m[32m    }[m
[32m+[m[32m  ],[m
[32m+[m[32m  "configuration_version": "1"[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/proguard-rules.pro b/app/proguard-rules.pro[m
[1mnew file mode 100644[m
[1mindex 0000000..481bb43[m
[1m--- /dev/null[m
[1m+++ b/app/proguard-rules.pro[m
[36m@@ -0,0 +1,21 @@[m
[32m+[m[32m# Add project specific ProGuard rules here.[m
[32m+[m[32m# You can control the set of applied configuration files using the[m
[32m+[m[32m# proguardFiles setting in build.gradle.[m
[32m+[m[32m#[m
[32m+[m[32m# For more details, see[m
[32m+[m[32m#   http://developer.android.com/guide/developing/tools/proguard.html[m
[32m+[m
[32m+[m[32m# If your project uses WebView with JS, uncomment the following[m
[32m+[m[32m# and specify the fully qualified class name to the JavaScript interface[m
[32m+[m[32m# class:[m
[32m+[m[32m#-keepclassmembers class fqcn.of.javascript.interface.for.webview {[m
[32m+[m[32m#   public *;[m
[32m+[m[32m#}[m
[32m+[m
[32m+[m[32m# Uncomment this to preserve the line number information for[m
[32m+[m[32m# debugging stack traces.[m
[32m+[m[32m#-keepattributes SourceFile,LineNumberTable[m
[32m+[m
[32m+[m[32m# If you keep the line number information, uncomment this to[m
[32m+[m[32m# hide the original source file name.[m
[32m+[m[32m#-renamesourcefileattribute SourceFile[m
\ No newline at end of file[m
[1mdiff --git a/app/src/androidTest/java/com/example/stushare/ExampleInstrumentedTest.kt b/app/src/androidTest/java/com/example/stushare/ExampleInstrumentedTest.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..4e0240f[m
[1m--- /dev/null[m
[1m+++ b/app/src/androidTest/java/com/example/stushare/ExampleInstrumentedTest.kt[m
[36m@@ -0,0 +1,24 @@[m
[32m+[m[32mpackage com.example.stushare[m
[32m+[m
[32m+[m[32mimport androidx.test.platform.app.InstrumentationRegistry[m
[32m+[m[32mimport androidx.test.ext.junit.runners.AndroidJUnit4[m
[32m+[m
[32m+[m[32mimport org.junit.Test[m
[32m+[m[32mimport org.junit.runner.RunWith[m
[32m+[m
[32m+[m[32mimport org.junit.Assert.*[m
[32m+[m
[32m+[m[32m/**[m
[32m+[m[32m * Instrumented test, which will execute on an Android device.[m
[32m+[m[32m *[m
[32m+[m[32m * See [testing documentation](http://d.android.com/tools/testing).[m
[32m+[m[32m */[m
[32m+[m[32m@RunWith(AndroidJUnit4::class)[m
[32m+[m[32mclass ExampleInstrumentedTest {[m
[32m+[m[32m    @Test[m
[32m+[m[32m    fun useAppContext() {[m
[32m+[m[32m        // Context of the app under test.[m
[32m+[m[32m        val appContext = InstrumentationRegistry.getInstrumentation().targetContext[m
[32m+[m[32m        assertEquals("com.example.stushare", appContext.packageName)[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/AndroidManifest.xml b/app/src/main/AndroidManifest.xml[m
[1mnew file mode 100644[m
[1mindex 0000000..449b6cd[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/AndroidManifest.xml[m
[36m@@ -0,0 +1,39 @@[m
[32m+[m[32m<?xml version="1.0" encoding="utf-8"?>[m
[32m+[m[32m<manifest xmlns:android="http://schemas.android.com/apk/res/android"[m
[32m+[m[32m    xmlns:tools="http://schemas.android.com/tools">[m
[32m+[m
[32m+[m[32m    <uses-permission android:name="android.permission.INTERNET" />[m
[32m+[m[32m    <uses-permission android:name="android.permission.ACCESS_NETWORK_STATE" />[m
[32m+[m
[32m+[m[32m    <uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" android:maxSdkVersion="29" />[m
[32m+[m[32m    <uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE" android:maxSdkVersion="32" />[m
[32m+[m
[32m+[m[32m    <uses-permission android:name="android.permission.READ_MEDIA_IMAGES" />[m
[32m+[m
[32m+[m[32m    <uses-permission android:name="android.permission.POST_NOTIFICATIONS" />[m
[32m+[m
[32m+[m[32m    <application[m
[32m+[m[32m        android:name="com.example.stushare.MainApplication"  android:allowBackup="true"[m
[32m+[m[32m        android:dataExtractionRules="@xml/data_extraction_rules"[m
[32m+[m[32m        android:fullBackupContent="@xml/backup_rules"[m
[32m+[m[32m        android:icon="@mipmap/ic_launcher"[m
[32m+[m[32m        android:label="@string/app_name"[m
[32m+[m[32m        android:roundIcon="@mipmap/ic_launcher_round"[m
[32m+[m[32m        android:supportsRtl="true"[m
[32m+[m
[32m+[m[32m        android:usesCleartextTraffic="true"[m
[32m+[m
[32m+[m[32m        android:theme="@style/Theme.StuShare">[m
[32m+[m[32m        <activity[m
[32m+[m[32m            android:name=".MainActivity"[m
[32m+[m[32m            android:exported="true"[m
[32m+[m[32m            android:label="@string/app_name"[m
[32m+[m[32m            android:theme="@style/Theme.StuShare">[m
[32m+[m[32m            <intent-filter>[m
[32m+[m[32m                <action android:name="android.intent.action.MAIN" />[m
[32m+[m[32m                <category android:name="android.intent.category.LAUNCHER" />[m
[32m+[m[32m            </intent-filter>[m
[32m+[m[32m        </activity>[m
[32m+[m[32m    </application>[m
[32m+[m
[32m+[m[32m</manifest>[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/AppNavigation.kt b/app/src/main/java/com/example/stushare/AppNavigation.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..6e680e9[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/AppNavigation.kt[m
[36m@@ -0,0 +1,635 @@[m
[32m+[m[32mpackage com.example.stushare[m
[32m+[m
[32m+[m[32mimport android.widget.Toast[m
[32m+[m[32mimport androidx.compose.animation.core.tween[m
[32m+[m[32mimport androidx.compose.animation.fadeIn[m
[32m+[m[32mimport androidx.compose.animation.fadeOut[m
[32m+[m[32mimport androidx.compose.animation.slideInHorizontally[m
[32m+[m[32mimport androidx.compose.animation.slideOutHorizontally[m
[32m+[m[32mimport androidx.compose.foundation.layout.Column[m
[32m+[m[32mimport androidx.compose.foundation.layout.Spacer[m
[32m+[m[32mimport androidx.compose.foundation.layout.fillMaxWidth[m
[32m+[m[32mimport androidx.compose.foundation.layout.height[m
[32m+[m[32mimport androidx.compose.material3.AlertDialog[m
[32m+[m[32mimport androidx.compose.material3.Button[m
[32m+[m[32mimport androidx.compose.material3.OutlinedTextField[m
[32m+[m[32mimport androidx.compose.material3.Text[m
[32m+[m[32mimport androidx.compose.material3.TextButton[m
[32m+[m[32mimport androidx.compose.material3.windowsizeclass.WindowSizeClass[m
[32m+[m[32mimport androidx.compose.runtime.Composable[m
[32m+[m[32mimport androidx.compose.runtime.LaunchedEffect[m
[32m+[m[32mimport androidx.compose.runtime.getValue[m
[32m+[m[32mimport androidx.compose.runtime.mutableStateOf[m
[32m+[m[32mimport androidx.compose.runtime.remember[m
[32m+[m[32mimport androidx.compose.runtime.setValue[m
[32m+[m[32mimport androidx.compose.ui.Modifier[m
[32m+[m[32mimport androidx.compose.ui.platform.LocalContext[m
[32m+[m[32mimport androidx.compose.ui.text.input.PasswordVisualTransformation[m
[32m+[m[32mimport androidx.compose.ui.unit.dp[m
[32m+[m[32mimport androidx.hilt.navigation.compose.hiltViewModel[m
[32m+[m[32mimport androidx.lifecycle.compose.collectAsStateWithLifecycle[m
[32m+[m[32mimport androidx.navigation.NavHostController[m
[32m+[m[32mimport androidx.navigation.compose.NavHost[m
[32m+[m[32mimport androidx.navigation.compose.composable[m
[32m+[m[32mimport androidx.navigation.toRoute[m
[32m+[m[32mimport com.google.firebase.auth.FirebaseAuth[m
[32m+[m
[32m+[m[32m// Import NavRoute[m
[32m+[m[32mimport com.example.stushare.core.navigation.NavRoute[m
[32m+[m[32mimport com.example.stushare.core.data.models.NotificationEntity[m
[32m+[m
[32m+[m[32m// Import Utils[m
[32m+[m[32mimport java.net.URLEncoder[m
[32m+[m[32mimport java.nio.charset.StandardCharsets[m
[32m+[m
[32m+[m[32m// Import Screens[m
[32m+[m[32mimport com.example.stushare.features.auth.ui.*[m
[32m+[m[32mimport com.example.stushare.features.feature_home.ui.home.HomeScreen[m
[32m+[m[32mimport com.example.stushare.features.feature_home.ui.viewall.ViewAllScreen[m
[32m+[m[32mimport com.example.stushare.features.feature_search.ui.search.SearchScreen[m
[32m+[m[32mimport com.example.stushare.feature_search.ui.search.SearchResultScreen[m
[32m+[m[32mimport com.example.stushare.feature_document_detail.ui.detail.DocumentDetailScreen[m
[32m+[m[32mimport com.example.stushare.feature_request.ui.list.RequestListScreen[m
[32m+[m[32mimport com.example.stushare.features.feature_upload.ui.UploadScreen[m
[32m+[m[32mimport com.example.stushare.features.feature_upload.ui.UploadViewModel[m
[32m+[m[32mimport com.example.stushare.features.feature_request.ui.create.CreateRequestScreen[m
[32m+[m[32mimport com.example.stushare.features.feature_leaderboard.ui.LeaderboardScreen[m
[32m+[m[32mimport com.example.stushare.features.feature_leaderboard.ui.LeaderboardViewModel[m
[32m+[m[32mimport com.example.stushare.features.feature_notification.ui.NotificationScreen[m
[32m+[m[32mimport com.example.stushare.features.feature_document_detail.ui.pdf.PdfViewerScreen[m
[32m+[m[32mimport com.example.stushare.features.feature_profile.ui.main.ProfileScreen[m
[32m+[m[32mimport com.example.stushare.features.feature_profile.ui.main.ProfileViewModel[m
[32m+[m[32mimport com.example.stushare.features.feature_profile.ui.settings.SettingsScreen[m
[32m+[m[32mimport com.example.stushare.features.feature_profile.ui.account.AccountSecurityScreen[m
[32m+[m[32mimport com.example.stushare.features.feature_profile.ui.account.PersonalInfoScreen[m
[32m+[m[32mimport com.example.stushare.features.feature_profile.ui.account.ChangePasswordScreen[m
[32m+[m[32mimport com.example.stushare.features.feature_profile.ui.account.SwitchAccountScreen[m
[32m+[m[32mimport com.example.stushare.features.feature_profile.ui.account.EditAttributeScreen[m
[32m+[m[32mimport com.example.stushare.features.feature_profile.ui.settings.notification.NotificationSettingsScreen[m
[32m+[m[32mimport com.example.stushare.features.feature_profile.ui.settings.appearance.AppearanceSettingsScreen[m
[32m+[m[32mimport com.example.stushare.features.feature_profile.ui.settings.appearance.AppearanceViewModel[m
[32m+[m[32mimport com.example.stushare.features.feature_profile.ui.legal.AboutAppScreen[m
[32m+[m[32mimport com.example.stushare.features.feature_profile.ui.legal.ContactSupportScreen[m
[32m+[m[32mimport com.example.stushare.features.feature_profile.ui.legal.ReportViolationScreen[m
[32m+[m[32mimport com.example.stushare.feature_request.ui.detail.RequestDetailScreen[m
[32m+[m
[32m+[m[32m// üü¢ ADMIN IMPORTS[m
[32m+[m[32mimport com.example.stushare.features.feature_admin.ui.AdminScreen[m
[32m+[m[32mimport com.example.stushare.features.feature_admin.ui.AdminReportScreen[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun AppNavigation([m
[32m+[m[32m    navController: NavHostController,[m
[32m+[m[32m    modifier: Modifier = Modifier,[m
[32m+[m[32m    windowSizeClass: WindowSizeClass[m
[32m+[m[32m) {[m
[32m+[m[32m    // --- C·∫§U H√åNH ANIMATION ---[m
[32m+[m[32m    val duration = 300[m
[32m+[m[32m    val enterTransition = slideInHorizontally(animationSpec = tween(duration), initialOffsetX = { it }) + fadeIn(animationSpec = tween(duration))[m
[32m+[m[32m    val exitTransition = slideOutHorizontally(animationSpec = tween(duration), targetOffsetX = { -it }) + fadeOut(animationSpec = tween(duration))[m
[32m+[m[32m    val popEnterTransition = slideInHorizontally(animationSpec = tween(duration), initialOffsetX = { -it }) + fadeIn(animationSpec = tween(duration))[m
[32m+[m[32m    val popExitTransition = slideOutHorizontally(animationSpec = tween(duration), targetOffsetX = { it }) + fadeOut(animationSpec = tween(duration))[m
[32m+[m
[32m+[m[32m    NavHost([m
[32m+[m[32m        navController = navController,[m
[32m+[m[32m        startDestination = NavRoute.Intro,[m
[32m+[m[32m        modifier = modifier,[m
[32m+[m[32m        enterTransition = { fadeIn(animationSpec = tween(duration)) },[m
[32m+[m[32m        exitTransition = { fadeOut(animationSpec = tween(duration)) },[m
[32m+[m[32m        popEnterTransition = { fadeIn(animationSpec = tween(duration)) },[m
[32m+[m[32m        popExitTransition = { fadeOut(animationSpec = tween(duration)) }[m
[32m+[m[32m    ) {[m
[32m+[m[32m        // ==========================================[m
[32m+[m[32m        // 1. AUTHENTICATION[m
[32m+[m[32m        // ==========================================[m
[32m+[m[32m        composable<NavRoute.Intro> { ManHinhChao(navController) }[m
[32m+[m[32m        composable<NavRoute.Onboarding> { ManHinhGioiThieu(navController) }[m
[32m+[m[32m        composable<NavRoute.Login> { ManHinhDangNhap(navController) }[m
[32m+[m[32m        composable<NavRoute.Register> { ManHinhDangKy(navController) }[m
[32m+[m[32m        composable<NavRoute.ForgotPassword> { ManHinhQuenMatKhau(navController) }[m
[32m+[m[32m        composable<NavRoute.LoginSMS> { ManHinhDangNhapSDT(navController) }[m
[32m+[m[32m        composable<NavRoute.VerifyOTP> { backStackEntry ->[m
[32m+[m[32m            val args = backStackEntry.toRoute<NavRoute.VerifyOTP>()[m
[32m+[m[32m            ManHinhXacThucOTP(navController, args.verificationId)[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        // ==========================================[m
[32m+[m[32m        // 2. MAIN FEATURES[m
[32m+[m[32m        // ==========================================[m
[32m+[m[32m        composable<NavRoute.Home> {[m
[32m+[m[32m            val context = LocalContext.current[m
[32m+[m[32m            HomeScreen([m
[32m+[m[32m                windowSizeClass = windowSizeClass,[m
[32m+[m[32m                onSearchClick = { navController.navigate(NavRoute.Search) },[m
[32m+[m[32m                onViewAllClick = { category -> navController.navigate(NavRoute.ViewAll(category)) },[m
[32m+[m[32m                onDocumentClick = { documentId -> navController.navigate(NavRoute.DocumentDetail(documentId)) },[m
[32m+[m[32m                onCreateRequestClick = {[m
[32m+[m[32m                    if (FirebaseAuth.getInstance().currentUser != null) navController.navigate(NavRoute.CreateRequest)[m
[32m+[m[32m                    else {[m
[32m+[m[32m                        Toast.makeText(context, "C·∫ßn ƒëƒÉng nh·∫≠p!", Toast.LENGTH_SHORT).show()[m
[32m+[m[32m                        navController.navigate(NavRoute.Login)[m
[32m+[m[32m                    }[m
[32m+[m[32m                },[m
[32m+[m[32m                onUploadClick = {[m
[32m+[m[32m                    if (FirebaseAuth.getInstance().currentUser != null) {[m
[32m+[m[32m                        navController.navigate(NavRoute.Upload)[m
[32m+[m[32m                    } else {[m
[32m+[m[32m                        Toast.makeText(context, "B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p ƒë·ªÉ ƒëƒÉng t√†i li·ªáu!", Toast.LENGTH_SHORT).show()[m
[32m+[m[32m                        navController.navigate(NavRoute.Login)[m
[32m+[m[32m                    }[m
[32m+[m[32m                },[m
[32m+[m[32m                onLeaderboardClick = { navController.navigate(NavRoute.Leaderboard) },[m
[32m+[m[32m                onNotificationClick = { navController.navigate(NavRoute.Notification) },[m
[32m+[m[32m                onRequestListClick = { navController.navigate(NavRoute.RequestList) }[m
[32m+[m[32m            )[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        composable<NavRoute.Search>([m
[32m+[m[32m            enterTransition = { enterTransition }, exitTransition = { exitTransition },[m
[32m+[m[32m            popEnterTransition = { popEnterTransition }, popExitTransition = { popExitTransition }[m
[32m+[m[32m        ) {[m
[32m+[m[32m            SearchScreen([m
[32m+[m[32m                onBackClick = { navController.popBackStack() },[m
[32m+[m[32m                onSearchSubmit = { query -> navController.navigate(NavRoute.SearchResult(query)) }[m
[32m+[m[32m            )[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        composable<NavRoute.SearchResult>([m
[32m+[m[32m            enterTransition = { enterTransition }, exitTransition = { exitTransition },[m
[32m+[m[32m            popEnterTransition = { popEnterTransition }, popExitTransition = { popExitTransition }[m
[32m+[m[32m        ) {[m
[32m+[m[32m            SearchResultScreen([m
[32m+[m[32m                onBackClick = { navController.popBackStack() },[m
[32m+[m[32m                onDocumentClick = { documentId -> navController.navigate(NavRoute.DocumentDetail(documentId.toString())) },[m
[32m+[m[32m                onRequestClick = { navController.navigate(NavRoute.RequestList) }[m
[32m+[m[32m            )[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        composable<NavRoute.DocumentDetail> { backStackEntry ->[m
[32m+[m[32m            val route = backStackEntry.toRoute<NavRoute.DocumentDetail>()[m
[32m+[m[32m            val context = LocalContext.current[m
[32m+[m
[32m+[m[32m            DocumentDetailScreen([m
[32m+[m[32m                documentId = route.documentId,[m
[32m+[m[32m                onBackClick = { navController.popBackStack() },[m
[32m+[m[32m                onLoginRequired = {[m
[32m+[m[32m                    Toast.makeText(context, "C·∫ßn ƒëƒÉng nh·∫≠p!", Toast.LENGTH_SHORT).show()[m
[32m+[m[32m                    navController.navigate(NavRoute.Login)[m
[32m+[m[32m                },[m
[32m+[m[32m                onReadPdf = { url, title ->[m
[32m+[m[32m                    if (url.isNotBlank()) {[m
[32m+[m[32m                        try {[m
[32m+[m[32m                            val encodedUrl = URLEncoder.encode(url, StandardCharsets.UTF_8.toString())[m
[32m+[m[32m                            navController.navigate(NavRoute.PdfViewer(url = encodedUrl, title = title))[m
[32m+[m[32m                        } catch (e: Exception) {[m
[32m+[m[32m                            Toast.makeText(context, "L·ªói ƒë∆∞·ªùng d·∫´n file", Toast.LENGTH_SHORT).show()[m
[32m+[m[32m                        }[m
[32m+[m[32m                    } else {[m
[32m+[m[32m                        Toast.makeText(context, "File kh√¥ng t·ªìn t·∫°i", Toast.LENGTH_SHORT).show()[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m            )[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        composable<NavRoute.PdfViewer> { backStackEntry ->[m
[32m+[m[32m            val route = backStackEntry.toRoute<NavRoute.PdfViewer>()[m
[32m+[m[32m            PdfViewerScreen([m
[32m+[m[32m                url = route.url,[m
[32m+[m[32m                title = route.title,[m
[32m+[m[32m                onBackClick = { navController.popBackStack() }[m
[32m+[m[32m            )[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        composable<NavRoute.ViewAll> { backStackEntry ->[m
[32m+[m[32m            val route = backStackEntry.toRoute<NavRoute.ViewAll>()[m
[32m+[m[32m            ViewAllScreen([m
[32m+[m[32m                category = route.category,[m
[32m+[m[32m                onBackClick = { navController.popBackStack() },[m
[32m+[m[32m                onDocumentClick = { documentId -> navController.navigate(NavRoute.DocumentDetail(documentId)) }[m
[32m+[m[32m            )[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        composable<NavRoute.RequestList> {[m
[32m+[m[32m            val context = LocalContext.current[m
[32m+[m[32m            RequestListScreen([m
[32m+[m[32m                onBackClick = { navController.popBackStack() },[m
[32m+[m[32m                onCreateRequestClick = {[m
[32m+[m[32m                    if (FirebaseAuth.getInstance().currentUser != null) navController.navigate(NavRoute.CreateRequest)[m
[32m+[m[32m                    else {[m
[32m+[m[32m                        Toast.makeText(context, "C·∫ßn ƒëƒÉng nh·∫≠p!", Toast.LENGTH_SHORT).show()[m
[32m+[m[32m                        navController.navigate(NavRoute.Login)[m
[32m+[m[32m                    }[m
[32m+[m[32m                },[m
[32m+[m[32m                onNavigateToDetail = { requestId -> navController.navigate(NavRoute.RequestDetail(requestId)) }[m
[32m+[m[32m            )[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        composable<NavRoute.RequestDetail> {[m
[32m+[m[32m            RequestDetailScreen(onBackClick = { navController.popBackStack() })[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        composable<NavRoute.CreateRequest> {[m
[32m+[m[32m            CreateRequestScreen([m
[32m+[m[32m                onBackClick = { navController.popBackStack() },[m
[32m+[m[32m                onSubmitClick = { navController.popBackStack() }[m
[32m+[m[32m            )[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        composable<NavRoute.Upload>([m
[32m+[m[32m            enterTransition = { enterTransition }, exitTransition = { exitTransition },[m
[32m+[m[32m            popEnterTransition = { popEnterTransition }, popExitTransition = { popExitTransition }[m
[32m+[m[32m        ) {[m
[32m+[m[32m            val viewModel = hiltViewModel<UploadViewModel>()[m
[32m+[m[32m            UploadScreen(viewModel = viewModel, onBackClick = { navController.popBackStack() })[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        composable<NavRoute.Leaderboard> {[m
[32m+[m[32m            val viewModel = hiltViewModel<LeaderboardViewModel>()[m
[32m+[m[32m            LeaderboardScreen(viewModel = viewModel, onBackClick = { navController.popBackStack() })[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        composable<NavRoute.Notification> {[m
[32m+[m[32m            val context = LocalContext.current[m
[32m+[m[32m            NotificationScreen([m
[32m+[m[32m                onBackClick = { navController.popBackStack() },[m
[32m+[m[32m                onNotificationClick = { notification ->[m
[32m+[m[32m                    when (notification.type) {[m
[32m+[m[32m                        NotificationEntity.TYPE_UPLOAD,[m
[32m+[m[32m                        NotificationEntity.TYPE_DOWNLOAD,[m
[32m+[m[32m                        NotificationEntity.TYPE_RATING,[m
[32m+[m[32m                        NotificationEntity.TYPE_COMMENT    -> {[m
[32m+[m[32m                            if (notification.relatedId != null) {[m
[32m+[m[32m                                navController.navigate(NavRoute.DocumentDetail(notification.relatedId))[m
[32m+[m[32m                            } else {[m
[32m+[m[32m                                Toast.makeText(context, "Kh√¥ng t√¨m th·∫•y t√†i li·ªáu li√™n k·∫øt", Toast.LENGTH_SHORT).show()[m
[32m+[m[32m                            }[m
[32m+[m[32m                        }[m
[32m+[m[32m                        NotificationEntity.TYPE_SYSTEM -> { }[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m            )[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        // ==========================================[m
[32m+[m[32m        // 3. PROFILE & SETTINGS[m
[32m+[m[32m        // ==========================================[m
[32m+[m[32m        composable<NavRoute.Profile> {[m
[32m+[m[32m            val viewModel = hiltViewModel<ProfileViewModel>()[m
[32m+[m[32m            ProfileScreen([m
[32m+[m[32m                viewModel = viewModel,[m
[32m+[m[32m                onNavigateToSettings = { navController.navigate(NavRoute.Settings) },[m
[32m+[m[32m                onNavigateToLeaderboard = { navController.navigate(NavRoute.Leaderboard) },[m
[32m+[m[32m                onNavigateToLogin = { navController.navigate(NavRoute.Login) },[m
[32m+[m[32m                onNavigateToRegister = { navController.navigate(NavRoute.Register) },[m
[32m+[m[32m                onDocumentClick = { docId -> navController.navigate(NavRoute.DocumentDetail(docId)) },[m
[32m+[m[32m                onNavigateToUpload = { navController.navigate(NavRoute.Upload) },[m
[32m+[m[32m                onNavigateToHome = { navController.navigate(NavRoute.Home) },[m
[32m+[m
[32m+[m[32m                // ƒêi·ªÅu h∆∞·ªõng t·ªõi Admin Dashboard[m
[32m+[m[32m                onNavigateToAdmin = { navController.navigate(NavRoute.AdminDashboard) }[m
[32m+[m[32m            )[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        // ==========================================[m
[32m+[m[32m        // 4. ADMIN FEATURES[m
[32m+[m[32m        // ==========================================[m
[32m+[m
[32m+[m[32m        composable<NavRoute.AdminDashboard>([m
[32m+[m[32m            enterTransition = { enterTransition }, exitTransition = { exitTransition },[m
[32m+[m[32m            popEnterTransition = { popEnterTransition }, popExitTransition = { popExitTransition }[m
[32m+[m[32m        ) {[m
[32m+[m[32m            AdminScreen([m
[32m+[m[32m                onBackClick = { navController.popBackStack() },[m
[32m+[m[32m                onNavigateToReports = { navController.navigate(NavRoute.AdminReports) }[m
[32m+[m[32m            )[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        composable<NavRoute.AdminReports>([m
[32m+[m[32m            enterTransition = { enterTransition }, exitTransition = { exitTransition },[m
[32m+[m[32m            popEnterTransition = { popEnterTransition }, popExitTransition = { popExitTransition }[m
[32m+[m[32m        ) {[m
[32m+[m[32m            AdminReportScreen([m
[32m+[m[32m                onBackClick = { navController.popBackStack() },[m
[32m+[m[32m                onDocumentClick = { documentId ->[m
[32m+[m[32m                    navController.navigate(NavRoute.DocumentDetail(documentId))[m
[32m+[m[32m                }[m
[32m+[m[32m            )[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        composable<NavRoute.Settings>([m
[32m+[m[32m            enterTransition = { enterTransition }, exitTransition = { exitTransition },[m
[32m+[m[32m            popEnterTransition = { popEnterTransition }, popExitTransition = { popExitTransition }[m
[32m+[m[32m        ) {[m
[32m+[m[32m            val context = LocalContext.current[m
[32m+[m[32m            SettingsScreen([m
[32m+[m[32m                onBackClick = { navController.popBackStack() },[m
[32m+[m[32m                onAccountSecurityClick = { navController.navigate(NavRoute.AccountSecurity) },[m
[32m+[m[32m                onNotificationSettingsClick = { navController.navigate(NavRoute.NotificationSettings) },[m
[32m+[m[32m                onAppearanceSettingsClick = { navController.navigate(NavRoute.AppearanceSettings) },[m
[32m+[m[32m                onAboutAppClick = { navController.navigate(NavRoute.AboutApp) },[m
[32m+[m[32m                onContactSupportClick = { navController.navigate(NavRoute.ContactSupport) },[m
[32m+[m[32m                onReportViolationClick = { navController.navigate(NavRoute.ReportViolation) },[m
[32m+[m[32m                onSwitchAccountClick = { navController.navigate(NavRoute.SwitchAccount) },[m
[32m+[m[32m                onLogoutClick = {[m
[32m+[m[32m                    FirebaseAuth.getInstance().signOut()[m
[32m+[m[32m                    Toast.makeText(context, "ƒê√£ ƒëƒÉng xu·∫•t th√†nh c√¥ng", Toast.LENGTH_SHORT).show()[m
[32m+[m[32m                    navController.navigate(NavRoute.Login) {[m
[32m+[m[32m                        popUpTo(0) { inclusive = true }[m
[32m+[m[32m                        launchSingleTop = true[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m            )[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        // üü¢ M√ÄN H√åNH T√ÄI KHO·∫¢N & B·∫¢O M·∫¨T[m
[32m+[m[32m        composable<NavRoute.AccountSecurity>([m
[32m+[m[32m            enterTransition = { enterTransition }, exitTransition = { exitTransition },[m
[32m+[m[32m            popEnterTransition = { popEnterTransition }, popExitTransition = { popExitTransition }[m
[32m+[m[32m        ) {[m
[32m+[m[32m            val context = LocalContext.current[m
[32m+[m[32m            val viewModel = hiltViewModel<ProfileViewModel>()[m
[32m+[m[32m            val uiState by viewModel.uiState.collectAsStateWithLifecycle()[m
[32m+[m
[32m+[m[32m            // L·∫•y email v√† SƒêT t·ª´ ViewModel[m
[32m+[m[32m            val user = FirebaseAuth.getInstance().currentUser[m
[32m+[m[32m            val currentEmail = user?.email ?: ""[m
[32m+[m[32m            val currentPhone = user?.phoneNumber ?: ""[m
[32m+[m
[32m+[m[32m            AccountSecurityScreen([m
[32m+[m[32m                userEmail = currentEmail,[m
[32m+[m[32m                userPhone = currentPhone,[m
[32m+[m[32m                onBackClick = { navController.popBackStack() },[m
[32m+[m[32m                onPersonalInfoClick = { navController.navigate(NavRoute.PersonalInfo) },[m
[32m+[m[41m                [m
[32m+[m[32m                // üü¢ SƒêT: V·∫´n cho ph√©p b·∫•m v√†o ƒë·ªÉ ch·ªânh s·ª≠a[m
[32m+[m[32m                onPhoneClick = { navController.navigate(NavRoute.EditPhone) },[m[41m [m
[32m+[m
[32m+[m[32m                // üî¥ EMAIL: B·∫•m v√†o KH√îNG l√†m g√¨ c·∫£ (kh√¥ng Toast, kh√¥ng navigate)[m
[32m+[m[32m                onEmailClick = {[m[41m [m
[32m+[m[32m                    // Empty lambda: Kh√¥ng c√≥ ph·∫£n h·ªìi g√¨ khi click[m
[32m+[m[32m                },[m
[32m+[m[41m                [m
[32m+[m[32m                onPasswordClick = { navController.navigate(NavRoute.ChangePassword) },[m
[32m+[m[32m                onDeleteAccountClick = { Toast.makeText(context, "Ch·ª©c nƒÉng c·∫ßn x√°c th·ª±c l·∫°i", Toast.LENGTH_SHORT).show() }[m
[32m+[m[32m            )[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        // üü¢ ROUTE M·ªöI: CH·ªàNH S·ª¨A EMAIL (ƒê·ªÇ D√ÄNH, CH∆ØA D√ôNG)[m
[32m+[m[32m        composable<NavRoute.EditEmail>([m
[32m+[m[32m            enterTransition = { enterTransition }, exitTransition = { exitTransition },[m
[32m+[m[32m            popEnterTransition = { popEnterTransition }, popExitTransition = { popExitTransition }[m
[32m+[m[32m        ) {[m
[32m+[m[32m            val context = LocalContext.current[m
[32m+[m[32m            val viewModel = hiltViewModel<ProfileViewModel>()[m
[32m+[m[32m            val user = FirebaseAuth.getInstance().currentUser[m
[32m+[m[41m            [m
[32m+[m[32m            // C√°c bi·∫øn tr·∫°ng th√°i ƒë·ªÉ qu·∫£n l√Ω Dialog[m
[32m+[m[32m            var showPasswordDialog by remember { mutableStateOf(false) }[m
[32m+[m[32m            var pendingNewEmail by remember { mutableStateOf("") }[m
[32m+[m
[32m+[m[32m            // L·∫Øng nghe k·∫øt qu·∫£ t·ª´ ViewModel[m
[32m+[m[32m            LaunchedEffect(Unit) {[m
[32m+[m[32m                viewModel.updateMessage.collect { msg ->[m
[32m+[m[32m                    Toast.makeText(context, msg, Toast.LENGTH_SHORT).show()[m
[32m+[m[32m                    if (msg.contains("th√†nh c√¥ng", ignoreCase = true)) {[m
[32m+[m[32m                        navController.popBackStack()[m[41m [m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            // M√†n h√¨nh ch√≠nh[m
[32m+[m[32m            EditAttributeScreen([m
[32m+[m[32m                title = "C·∫≠p nh·∫≠t Email",[m
[32m+[m[32m                initialValue = user?.email ?: "",[m
[32m+[m[32m                label = "Email m·ªõi",[m
[32m+[m[32m                onBackClick = { navController.popBackStack() },[m
[32m+[m[32m                onSaveClick = { newEmail ->[m
[32m+[m[32m                    if (newEmail == user?.email) {[m
[32m+[m[32m                        Toast.makeText(context, "Email m·ªõi tr√πng v·ªõi email hi·ªán t·∫°i", Toast.LENGTH_SHORT).show()[m
[32m+[m[32m                    } else {[m
[32m+[m[32m                        // L∆∞u email t·∫°m v√† hi·ªán Dialog nh·∫≠p pass[m
[32m+[m[32m                        pendingNewEmail = newEmail[m
[32m+[m[32m                        showPasswordDialog = true[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m            )[m
[32m+[m
[32m+[m[32m            // Hi·ªÉn th·ªã Dialog n·∫øu c·∫ßn[m
[32m+[m[32m            if (showPasswordDialog) {[m
[32m+[m[32m                ReAuthenticateDialog([m
[32m+[m[32m                    onDismiss = { showPasswordDialog = false },[m
[32m+[m[32m                    onConfirm = { password ->[m
[32m+[m[32m                        showPasswordDialog = false[m
[32m+[m[32m                        // G·ªçi ViewModel ƒë·ªÉ th·ª±c hi·ªán ƒë·ªïi email[m
[32m+[m[32m                        viewModel.updateEmail(currentPass = password, newEmail = pendingNewEmail)[m
[32m+[m[32m                    }[m
[32m+[m[32m                )[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        // üü¢ ROUTE M·ªöI: CH·ªàNH S·ª¨A S·ªê ƒêI·ªÜN THO·∫†I (HO·∫†T ƒê·ªòNG B√åNH TH∆Ø·ªúNG)[m
[32m+[m[32m        composable<NavRoute.EditPhone>([m
[32m+[m[32m            enterTransition = { enterTransition }, exitTransition = { exitTransition },[m
[32m+[m[32m            popEnterTransition = { popEnterTransition }, popExitTransition = { popExitTransition }[m
[32m+[m[32m        ) {[m
[32m+[m[32m            val context = LocalContext.current[m
[32m+[m[32m            val activity = LocalContext.current as? android.app.Activity[m
[32m+[m[32m            val user = FirebaseAuth.getInstance().currentUser[m
[32m+[m[32m            val viewModel = hiltViewModel<ProfileViewModel>()[m
[32m+[m
[32m+[m[32m            var showOtpDialog by remember { mutableStateOf(false) }[m
[32m+[m[32m            var isLoading by remember { mutableStateOf(false) }[m
[32m+[m
[32m+[m[32m            LaunchedEffect(Unit) {[m
[32m+[m[32m                viewModel.updateMessage.collect { msg ->[m
[32m+[m[32m                    Toast.makeText(context, msg, Toast.LENGTH_SHORT).show()[m
[32m+[m[32m                    if (msg.contains("th√†nh c√¥ng", ignoreCase = true)) {[m
[32m+[m[32m                        showOtpDialog = false[m
[32m+[m[32m                        navController.popBackStack()[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            EditAttributeScreen([m
[32m+[m[32m                title = "C·∫≠p nh·∫≠t SƒêT",[m
[32m+[m[32m                initialValue = user?.phoneNumber ?: "",[m
[32m+[m[32m                label = "S·ªë ƒëi·ªán tho·∫°i m·ªõi (VD: 0912...)",[m
[32m+[m[32m                onBackClick = { navController.popBackStack() },[m
[32m+[m[32m                onSaveClick = { rawPhone ->[m
[32m+[m[32m                    if (activity != null && rawPhone.isNotBlank()) {[m
[32m+[m[41m                        [m
[32m+[m[32m                        // üü¢ FIX L·ªñI FORMAT: T·ª± ƒë·ªông chuy·ªÉn ƒë·ªïi sang +84[m
[32m+[m[32m                        var formattedPhone = rawPhone.trim()[m
[32m+[m[32m                        if (formattedPhone.startsWith("0")) {[m
[32m+[m[32m                            // Chuy·ªÉn 09... th√†nh +849...[m
[32m+[m[32m                            formattedPhone = "+84" + formattedPhone.substring(1)[m
[32m+[m[32m                        } else if (!formattedPhone.startsWith("+")) {[m
[32m+[m[32m                            // N·∫øu nh·∫≠p 9... th√¨ th√™m +84 v√†o ƒë·∫ßu[m
[32m+[m[32m                            formattedPhone = "+84$formattedPhone"[m
[32m+[m[32m                        }[m
[32m+[m
[32m+[m[32m                        isLoading = true[m
[32m+[m[32m                        Toast.makeText(context, "ƒêang g·ª≠i OTP ƒë·∫øn $formattedPhone...", Toast.LENGTH_SHORT).show()[m
[32m+[m[41m                        [m
[32m+[m[32m                        viewModel.sendOtp([m
[32m+[m[32m                            phoneNumber = formattedPhone, // G·ª≠i s·ªë ƒë√£ format[m
[32m+[m[32m                            activity = activity,[m
[32m+[m[32m                            onCodeSent = {[m
[32m+[m[32m                                isLoading = false[m
[32m+[m[32m                                showOtpDialog = true[m
[32m+[m[32m                                Toast.makeText(context, "ƒê√£ g·ª≠i m√£ OTP!", Toast.LENGTH_SHORT).show()[m
[32m+[m[32m                            },[m
[32m+[m[32m                            onError = { errorMsg ->[m
[32m+[m[32m                                isLoading = false[m
[32m+[m[32m                                Toast.makeText(context, "L·ªói: $errorMsg", Toast.LENGTH_LONG).show()[m
[32m+[m[32m                            }[m
[32m+[m[32m                        )[m
[32m+[m[32m                    } else {[m
[32m+[m[32m                        Toast.makeText(context, "Vui l√≤ng nh·∫≠p s·ªë ƒëi·ªán tho·∫°i", Toast.LENGTH_SHORT).show()[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m            )[m
[32m+[m
[32m+[m[32m            if (showOtpDialog) {[m
[32m+[m[32m                var otpCode by remember { mutableStateOf("") }[m
[32m+[m[41m                [m
[32m+[m[32m                AlertDialog([m
[32m+[m[32m                    onDismissRequest = { showOtpDialog = false },[m
[32m+[m[32m                    title = { Text("Nh·∫≠p m√£ x√°c th·ª±c") },[m
[32m+[m[32m                    text = {[m
[32m+[m[32m                        Column {[m
[32m+[m[32m                            Text("M√£ OTP ƒë√£ ƒë∆∞·ª£c g·ª≠i ƒë·∫øn s·ªë ƒëi·ªán tho·∫°i c·ªßa b·∫°n.")[m
[32m+[m[32m                            Spacer(modifier = Modifier.height(16.dp))[m
[32m+[m[32m                            OutlinedTextField([m
[32m+[m[32m                                value = otpCode,[m
[32m+[m[32m                                onValueChange = { otpCode = it },[m
[32m+[m[32m                                label = { Text("M√£ OTP (6 s·ªë)") },[m
[32m+[m[32m                                singleLine = true,[m
[32m+[m[32m                                modifier = Modifier.fillMaxWidth()[m
[32m+[m[32m                            )[m
[32m+[m[32m                        }[m
[32m+[m[32m                    },[m
[32m+[m[32m                    confirmButton = {[m
[32m+[m[32m                        Button(onClick = {[m[41m [m
[32m+[m[32m                            if (otpCode.length == 6) {[m
[32m+[m[32m                                viewModel.verifyAndUpdatePhone(otpCode)[m
[32m+[m[32m                            } else {[m
[32m+[m[32m                                Toast.makeText(context, "M√£ OTP ph·∫£i c√≥ 6 s·ªë", Toast.LENGTH_SHORT).show()[m
[32m+[m[32m                            }[m
[32m+[m[32m                        }) {[m
[32m+[m[32m                            Text("X√°c nh·∫≠n")[m
[32m+[m[32m                        }[m
[32m+[m[32m                    },[m
[32m+[m[32m                    dismissButton = {[m
[32m+[m[32m                        TextButton(onClick = { showOtpDialog = false }) {[m
[32m+[m[32m                            Text("H·ªßy")[m
[32m+[m[32m                        }[m
[32m+[m[32m                    }[m
[32m+[m[32m                )[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        composable<NavRoute.PersonalInfo>([m
[32m+[m[32m            enterTransition = { enterTransition }, exitTransition = { exitTransition },[m
[32m+[m[32m            popEnterTransition = { popEnterTransition }, popExitTransition = { popExitTransition }[m
[32m+[m[32m        ) {[m
[32m+[m[32m            PersonalInfoScreen(onBackClick = { navController.popBackStack() })[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        composable<NavRoute.ChangePassword>([m
[32m+[m[32m            enterTransition = { enterTransition }, exitTransition = { exitTransition },[m
[32m+[m[32m            popEnterTransition = { popEnterTransition }, popExitTransition = { popExitTransition }[m
[32m+[m[32m        ) {[m
[32m+[m[32m            ChangePasswordScreen(onBackClick = { navController.popBackStack() })[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        composable<NavRoute.SwitchAccount>([m
[32m+[m[32m            enterTransition = { enterTransition }, exitTransition = { exitTransition },[m
[32m+[m[32m            popEnterTransition = { popEnterTransition }, popExitTransition = { popExitTransition }[m
[32m+[m[32m        ) {[m
[32m+[m[32m            SwitchAccountScreen(onBackClick = { navController.popBackStack() })[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        composable<NavRoute.NotificationSettings>([m
[32m+[m[32m            enterTransition = { enterTransition }, exitTransition = { exitTransition },[m
[32m+[m[32m            popEnterTransition = { popEnterTransition }, popExitTransition = { popExitTransition }[m
[32m+[m[32m        ) {[m
[32m+[m[32m            NotificationSettingsScreen(onBackClick = { navController.popBackStack() })[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        composable<NavRoute.AppearanceSettings>([m
[32m+[m[32m            enterTransition = { enterTransition }, exitTransition = { exitTransition },[m
[32m+[m[32m            popEnterTransition = { popEnterTransition }, popExitTransition = { popExitTransition }[m
[32m+[m[32m        ) {[m
[32m+[m[32m            val viewModel = hiltViewModel<AppearanceViewModel>()[m
[32m+[m[32m            AppearanceSettingsScreen(viewModel = viewModel, onBackClick = { navController.popBackStack() })[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        composable<NavRoute.AboutApp>([m
[32m+[m[32m            enterTransition = { enterTransition }, exitTransition = { exitTransition },[m
[32m+[m[32m            popEnterTransition = { popEnterTransition }, popExitTransition = { popExitTransition }[m
[32m+[m[32m        ) {[m
[32m+[m[32m            val context = LocalContext.current[m
[32m+[m[32m            AboutAppScreen([m
[32m+[m[32m                onBackClick = { navController.popBackStack() },[m
[32m+[m[32m                onPrivacyClick = { Toast.makeText(context, "ƒêang m·ªü ch√≠nh s√°ch...", Toast.LENGTH_SHORT).show() },[m
[32m+[m[32m                onTermsClick = { Toast.makeText(context, "ƒêang m·ªü ƒëi·ªÅu kho·∫£n...", Toast.LENGTH_SHORT).show() }[m
[32m+[m[32m            )[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        composable<NavRoute.ContactSupport>([m
[32m+[m[32m            enterTransition = { enterTransition }, exitTransition = { exitTransition },[m
[32m+[m[32m            popEnterTransition = { popEnterTransition }, popExitTransition = { popExitTransition }[m
[32m+[m[32m        ) {[m
[32m+[m[32m            ContactSupportScreen(onBackClick = { navController.popBackStack() })[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        composable<NavRoute.ReportViolation>([m
[32m+[m[32m            enterTransition = { enterTransition }, exitTransition = { exitTransition },[m
[32m+[m[32m            popEnterTransition = { popEnterTransition }, popExitTransition = { popExitTransition }[m
[32m+[m[32m        ) {[m
[32m+[m[32m            ReportViolationScreen(onBackClick = { navController.popBackStack() })[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m// üü¢ COMPONENT: H·ªòP THO·∫†I X√ÅC TH·ª∞C M·∫¨T KH·∫®U[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun ReAuthenticateDialog([m
[32m+[m[32m    onDismiss: () -> Unit,[m
[32m+[m[32m    onConfirm: (String) -> Unit[m
[32m+[m[32m) {[m
[32m+[m[32m    var password by remember { mutableStateOf("") }[m
[32m+[m
[32m+[m[32m    AlertDialog([m
[32m+[m[32m        onDismissRequest = onDismiss,[m
[32m+[m[32m        title = { Text(text = "X√°c th·ª±c b·∫£o m·∫≠t") },[m
[32m+[m[32m        text = {[m
[32m+[m[32m            Column {[m
[32m+[m[32m                Text("Vui l√≤ng nh·∫≠p m·∫≠t kh·∫©u hi·ªán t·∫°i ƒë·ªÉ ti·∫øp t·ª•c:")[m
[32m+[m[32m                Spacer(modifier = Modifier.height(10.dp))[m
[32m+[m[32m                OutlinedTextField([m
[32m+[m[32m                    value = password,[m
[32m+[m[32m                    onValueChange = { password = it },[m
[32m+[m[32m                    label = { Text("M·∫≠t kh·∫©u") },[m
[32m+[m[32m                    singleLine = true,[m
[32m+[m[32m                    visualTransformation = PasswordVisualTransformation(), // ·∫®n m·∫≠t kh·∫©u[m
[32m+[m[32m                    modifier = Modifier.fillMaxWidth()[m
[32m+[m[32m                )[m
[32m+[m[32m            }[m
[32m+[m[32m        },[m
[32m+[m[32m        confirmButton = {[m
[32m+[m[32m            Button([m
[32m+[m[32m                onClick = { onConfirm(password) },[m
[32m+[m[32m                enabled = password.isNotBlank()[m
[32m+[m[32m            ) {[m
[32m+[m[32m                Text("X√°c nh·∫≠n")[m
[32m+[m[32m            }[m
[32m+[m[32m        },[m
[32m+[m[32m        dismissButton = {[m
[32m+[m[32m            TextButton(onClick = onDismiss) {[m
[32m+[m[32m                Text("H·ªßy")[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    )[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/MainActivity.kt b/app/src/main/java/com/example/stushare/MainActivity.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..f17dcaa[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/MainActivity.kt[m
[36m@@ -0,0 +1,117 @@[m
[32m+[m[32mpackage com.example.stushare[m
[32m+[m
[32m+[m[32mimport android.os.Bundle[m
[32m+[m[32mimport androidx.activity.compose.setContent[m
[32m+[m[32mimport androidx.activity.enableEdgeToEdge[m
[32m+[m[32mimport androidx.appcompat.app.AppCompatActivity[m
[32m+[m[32mimport androidx.appcompat.app.AppCompatDelegate[m
[32m+[m[32mimport androidx.compose.foundation.isSystemInDarkTheme[m
[32m+[m[32mimport androidx.compose.foundation.layout.*[m
[32m+[m[32mimport androidx.compose.material3.*[m
[32m+[m[32mimport androidx.compose.material3.windowsizeclass.ExperimentalMaterial3WindowSizeClassApi[m
[32m+[m[32mimport androidx.compose.material3.windowsizeclass.WindowSizeClass[m
[32m+[m[32mimport androidx.compose.material3.windowsizeclass.calculateWindowSizeClass[m
[32m+[m[32mimport androidx.compose.runtime.*[m
[32m+[m[32mimport androidx.compose.ui.Modifier[m
[32m+[m[32mimport androidx.compose.ui.platform.LocalDensity[m
[32m+[m[32mimport androidx.compose.ui.unit.Density[m
[32m+[m[32mimport androidx.core.os.LocaleListCompat[m
[32m+[m[32mimport androidx.hilt.navigation.compose.hiltViewModel[m
[32m+[m[32mimport androidx.navigation.NavDestination.Companion.hasRoute[m
[32m+[m[32mimport androidx.navigation.compose.currentBackStackEntryAsState[m
[32m+[m[32mimport androidx.navigation.compose.rememberNavController[m
[32m+[m[32mimport com.example.stushare.core.data.repository.SettingsRepository[m
[32m+[m[32mimport com.example.stushare.core.navigation.NavRoute[m
[32m+[m[32mimport com.example.stushare.features.feature_home.ui.components.BottomNavBar[m
[32m+[m[32mimport com.example.stushare.ui.theme.StuShareTheme[m
[32m+[m[32mimport dagger.hilt.android.AndroidEntryPoint[m
[32m+[m[32mimport javax.inject.Inject[m
[32m+[m
[32m+[m[32m@AndroidEntryPoint[m
[32m+[m[32mclass MainActivity : AppCompatActivity() {[m
[32m+[m
[32m+[m[32m    @Inject[m
[32m+[m[32m    lateinit var settingsRepository: SettingsRepository[m
[32m+[m
[32m+[m[32m    @OptIn(ExperimentalMaterial3WindowSizeClassApi::class)[m
[32m+[m[32m    override fun onCreate(savedInstanceState: Bundle?) {[m
[32m+[m[32m        super.onCreate(savedInstanceState)[m
[32m+[m[32m        enableEdgeToEdge()[m
[32m+[m
[32m+[m[32m        setContent {[m
[32m+[m[32m            val windowSizeClass = calculateWindowSizeClass(this)[m
[32m+[m
[32m+[m[32m            val isDarkTheme by settingsRepository.isDarkTheme[m
[32m+[m[32m                .collectAsState(initial = isSystemInDarkTheme())[m
[32m+[m
[32m+[m[32m            val fontScale by settingsRepository.fontScale[m
[32m+[m[32m                .collectAsState(initial = 1.0f)[m
[32m+[m
[32m+[m[32m            val languageCode by settingsRepository.languageCode[m
[32m+[m[32m                .collectAsState(initial = "vi")[m
[32m+[m
[32m+[m[32m            LaunchedEffect(languageCode) {[m
[32m+[m[32m                val currentLocales = AppCompatDelegate.getApplicationLocales()[m
[32m+[m[32m                val newLocale = LocaleListCompat.forLanguageTags(languageCode)[m
[32m+[m[32m                if (currentLocales.toLanguageTags() != languageCode) {[m
[32m+[m[32m                    AppCompatDelegate.setApplicationLocales(newLocale)[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            StuShareTheme([m
[32m+[m[32m                darkTheme = isDarkTheme,[m
[32m+[m[32m                fontScale = fontScale[m
[32m+[m[32m            ) {[m
[32m+[m[32m                MainAppScreen(windowSizeClass = windowSizeClass)[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun MainAppScreen(windowSizeClass: WindowSizeClass) {[m
[32m+[m[32m    val navController = rememberNavController()[m
[32m+[m[32m    val navBackStackEntry by navController.currentBackStackEntryAsState()[m
[32m+[m[32m    val currentDestination = navBackStackEntry?.destination[m
[32m+[m
[32m+[m[32m    // K·∫øt n·ªëi ViewModel ƒë·ªÉ l·∫•y d·ªØ li·ªáu Badge[m
[32m+[m[32m    val mainViewModel: MainViewModel = hiltViewModel()[m
[32m+[m[32m    val unreadCount by mainViewModel.unreadCount.collectAsState(initial = 0)[m
[32m+[m
[32m+[m[32m    val showBottomBar = listOf([m
[32m+[m[32m        NavRoute.Home,[m
[32m+[m[32m        NavRoute.Search,[m
[32m+[m[32m        NavRoute.Notification,[m
[32m+[m[32m        NavRoute.Profile,[m
[32m+[m[32m        NavRoute.RequestList[m
[32m+[m[32m    ).any { route ->[m
[32m+[m[32m        currentDestination?.hasRoute(route::class) == true[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    Scaffold([m
[32m+[m[32m        bottomBar = {[m
[32m+[m[32m            if (showBottomBar) {[m
[32m+[m[32m                val currentDensity = LocalDensity.current[m
[32m+[m[32m                CompositionLocalProvider([m
[32m+[m[32m                    LocalDensity provides Density(density = currentDensity.density, fontScale = 1.0f)[m
[32m+[m[32m                ) {[m
[32m+[m[32m                    BottomNavBar([m
[32m+[m[32m                        navController = navController,[m
[32m+[m[32m                        unreadNotificationCount = unreadCount[m
[32m+[m[32m                    )[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    ) { innerPadding ->[m
[32m+[m[32m        Box([m
[32m+[m[32m            modifier = Modifier[m
[32m+[m[32m                .fillMaxSize()[m
[32m+[m[32m                .padding(innerPadding)[m
[32m+[m[32m        ) {[m
[32m+[m[32m            AppNavigation([m
[32m+[m[32m                navController = navController,[m
[32m+[m[32m                windowSizeClass = windowSizeClass[m
[32m+[m[32m            )[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/MainApplication.kt b/app/src/main/java/com/example/stushare/MainApplication.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..9e36d1f[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/MainApplication.kt[m
[36m@@ -0,0 +1,9 @@[m
[32m+[m[32mpackage com.example.stushare[m
[32m+[m
[32m+[m[32mimport android.app.Application[m
[32m+[m[32mimport dagger.hilt.android.HiltAndroidApp[m
[32m+[m
[32m+[m
[32m+[m[32m@HiltAndroidApp[m
[32m+[m[32mclass MainApplication : Application() {[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/MainViewModel.kt b/app/src/main/java/com/example/stushare/MainViewModel.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..2f4dd60[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/MainViewModel.kt[m
[36m@@ -0,0 +1,24 @@[m
[32m+[m[32mpackage com.example.stushare[m
[32m+[m
[32m+[m[32mimport androidx.lifecycle.ViewModel[m
[32m+[m[32mimport androidx.lifecycle.viewModelScope[m
[32m+[m[32mimport com.example.stushare.core.data.repository.NotificationRepository[m
[32m+[m[32mimport dagger.hilt.android.lifecycle.HiltViewModel[m
[32m+[m[32mimport kotlinx.coroutines.flow.SharingStarted[m
[32m+[m[32mimport kotlinx.coroutines.flow.StateFlow[m
[32m+[m[32mimport kotlinx.coroutines.flow.stateIn[m
[32m+[m[32mimport javax.inject.Inject[m
[32m+[m
[32m+[m[32m@HiltViewModel[m
[32m+[m[32mclass MainViewModel @Inject constructor([m
[32m+[m[32m    notificationRepository: NotificationRepository[m
[32m+[m[32m) : ViewModel() {[m
[32m+[m
[32m+[m[32m    // L·∫•y s·ªë l∆∞·ª£ng tin ch∆∞a ƒë·ªçc. D√πng stateIn ƒë·ªÉ gi·ªØ tr·∫°ng th√°i khi xoay m√†n h√¨nh[m
[32m+[m[32m    val unreadCount: StateFlow<Int> = notificationRepository.getUnreadCount()[m
[32m+[m[32m        .stateIn([m
[32m+[m[32m            scope = viewModelScope,[m
[32m+[m[32m            started = SharingStarted.WhileSubscribed(5000),[m
[32m+[m[32m            initialValue = 0[m
[32m+[m[32m        )[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/core/data/db/AppDatabase.kt b/app/src/main/java/com/example/stushare/core/data/db/AppDatabase.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..df4a585[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/core/data/db/AppDatabase.kt[m
[36m@@ -0,0 +1,25 @@[m
[32m+[m[32mpackage com.example.stushare.core.data.db[m
[32m+[m
[32m+[m[32mimport androidx.room.Database[m
[32m+[m[32mimport androidx.room.RoomDatabase[m
[32m+[m[32mimport com.example.stushare.core.data.models.Document[m
[32m+[m[32mimport com.example.stushare.core.data.models.NotificationEntity[m
[32m+[m[32mimport com.example.stushare.core.data.models.UserEntity[m
[32m+[m
[32m+[m[32m@Database([m
[32m+[m[32m    entities = [[m
[32m+[m[32m        Document::class,           // B·∫£ng T√†i li·ªáu[m
[32m+[m[32m        NotificationEntity::class, // B·∫£ng Th√¥ng b√°o[m
[32m+[m[32m        UserEntity::class          // B·∫£ng Ng∆∞·ªùi d√πng[m
[32m+[m[32m    ],[m
[32m+[m[32m    // üî¥ TƒÇNG VERSION T·ª™ 3 -> 4 ƒê·ªÇ C·∫¨P NH·∫¨T C·ªòT fileUrl[m
[32m+[m[32m    version = 4,[m
[32m+[m[32m    exportSchema = false[m
[32m+[m[32m)[m
[32m+[m[32mabstract class AppDatabase : RoomDatabase() {[m
[32m+[m
[32m+[m[32m    abstract fun documentDao(): DocumentDao[m
[32m+[m[32m    abstract fun notificationDao(): NotificationDao[m
[32m+[m[32m    abstract fun userDao(): UserDao[m
[32m+[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/core/data/db/DocumentDao.kt b/app/src/main/java/com/example/stushare/core/data/db/DocumentDao.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..9b7655f[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/core/data/db/DocumentDao.kt[m
[36m@@ -0,0 +1,60 @@[m
[32m+[m[32mpackage com.example.stushare.core.data.db[m
[32m+[m
[32m+[m[32mimport androidx.room.Dao[m
[32m+[m[32mimport androidx.room.Insert[m
[32m+[m[32mimport androidx.room.OnConflictStrategy[m
[32m+[m[32mimport androidx.room.Query[m
[32m+[m[32mimport androidx.room.Transaction[m
[32m+[m[32mimport com.example.stushare.core.data.models.Document[m
[32m+[m[32mimport kotlinx.coroutines.flow.Flow[m
[32m+[m
[32m+[m[32m@Dao[m
[32m+[m[32minterface DocumentDao {[m
[32m+[m
[32m+[m[32m    // 1. L·∫•y t·∫•t c·∫£ t√†i li·ªáu (D√πng cho Home/List)[m
[32m+[m[32m    // Flow gi√∫p UI t·ª± ƒë·ªông render l·∫°i khi b·∫£ng thay ƒë·ªïi[m
[32m+[m[32m    @Query("SELECT * FROM documents ORDER BY createdAt DESC") // N√™n th√™m s·∫Øp x·∫øp theo th·ªùi gian[m
[32m+[m[32m    fun getAllDocuments(): Flow<List<Document>>[m
[32m+[m
[32m+[m[32m    // 2. L·∫•y chi ti·∫øt t√†i li·ªáu[m
[32m+[m[32m    @Query("SELECT * FROM documents WHERE id = :documentId")[m
[32m+[m[32m    fun getDocumentById(documentId: String): Flow<Document>[m
[32m+[m
[32m+[m[32m    // 3. Insert ho·∫∑c Update (N·∫øu tr√πng ID th√¨ ghi ƒë√®)[m
[32m+[m[32m    @Insert(onConflict = OnConflictStrategy.REPLACE)[m
[32m+[m[32m    suspend fun insertDocument(document: Document)[m
[32m+[m
[32m+[m[32m    @Insert(onConflict = OnConflictStrategy.REPLACE)[m
[32m+[m[32m    suspend fun insertAllDocuments(documents: List<Document>)[m
[32m+[m
[32m+[m[32m    // 4. T√¨m ki·∫øm (C·∫¢I TI·∫æN: Chuy·ªÉn sang Flow ƒë·ªÉ search c≈©ng realtime)[m
[32m+[m[32m    // L∆∞u √Ω: COLLATE NOACCENT c√≥ th·ªÉ c·∫ßn c√†i ƒë·∫∑t th√™m t√πy phi√™n b·∫£n Android/Room.[m
[32m+[m[32m    // N·∫øu l·ªói crash, h√£y b·ªè "COLLATE NOACCENT" ƒëi.[m
[32m+[m[32m    @Query("SELECT * FROM documents WHERE normalizedTitle LIKE '%' || :query || '%'")[m
[32m+[m[32m    fun searchDocuments(query: String): Flow<List<Document>>[m
[32m+[m
[32m+[m[32m    // 5. L·∫•y theo lo·∫°i (Flow)[m
[32m+[m[32m    @Query("SELECT * FROM documents WHERE type = :type")[m
[32m+[m[32m    fun getDocumentsByType(type: String): Flow<List<Document>>[m
[32m+[m
[32m+[m[32m    // 6. L·∫•y top t√†i li·ªáu (Flow)[m
[32m+[m[32m    @Query("SELECT * FROM documents ORDER BY downloads DESC LIMIT 10")[m
[32m+[m[32m    fun getTopDocuments(): Flow<List<Document>>[m
[32m+[m
[32m+[m[32m    // 7. X√≥a to√†n b·ªô[m
[32m+[m[32m    @Query("DELETE FROM documents")[m
[32m+[m[32m    suspend fun deleteAllDocuments()[m
[32m+[m
[32m+[m[32m    // 8. Transaction l√†m m·ªõi d·ªØ li·ªáu t·ª´ API v·ªÅ Local[m
[32m+[m[32m    @Transaction[m
[32m+[m[32m    suspend fun replaceAllDocuments(documents: List<Document>) {[m
[32m+[m[32m        deleteAllDocuments()[m
[32m+[m[32m        insertAllDocuments(documents)[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    // ‚≠êÔ∏è QUAN TR·ªåNG: S·ª≠a l·∫°i ki·ªÉu d·ªØ li·ªáu ID th√†nh String (kh·ªõp v·ªõi model Document th∆∞·ªùng d√πng)[m
[32m+[m[32m    // N·∫øu trong Model Document c·ªßa b·∫°n id l√† Long, h√£y ƒë·ªïi l·∫°i th√†nh Long.[m
[32m+[m[32m    // Nh∆∞ng n·∫øu id t·ª´ API v·ªÅ l√† chu·ªói k√Ω t·ª±, PH·∫¢I L√Ä STRING.[m
[32m+[m[32m    @Query("DELETE FROM documents WHERE id = :id")[m
[32m+[m[32m    suspend fun deleteDocumentById(id: String)[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/core/data/db/NotificationDao.kt b/app/src/main/java/com/example/stushare/core/data/db/NotificationDao.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..5d9f6f9[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/core/data/db/NotificationDao.kt[m
[36m@@ -0,0 +1,35 @@[m
[32m+[m[32mpackage com.example.stushare.core.data.db[m
[32m+[m
[32m+[m[32mimport androidx.room.Dao[m
[32m+[m[32mimport androidx.room.Insert[m
[32m+[m[32mimport androidx.room.OnConflictStrategy[m
[32m+[m[32mimport androidx.room.Query[m
[32m+[m[32mimport com.example.stushare.core.data.models.NotificationEntity[m
[32m+[m[32mimport kotlinx.coroutines.flow.Flow[m
[32m+[m
[32m+[m[32m@Dao[m
[32m+[m[32minterface NotificationDao {[m
[32m+[m[32m    // 1. L·∫•y th√¥ng b√°o c·ªßa user c·ª• th·ªÉ (S·∫Øp x·∫øp m·ªõi nh·∫•t l√™n ƒë·∫ßu)[m
[32m+[m[32m    // üü¢ TH√äM: WHERE userId = :userId ƒë·ªÉ tr√°nh l·∫´n l·ªôn gi·ªØa c√°c t√†i kho·∫£n[m
[32m+[m[32m    @Query("SELECT * FROM notifications WHERE userId = :userId ORDER BY timestamp DESC")[m
[32m+[m[32m    fun getNotifications(userId: String): Flow<List<NotificationEntity>>[m
[32m+[m
[32m+[m[32m    @Insert(onConflict = OnConflictStrategy.REPLACE)[m
[32m+[m[32m    suspend fun insertNotification(notification: NotificationEntity)[m
[32m+[m
[32m+[m[32m    // üü¢ S·ª¨A: ƒê·ªïi id t·ª´ Long -> String[m
[32m+[m[32m    @Query("DELETE FROM notifications WHERE id = :id")[m
[32m+[m[32m    suspend fun deleteNotification(id: String)[m
[32m+[m
[32m+[m[32m    // üü¢ S·ª¨A: ƒê·ªïi id t·ª´ Long -> String[m
[32m+[m[32m    @Query("UPDATE notifications SET isRead = 1 WHERE id = :id")[m
[32m+[m[32m    suspend fun markAsRead(id: String)[m
[32m+[m
[32m+[m[32m    // üü¢ TH√äM: ƒê√°nh d·∫•u t·∫•t c·∫£ l√† ƒë√£ ƒë·ªçc[m
[32m+[m[32m    @Query("UPDATE notifications SET isRead = 1 WHERE userId = :userId")[m
[32m+[m[32m    suspend fun markAllAsRead(userId: String)[m
[32m+[m
[32m+[m[32m    // üü¢ S·ª¨A: ƒê·∫øm tin ch∆∞a ƒë·ªçc c·ªßa user c·ª• th·ªÉ[m
[32m+[m[32m    @Query("SELECT COUNT(*) FROM notifications WHERE userId = :userId AND isRead = 0")[m
[32m+[m[32m    fun getUnreadCount(userId: String): Flow<Int>[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/core/data/db/UserDao.kt b/app/src/main/java/com/example/stushare/core/data/db/UserDao.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..55488d0[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/core/data/db/UserDao.kt[m
[36m@@ -0,0 +1,24 @@[m
[32m+[m[32mpackage com.example.stushare.core.data.db[m
[32m+[m
[32m+[m[32mimport androidx.room.Dao[m
[32m+[m[32mimport androidx.room.Insert[m
[32m+[m[32mimport androidx.room.OnConflictStrategy[m
[32m+[m[32mimport androidx.room.Query[m
[32m+[m[32mimport com.example.stushare.core.data.models.UserEntity[m
[32m+[m[32mimport kotlinx.coroutines.flow.Flow[m
[32m+[m
[32m+[m[32m@Dao[m
[32m+[m[32minterface UserDao {[m
[32m+[m[32m    // L·∫•y Top 10 ng∆∞·ªùi d√πng c√≥ ƒëi·ªÉm cao nh·∫•t ƒë·ªÉ hi·ªÉn th·ªã B·∫£ng x·∫øp h·∫°ng[m
[32m+[m[32m    @Query("SELECT * FROM users ORDER BY contributionPoints DESC LIMIT 10")[m
[32m+[m[32m    fun getTopUsers(): Flow<List<UserEntity>>[m
[32m+[m
[32m+[m[32m    // Th√™m ho·∫∑c c·∫≠p nh·∫≠t th√¥ng tin ng∆∞·ªùi d√πng[m
[32m+[m[32m    @Insert(onConflict = OnConflictStrategy.REPLACE)[m
[32m+[m[32m    suspend fun insertUser(user: UserEntity)[m
[32m+[m
[32m+[m[32m    // L·∫•y th√¥ng tin m·ªôt ng∆∞·ªùi d√πng c·ª• th·ªÉ (ƒë·ªÉ c·ªông ƒëi·ªÉm)[m
[32m+[m[32m    @Query("SELECT * FROM users WHERE id = :userId")[m
[32m+[m[32m    suspend fun getUserById(userId: String): UserEntity?[m
[32m+[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/core/data/models/CommentEntity.kt b/app/src/main/java/com/example/stushare/core/data/models/CommentEntity.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..d210c4b[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/core/data/models/CommentEntity.kt[m
[36m@@ -0,0 +1,16 @@[m
[32m+[m[32mpackage com.example.stushare.core.data.models[m
[32m+[m
[32m+[m[32mimport com.google.firebase.firestore.ServerTimestamp[m
[32m+[m[32mimport java.util.Date[m
[32m+[m
[32m+[m[32mdata class CommentEntity([m
[32m+[m[32m    val id: String = "",[m
[32m+[m[32m    val documentId: String = "",[m
[32m+[m[32m    val userId: String = "",[m
[32m+[m[32m    val userName: String = "Ng∆∞·ªùi d√πng ·∫©n danh",[m
[32m+[m[32m    val userAvatar: String? = null,[m
[32m+[m[32m    val content: String = "",[m
[32m+[m
[32m+[m[32m    @ServerTimestamp // T·ª± ƒë·ªông l·∫•y gi·ªù chu·∫©n c·ªßa Server Firebase[m
[32m+[m[32m    val timestamp: Date? = null[m
[32m+[m[32m)[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/core/data/models/DataFailureException.kt b/app/src/main/java/com/example/stushare/core/data/models/DataFailureException.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..137ffaf[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/core/data/models/DataFailureException.kt[m
[36m@@ -0,0 +1,23 @@[m
[32m+[m[32m// File: core/data/models/DataFailureException.kt[m
[32m+[m
[32m+[m[32mpackage com.example.stushare.core.data.models[m
[32m+[m
[32m+[m[32mimport java.io.IOException[m
[32m+[m
[32m+[m[32m/**[m
[32m+[m[32m * Sealed class ƒë·∫°i di·ªán cho c√°c lo·∫°i l·ªói m√† Data Layer c√≥ th·ªÉ tr·∫£ v·ªÅ.[m
[32m+[m[32m * ƒêi·ªÅu n√†y gi√∫p ViewModel kh√¥ng c·∫ßn ph·∫£i bi·∫øt v·ªÅ Retrofit hay IOException.[m
[32m+[m[32m */[m
[32m+[m[32msealed class DataFailureException(message: String? = null, cause: Throwable? = null) :[m
[32m+[m[32m    IOException(message, cause) {[m
[32m+[m
[32m+[m[32m    // L·ªói x·∫£y ra khi kh√¥ng c√≥ k·∫øt n·ªëi Internet[m
[32m+[m[32m    data object NetworkError : DataFailureException("Kh√¥ng c√≥ k·∫øt n·ªëi m·∫°ng. Vui l√≤ng th·ª≠ l·∫°i.")[m
[32m+[m
[32m+[m[32m    // L·ªói t·ª´ ph√≠a API (4xx, 5xx)[m
[32m+[m[32m    data class ApiError(val code: Int) : DataFailureException("L·ªói m√°y ch·ªß v·ªõi m√£ $code.")[m
[32m+[m
[32m+[m[32m    // L·ªói kh√¥ng x√°c ƒë·ªãnh kh√°c[m
[32m+[m[32m    data class UnknownError(override val message: String? = "ƒê√£ x·∫£y ra l·ªói kh√¥ng x√°c ƒë·ªãnh.") :[m
[32m+[m[32m        DataFailureException(message)[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/core/data/models/Document.kt b/app/src/main/java/com/example/stushare/core/data/models/Document.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..980d040[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/core/data/models/Document.kt[m
[36m@@ -0,0 +1,30 @@[m
[32m+[m[32mpackage com.example.stushare.core.data.models[m
[32m+[m
[32m+[m[32mimport androidx.room.Entity[m
[32m+[m[32mimport androidx.room.PrimaryKey[m
[32m+[m[32mimport androidx.room.Index[m
[32m+[m
[32m+[m[32m@Entity([m
[32m+[m[32m    tableName = "documents",[m
[32m+[m[32m    indices = [[m
[32m+[m[32m        Index(value = ["type"]),[m
[32m+[m[32m        Index(value = ["courseCode"])[m
[32m+[m[32m    ][m
[32m+[m[32m)[m
[32m+[m[32mdata class Document([m
[32m+[m[32m    @PrimaryKey[m
[32m+[m[32m    val id: String,[m
[32m+[m[32m    val title: String,[m
[32m+[m[32m    // üü¢ TH√äM D√íNG N√ÄY:[m
[32m+[m[32m    val normalizedTitle: String = "",[m
[32m+[m[32m    val description: String = "",[m
[32m+[m[32m    val type: String,[m
[32m+[m[32m    val imageUrl: String,[m
[32m+[m[32m    val fileUrl: String = "",[m
[32m+[m[32m    val downloads: Int,[m
[32m+[m[32m    val rating: Double,[m
[32m+[m[32m    val author: String,[m
[32m+[m[32m    val courseCode: String,[m
[32m+[m[32m    val createdAt: Long = System.currentTimeMillis(),[m
[32m+[m[32m    val authorId: String? = null[m
[32m+[m[32m)[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/core/data/models/DocumentRequest.kt b/app/src/main/java/com/example/stushare/core/data/models/DocumentRequest.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..280b097[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/core/data/models/DocumentRequest.kt[m
[36m@@ -0,0 +1,24 @@[m
[32m+[m[32mpackage com.example.stushare.core.data.models[m
[32m+[m
[32m+[m[32mimport com.google.firebase.firestore.DocumentId[m
[32m+[m[32mimport com.google.firebase.firestore.ServerTimestamp[m
[32m+[m[32mimport java.util.Date[m
[32m+[m
[32m+[m[32mdata class DocumentRequest([m
[32m+[m[32m    @DocumentId[m
[32m+[m[32m    val id: String = "",[m
[32m+[m[32m    val title: String = "",[m
[32m+[m[32m    val authorName: String = "",[m
[32m+[m
[32m+[m[32m    // üü¢ TH√äM: ID v√† Avatar ng∆∞·ªùi t·∫°o ƒë·ªÉ hi·ªÉn th·ªã trong ƒëo·∫°n chat[m
[32m+[m[32m    val authorId: String = "",[m
[32m+[m[32m    val authorAvatar: String? = null,[m
[32m+[m
[32m+[m[32m    val subject: String = "",[m
[32m+[m[32m    val description: String = "",[m
[32m+[m
[32m+[m[32m    @ServerTimestamp[m
[32m+[m[32m    val createdAt: Date? = null[m
[32m+[m[32m) {[m
[32m+[m[32m    constructor() : this("", "", "", "", null, "", "", null)[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/core/data/models/NotificationEntity.kt b/app/src/main/java/com/example/stushare/core/data/models/NotificationEntity.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..3d120d7[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/core/data/models/NotificationEntity.kt[m
[36m@@ -0,0 +1,33 @@[m
[32m+[m[32mpackage com.example.stushare.core.data.models[m
[32m+[m
[32m+[m[32mimport androidx.room.Entity[m
[32m+[m[32mimport androidx.room.PrimaryKey[m
[32m+[m
[32m+[m[32m@Entity(tableName = "notifications")[m
[32m+[m[32mdata class NotificationEntity([m
[32m+[m[32m    @PrimaryKey[m
[32m+[m[32m    val id: String,[m
[32m+[m[32m    val title: String,[m
[32m+[m[32m    val message: String,[m
[32m+[m
[32m+[m[32m    // M·∫∑c ƒë·ªãnh l·∫•y th·ªùi gian hi·ªán t·∫°i[m
[32m+[m[32m    val timestamp: Long = System.currentTimeMillis(),[m
[32m+[m
[32m+[m[32m    val userId: String,     // ID ng∆∞·ªùi nh·∫≠n th√¥ng b√°o[m
[32m+[m[32m    val type: String,       // Lo·∫°i th√¥ng b√°o (UPLOAD, DOWNLOAD, RATING, COMMENT...)[m
[32m+[m[32m    val isRead: Boolean = false,[m
[32m+[m
[32m+[m[32m    // ID c·ªßa ƒë·ªëi t∆∞·ª£ng li√™n quan (VD: ID t√†i li·ªáu)[m
[32m+[m[32m    val relatedId: String? = null[m
[32m+[m[32m) {[m
[32m+[m[32m    // ƒê·ªãnh nghƒ©a c√°c lo·∫°i th√¥ng b√°o[m
[32m+[m[32m    companion object {[m
[32m+[m[32m        const val TYPE_UPLOAD = "UPLOAD"     // Th√¥ng b√°o khi t·ª± ƒëƒÉng b√†i th√†nh c√¥ng[m
[32m+[m[32m        const val TYPE_DOWNLOAD = "DOWNLOAD" // Th√¥ng b√°o khi c√≥ ng∆∞·ªùi t·∫£i b√†i c·ªßa m√¨nh[m
[32m+[m[32m        const val TYPE_SYSTEM = "SYSTEM"     // Th√¥ng b√°o t·ª´ h·ªá th·ªëng[m
[32m+[m[32m        const val TYPE_RATING = "RATING"     // Th√¥ng b√°o khi c√≥ ng∆∞·ªùi ƒë√°nh gi√°[m
[32m+[m
[32m+[m[32m        // üü¢ M·ªöI: Lo·∫°i th√¥ng b√°o khi c√≥ b√¨nh lu·∫≠n[m
[32m+[m[32m        const val TYPE_COMMENT = "COMMENT"[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/core/data/models/Report.kt b/app/src/main/java/com/example/stushare/core/data/models/Report.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..5ca3efc[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/core/data/models/Report.kt[m
[36m@@ -0,0 +1,12 @@[m
[32m+[m[32mpackage com.example.stushare.core.data.models[m
[32m+[m
[32m+[m[32mdata class Report([m
[32m+[m[32m    val id: String = "",[m
[32m+[m[32m    val documentId: String = "",[m
[32m+[m[32m    val documentTitle: String = "", // üü¢ Hi·ªÉn th·ªã t√™n cho d·ªÖ nh√¨n[m
[32m+[m[32m    val reason: String = "",[m
[32m+[m[32m    val reporterId: String = "",[m
[32m+[m[32m    val reporterEmail: String = "", // üü¢ Bi·∫øt ai b√°o c√°o[m
[32m+[m[32m    val timestamp: Long = 0,[m
[32m+[m[32m    val status: String = "pending" // pending, resolved, dismissed[m
[32m+[m[32m)[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/core/data/models/UserEntity.kt b/app/src/main/java/com/example/stushare/core/data/models/UserEntity.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..3ed1fdd[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/core/data/models/UserEntity.kt[m
[36m@@ -0,0 +1,15 @@[m
[32m+[m[32mpackage com.example.stushare.core.data.models[m
[32m+[m
[32m+[m[32mimport androidx.room.Entity[m
[32m+[m[32mimport androidx.room.PrimaryKey[m
[32m+[m
[32m+[m[32m@Entity(tableName = "users")[m
[32m+[m[32mdata class UserEntity([m
[32m+[m[32m    @PrimaryKey[m
[32m+[m[32m    val id: String,                 // ID ng∆∞·ªùi d√πng (kh·ªõp v·ªõi Firebase Auth UID)[m
[32m+[m[32m    val fullName: String,           // T√™n hi·ªÉn th·ªã[m
[32m+[m[32m    val email: String,              // Email[m
[32m+[m[32m    val avatarUrl: String? = null,  // Link ·∫£nh ƒë·∫°i di·ªán[m
[32m+[m[32m    val contributionPoints: Int = 0,// ƒêi·ªÉm ƒë√≥ng g√≥p (ƒë·ªÉ x·∫øp h·∫°ng)[m
[32m+[m[32m    val uploadedCount: Int = 0      // S·ªë l∆∞·ª£ng t√†i li·ªáu ƒë√£ t·∫£i l√™n[m
[32m+[m[32m)[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/core/data/network/models/ApiService.kt b/app/src/main/java/com/example/stushare/core/data/network/models/ApiService.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..f0364b1[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/core/data/network/models/ApiService.kt[m
[36m@@ -0,0 +1,39 @@[m
[32m+[m[32mpackage com.example.stushare.core.data.network.models[m
[32m+[m
[32m+[m[32m// ‚≠êÔ∏è X√ìA: import com.example.stushare.core.data.models.DocumentRequest[m
[32m+[m[32mimport retrofit2.http.Body[m
[32m+[m[32mimport retrofit2.http.GET[m
[32m+[m[32mimport retrofit2.http.POST[m
[32m+[m[32mimport retrofit2.http.Query[m
[32m+[m
[32m+[m[32m/**[m
[32m+[m[32m * ApiService - Giao ti·∫øp v·ªõi backend ho·∫∑c mock server (My JSON Server)[m
[32m+[m[32m * M·ª•c ƒë√≠ch: L·∫•y t√†i li·ªáu, t√¨m ki·∫øm, v√† g·ª≠i y√™u c·∫ßu t√†i li·ªáu.[m
[32m+[m[32m */[m
[32m+[m[32minterface ApiService {[m
[32m+[m
[32m+[m[32m    // =======================[m
[32m+[m[32m    // üìö T√ÄI LI·ªÜU (Documents)[m
[32m+[m[32m    // =======================[m
[32m+[m
[32m+[m[32m    /**[m
[32m+[m[32m     * L·∫•y danh s√°ch t·∫•t c·∫£ t√†i li·ªáu.[m
[32m+[m[32m     */[m
[32m+[m[32m    @GET("documents")[m
[32m+[m[32m    suspend fun getAllDocuments(): List<DocumentDto>[m
[32m+[m
[32m+[m[32m    /**[m
[32m+[m[32m     * T√¨m ki·∫øm t√†i li·ªáu theo ti√™u ƒë·ªÅ.[m
[32m+[m[32m     *[m
[32m+[m[32m     * ‚ö†Ô∏è L∆∞u √Ω: My JSON Server kh√¥ng h·ªó tr·ª£ t·ªët Unicode c√≥ d·∫•u.[m
[32m+[m[32m     * V√¨ v·∫≠y, n·∫øu b·∫°n d√πng ti·∫øng Vi·ªát, h√£y l·ªçc t·∫°i client trong ViewModel.[m
[32m+[m[32m     */[m
[32m+[m[32m    @GET("documents")[m
[32m+[m[32m    suspend fun searchDocuments(@Query("title_like") query: String): List<DocumentDto>[m
[32m+[m
[32m+[m
[32m+[m[32m    // =======================[m
[32m+[m[32m    // üì¨ Y√äU C·∫¶U (Requests)[m
[32m+[m[32m    // =======================[m
[32m+[m[32m    // ‚≠êÔ∏è C√ÅC H√ÄM C≈® ƒê√É B·ªä X√ìA ‚≠êÔ∏è[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/core/data/network/models/DocumentDto.kt b/app/src/main/java/com/example/stushare/core/data/network/models/DocumentDto.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..8a1fb20[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/core/data/network/models/DocumentDto.kt[m
[36m@@ -0,0 +1,38 @@[m
[32m+[m[32mpackage com.example.stushare.core.data.network.models[m
[32m+[m
[32m+[m[32mimport com.example.stushare.core.data.models.Document[m
[32m+[m[32mimport com.squareup.moshi.Json[m
[32m+[m[32mimport com.squareup.moshi.JsonClass[m
[32m+[m
[32m+[m[32m@JsonClass(generateAdapter = true)[m
[32m+[m[32mdata class DocumentDto([m
[32m+[m[32m    @Json(name = "id") val id: String,[m
[32m+[m[32m    @Json(name = "title") val title: String,[m
[32m+[m[32m    // üü¢ TH√äM:[m
[32m+[m[32m    @Json(name = "description") val description: String? = null,[m
[32m+[m[32m    @Json(name = "type") val type: String,[m
[32m+[m[32m    @Json(name = "image_url") val imageUrl: String,[m
[32m+[m[32m    @Json(name = "file_url") val fileUrl: String? = null,[m
[32m+[m[32m    @Json(name = "downloads") val downloads: Int,[m
[32m+[m[32m    @Json(name = "rating") val rating: Float,[m
[32m+[m[32m    @Json(name = "author") val author: String,[m
[32m+[m[32m    @Json(name = "course_code") val courseCode: String[m
[32m+[m[32m)[m
[32m+[m
[32m+[m[32mfun DocumentDto.toDocumentEntity(): Document {[m
[32m+[m[32m    return Document([m
[32m+[m[32m        id = this.id,[m
[32m+[m[32m        title = this.title,[m
[32m+[m[32m        // üü¢ TH√äM:[m
[32m+[m[32m        description = this.description ?: "",[m
[32m+[m[32m        type = this.type,[m
[32m+[m[32m        imageUrl = this.imageUrl,[m
[32m+[m[32m        fileUrl = this.fileUrl ?: "",[m
[32m+[m[32m        downloads = this.downloads,[m
[32m+[m[32m        rating = this.rating.toDouble(),[m
[32m+[m[32m        author = this.author,[m
[32m+[m[32m        courseCode = this.courseCode,[m
[32m+[m[32m        createdAt = System.currentTimeMillis(),[m
[32m+[m[32m        authorId = null[m
[32m+[m[32m    )[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/core/data/repository/AdminRepository.kt b/app/src/main/java/com/example/stushare/core/data/repository/AdminRepository.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..ebe3b52[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/core/data/repository/AdminRepository.kt[m
[36m@@ -0,0 +1,149 @@[m
[32m+[m[32mpackage com.example.stushare.core.data.repository[m
[32m+[m
[32m+[m[32mimport com.example.stushare.core.data.models.Report // üü¢ Nh·ªõ import Model Report[m
[32m+[m[32mimport com.google.firebase.firestore.AggregateSource[m
[32m+[m[32mimport com.google.firebase.firestore.FirebaseFirestore[m
[32m+[m[32mimport com.google.firebase.storage.FirebaseStorage // üü¢ Th√™m c√°i n√†y ƒë·ªÉ x√≥a file[m
[32m+[m[32mimport kotlinx.coroutines.tasks.await[m
[32m+[m[32mimport javax.inject.Inject[m
[32m+[m
[32m+[m[32m// ==========================================[m
[32m+[m[32m// 1. DATA MODELS[m
[32m+[m[32m// ==========================================[m
[32m+[m
[32m+[m[32m// Data Model cho th·ªëng k√™ (Gi·ªØ nguy√™n c·ªßa b·∫°n)[m
[32m+[m[32mdata class AdminStats([m
[32m+[m[32m    val userCount: Long = 0,[m
[32m+[m[32m    val documentCount: Long = 0,[m
[32m+[m[32m    val requestCount: Long = 0[m
[32m+[m[32m)[m
[32m+[m
[32m+[m[32m// ==========================================[m
[32m+[m[32m// 2. INTERFACE[m
[32m+[m[32m// ==========================================[m
[32m+[m
[32m+[m[32minterface AdminRepository {[m
[32m+[m[32m    // --- Ph·∫ßn c≈©: Th·ªëng k√™ ---[m
[32m+[m[32m    suspend fun getSystemStats(): AdminStats[m
[32m+[m
[32m+[m[32m    // --- Ph·∫ßn m·ªõi: Qu·∫£n l√Ω B√°o c√°o ---[m
[32m+[m[32m    suspend fun getPendingReports(): Result<List<Report>>[m
[32m+[m[32m    suspend fun deleteDocumentAndResolveReport(documentId: String, reportId: String): Result<Unit>[m
[32m+[m[32m    suspend fun dismissReport(reportId: String): Result<Unit>[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m// ==========================================[m
[32m+[m[32m// 3. IMPLEMENTATION[m
[32m+[m[32m// ==========================================[m
[32m+[m
[32m+[m[32mclass AdminRepositoryImpl @Inject constructor([m
[32m+[m[32m    private val firestore: FirebaseFirestore,[m
[32m+[m[32m    private val storage: FirebaseStorage // üü¢ Inject th√™m Storage v√†o ƒë√¢y[m
[32m+[m[32m) : AdminRepository {[m
[32m+[m
[32m+[m[32m    // ----------------------------------------------------------------[m
[32m+[m[32m    // LOGIC C≈®: TH·ªêNG K√ä[m
[32m+[m[32m    // ----------------------------------------------------------------[m
[32m+[m[32m    override suspend fun getSystemStats(): AdminStats {[m
[32m+[m[32m        return try {[m
[32m+[m[32m            // AggregateSource.SERVER: ƒê·∫øm tr·ª±c ti·∫øp tr√™n server (Ti·∫øt ki·ªám bƒÉng th√¥ng)[m
[32m+[m[32m            val usersQuery = firestore.collection("users").count().get(AggregateSource.SERVER)[m
[32m+[m[32m            val docsQuery = firestore.collection("documents").count().get(AggregateSource.SERVER)[m
[32m+[m[32m            val requestsQuery = firestore.collection("requests").count().get(AggregateSource.SERVER)[m
[32m+[m
[32m+[m[32m            // Ch·ªù k·∫øt qu·∫£ song song[m
[32m+[m[32m            val userSnapshot = usersQuery.await()[m
[32m+[m[32m            val docSnapshot = docsQuery.await()[m
[32m+[m[32m            val reqSnapshot = requestsQuery.await()[m
[32m+[m
[32m+[m[32m            AdminStats([m
[32m+[m[32m                userCount = userSnapshot.count,[m
[32m+[m[32m                documentCount = docSnapshot.count,[m
[32m+[m[32m                requestCount = reqSnapshot.count[m
[32m+[m[32m            )[m
[32m+[m[32m        } catch (e: Exception) {[m
[32m+[m[32m            // Tr·∫£ v·ªÅ m·∫∑c ƒë·ªãnh n·∫øu l·ªói m·∫°ng[m
[32m+[m[32m            AdminStats()[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    // ----------------------------------------------------------------[m
[32m+[m[32m    // LOGIC M·ªöI: QU·∫¢N L√ù B√ÅO C√ÅO[m
[32m+[m[32m    // ----------------------------------------------------------------[m
[32m+[m
[32m+[m[32m    override suspend fun getPendingReports(): Result<List<Report>> {[m
[32m+[m[32m        return try {[m
[32m+[m[32m            val snapshot = firestore.collection("reports")[m
[32m+[m[32m                .whereEqualTo("status", "pending")[m
[32m+[m[32m                .orderBy("timestamp") // X·ª≠ l√Ω c√°i c≈© tr∆∞·ªõc[m
[32m+[m[32m                .get()[m
[32m+[m[32m                .await()[m
[32m+[m
[32m+[m[32m            val reports = snapshot.documents.map { doc ->[m
[32m+[m[32m                // √âp ki·ªÉu v·ªÅ Report object v√† g√°n ID c·ªßa document report v√†o[m
[32m+[m[32m                doc.toObject(Report::class.java)!!.copy(id = doc.id)[m
[32m+[m[32m            }[m
[32m+[m[32m            Result.success(reports)[m
[32m+[m[32m        } catch (e: Exception) {[m
[32m+[m[32m            Result.failure(e)[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    override suspend fun deleteDocumentAndResolveReport(documentId: String, reportId: String): Result<Unit> {[m
[32m+[m[32m        return try {[m
[32m+[m[32m            // 1. L·∫•y th√¥ng tin t√†i li·ªáu ƒë·ªÉ l·∫•y URL file/·∫£nh (c·∫ßn ƒë·ªÉ x√≥a tr√™n Storage)[m
[32m+[m[32m            val docSnapshot = firestore.collection("documents").document(documentId).get().await()[m
[32m+[m
[32m+[m[32m            if (docSnapshot.exists()) {[m
[32m+[m[32m                val fileUrl = docSnapshot.getString("fileUrl")[m
[32m+[m[32m                val imageUrl = docSnapshot.getString("imageUrl")[m
[32m+[m
[32m+[m[32m                // 2. X√≥a File PDF/Word tr√™n Storage (n·∫øu c√≥ v√† link h·ª£p l·ªá)[m
[32m+[m[32m                if (!fileUrl.isNullOrBlank() && fileUrl.startsWith("http")) {[m
[32m+[m[32m                    try {[m
[32m+[m[32m                        val fileRef = storage.getReferenceFromUrl(fileUrl)[m
[32m+[m[32m                        fileRef.delete().await()[m
[32m+[m[32m                    } catch (e: Exception) {[m
[32m+[m[32m                        // B·ªè qua l·ªói x√≥a file (v√≠ d·ª• file ƒë√£ b·ªã x√≥a th·ªß c√¥ng tr∆∞·ªõc ƒë√≥)[m
[32m+[m[32m                        // ƒë·ªÉ kh√¥ng ch·∫∑n quy tr√¨nh x√≥a data[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m
[32m+[m[32m                // 3. X√≥a ·∫¢nh b√¨a tr√™n Storage (tr·ª´ ·∫£nh m·∫∑c ƒë·ªãnh picsum)[m
[32m+[m[32m                if (!imageUrl.isNullOrBlank() && imageUrl.startsWith("http") && !imageUrl.contains("picsum")) {[m
[32m+[m[32m                    try {[m
[32m+[m[32m                        val imgRef = storage.getReferenceFromUrl(imageUrl)[m
[32m+[m[32m                        imgRef.delete().await()[m
[32m+[m[32m                    } catch (e: Exception) { /* B·ªè qua */ }[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            // 4. Transaction: X√≥a doc trong Firestore & C·∫≠p nh·∫≠t Report c√πng l√∫c[m
[32m+[m[32m            firestore.runTransaction { transaction ->[m
[32m+[m[32m                val docRef = firestore.collection("documents").document(documentId)[m
[32m+[m[32m                val reportRef = firestore.collection("reports").document(reportId)[m
[32m+[m
[32m+[m[32m                // X√≥a document[m
[32m+[m[32m                transaction.delete(docRef)[m
[32m+[m
[32m+[m[32m                // ƒê√°nh d·∫•u report ƒë√£ gi·∫£i quy·∫øt[m
[32m+[m[32m                transaction.update(reportRef, "status", "resolved")[m
[32m+[m[32m            }.await()[m
[32m+[m
[32m+[m[32m            Result.success(Unit)[m
[32m+[m[32m        } catch (e: Exception) {[m
[32m+[m[32m            Result.failure(e)[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    override suspend fun dismissReport(reportId: String): Result<Unit> {[m
[32m+[m[32m        return try {[m
[32m+[m[32m            firestore.collection("reports").document(reportId)[m
[32m+[m[32m                .update("status", "dismissed") // ƒê√°nh d·∫•u l√† ƒë√£ xem/b·ªè qua[m
[32m+[m[32m                .await()[m
[32m+[m[32m            Result.success(Unit)[m
[32m+[m[32m        } catch (e: Exception) {[m
[32m+[m[32m            Result.failure(e)[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/core/data/repository/DocumentRepository.kt b/app/src/main/java/com/example/stushare/core/data/repository/DocumentRepository.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..9a8bf88[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/core/data/repository/DocumentRepository.kt[m
[36m@@ -0,0 +1,81 @@[m
[32m+[m[32mpackage com.example.stushare.core.data.repository[m
[32m+[m
[32m+[m[32mimport android.net.Uri[m
[32m+[m[32mimport com.example.stushare.core.data.models.CommentEntity[m
[32m+[m[32mimport com.example.stushare.core.data.models.Document[m
[32m+[m[32mimport kotlinx.coroutines.flow.Flow[m
[32m+[m
[32m+[m[32m/**[m
[32m+[m[32m * Interface ƒë·ªãnh nghƒ©a c√°c h√†nh vi thao t√°c d·ªØ li·ªáu.[m
[32m+[m[32m */[m
[32m+[m[32minterface DocumentRepository {[m
[32m+[m
[32m+[m[32m    // ==========================================[m
[32m+[m[32m    // 1. TRUY V·∫§N D·ªÆ LI·ªÜU (READ)[m
[32m+[m[32m    // ==========================================[m
[32m+[m
[32m+[m[32m    fun getAllDocuments(): Flow<List<Document>>[m
[32m+[m
[32m+[m[32m    fun getDocumentById(documentId: String): Flow<Document>[m
[32m+[m
[32m+[m[32m    fun searchDocuments(query: String): Flow<List<Document>>[m
[32m+[m
[32m+[m[32m    fun getDocumentsByType(type: String): Flow<List<Document>>[m
[32m+[m
[32m+[m[32m    fun getDocumentsByAuthor(authorId: String): Flow<List<Document>>[m
[32m+[m
[32m+[m[32m    fun getBookmarkedDocuments(): Flow<List<Document>>[m
[32m+[m
[32m+[m
[32m+[m[32m    // ==========================================[m
[32m+[m[32m    // 2. ƒê·ªíNG B·ªò D·ªÆ LI·ªÜU (SYNC)[m
[32m+[m[32m    // ==========================================[m
[32m+[m
[32m+[m[32m    suspend fun refreshDocuments(): Result<Unit>[m
[32m+[m
[32m+[m[32m    suspend fun refreshDocumentsIfStale()[m
[32m+[m
[32m+[m
[32m+[m[32m    // ==========================================[m
[32m+[m[32m    // 3. T√ÅC V·ª§ D·ªÆ LI·ªÜU (WRITE/UPDATE)[m
[32m+[m[32m    // ==========================================[m
[32m+[m
[32m+[m[32m    suspend fun insertDocument(document: Document)[m
[32m+[m
[32m+[m[32m    suspend fun uploadDocument([m
[32m+[m[32m        title: String,[m
[32m+[m[32m        description: String,[m
[32m+[m[32m        fileUri: Uri,[m
[32m+[m[32m        mimeType: String,[m
[32m+[m[32m        coverUri: Uri?,[m
[32m+[m[32m        author: String,[m
[32m+[m[32m        type: String[m
[32m+[m[32m    ): Result<String>[m
[32m+[m
[32m+[m[32m    suspend fun deleteDocument(documentId: String): Result<Unit>[m
[32m+[m
[32m+[m[32m    suspend fun incrementDownloadCount(documentId: String, authorId: String?, docTitle: String): Result<Unit>[m
[32m+[m
[32m+[m[32m    // üü¢ M·ªöI: H√†m b√°o c√°o t√†i li·ªáu[m
[32m+[m[32m    suspend fun reportDocument(documentId: String, documentTitle: String, reason: String): Result<Unit>[m
[32m+[m
[32m+[m
[32m+[m[32m    // ==========================================[m
[32m+[m[32m    // 4. T∆Ø∆†NG T√ÅC NG∆Ø·ªúI D√ôNG (USER ACTIONS)[m
[32m+[m[32m    // ==========================================[m
[32m+[m
[32m+[m[32m    // --- Bookmark (L∆∞u tr·ªØ) ---[m
[32m+[m[32m    suspend fun isDocumentBookmarked(documentId: String): Result<Boolean>[m
[32m+[m
[32m+[m[32m    suspend fun toggleBookmark(documentId: String, isBookmarked: Boolean): Result<Unit>[m
[32m+[m
[32m+[m[32m    // --- Comment (B√¨nh lu·∫≠n) ---[m
[32m+[m[32m    fun getComments(documentId: String): Flow<List<CommentEntity>>[m
[32m+[m
[32m+[m[32m    suspend fun sendComment(documentId: String, content: String): Result<Unit>[m
[32m+[m
[32m+[m[32m    suspend fun deleteComment(documentId: String, commentId: String): Result<Unit>[m
[32m+[m
[32m+[m[32m    // --- Rating (ƒê√°nh gi√°) ---[m
[32m+[m[32m    suspend fun rateDocument(documentId: String, rating: Int): Result<Unit>[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/core/data/repository/DocumentRepositoryImpl.kt b/app/src/main/java/com/example/stushare/core/data/repository/DocumentRepositoryImpl.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..524002f[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/core/data/repository/DocumentRepositoryImpl.kt[m
[36m@@ -0,0 +1,418 @@[m
[32m+[m[32mpackage com.example.stushare.core.data.repository[m
[32m+[m
[32m+[m[32mimport android.net.Uri[m
[32m+[m[32mimport com.example.stushare.core.data.db.DocumentDao[m
[32m+[m[32mimport com.example.stushare.core.data.models.CommentEntity[m
[32m+[m[32mimport com.example.stushare.core.data.models.Document[m
[32m+[m[32mimport com.example.stushare.core.data.models.NotificationEntity[m
[32m+[m[32mimport com.example.stushare.core.data.network.models.ApiService[m
[32m+[m[32mimport com.example.stushare.core.utils.AppConstants[m
[32m+[m[32mimport com.example.stushare.core.utils.removeAccents[m
[32m+[m[32mimport com.google.firebase.auth.FirebaseAuth[m
[32m+[m[32mimport com.google.firebase.firestore.DocumentSnapshot[m
[32m+[m[32mimport com.google.firebase.firestore.FieldValue[m
[32m+[m[32mimport com.google.firebase.firestore.FirebaseFirestore[m
[32m+[m[32mimport com.google.firebase.firestore.Query[m
[32m+[m[32mimport com.google.firebase.storage.FirebaseStorage[m
[32m+[m[32mimport kotlinx.coroutines.Dispatchers[m
[32m+[m[32mimport kotlinx.coroutines.async[m
[32m+[m[32mimport kotlinx.coroutines.channels.awaitClose[m
[32m+[m[32mimport kotlinx.coroutines.coroutineScope[m
[32m+[m[32mimport kotlinx.coroutines.flow.Flow[m
[32m+[m[32mimport kotlinx.coroutines.flow.callbackFlow[m
[32m+[m[32mimport kotlinx.coroutines.flow.first[m
[32m+[m[32mimport kotlinx.coroutines.tasks.await[m
[32m+[m[32mimport kotlinx.coroutines.withContext[m
[32m+[m[32mimport java.util.UUID[m
[32m+[m[32mimport javax.inject.Inject[m
[32m+[m
[32m+[m[32mprivate const val CACHE_DURATION_MS = 15 * 60 * 1000 // 15 ph√∫t[m
[32m+[m
[32m+[m[32mclass DocumentRepositoryImpl @Inject constructor([m
[32m+[m[32m    private val documentDao: DocumentDao,[m
[32m+[m[32m    private val apiService: ApiService,[m
[32m+[m[32m    private val settingsRepository: SettingsRepository,[m
[32m+[m[32m    private val storage: FirebaseStorage,[m
[32m+[m[32m    private val firestore: FirebaseFirestore,[m
[32m+[m[32m    private val notificationRepository: NotificationRepository,[m
[32m+[m[32m    private val auth: FirebaseAuth[m
[32m+[m[32m) : DocumentRepository {[m
[32m+[m
[32m+[m[32m    // ==========================================[m
[32m+[m[32m    // 1. TRUY V·∫§N (READ)[m
[32m+[m[32m    // ==========================================[m
[32m+[m[32m    override fun getAllDocuments(): Flow<List<Document>> = documentDao.getAllDocuments()[m
[32m+[m[32m    override fun getDocumentById(documentId: String): Flow<Document> = documentDao.getDocumentById(documentId)[m
[32m+[m
[32m+[m[32m    override fun searchDocuments(query: String): Flow<List<Document>> {[m
[32m+[m[32m        val normalizedQuery = query.removeAccents()[m
[32m+[m[32m        return documentDao.searchDocuments(normalizedQuery)[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    override fun getDocumentsByType(type: String): Flow<List<Document>> = documentDao.getDocumentsByType(type)[m
[32m+[m
[32m+[m
[32m+[m[32m    // ==========================================[m
[32m+[m[32m    // 2. ƒê·ªíNG B·ªò D·ªÆ LI·ªÜU (SYNC)[m
[32m+[m[32m    // ==========================================[m
[32m+[m
[32m+[m[32m    override suspend fun refreshDocuments(): Result<Unit> {[m
[32m+[m[32m        return withContext(Dispatchers.IO) {[m
[32m+[m[32m            try {[m
[32m+[m[32m                coroutineScope {[m
[32m+[m[32m                    // 1. M·ªõi nh·∫•t[m
[32m+[m[32m                    val recentDeferred = async {[m
[32m+[m[32m                        firestore.collection("documents")[m
[32m+[m[32m                            .orderBy("uploadedAt", Query.Direction.DESCENDING)[m
[32m+[m[32m                            .limit(50)[m
[32m+[m[32m                            .get().await()[m
[32m+[m[32m                    }[m
[32m+[m
[32m+[m[32m                    // 2. √în thi[m
[32m+[m[32m                    val examDeferred = async {[m
[32m+[m[32m                        firestore.collection("documents")[m
[32m+[m[32m                            .whereEqualTo("type", AppConstants.TYPE_EXAM_PREP)[m
[32m+[m[32m                            .orderBy("uploadedAt", Query.Direction.DESCENDING)[m
[32m+[m[32m                            .limit(20)[m
[32m+[m[32m                            .get().await()[m
[32m+[m[32m                    }[m
[32m+[m
[32m+[m[32m                    // 3. S√°ch[m
[32m+[m[32m                    val bookDeferred = async {[m
[32m+[m[32m                        firestore.collection("documents")[m
[32m+[m[32m                            .whereEqualTo("type", "book")[m
[32m+[m[32m                            .orderBy("uploadedAt", Query.Direction.DESCENDING)[m
[32m+[m[32m                            .limit(20)[m
[32m+[m[32m                            .get().await()[m
[32m+[m[32m                    }[m
[32m+[m
[32m+[m[32m                    // 4. B√†i gi·∫£ng[m
[32m+[m[32m                    val lectureDeferred = async {[m
[32m+[m[32m                        firestore.collection("documents")[m
[32m+[m[32m                            .whereEqualTo("type", "lecture")[m
[32m+[m[32m                            .orderBy("uploadedAt", Query.Direction.DESCENDING)[m
[32m+[m[32m                            .limit(20)[m
[32m+[m[32m                            .get().await()[m
[32m+[m[32m                    }[m
[32m+[m
[32m+[m[32m                    val recentSnapshot = recentDeferred.await()[m
[32m+[m[32m                    val examSnapshot = examDeferred.await()[m
[32m+[m[32m                    val bookSnapshot = bookDeferred.await()[m
[32m+[m[32m                    val lectureSnapshot = lectureDeferred.await()[m
[32m+[m
[32m+[m[32m                    val allDocs = mutableSetOf<Document>()[m
[32m+[m
[32m+[m[32m                    recentSnapshot.documents.forEach { doc -> mapFirestoreToDocument(doc)?.let { allDocs.add(it) } }[m
[32m+[m[32m                    examSnapshot.documents.forEach { doc -> mapFirestoreToDocument(doc)?.let { allDocs.add(it) } }[m
[32m+[m[32m                    bookSnapshot.documents.forEach { doc -> mapFirestoreToDocument(doc)?.let { allDocs.add(it) } }[m
[32m+[m[32m                    lectureSnapshot.documents.forEach { doc -> mapFirestoreToDocument(doc)?.let { allDocs.add(it) } }[m
[32m+[m
[32m+[m[32m                    documentDao.insertAllDocuments(allDocs.toList())[m
[32m+[m[32m                    settingsRepository.updateLastRefreshTimestamp()[m
[32m+[m[32m                }[m
[32m+[m[32m                Result.success(Unit)[m
[32m+[m[32m            } catch (e: Exception) {[m
[32m+[m[32m                e.printStackTrace()[m
[32m+[m[32m                Result.failure(e)[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    override suspend fun refreshDocumentsIfStale() {[m
[32m+[m[32m        val lastRefresh = settingsRepository.lastRefreshTimestamp.first()[m
[32m+[m[32m        val currentTime = System.currentTimeMillis()[m
[32m+[m[32m        if ((currentTime - lastRefresh) > CACHE_DURATION_MS || lastRefresh == 0L) {[m
[32m+[m[32m            refreshDocuments()[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    private fun mapFirestoreToDocument(doc: DocumentSnapshot): Document? {[m
[32m+[m[32m        val data = doc.data ?: return null[m
[32m+[m[32m        val title = data["title"] as? String ?: ""[m
[32m+[m[32m        val uploadedAt = (data["uploadedAt"] as? Number)?.toLong() ?: System.currentTimeMillis()[m
[32m+[m
[32m+[m[32m        return Document([m
[32m+[m[32m            id = doc.getString("id") ?: doc.id,[m
[32m+[m[32m            title = title,[m
[32m+[m[32m            normalizedTitle = title.removeAccents(),[m
[32m+[m[32m            description = data["description"] as? String ?: "",[m
[32m+[m[32m            type = data["type"] as? String ?: "S√°ch",[m
[32m+[m[32m            imageUrl = data["imageUrl"] as? String ?: "",[m
[32m+[m[32m            fileUrl = data["fileUrl"] as? String ?: "",[m
[32m+[m[32m            downloads = (data["downloads"] as? Number)?.toInt() ?: 0,[m
[32m+[m[32m            rating = (data["rating"] as? Number)?.toDouble() ?: 0.0,[m
[32m+[m[32m            author = data["author"] as? String ?: data["authorName"] as? String ?: "·∫®n danh",[m
[32m+[m[32m            courseCode = data["courseCode"] as? String ?: "GEN",[m
[32m+[m[32m            authorId = data["authorId"] as? String,[m
[32m+[m[32m            createdAt = uploadedAt[m
[32m+[m[32m        )[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    // ==========================================[m
[32m+[m[32m    // 3. UPLOAD & WRITE[m
[32m+[m[32m    // ==========================================[m
[32m+[m
[32m+[m[32m    override suspend fun uploadDocument([m
[32m+[m[32m        title: String, description: String, fileUri: Uri, mimeType: String, coverUri: Uri?, author: String, type: String[m
[32m+[m[32m    ): Result<String> {[m
[32m+[m[32m        return withContext(Dispatchers.IO) {[m
[32m+[m[32m            try {[m
[32m+[m[32m                val currentUserId = auth.currentUser?.uid ?: return@withContext Result.failure(Exception("B·∫°n ch∆∞a ƒëƒÉng nh·∫≠p!"))[m
[32m+[m[32m                val uploaderName = auth.currentUser?.displayName ?: "·∫®n danh"[m
[32m+[m
[32m+[m[32m                val docExtension = if (mimeType.contains("pdf")) "pdf" else "docx"[m
[32m+[m[32m                val docFileName = "documents/${UUID.randomUUID()}.$docExtension"[m
[32m+[m[32m                val docRef = storage.reference.child(docFileName)[m
[32m+[m[32m                docRef.putFile(fileUri).await()[m
[32m+[m[32m                val fileDownloadUrl = docRef.downloadUrl.await().toString()[m
[32m+[m
[32m+[m[32m                val imageDownloadUrl = if (coverUri != null) {[m
[32m+[m[32m                    val imageFileName = "covers/${UUID.randomUUID()}.jpg"[m
[32m+[m[32m                    val imageRef = storage.reference.child(imageFileName)[m
[32m+[m[32m                    imageRef.putFile(coverUri).await()[m
[32m+[m[32m                    imageRef.downloadUrl.await().toString()[m
[32m+[m[32m                } else "https://picsum.photos/seed/${System.currentTimeMillis()}/200/300"[m
[32m+[m
[32m+[m[32m                val newId = UUID.randomUUID().toString()[m
[32m+[m[32m                val timestamp = System.currentTimeMillis()[m
[32m+[m
[32m+[m[32m                val documentMap = hashMapOf([m
[32m+[m[32m                    "id" to newId,[m
[32m+[m[32m                    "title" to title,[m
[32m+[m[32m                    "description" to description,[m
[32m+[m[32m                    "fileUrl" to fileDownloadUrl,[m
[32m+[m[32m                    "imageUrl" to imageDownloadUrl,[m
[32m+[m[32m                    "type" to type,[m
[32m+[m[32m                    "uploadedAt" to timestamp,[m
[32m+[m[32m                    "downloads" to 0,[m
[32m+[m[32m                    "rating" to 0.0,[m
[32m+[m[32m                    "ratingCount" to 0,[m
[32m+[m[32m                    "author" to author,[m
[32m+[m[32m                    "authorName" to uploaderName,[m
[32m+[m[32m                    "authorId" to currentUserId,[m
[32m+[m[32m                    "courseCode" to "GEN"[m
[32m+[m[32m                )[m
[32m+[m[32m                firestore.collection("documents").document(newId).set(documentMap).await()[m
[32m+[m
[32m+[m[32m                val newLocalDocument = Document([m
[32m+[m[32m                    id = newId, title = title, normalizedTitle = title.removeAccents(), type = type, description = description,[m
[32m+[m[32m                    imageUrl = imageDownloadUrl, fileUrl = fileDownloadUrl, downloads = 0, rating = 0.0,[m
[32m+[m[32m                    author = author, courseCode = "GEN", authorId = currentUserId,[m
[32m+[m[32m                    createdAt = timestamp[m
[32m+[m[32m                )[m
[32m+[m[32m                documentDao.insertDocument(newLocalDocument)[m
[32m+[m
[32m+[m[32m                notificationRepository.createNotification([m
[32m+[m[32m                    targetUserId = currentUserId,[m
[32m+[m[32m                    title = "ƒêƒÉng t·∫£i th√†nh c√¥ng ‚úÖ",[m
[32m+[m[32m                    message = "T√†i li·ªáu '$title' c·ªßa b·∫°n ƒë√£ ƒë∆∞·ª£c chia s·∫ª.",[m
[32m+[m[32m                    type = NotificationEntity.TYPE_UPLOAD,[m
[32m+[m[32m                    relatedId = newId[m
[32m+[m[32m                )[m
[32m+[m[32m                Result.success(newId)[m
[32m+[m[32m            } catch (e: Exception) { Result.failure(e) }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    override suspend fun incrementDownloadCount(documentId: String, authorId: String?, docTitle: String): Result<Unit> {[m
[32m+[m[32m        return withContext(Dispatchers.IO) {[m
[32m+[m[32m            try {[m
[32m+[m[32m                firestore.collection("documents").document(documentId).update("downloads", FieldValue.increment(1))[m
[32m+[m[32m                val localDoc = documentDao.getDocumentById(documentId).first()[m
[32m+[m[32m                if (localDoc != null) {[m
[32m+[m[32m                    documentDao.insertDocument(localDoc.copy(downloads = localDoc.downloads + 1))[m
[32m+[m[32m                }[m
[32m+[m[32m                val currentUserId = auth.currentUser?.uid[m
[32m+[m[32m                if (authorId != null && authorId != currentUserId) {[m
[32m+[m[32m                    notificationRepository.createNotification([m
[32m+[m[32m                        targetUserId = authorId,[m
[32m+[m[32m                        title = "T√†i li·ªáu ƒë∆∞·ª£c t·∫£i xu·ªëng üì•",[m
[32m+[m[32m                        message = "Ai ƒë√≥ v·ª´a t·∫£i t√†i li·ªáu '$docTitle' c·ªßa b·∫°n!",[m
[32m+[m[32m                        type = NotificationEntity.TYPE_DOWNLOAD,[m
[32m+[m[32m                        relatedId = documentId[m
[32m+[m[32m                    )[m
[32m+[m[32m                }[m
[32m+[m[32m                Result.success(Unit)[m
[32m+[m[32m            } catch (e: Exception) { Result.failure(e) }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    // üü¢ M·ªöI: Tri·ªÉn khai h√†m Report Document[m
[32m+[m[32m    override suspend fun reportDocument(documentId: String, documentTitle: String, reason: String): Result<Unit> {[m
[32m+[m[32m        return withContext(Dispatchers.IO) {[m
[32m+[m[32m            try {[m
[32m+[m[32m                val userId = auth.currentUser?.uid ?: return@withContext Result.failure(Exception("B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p ƒë·ªÉ b√°o c√°o."))[m
[32m+[m[32m                val reporterEmail = auth.currentUser?.email ?: "No email"[m
[32m+[m
[32m+[m[32m                val reportData = hashMapOf([m
[32m+[m[32m                    "documentId" to documentId,[m
[32m+[m[32m                    "documentTitle" to documentTitle, // L∆∞u t√™n ƒë·ªÉ Admin d·ªÖ nh√¨n[m
[32m+[m[32m                    "reporterId" to userId,[m
[32m+[m[32m                    "reporterEmail" to reporterEmail,[m
[32m+[m[32m                    "reason" to reason,[m
[32m+[m[32m                    "timestamp" to System.currentTimeMillis(),[m
[32m+[m[32m                    "status" to "pending" // Tr·∫°ng th√°i ch·ªù Admin duy·ªát[m
[32m+[m[32m                )[m
[32m+[m
[32m+[m[32m                // L∆∞u v√†o collection "reports"[m
[32m+[m[32m                firestore.collection("reports").add(reportData).await()[m
[32m+[m[32m                Result.success(Unit)[m
[32m+[m[32m            } catch (e: Exception) {[m
[32m+[m[32m                Result.failure(e)[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    // C√°c h√†m kh√°c gi·ªØ nguy√™n[m
[32m+[m[32m    override suspend fun insertDocument(document: Document) { withContext(Dispatchers.IO) { documentDao.insertDocument(document) } }[m
[32m+[m[32m    override suspend fun deleteDocument(documentId: String): Result<Unit> {[m
[32m+[m[32m        return withContext(Dispatchers.IO) {[m
[32m+[m[32m            try {[m
[32m+[m[32m                firestore.collection("documents").document(documentId).delete().await()[m
[32m+[m[32m                documentDao.deleteDocumentById(documentId)[m
[32m+[m[32m                Result.success(Unit)[m
[32m+[m[32m            } catch (e: Exception) { Result.failure(e) }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m    override suspend fun isDocumentBookmarked(documentId: String): Result<Boolean> {[m
[32m+[m[32m        return withContext(Dispatchers.IO) {[m
[32m+[m[32m            try {[m
[32m+[m[32m                val userId = auth.currentUser?.uid ?: return@withContext Result.success(false)[m
[32m+[m[32m                val doc = firestore.collection("users").document(userId).collection("bookmarks").document(documentId).get().await()[m
[32m+[m[32m                Result.success(doc.exists())[m
[32m+[m[32m            } catch (e: Exception) { Result.failure(e) }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m    override suspend fun toggleBookmark(documentId: String, isBookmarked: Boolean): Result<Unit> {[m
[32m+[m[32m        return withContext(Dispatchers.IO) {[m
[32m+[m[32m            try {[m
[32m+[m[32m                val userId = auth.currentUser?.uid ?: return@withContext Result.failure(Exception("Ch∆∞a ƒëƒÉng nh·∫≠p"))[m
[32m+[m[32m                val ref = firestore.collection("users").document(userId).collection("bookmarks").document(documentId)[m
[32m+[m[32m                if (isBookmarked) ref.set(mapOf("documentId" to documentId, "savedAt" to System.currentTimeMillis())).await()[m
[32m+[m[32m                else ref.delete().await()[m
[32m+[m[32m                Result.success(Unit)[m
[32m+[m[32m            } catch (e: Exception) { Result.failure(e) }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m    override fun getBookmarkedDocuments(): Flow<List<Document>> = callbackFlow {[m
[32m+[m[32m        val userId = auth.currentUser?.uid[m
[32m+[m[32m        if (userId == null) { trySend(emptyList()); close(); return@callbackFlow }[m
[32m+[m[32m        val subscription = firestore.collection("users").document(userId).collection("bookmarks").orderBy("savedAt", Query.Direction.DESCENDING).addSnapshotListener { snapshot, error ->[m
[32m+[m[32m            if (error != null) { close(error); return@addSnapshotListener }[m
[32m+[m[32m            if (snapshot != null) {[m
[32m+[m[32m                val ids = snapshot.documents.mapNotNull { it.getString("documentId") }[m
[32m+[m[32m                if (ids.isEmpty()) trySend(emptyList())[m
[32m+[m[32m                else {[m
[32m+[m[32m                    firestore.collection("documents").whereIn("id", ids.take(10)).get().addOnSuccessListener { docsSnapshot ->[m
[32m+[m[32m                        val docs = docsSnapshot.documents.mapNotNull { mapFirestoreToDocument(it) }[m
[32m+[m[32m                        trySend(docs)[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m        awaitClose { subscription.remove() }[m
[32m+[m[32m    }[m
[32m+[m[32m    override suspend fun sendComment(documentId: String, content: String): Result<Unit> {[m
[32m+[m[32m        return withContext(Dispatchers.IO) {[m
[32m+[m[32m            try {[m
[32m+[m[32m                val user = auth.currentUser ?: return@withContext Result.failure(Exception("Ch∆∞a ƒëƒÉng nh·∫≠p"))[m
[32m+[m[32m                val docSnapshot = firestore.collection("documents").document(documentId).get().await()[m
[32m+[m[32m                val authorId = docSnapshot.getString("authorId")[m
[32m+[m[32m                val docTitle = docSnapshot.getString("title") ?: "T√†i li·ªáu"[m
[32m+[m[32m                val commentData = hashMapOf("documentId" to documentId, "userId" to user.uid, "userName" to (user.displayName ?: "Sinh vi√™n"), "userAvatar" to user.photoUrl?.toString(), "content" to content, "timestamp" to FieldValue.serverTimestamp())[m
[32m+[m[32m                firestore.collection("documents").document(documentId).collection("comments").add(commentData).await()[m
[32m+[m[32m                if (authorId != null && authorId != user.uid) {[m
[32m+[m[32m                    notificationRepository.createNotification(targetUserId = authorId, title = "B√¨nh lu·∫≠n m·ªõi üí¨", message = "${user.displayName ?: "Ai ƒë√≥"} ƒë√£ b√¨nh lu·∫≠n v√†o t√†i li·ªáu '$docTitle': \"$content\"", type = NotificationEntity.TYPE_COMMENT, relatedId = documentId)[m
[32m+[m[32m                }[m
[32m+[m[32m                Result.success(Unit)[m
[32m+[m[32m            } catch (e: Exception) { Result.failure(e) }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m    override fun getComments(documentId: String): Flow<List<CommentEntity>> = callbackFlow {[m
[32m+[m[32m        val subscription = firestore.collection("documents").document(documentId).collection("comments").orderBy("timestamp", Query.Direction.DESCENDING).addSnapshotListener { snapshot, error ->[m
[32m+[m[32m            if (error != null) { close(error); return@addSnapshotListener }[m
[32m+[m[32m            if (snapshot != null) {[m
[32m+[m[32m                val comments = snapshot.documents.mapNotNull { doc ->[m
[32m+[m[32m                    val timestamp = doc.getTimestamp("timestamp")?.toDate()[m
[32m+[m[32m                    CommentEntity(id = doc.id, documentId = doc.getString("documentId") ?: "", userId = doc.getString("userId") ?: "", userName = doc.getString("userName") ?: "·∫®n danh", userAvatar = doc.getString("userAvatar"), content = doc.getString("content") ?: "", timestamp = timestamp)[m
[32m+[m[32m                }[m
[32m+[m[32m                trySend(comments)[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m        awaitClose { subscription.remove() }[m
[32m+[m[32m    }[m
[32m+[m[32m    override suspend fun deleteComment(documentId: String, commentId: String): Result<Unit> {[m
[32m+[m[32m        return withContext(Dispatchers.IO) {[m
[32m+[m[32m            try {[m
[32m+[m[32m                firestore.collection("documents").document(documentId).collection("comments").document(commentId).delete().await()[m
[32m+[m[32m                Result.success(Unit)[m
[32m+[m[32m            } catch (e: Exception) { Result.failure(e) }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m    override suspend fun rateDocument(documentId: String, rating: Int): Result<Unit> {[m
[32m+[m[32m        return withContext(Dispatchers.IO) {[m
[32m+[m[32m            try {[m
[32m+[m[32m                val userId = auth.currentUser?.uid ?: return@withContext Result.failure(Exception("Ch∆∞a ƒëƒÉng nh·∫≠p"))[m
[32m+[m[32m                val docRef = firestore.collection("documents").document(documentId)[m
[32m+[m[32m                val userRatingRef = docRef.collection("ratings").document(userId)[m
[32m+[m
[32m+[m[32m                var finalNewAverage = 0.0[m
[32m+[m[32m                var docTitle = ""[m
[32m+[m[32m                var docAuthorId = ""[m
[32m+[m
[32m+[m[32m                firestore.runTransaction { transaction ->[m
[32m+[m[32m                    val snapshot = transaction.get(docRef)[m
[32m+[m[32m                    docTitle = snapshot.getString("title") ?: "T√†i li·ªáu"[m
[32m+[m[32m                    docAuthorId = snapshot.getString("authorId") ?: ""[m
[32m+[m
[32m+[m[32m                    val currentRating = snapshot.getDouble("rating") ?: 0.0[m
[32m+[m[32m                    val ratingCount = snapshot.getLong("ratingCount") ?: 0[m
[32m+[m
[32m+[m[32m                    val userRatingSnapshot = transaction.get(userRatingRef)[m
[32m+[m[32m                    val oldRating = if (userRatingSnapshot.exists()) userRatingSnapshot.getLong("value")?.toInt() ?: 0 else 0[m
[32m+[m
[32m+[m[32m                    var newCount = ratingCount[m
[32m+[m[32m                    if (oldRating == 0) newCount = ratingCount + 1[m
[32m+[m[32m                    if (newCount == 0L) newCount = 1[m
[32m+[m
[32m+[m[32m                    val totalOldScore = currentRating * ratingCount[m
[32m+[m[32m                    val newTotalScore = totalOldScore - oldRating + rating[m
[32m+[m[32m                    finalNewAverage = newTotalScore / newCount.toDouble()[m
[32m+[m
[32m+[m[32m                    transaction.set(userRatingRef, mapOf("value" to rating, "userId" to userId))[m
[32m+[m[32m                    transaction.update(docRef, "rating", finalNewAverage)[m
[32m+[m[32m                    transaction.update(docRef, "ratingCount", newCount)[m
[32m+[m[32m                }.await()[m
[32m+[m
[32m+[m[32m                val currentLocalDoc = documentDao.getDocumentById(documentId).first()[m
[32m+[m[32m                if (currentLocalDoc != null) {[m
[32m+[m[32m                    val updatedDoc = currentLocalDoc.copy(rating = finalNewAverage)[m
[32m+[m[32m                    documentDao.insertDocument(updatedDoc)[m
[32m+[m[32m                }[m
[32m+[m
[32m+[m[32m                if (docAuthorId.isNotEmpty() && docAuthorId != userId) {[m
[32m+[m[32m                    notificationRepository.createNotification([m
[32m+[m[32m                        targetUserId = docAuthorId,[m
[32m+[m[32m                        title = "ƒê√°nh gi√° m·ªõi ‚≠êÔ∏è",[m
[32m+[m[32m                        message = "T√†i li·ªáu '$docTitle' v·ª´a nh·∫≠n ƒë∆∞·ª£c $rating sao.",[m
[32m+[m[32m                        type = NotificationEntity.TYPE_RATING,[m
[32m+[m[32m                        relatedId = documentId[m
[32m+[m[32m                    )[m
[32m+[m[32m                }[m
[32m+[m
[32m+[m[32m                Result.success(Unit)[m
[32m+[m[32m            } catch (e: Exception) { Result.failure(e) }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m    override fun getDocumentsByAuthor(authorId: String): Flow<List<Document>> = callbackFlow {[m
[32m+[m[32m        val query = firestore.collection("documents").whereEqualTo("authorId", authorId)[m
[32m+[m[32m        val listener = query.addSnapshotListener { snapshot, error ->[m
[32m+[m[32m            if (error != null) { close(error); return@addSnapshotListener }[m
[32m+[m[32m            if (snapshot != null) {[m
[32m+[m[32m                val docs = snapshot.documents.mapNotNull { mapFirestoreToDocument(it) }[m
[32m+[m[32m                trySend(docs)[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m        awaitClose { listener.remove() }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/core/data/repository/LeaderboardRepository.kt b/app/src/main/java/com/example/stushare/core/data/repository/LeaderboardRepository.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..c1b253b[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/core/data/repository/LeaderboardRepository.kt[m
[36m@@ -0,0 +1,19 @@[m
[32m+[m[32mpackage com.example.stushare.core.data.repository[m
[32m+[m
[32m+[m[32mimport com.example.stushare.core.data.models.Document[m
[32m+[m[32mimport com.example.stushare.core.data.models.UserEntity[m
[32m+[m[32mimport kotlinx.coroutines.flow.Flow[m
[32m+[m
[32m+[m[32minterface LeaderboardRepository {[m
[32m+[m[32m    // L·∫•y danh s√°ch Top ng∆∞·ªùi d√πng[m
[32m+[m[32m    fun getTopUsers(): Flow<List<UserEntity>>[m
[32m+[m
[32m+[m[32m    // L·∫•y danh s√°ch Top t√†i li·ªáu (d·ª±a tr√™n l∆∞·ª£t t·∫£i)[m
[32m+[m[32m    fun getTopDocuments(): Flow<List<Document>>[m
[32m+[m
[32m+[m[32m    // H√†m c·∫≠p nh·∫≠t ƒëi·ªÉm cho User (d√πng khi h·ªç upload t√†i li·ªáu th√†nh c√¥ng)[m
[32m+[m[32m    suspend fun updateUserContribution(userId: String, points: Int)[m
[32m+[m
[32m+[m[32m    // --- B·∫†N C·∫¶N TH√äM D√íNG N√ÄY ---[m
[32m+[m[32m    suspend fun refreshLeaderboard()[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/core/data/repository/LeaderboardRepositoryImpl.kt b/app/src/main/java/com/example/stushare/core/data/repository/LeaderboardRepositoryImpl.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..e3cfca6[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/core/data/repository/LeaderboardRepositoryImpl.kt[m
[36m@@ -0,0 +1,80 @@[m
[32m+[m[32mpackage com.example.stushare.core.data.repository[m
[32m+[m
[32m+[m[32mimport android.util.Log[m
[32m+[m[32mimport com.example.stushare.core.data.db.DocumentDao[m
[32m+[m[32mimport com.example.stushare.core.data.db.UserDao[m
[32m+[m[32mimport com.example.stushare.core.data.models.Document[m
[32m+[m[32mimport com.example.stushare.core.data.models.UserEntity[m
[32m+[m[32mimport com.google.firebase.firestore.FirebaseFirestore[m
[32m+[m[32mimport com.google.firebase.firestore.Query[m
[32m+[m[32mimport kotlinx.coroutines.flow.Flow[m
[32m+[m[32mimport kotlinx.coroutines.tasks.await[m
[32m+[m[32mimport javax.inject.Inject[m
[32m+[m
[32m+[m[32mclass LeaderboardRepositoryImpl @Inject constructor([m
[32m+[m[32m    private val userDao: UserDao,[m
[32m+[m[32m    private val documentDao: DocumentDao,[m
[32m+[m[32m    private val firestore: FirebaseFirestore[m
[32m+[m[32m) : LeaderboardRepository {[m
[32m+[m
[32m+[m[32m    override fun getTopUsers(): Flow<List<UserEntity>> {[m
[32m+[m[32m        // L·∫•y d·ªØ li·ªáu t·ª´ Local Database (Room)[m
[32m+[m[32m        return userDao.getTopUsers()[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    override fun getTopDocuments(): Flow<List<Document>> {[m
[32m+[m[32m        return documentDao.getTopDocuments()[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    override suspend fun updateUserContribution(userId: String, points: Int) {[m
[32m+[m[32m        // 1. C·∫≠p nh·∫≠t v√†o Room (Local)[m
[32m+[m[32m        val user = userDao.getUserById(userId)[m
[32m+[m[32m        if (user != null) {[m
[32m+[m[32m            val updatedUser = user.copy(contributionPoints = user.contributionPoints + points)[m
[32m+[m[32m            userDao.insertUser(updatedUser)[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        // 2. C·∫≠p nh·∫≠t l√™n Firestore[m
[32m+[m[32m        try {[m
[32m+[m[32m            firestore.collection("users").document(userId)[m
[32m+[m[32m                .update("contributionPoints", com.google.firebase.firestore.FieldValue.increment(points.toLong()))[m
[32m+[m[32m                .await()[m
[32m+[m[32m        } catch (e: Exception) {[m
[32m+[m[32m            Log.e("LeaderboardRepo", "L·ªói khi c·∫≠p nh·∫≠t ƒëi·ªÉm l√™n Firestore: ${e.message}")[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    override suspend fun refreshLeaderboard() {[m
[32m+[m[32m        try {[m
[32m+[m[32m            // 1. L·∫•y Top 20 user c√≥ ƒëi·ªÉm cao nh·∫•t t·ª´ Firestore[m
[32m+[m[32m            val snapshot = firestore.collection("users")[m
[32m+[m[32m                .orderBy("contributionPoints", Query.Direction.DESCENDING)[m
[32m+[m[32m                .limit(20)[m
[32m+[m[32m                .get()[m
[32m+[m[32m                .await()[m
[32m+[m
[32m+[m[32m            // 2. Chuy·ªÉn ƒë·ªïi d·ªØ li·ªáu[m
[32m+[m[32m            val userList = snapshot.documents.mapNotNull { doc ->[m
[32m+[m[32m                UserEntity([m
[32m+[m[32m                    id = doc.id,[m
[32m+[m[32m                    fullName = doc.getString("fullName") ?: "Unknown User",[m
[32m+[m[32m                    // --- ƒê√É S·ª¨A: Th√™m email v√† x√≥a rank ---[m
[32m+[m[32m                    email = doc.getString("email") ?: "",[m
[32m+[m[32m                    avatarUrl = doc.getString("avatarUrl"),[m
[32m+[m[32m                    contributionPoints = doc.getLong("contributionPoints")?.toInt() ?: 0[m
[32m+[m[32m                )[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            // 3. L∆∞u v√†o Room Database[m
[32m+[m[32m            if (userList.isNotEmpty()) {[m
[32m+[m[32m                // --- ƒê√É S·ª¨A: D√πng v√≤ng l·∫∑p ƒë·ªÉ tr√°nh l·ªói n·∫øu DAO ch∆∞a c√≥ h√†m insert list ---[m
[32m+[m[32m                userList.forEach { user ->[m
[32m+[m[32m                    userDao.insertUser(user)[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m        } catch (e: Exception) {[m
[32m+[m[32m            Log.e("LeaderboardRepo", "L·ªói khi t·∫£i b·∫£ng x·∫øp h·∫°ng: ${e.message}")[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/core/data/repository/NotificationRepository.kt b/app/src/main/java/com/example/stushare/core/data/repository/NotificationRepository.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..ecd98ca[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/core/data/repository/NotificationRepository.kt[m
[36m@@ -0,0 +1,27 @@[m
[32m+[m[32mpackage com.example.stushare.core.data.repository[m
[32m+[m
[32m+[m[32mimport com.example.stushare.core.data.models.NotificationEntity[m
[32m+[m[32mimport kotlinx.coroutines.flow.Flow[m
[32m+[m
[32m+[m[32minterface NotificationRepository {[m
[32m+[m[32m    // L·∫•y danh s√°ch th√¥ng b√°o[m
[32m+[m[32m    fun getNotifications(): Flow<List<NotificationEntity>>[m
[32m+[m
[32m+[m[32m    // L·∫•y s·ªë l∆∞·ª£ng tin ch∆∞a ƒë·ªçc[m
[32m+[m[32m    fun getUnreadCount(): Flow<Int>[m
[32m+[m
[32m+[m[32m    // T·∫°o th√¥ng b√°o m·ªõi[m
[32m+[m[32m    // üÜï C·∫¨P NH·∫¨T: Th√™m tham s·ªë relatedId (ƒë·ªÉ bi·∫øt link t·ªõi t√†i li·ªáu n√†o)[m
[32m+[m[32m    suspend fun createNotification([m
[32m+[m[32m        targetUserId: String,[m
[32m+[m[32m        title: String,[m
[32m+[m[32m        message: String,[m
[32m+[m[32m        type: String,[m
[32m+[m[32m        relatedId: String? = null // Cho ph√©p null[m
[32m+[m[32m    )[m
[32m+[m
[32m+[m[32m    // C√°c h√†m thao t√°c kh√°c gi·ªØ nguy√™n[m
[32m+[m[32m    suspend fun markAsRead(id: String)[m
[32m+[m[32m    suspend fun markAllAsRead()[m
[32m+[m[32m    suspend fun deleteNotification(id: String)[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/core/data/repository/NotificationRepositoryImpl.kt b/app/src/main/java/com/example/stushare/core/data/repository/NotificationRepositoryImpl.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..fd4e096[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/core/data/repository/NotificationRepositoryImpl.kt[m
[36m@@ -0,0 +1,222 @@[m
[32m+[m[32mpackage com.example.stushare.core.data.repository[m
[32m+[m
[32m+[m[32mimport android.util.Log[m
[32m+[m[32mimport com.example.stushare.core.data.db.NotificationDao[m
[32m+[m[32mimport com.example.stushare.core.data.models.NotificationEntity[m
[32m+[m[32mimport com.google.firebase.auth.FirebaseAuth[m
[32m+[m[32mimport com.google.firebase.firestore.FirebaseFirestore[m
[32m+[m[32mimport com.google.firebase.firestore.ListenerRegistration[m
[32m+[m[32mimport com.google.firebase.firestore.Query[m
[32m+[m[32mimport kotlinx.coroutines.CoroutineScope[m
[32m+[m[32mimport kotlinx.coroutines.Dispatchers[m
[32m+[m[32mimport kotlinx.coroutines.flow.Flow[m
[32m+[m[32mimport kotlinx.coroutines.flow.emptyFlow[m
[32m+[m[32mimport kotlinx.coroutines.launch[m
[32m+[m[32mimport kotlinx.coroutines.tasks.await[m
[32m+[m[32mimport kotlinx.coroutines.withContext[m
[32m+[m[32mimport java.util.UUID[m
[32m+[m[32mimport javax.inject.Inject[m
[32m+[m
[32m+[m[32mclass NotificationRepositoryImpl @Inject constructor([m
[32m+[m[32m    private val notificationDao: NotificationDao,[m
[32m+[m[32m    private val firestore: FirebaseFirestore,[m
[32m+[m[32m    private val auth: FirebaseAuth[m
[32m+[m[32m) : NotificationRepository {[m
[32m+[m
[32m+[m[32m    private var isListening = false[m
[32m+[m[32m    // üü¢ M·ªöI: Bi·∫øn theo d√µi User hi·ªán t·∫°i ƒëang l·∫Øng nghe[m
[32m+[m[32m    private var currentUserIdListening: String? = null[m
[32m+[m[32m    // üü¢ M·ªöI: Bi·∫øn gi·ªØ listener ƒë·ªÉ h·ªßy khi c·∫ßn thi·∫øt (tr√°nh r√≤ r·ªâ b·ªô nh·ªõ)[m
[32m+[m[32m    private var listenerRegistration: ListenerRegistration? = null[m
[32m+[m
[32m+[m[32m    // =========================================================================[m
[32m+[m[32m    // 1. L·∫§Y DANH S√ÅCH TH√îNG B√ÅO (REALTIME)[m
[32m+[m[32m    // =========================================================================[m
[32m+[m[32m    override fun getNotifications(): Flow<List<NotificationEntity>> {[m
[32m+[m[32m        val currentUser = auth.currentUser[m
[32m+[m[32m        if (currentUser == null) return emptyFlow()[m
[32m+[m
[32m+[m[32m        // üü¢ S·ª¨A L·ªñI QUAN TR·ªåNG: Ki·ªÉm tra n·∫øu User thay ƒë·ªïi -> Reset listener[m
[32m+[m[32m        if (currentUserIdListening != currentUser.uid) {[m
[32m+[m[32m            Log.d("NOTIF_DEBUG", "üîÑ Ph√°t hi·ªán ƒë·ªïi User (C≈©: $currentUserIdListening -> M·ªõi: ${currentUser.uid}). Reset Listener.")[m
[32m+[m
[32m+[m[32m            // H·ªßy listener c≈© n·∫øu c√≥[m
[32m+[m[32m            listenerRegistration?.remove()[m
[32m+[m[32m            isListening = false[m
[32m+[m[32m            currentUserIdListening = currentUser.uid[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        // K√≠ch ho·∫°t l·∫Øng nghe Realtime t·ª´ Firestore[m
[32m+[m[32m        startRealtimeSync(currentUser.uid)[m
[32m+[m
[32m+[m[32m        // Tr·∫£ v·ªÅ d·ªØ li·ªáu t·ª´ Local Room[m
[32m+[m[32m        return notificationDao.getNotifications(currentUser.uid)[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    override fun getUnreadCount(): Flow<Int> {[m
[32m+[m[32m        val userId = auth.currentUser?.uid ?: return emptyFlow()[m
[32m+[m[32m        return notificationDao.getUnreadCount(userId)[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    // =========================================================================[m
[32m+[m[32m    // 2. T·∫†O TH√îNG B√ÅO M·ªöI[m
[32m+[m[32m    // =========================================================================[m
[32m+[m[32m    override suspend fun createNotification([m
[32m+[m[32m        targetUserId: String,[m
[32m+[m[32m        title: String,[m
[32m+[m[32m        message: String,[m
[32m+[m[32m        type: String,[m
[32m+[m[32m        relatedId: String?[m
[32m+[m[32m    ) {[m
[32m+[m[32m        withContext(Dispatchers.IO) {[m
[32m+[m[32m            try {[m
[32m+[m[32m                val newId = UUID.randomUUID().toString()[m
[32m+[m[32m                val timestamp = System.currentTimeMillis()[m
[32m+[m
[32m+[m[32m                // 1. T·∫°o Entity ƒë·ªÉ l∆∞u Local[m
[32m+[m[32m                val notificationEntity = NotificationEntity([m
[32m+[m[32m                    id = newId,[m
[32m+[m[32m                    title = title,[m
[32m+[m[32m                    message = message,[m
[32m+[m[32m                    timestamp = timestamp,[m
[32m+[m[32m                    userId = targetUserId,[m
[32m+[m[32m                    type = type,[m
[32m+[m[32m                    isRead = false,[m
[32m+[m[32m                    relatedId = relatedId[m
[32m+[m[32m                )[m
[32m+[m
[32m+[m[32m                // 2. T·∫°o Map ƒë·ªÉ l∆∞u Firestore (ƒê·∫£m b·∫£o c√≥ relatedId)[m
[32m+[m[32m                val firestoreData = hashMapOf([m
[32m+[m[32m                    "id" to newId,[m
[32m+[m[32m                    "title" to title,[m
[32m+[m[32m                    "message" to message,[m
[32m+[m[32m                    "timestamp" to timestamp,[m
[32m+[m[32m                    "userId" to targetUserId,[m
[32m+[m[32m                    "type" to type,[m
[32m+[m[32m                    "isRead" to false,[m
[32m+[m[32m                    "relatedId" to relatedId[m
[32m+[m[32m                )[m
[32m+[m
[32m+[m[32m                Log.d("NOTIF_DEBUG", "üì§ ƒêang g·ª≠i th√¥ng b√°o ƒë·∫øn: $targetUserId | relatedId: $relatedId")[m
[32m+[m
[32m+[m[32m                // A. L∆∞u l√™n Cloud (Firestore)[m
[32m+[m[32m                firestore.collection("users")[m
[32m+[m[32m                    .document(targetUserId)[m
[32m+[m[32m                    .collection("notifications")[m
[32m+[m[32m                    .document(newId)[m
[32m+[m[32m                    .set(firestoreData)[m
[32m+[m[32m                    .await()[m
[32m+[m
[32m+[m[32m                Log.d("NOTIF_DEBUG", "‚úÖ G·ª≠i th√†nh c√¥ng l√™n Cloud")[m
[32m+[m
[32m+[m[32m                // B. N·∫øu g·ª≠i cho ch√≠nh m√¨nh -> L∆∞u lu√¥n v√†o Local[m
[32m+[m[32m                if (targetUserId == auth.currentUser?.uid) {[m
[32m+[m[32m                    notificationDao.insertNotification(notificationEntity)[m
[32m+[m[32m                }[m
[32m+[m
[32m+[m[32m            } catch (e: Exception) {[m
[32m+[m[32m                e.printStackTrace()[m
[32m+[m[32m                Log.e("NOTIF_DEBUG", "‚ùå L·ªói t·∫°o th√¥ng b√°o: ${e.message}")[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    // =========================================================================[m
[32m+[m[32m    // 3. C√ÅC H√ÄM THAO T√ÅC KH√ÅC[m
[32m+[m[32m    // =========================================================================[m
[32m+[m[32m    override suspend fun markAsRead(id: String) {[m
[32m+[m[32m        withContext(Dispatchers.IO) {[m
[32m+[m[32m            notificationDao.markAsRead(id)[m
[32m+[m[32m            updateReadStatusOnCloud(id, true)[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    override suspend fun markAllAsRead() {[m
[32m+[m[32m        val userId = auth.currentUser?.uid ?: return[m
[32m+[m[32m        withContext(Dispatchers.IO) {[m
[32m+[m[32m            notificationDao.markAllAsRead(userId)[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    override suspend fun deleteNotification(id: String) {[m
[32m+[m[32m        withContext(Dispatchers.IO) {[m
[32m+[m[32m            notificationDao.deleteNotification(id)[m
[32m+[m[32m            updateReadStatusOnCloud(id, null) // Null = X√≥a[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    // =========================================================================[m
[32m+[m[32m    // 4. PRIVATE HELPERS (ƒê·ªìng b·ªô ng·∫ßm)[m
[32m+[m[32m    // =========================================================================[m
[32m+[m
[32m+[m[32m    private fun startRealtimeSync(userId: String) {[m
[32m+[m[32m        if (isListening) return[m
[32m+[m[32m        isListening = true[m
[32m+[m[32m        Log.d("NOTIF_DEBUG", "üéß B·∫Øt ƒë·∫ßu l·∫Øng nghe th√¥ng b√°o cho User: $userId")[m
[32m+[m
[32m+[m[32m        // üü¢ G√°n listener v√†o bi·∫øn ƒë·ªÉ qu·∫£n l√Ω v√≤ng ƒë·ªùi[m
[32m+[m[32m        listenerRegistration = firestore.collection("users")[m
[32m+[m[32m            .document(userId)[m
[32m+[m[32m            .collection("notifications")[m
[32m+[m[32m            .orderBy("timestamp", Query.Direction.DESCENDING)[m
[32m+[m[32m            .limit(50)[m
[32m+[m[32m            .addSnapshotListener { snapshot, e ->[m
[32m+[m[32m                if (e != null) {[m
[32m+[m[32m                    isListening = false[m
[32m+[m[32m                    Log.e("NOTIF_DEBUG", "‚ùå L·ªói l·∫Øng nghe Realtime: ${e.message}")[m
[32m+[m[32m                    return@addSnapshotListener[m
[32m+[m[32m                }[m
[32m+[m
[32m+[m[32m                if (snapshot != null && !snapshot.isEmpty) {[m
[32m+[m[32m                    Log.d("NOTIF_DEBUG", "üì• Nh·∫≠n ƒë∆∞·ª£c ${snapshot.size()} th√¥ng b√°o t·ª´ Cloud")[m
[32m+[m
[32m+[m[32m                    CoroutineScope(Dispatchers.IO).launch {[m
[32m+[m[32m                        val notifications = snapshot.documents.mapNotNull { doc ->[m
[32m+[m[32m                            val id = doc.getString("id") ?: doc.id[m
[32m+[m[32m                            val title = doc.getString("title") ?: ""[m
[32m+[m[32m                            val message = doc.getString("message") ?: ""[m
[32m+[m[32m                            val type = doc.getString("type") ?: "SYSTEM"[m
[32m+[m[32m                            val timestamp = doc.getLong("timestamp") ?: System.currentTimeMillis()[m
[32m+[m[32m                            val isRead = doc.getBoolean("isRead") ?: false[m
[32m+[m[32m                            val relatedId = doc.getString("relatedId")[m
[32m+[m
[32m+[m[32m                            NotificationEntity([m
[32m+[m[32m                                id = id,[m
[32m+[m[32m                                title = title,[m
[32m+[m[32m                                message = message,[m
[32m+[m[32m                                timestamp = timestamp,[m
[32m+[m[32m                                userId = userId,[m
[32m+[m[32m                                type = type,[m
[32m+[m[32m                                isRead = isRead,[m
[32m+[m[32m                                relatedId = relatedId[m
[32m+[m[32m                            )[m
[32m+[m[32m                        }[m
[32m+[m[32m                        // L∆∞u danh s√°ch m·ªõi v√†o Room -> UI s·∫Ω t·ª± c·∫≠p nh·∫≠t[m
[32m+[m[32m                        notifications.forEach {[m
[32m+[m[32m                            notificationDao.insertNotification(it)[m
[32m+[m[32m                        }[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    private fun updateReadStatusOnCloud(notifId: String, isRead: Boolean?) {[m
[32m+[m[32m        val userId = auth.currentUser?.uid ?: return[m
[32m+[m[32m        CoroutineScope(Dispatchers.IO).launch {[m
[32m+[m[32m            try {[m
[32m+[m[32m                val ref = firestore.collection("users")[m
[32m+[m[32m                    .document(userId)[m
[32m+[m[32m                    .collection("notifications")[m
[32m+[m[32m                    .document(notifId)[m
[32m+[m
[32m+[m[32m                if (isRead == null) {[m
[32m+[m[32m                    ref.delete()[m
[32m+[m[32m                } else {[m
[32m+[m[32m                    ref.update("isRead", isRead)[m
[32m+[m[32m                }[m
[32m+[m[32m            } catch (e: Exception) {[m
[32m+[m[32m                e.printStackTrace()[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/core/data/repository/RequestRepository.kt b/app/src/main/java/com/example/stushare/core/data/repository/RequestRepository.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..689aa9c[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/core/data/repository/RequestRepository.kt[m
[36m@@ -0,0 +1,22 @@[m
[32m+[m[32mpackage com.example.stushare.core.data.repository[m
[32m+[m
[32m+[m[32mimport com.example.stushare.core.data.models.CommentEntity[m
[32m+[m[32mimport com.example.stushare.core.data.models.DocumentRequest[m
[32m+[m[32mimport kotlinx.coroutines.flow.Flow[m
[32m+[m
[32m+[m[32minterface RequestRepository {[m
[32m+[m[32m    // L·∫•y danh s√°ch y√™u c·∫ßu (Real-time)[m
[32m+[m[32m    fun getAllRequests(): Flow<List<DocumentRequest>>[m
[32m+[m
[32m+[m[32m    // T·∫°o y√™u c·∫ßu m·ªõi[m
[32m+[m[32m    suspend fun createRequest(title: String, subject: String, description: String)[m
[32m+[m
[32m+[m[32m    // üü¢ M·ªöI: L·∫•y chi ti·∫øt 1 y√™u c·∫ßu[m
[32m+[m[32m    fun getRequestById(requestId: String): Flow<DocumentRequest?>[m
[32m+[m
[32m+[m[32m    // üü¢ M·ªöI: L·∫•y danh s√°ch b√¨nh lu·∫≠n (Chat) c·ªßa y√™u c·∫ßu[m
[32m+[m[32m    fun getCommentsForRequest(requestId: String): Flow<List<CommentEntity>>[m
[32m+[m
[32m+[m[32m    // üü¢ M·ªöI: G·ª≠i b√¨nh lu·∫≠n/tr·∫£ l·ªùi[m
[32m+[m[32m    suspend fun addCommentToRequest(requestId: String, content: String)[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/core/data/repository/RequestRepositoryImpl.kt b/app/src/main/java/com/example/stushare/core/data/repository/RequestRepositoryImpl.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..05fa1f1[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/core/data/repository/RequestRepositoryImpl.kt[m
[36m@@ -0,0 +1,145 @@[m
[32m+[m[32mpackage com.example.stushare.core.data.repository[m
[32m+[m
[32m+[m[32mimport com.example.stushare.core.data.models.CommentEntity // üü¢ Import Model Comment[m
[32m+[m[32mimport com.example.stushare.core.data.models.DocumentRequest[m
[32m+[m[32mimport com.google.firebase.auth.FirebaseAuth[m
[32m+[m[32mimport com.google.firebase.firestore.FirebaseFirestore[m
[32m+[m[32mimport com.google.firebase.firestore.Query[m
[32m+[m[32mimport kotlinx.coroutines.channels.awaitClose[m
[32m+[m[32mimport kotlinx.coroutines.flow.Flow[m
[32m+[m[32mimport kotlinx.coroutines.flow.callbackFlow[m
[32m+[m[32mimport kotlinx.coroutines.tasks.await[m
[32m+[m[32mimport java.io.IOException[m
[32m+[m[32mimport javax.inject.Inject[m
[32m+[m
[32m+[m[32mclass RequestRepositoryImpl @Inject constructor([m
[32m+[m[32m    private val firestore: FirebaseFirestore,[m
[32m+[m[32m    private val firebaseAuth: FirebaseAuth[m
[32m+[m[32m) : RequestRepository {[m
[32m+[m
[32m+[m[32m    // Collection "requests"[m
[32m+[m[32m    private val requestsCollection = firestore.collection("requests")[m
[32m+[m
[32m+[m[32m    /**[m
[32m+[m[32m     * L·∫Øng nghe T·∫§T C·∫¢ y√™u c·∫ßu (D√πng cho RequestListScreen & HomeScreen)[m
[32m+[m[32m     */[m
[32m+[m[32m    override fun getAllRequests(): Flow<List<DocumentRequest>> {[m
[32m+[m[32m        return callbackFlow {[m
[32m+[m[32m            val listenerRegistration = requestsCollection[m
[32m+[m[32m                .orderBy("createdAt", Query.Direction.DESCENDING) // M·ªõi nh·∫•t l√™n ƒë·∫ßu[m
[32m+[m[32m                .addSnapshotListener { snapshot, error ->[m
[32m+[m[32m                    if (error != null) {[m
[32m+[m[32m                        close(error)[m
[32m+[m[32m                        return@addSnapshotListener[m
[32m+[m[32m                    }[m
[32m+[m[32m                    if (snapshot != null) {[m
[32m+[m[32m                        val requests = snapshot.toObjects(DocumentRequest::class.java)[m
[32m+[m[32m                        trySend(requests)[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m            awaitClose { listenerRegistration.remove() }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    /**[m
[32m+[m[32m     * üü¢ M·ªöI: L·∫Øng nghe CHI TI·∫æT 1 y√™u c·∫ßu (D√πng cho RequestDetailScreen)[m
[32m+[m[32m     */[m
[32m+[m[32m    override fun getRequestById(requestId: String): Flow<DocumentRequest?> {[m
[32m+[m[32m        return callbackFlow {[m
[32m+[m[32m            val listenerRegistration = requestsCollection.document(requestId)[m
[32m+[m[32m                .addSnapshotListener { snapshot, error ->[m
[32m+[m[32m                    if (error != null) {[m
[32m+[m[32m                        close(error)[m
[32m+[m[32m                        return@addSnapshotListener[m
[32m+[m[32m                    }[m
[32m+[m[32m                    if (snapshot != null && snapshot.exists()) {[m
[32m+[m[32m                        val request = snapshot.toObject(DocumentRequest::class.java)[m
[32m+[m[32m                        trySend(request)[m
[32m+[m[32m                    } else {[m
[32m+[m[32m                        trySend(null) // Kh√¥ng t√¨m th·∫•y ho·∫∑c ƒë√£ b·ªã x√≥a[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m            awaitClose { listenerRegistration.remove() }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    /**[m
[32m+[m[32m     * üü¢ M·ªöI: L·∫Øng nghe DANH S√ÅCH B√åNH LU·∫¨N (Chat)[m
[32m+[m[32m     * C·∫•u tr√∫c: requests/{requestId}/comments[m
[32m+[m[32m     */[m
[32m+[m[32m    override fun getCommentsForRequest(requestId: String): Flow<List<CommentEntity>> {[m
[32m+[m[32m        return callbackFlow {[m
[32m+[m[32m            val commentsRef = requestsCollection.document(requestId).collection("comments")[m
[32m+[m
[32m+[m[32m            val listenerRegistration = commentsRef[m
[32m+[m[32m                .orderBy("timestamp", Query.Direction.ASCENDING) // Tin nh·∫Øn c≈© ·ªü tr√™n, m·ªõi ·ªü d∆∞·ªõi[m
[32m+[m[32m                .addSnapshotListener { snapshot, error ->[m
[32m+[m[32m                    if (error != null) {[m
[32m+[m[32m                        close(error)[m
[32m+[m[32m                        return@addSnapshotListener[m
[32m+[m[32m                    }[m
[32m+[m[32m                    if (snapshot != null) {[m
[32m+[m[32m                        val comments = snapshot.toObjects(CommentEntity::class.java)[m
[32m+[m[32m                        trySend(comments)[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m            awaitClose { listenerRegistration.remove() }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    /**[m
[32m+[m[32m     * T·∫°o y√™u c·∫ßu m·ªõi (ƒê√£ c·∫≠p nh·∫≠t th√™m authorId, avatar)[m
[32m+[m[32m     */[m
[32m+[m[32m    override suspend fun createRequest(title: String, subject: String, description: String) {[m
[32m+[m[32m        try {[m
[32m+[m[32m            val currentUser = firebaseAuth.currentUser[m
[32m+[m[32m            val authorName = currentUser?.displayName ?: "Ng∆∞·ªùi d√πng ·∫©n danh"[m
[32m+[m[32m            val authorId = currentUser?.uid ?: ""[m
[32m+[m[32m            val authorAvatar = currentUser?.photoUrl?.toString()[m
[32m+[m
[32m+[m[32m            val newRequest = DocumentRequest([m
[32m+[m[32m                title = title,[m
[32m+[m[32m                subject = subject,[m
[32m+[m[32m                description = description,[m
[32m+[m[32m                authorName = authorName,[m
[32m+[m[32m                // üü¢ L∆∞u th√™m th√¥ng tin ƒë·ªãnh danh[m
[32m+[m[32m                authorId = authorId,[m
[32m+[m[32m                authorAvatar = authorAvatar[m
[32m+[m[32m            )[m
[32m+[m
[32m+[m[32m            requestsCollection.add(newRequest).await()[m
[32m+[m
[32m+[m[32m        } catch (e: Exception) {[m
[32m+[m[32m            e.printStackTrace()[m
[32m+[m[32m            throw IOException("Kh√¥ng th·ªÉ t·∫°o y√™u c·∫ßu", e)[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    /**[m
[32m+[m[32m     * üü¢ M·ªöI: G·ª≠i b√¨nh lu·∫≠n (Chat)[m
[32m+[m[32m     */[m
[32m+[m[32m    override suspend fun addCommentToRequest(requestId: String, content: String) {[m
[32m+[m[32m        try {[m
[32m+[m[32m            val currentUser = firebaseAuth.currentUser ?: throw Exception("Ch∆∞a ƒëƒÉng nh·∫≠p")[m
[32m+[m
[32m+[m[32m            val comment = CommentEntity([m
[32m+[m[32m                documentId = requestId,[m
[32m+[m[32m                userId = currentUser.uid,[m
[32m+[m[32m                userName = currentUser.displayName ?: "·∫®n danh",[m
[32m+[m[32m                userAvatar = currentUser.photoUrl?.toString(),[m
[32m+[m[32m                content = content[m
[32m+[m[32m                // timestamp s·∫Ω ƒë∆∞·ª£c Firestore t·ª± ƒëi·ªÅn nh·ªù @ServerTimestamp trong Model[m
[32m+[m[32m            )[m
[32m+[m
[32m+[m[32m            // L∆∞u v√†o sub-collection "comments"[m
[32m+[m[32m            requestsCollection.document(requestId)[m
[32m+[m[32m                .collection("comments")[m
[32m+[m[32m                .add(comment)[m
[32m+[m[32m                .await()[m
[32m+[m
[32m+[m[32m        } catch (e: Exception) {[m
[32m+[m[32m            e.printStackTrace()[m
[32m+[m[32m            throw IOException("Kh√¥ng th·ªÉ g·ª≠i b√¨nh lu·∫≠n", e)[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/core/data/repository/SettingsRepository.kt b/app/src/main/java/com/example/stushare/core/data/repository/SettingsRepository.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..908047a[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/core/data/repository/SettingsRepository.kt[m
[36m@@ -0,0 +1,156 @@[m
[32m+[m[32mpackage com.example.stushare.core.data.repository[m
[32m+[m
[32m+[m[32mimport android.content.Context[m
[32m+[m[32mimport androidx.datastore.core.DataStore[m
[32m+[m[32mimport androidx.datastore.preferences.core.Preferences[m
[32m+[m[32mimport androidx.datastore.preferences.core.booleanPreferencesKey[m
[32m+[m[32mimport androidx.datastore.preferences.core.edit[m
[32m+[m[32mimport androidx.datastore.preferences.core.floatPreferencesKey[m
[32m+[m[32mimport androidx.datastore.preferences.core.longPreferencesKey[m
[32m+[m[32mimport androidx.datastore.preferences.core.stringPreferencesKey[m
[32m+[m[32mimport androidx.datastore.preferences.core.stringSetPreferencesKey[m
[32m+[m[32mimport androidx.datastore.preferences.preferencesDataStore[m
[32m+[m[32mimport dagger.hilt.android.qualifiers.ApplicationContext[m
[32m+[m[32mimport kotlinx.coroutines.flow.Flow[m
[32m+[m[32mimport kotlinx.coroutines.flow.map[m
[32m+[m[32mimport javax.inject.Inject[m
[32m+[m[32mimport javax.inject.Singleton[m
[32m+[m
[32m+[m[32m// ƒê·ªãnh nghƒ©a DataStore[m
[32m+[m[32mval Context.dataStore: DataStore<Preferences> by preferencesDataStore(name = "settings")[m
[32m+[m
[32m+[m[32m@Singleton[m
[32m+[m[32mclass SettingsRepository @Inject constructor([m
[32m+[m[32m    @ApplicationContext private val context: Context[m
[32m+[m[32m) {[m
[32m+[m[32m    // ƒê·ªãnh nghƒ©a t·∫•t c·∫£ c√°c Keys[m
[32m+[m[32m    private object PreferencesKeys {[m
[32m+[m[32m        // 1. User & Caching[m
[32m+[m[32m        val USER_NAME = stringPreferencesKey("user_name")[m
[32m+[m[32m        val LAST_REFRESH_TIMESTAMP = longPreferencesKey("last_refresh_timestamp")[m
[32m+[m
[32m+[m[32m        // 2. Search History[m
[32m+[m[32m        val RECENT_SEARCHES = stringSetPreferencesKey("recent_searches")[m
[32m+[m
[32m+[m[32m        // 3. Appearance & Settings (M·ªöI TH√äM)[m
[32m+[m[32m        val IS_DARK_THEME = booleanPreferencesKey("is_dark_theme")[m
[32m+[m[32m        val LANGUAGE_CODE = stringPreferencesKey("language_code")[m
[32m+[m[32m        val FONT_SCALE = floatPreferencesKey("font_scale")[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    // ==========================================[m
[32m+[m[32m    // 1. USER INFO[m
[32m+[m[32m    // ==========================================[m
[32m+[m[32m    val userName: Flow<String> = context.dataStore.data[m
[32m+[m[32m        .map { preferences ->[m
[32m+[m[32m            preferences[PreferencesKeys.USER_NAME] ?: "Sinh vi√™n UTH"[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m    suspend fun saveUserName(name: String) {[m
[32m+[m[32m        context.dataStore.edit { settings ->[m
[32m+[m[32m            settings[PreferencesKeys.USER_NAME] = name[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    // Gi·∫£ l·∫≠p lu·ªìng d·ªØ li·ªáu UserProfile ƒë·ªÉ d√πng cho ProfileViewModel[m
[32m+[m[32m    // (Sau n√†y b·∫°n c√≥ th·ªÉ m·ªü r·ªông th√™m email, avatar...)[m
[32m+[m[32m    val userPreferencesFlow: Flow<UserPreferences> = context.dataStore.data[m
[32m+[m[32m        .map { preferences ->[m
[32m+[m[32m            val name = preferences[PreferencesKeys.USER_NAME] ?: "Sinh vi√™n UTH"[m
[32m+[m[32m            UserPreferences(userName = name)[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m    // ==========================================[m
[32m+[m[32m    // 2. CACHING STRATEGY[m
[32m+[m[32m    // ==========================================[m
[32m+[m[32m    val lastRefreshTimestamp: Flow<Long> = context.dataStore.data[m
[32m+[m[32m        .map { preferences ->[m
[32m+[m[32m            preferences[PreferencesKeys.LAST_REFRESH_TIMESTAMP] ?: 0L[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m    suspend fun updateLastRefreshTimestamp() {[m
[32m+[m[32m        context.dataStore.edit { preferences ->[m
[32m+[m[32m            preferences[PreferencesKeys.LAST_REFRESH_TIMESTAMP] = System.currentTimeMillis()[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    // ==========================================[m
[32m+[m[32m    // 3. SEARCH HISTORY (T√¨m ki·∫øm g·∫ßn ƒë√¢y)[m
[32m+[m[32m    // ==========================================[m
[32m+[m[32m    val recentSearches: Flow<List<String>> = context.dataStore.data[m
[32m+[m[32m        .map { preferences ->[m
[32m+[m[32m            val searchesSet = preferences[PreferencesKeys.RECENT_SEARCHES] ?: emptySet()[m
[32m+[m[32m            // Chuy·ªÉn Set th√†nh List v√† ƒë·∫£o ng∆∞·ª£c ƒë·ªÉ t·ª´ m·ªõi nh·∫•t l√™n ƒë·∫ßu[m
[32m+[m[32m            searchesSet.toList().reversed()[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m    suspend fun addRecentSearch(query: String) {[m
[32m+[m[32m        context.dataStore.edit { preferences ->[m
[32m+[m[32m            val oldSet = preferences[PreferencesKeys.RECENT_SEARCHES] ?: emptySet()[m
[32m+[m[32m            val newSet = oldSet.toMutableSet()[m
[32m+[m
[32m+[m[32m            newSet.remove(query) // X√≥a c≈© ƒë·ªÉ ƒë∆∞a l√™n ƒë·∫ßu[m
[32m+[m[32m            newSet.add(query)    // Th√™m m·ªõi[m
[32m+[m
[32m+[m[32m            // Gi·ªõi h·∫°n 5 t·ª´ kh√≥a[m
[32m+[m[32m            val tempList = newSet.toList()[m
[32m+[m[32m            val limitedList = if (tempList.size > 5) {[m
[32m+[m[32m                tempList.subList(tempList.size - 5, tempList.size)[m
[32m+[m[32m            } else {[m
[32m+[m[32m                tempList[m
[32m+[m[32m            }[m
[32m+[m[32m            preferences[PreferencesKeys.RECENT_SEARCHES] = limitedList.toSet()[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    suspend fun clearRecentSearches() {[m
[32m+[m[32m        context.dataStore.edit { preferences ->[m
[32m+[m[32m            preferences[PreferencesKeys.RECENT_SEARCHES] = emptySet()[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    // ==========================================[m
[32m+[m[32m    // 4. APPEARANCE & SETTINGS (M·ªöI TH√äM)[m
[32m+[m[32m    // ==========================================[m
[32m+[m
[32m+[m[32m    // --- Dark Mode ---[m
[32m+[m[32m    val isDarkTheme: Flow<Boolean> = context.dataStore.data[m
[32m+[m[32m        .map { preferences ->[m
[32m+[m[32m            preferences[PreferencesKeys.IS_DARK_THEME] ?: false[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m    suspend fun setDarkTheme(isDark: Boolean) {[m
[32m+[m[32m        context.dataStore.edit { preferences ->[m
[32m+[m[32m            preferences[PreferencesKeys.IS_DARK_THEME] = isDark[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    // --- Language ---[m
[32m+[m[32m    val languageCode: Flow<String> = context.dataStore.data[m
[32m+[m[32m        .map { preferences ->[m
[32m+[m[32m            preferences[PreferencesKeys.LANGUAGE_CODE] ?: "vi"[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m    suspend fun setLanguage(code: String) {[m
[32m+[m[32m        context.dataStore.edit { preferences ->[m
[32m+[m[32m            preferences[PreferencesKeys.LANGUAGE_CODE] = code[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    // --- Font Scale ---[m
[32m+[m[32m    val fontScale: Flow<Float> = context.dataStore.data[m
[32m+[m[32m        .map { preferences ->[m
[32m+[m[32m            preferences[PreferencesKeys.FONT_SCALE] ?: 1.0f[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m    suspend fun setFontScale(scale: Float) {[m
[32m+[m[32m        context.dataStore.edit { preferences ->[m
[32m+[m[32m            preferences[PreferencesKeys.FONT_SCALE] = scale[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m// Data class ph·ª• tr·ª£ ƒë·ªÉ gom nh√≥m th√¥ng tin User (d√πng cho ProfileViewModel)[m
[32m+[m[32mdata class UserPreferences([m
[32m+[m[32m    val userName: String[m
[32m+[m[32m)[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/core/di/DatabaseModule.kt b/app/src/main/java/com/example/stushare/core/di/DatabaseModule.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..2dc4828[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/core/di/DatabaseModule.kt[m
[36m@@ -0,0 +1,98 @@[m
[32m+[m[32mpackage com.example.stushare.core.di[m
[32m+[m
[32m+[m[32mimport android.content.Context[m
[32m+[m[32mimport androidx.room.Room[m
[32m+[m[32mimport com.example.stushare.core.data.db.AppDatabase[m
[32m+[m[32mimport com.example.stushare.core.data.db.DocumentDao[m
[32m+[m[32mimport com.example.stushare.core.data.db.NotificationDao[m
[32m+[m[32mimport com.example.stushare.core.data.db.UserDao[m
[32m+[m[32mimport com.example.stushare.core.data.network.models.ApiService[m
[32m+[m[32mimport com.example.stushare.core.data.repository.*[m
[32m+[m[32mimport com.google.firebase.auth.FirebaseAuth[m
[32m+[m[32mimport com.google.firebase.firestore.FirebaseFirestore[m
[32m+[m[32mimport com.google.firebase.storage.FirebaseStorage[m
[32m+[m[32mimport dagger.Module[m
[32m+[m[32mimport dagger.Provides[m
[32m+[m[32mimport dagger.hilt.InstallIn[m
[32m+[m[32mimport dagger.hilt.android.qualifiers.ApplicationContext[m
[32m+[m[32mimport dagger.hilt.components.SingletonComponent[m
[32m+[m[32mimport javax.inject.Singleton[m
[32m+[m
[32m+[m[32m@Module[m
[32m+[m[32m@InstallIn(SingletonComponent::class)[m
[32m+[m[32mobject DatabaseModule {[m
[32m+[m
[32m+[m[32m    @Provides[m
[32m+[m[32m    @Singleton[m
[32m+[m[32m    fun provideAppDatabase(@ApplicationContext context: Context): AppDatabase {[m
[32m+[m[32m        return Room.databaseBuilder([m
[32m+[m[32m            context.applicationContext,[m
[32m+[m[32m            AppDatabase::class.java,[m
[32m+[m[32m            "stushare_database"[m
[32m+[m[32m        )[m
[32m+[m[32m            .fallbackToDestructiveMigration()[m
[32m+[m[32m            .build()[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    @Provides[m
[32m+[m[32m    fun provideDocumentDao(database: AppDatabase): DocumentDao {[m
[32m+[m[32m        return database.documentDao()[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    @Provides[m
[32m+[m[32m    fun provideNotificationDao(database: AppDatabase): NotificationDao {[m
[32m+[m[32m        return database.notificationDao()[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    @Provides[m
[32m+[m[32m    fun provideUserDao(database: AppDatabase): UserDao {[m
[32m+[m[32m        return database.userDao()[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    // --- REPOSITORIES (Cung c·∫•p c√°c Repo ch∆∞a chuy·ªÉn sang RepositoryModule) ---[m
[32m+[m
[32m+[m[32m    @Provides[m
[32m+[m[32m    @Singleton[m
[32m+[m[32m    fun provideNotificationRepository([m
[32m+[m[32m        notificationDao: NotificationDao,[m
[32m+[m[32m        firestore: FirebaseFirestore,[m
[32m+[m[32m        auth: FirebaseAuth[m
[32m+[m[32m    ): NotificationRepository {[m
[32m+[m[32m        return NotificationRepositoryImpl(notificationDao, firestore, auth)[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    @Provides[m
[32m+[m[32m    @Singleton[m
[32m+[m[32m    fun provideDocumentRepository([m
[32m+[m[32m        documentDao: DocumentDao,[m
[32m+[m[32m        apiService: ApiService,[m
[32m+[m[32m        settingsRepository: SettingsRepository,[m
[32m+[m[32m        storage: FirebaseStorage,[m
[32m+[m[32m        firestore: FirebaseFirestore,[m
[32m+[m[32m        notificationRepository: NotificationRepository,[m
[32m+[m[32m        auth: FirebaseAuth[m
[32m+[m[32m    ): DocumentRepository {[m
[32m+[m[32m        return DocumentRepositoryImpl([m
[32m+[m[32m            documentDao,[m
[32m+[m[32m            apiService,[m
[32m+[m[32m            settingsRepository,[m
[32m+[m[32m            storage,[m
[32m+[m[32m            firestore,[m
[32m+[m[32m            notificationRepository,[m
[32m+[m[32m            auth[m
[32m+[m[32m        )[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    // ‚ùå ƒê√É X√ìA: provideRequestRepository[m
[32m+[m[32m    // V√¨ ƒë√£ ƒë∆∞·ª£c bind b√™n RepositoryModule.kt -> S·ª≠a l·ªói DuplicateBindings th√†nh c√¥ng![m
[32m+[m
[32m+[m[32m    @Provides[m
[32m+[m[32m    @Singleton[m
[32m+[m[32m    fun provideLeaderboardRepository([m
[32m+[m[32m        userDao: UserDao,[m
[32m+[m[32m        documentDao: DocumentDao,[m
[32m+[m[32m        firestore: FirebaseFirestore[m
[32m+[m[32m    ): LeaderboardRepository {[m
[32m+[m[32m        return LeaderboardRepositoryImpl(userDao, documentDao, firestore)[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[1mdiff --git a/app/src/main/java/com/example/stushare/core/di/FirebaseModule.kt b/app/src/main/java/com/example/stushare/core/di/FirebaseModule.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..d77908d[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/core/di/FirebaseModule.kt[m
[36m@@ -0,0 +1,36 @@[m
[32m+[m[32mpackage com.example.stushare.core.di[m
[32m+[m
[32m+[m[32mimport com.google.firebase.auth.FirebaseAuth[m
[32m+[m[32mimport com.google.firebase.firestore.FirebaseFirestore[m
[32m+[m[32mimport com.google.firebase.storage.FirebaseStorage[m
[32m+[m[32mimport dagger.Module[m
[32m+[m[32mimport dagger.Provides[m
[32m+[m[32mimport dagger.hilt.InstallIn[m
[32m+[m[32mimport dagger.hilt.components.SingletonComponent[m
[32m+[m[32mimport javax.inject.Singleton[m
[32m+[m
[32m+[m[32m@Module[m
[32m+[m[32m@InstallIn(SingletonComponent::class)[m
[32m+[m[32mobject FirebaseModule {[m
[32m+[m
[32m+[m[32m    @Provides[m
[32m+[m[32m    @Singleton[m
[32m+[m[32m    fun provideFirestoreInstance(): FirebaseFirestore {[m
[32m+[m[32m        return FirebaseFirestore.getInstance()[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    @Provides[m
[32m+[m[32m    @Singleton[m
[32m+[m[32m    fun provideFirebaseAuthInstance(): FirebaseAuth {[m
[32m+[m[32m        return FirebaseAuth.getInstance()[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    @Provides[m
[32m+[m[32m    @Singleton[m
[32m+[m[32m    fun provideFirebaseStorageInstance(): FirebaseStorage {[m
[32m+[m[32m        // ‚úÖ C·∫¢I TI·∫æN: S·ª≠ d·ª•ng getInstance() kh√¥ng tham s·ªë.[m
[32m+[m[32m        // Firebase SDK s·∫Ω t·ª± ƒë·ªông ƒë·ªçc bucket chu·∫©n t·ª´ file google-services.json.[m
[32m+[m[32m        // ƒêi·ªÅu n√†y gi√∫p tr√°nh l·ªói sai t√™n bucket v√† d·ªÖ d√†ng b·∫£o tr√¨.[m
[32m+[m[32m        return FirebaseStorage.getInstance()[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/core/di/NetworkModule.kt b/app/src/main/java/com/example/stushare/core/di/NetworkModule.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..78fba14[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/core/di/NetworkModule.kt[m
[36m@@ -0,0 +1,117 @@[m
[32m+[m[32mpackage com.example.stushare.core.di[m
[32m+[m
[32m+[m[32mimport com.example.stushare.core.data.network.models.ApiService[m
[32m+[m[32mimport com.squareup.moshi.Moshi[m
[32m+[m[32mimport com.squareup.moshi.kotlin.reflect.KotlinJsonAdapterFactory[m
[32m+[m[32mimport dagger.Module[m
[32m+[m[32mimport dagger.Provides[m
[32m+[m[32mimport dagger.hilt.InstallIn[m
[32m+[m[32mimport dagger.hilt.components.SingletonComponent[m
[32m+[m[32mimport okhttp3.OkHttpClient[m
[32m+[m[32mimport okhttp3.logging.HttpLoggingInterceptor[m
[32m+[m[32mimport retrofit2.Retrofit[m
[32m+[m[32mimport retrofit2.converter.moshi.MoshiConverterFactory[m
[32m+[m[32mimport javax.inject.Singleton[m
[32m+[m[32mimport com.squareup.moshi.JsonReader[m
[32m+[m[32mimport com.squareup.moshi.JsonWriter[m
[32m+[m[32mimport com.squareup.moshi.FromJson[m
[32m+[m[32mimport com.squareup.moshi.ToJson[m
[32m+[m[32mimport com.squareup.moshi.JsonAdapter[m
[32m+[m[32mimport java.lang.reflect.Type[m
[32m+[m
[32m+[m[32m// ‚≠êÔ∏è IMPORT B·∫ÆT BU·ªòC[m
[32m+[m[32mimport com.example.stushare.BuildConfig[m
[32m+[m[32mimport java.util.concurrent.TimeUnit[m
[32m+[m
[32m+[m[32m// =======================================================[m
[32m+[m[32m// Custom Float Adapter c·ªßa b·∫°n (Gi·ªØ nguy√™n)[m
[32m+[m[32m// =======================================================[m
[32m+[m[32mclass CustomFloatAdapter : JsonAdapter<Float>() {[m
[32m+[m[32m    @FromJson[m
[32m+[m[32m    override fun fromJson(reader: JsonReader): Float {[m
[32m+[m[32m        return when (reader.peek()) {[m
[32m+[m[32m            JsonReader.Token.NUMBER -> reader.nextDouble().toFloat()[m
[32m+[m[32m            JsonReader.Token.STRING -> reader.nextString()?.toFloatOrNull() ?: 0.0f[m
[32m+[m[32m            else -> {[m
[32m+[m[32m                reader.skipValue()[m
[32m+[m[32m                0.0f[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m    @ToJson[m
[32m+[m[32m    override fun toJson(writer: JsonWriter, value: Float?) {[m
[32m+[m[32m        writer.value(value?.toDouble())[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32mobject FloatAdapterFactory : JsonAdapter.Factory {[m
[32m+[m[32m    override fun create(type: Type, annotations: Set<Annotation>, moshi: Moshi): JsonAdapter<*>? {[m
[32m+[m[32m        if (type == Float::class.java || type == java.lang.Float::class.java) {[m
[32m+[m[32m            return CustomFloatAdapter().nullSafe()[m
[32m+[m[32m        }[m
[32m+[m[32m        return null[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m[32m// =======================================================[m
[32m+[m
[32m+[m
[32m+[m[32m@Module[m
[32m+[m[32m@InstallIn(SingletonComponent::class)[m
[32m+[m[32mobject NetworkModule {[m
[32m+[m
[32m+[m[32m    private const val BASE_URL = "https://my-json-server.typicode.com/nqthien1509/stushare-api/"[m
[32m+[m
[32m+[m[32m    // 1. "D·∫°y" Hilt c√°ch t·∫°o Moshi (Gi·ªØ nguy√™n)[m
[32m+[m[32m    @Provides[m
[32m+[m[32m    @Singleton[m
[32m+[m[32m    fun provideMoshi(): Moshi {[m
[32m+[m[32m        return Moshi.Builder()[m
[32m+[m[32m            .add(FloatAdapterFactory)[m
[32m+[m[32m            .add(KotlinJsonAdapterFactory())[m
[32m+[m[32m            .build()[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    // 2. "D·∫°y" Hilt c√°ch t·∫°o OkHttpClient (‚≠êÔ∏è ƒê√É C·∫¨P NH·∫¨T)[m
[32m+[m[32m    @Provides[m
[32m+[m[32m    @Singleton[m
[32m+[m[32m    fun provideOkHttpClient(): OkHttpClient {[m
[32m+[m[32m        // 1. T·∫°o Interceptor[m
[32m+[m[32m        val logging = HttpLoggingInterceptor()[m
[32m+[m
[32m+[m[32m        // 2. ‚≠êÔ∏è C·∫¢I TI·∫æN B·∫¢O M·∫¨T (LOGGING) ‚≠êÔ∏è[m
[32m+[m[32m        // Ch·ªâ log chi ti·∫øt (BODY) khi ƒëang ·ªü build DEBUG[m
[32m+[m[32m        // T·∫Øt log (NONE) khi build RELEASE (cho ng∆∞·ªùi d√πng)[m
[32m+[m[32m        if (BuildConfig.DEBUG) {[m
[32m+[m[32m            logging.setLevel(HttpLoggingInterceptor.Level.BODY)[m
[32m+[m[32m        } else {[m
[32m+[m[32m            logging.setLevel(HttpLoggingInterceptor.Level.NONE)[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        // 3. X√¢y d·ª±ng Client[m
[32m+[m[32m        return OkHttpClient.Builder()[m
[32m+[m[32m            .addInterceptor(logging) // Th√™m logging interceptor[m
[32m+[m[32m            // ‚≠êÔ∏è G·ª¢I √ù TH√äM: Th√™m timeouts ƒë·ªÉ app ·ªïn ƒë·ªãnh h∆°n[m
[32m+[m[32m            .connectTimeout(30, TimeUnit.SECONDS) // Th·ªùi gian ch·ªù k·∫øt n·ªëi[m
[32m+[m[32m            .readTimeout(30, TimeUnit.SECONDS)    // Th·ªùi gian ch·ªù ƒë·ªçc[m
[32m+[m[32m            .writeTimeout(30, TimeUnit.SECONDS)   // Th·ªùi gian ch·ªù ghi[m
[32m+[m[32m            .build()[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    // 3. "D·∫°y" Hilt c√°ch t·∫°o Retrofit (Gi·ªØ nguy√™n)[m
[32m+[m[32m    @Provides[m
[32m+[m[32m    @Singleton[m
[32m+[m[32m    fun provideRetrofit(okHttpClient: OkHttpClient, moshi: Moshi): Retrofit {[m
[32m+[m[32m        return Retrofit.Builder()[m
[32m+[m[32m            .baseUrl(BASE_URL)[m
[32m+[m[32m            .client(okHttpClient) // <-- T·ª± ƒë·ªông nh·∫≠n OkHttpClient ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t[m
[32m+[m[32m            .addConverterFactory(MoshiConverterFactory.create(moshi))[m
[32m+[m[32m            .build()[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    // 4. "D·∫°y" Hilt c√°ch t·∫°o ApiService (Gi·ªØ nguy√™n)[m
[32m+[m[32m    @Provides[m
[32m+[m[32m    @Singleton[m
[32m+[m[32m    fun provideApiService(retrofit: Retrofit): ApiService {[m
[32m+[m[32m        return retrofit.create(ApiService::class.java)[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/core/di/RepositoryModule.kt b/app/src/main/java/com/example/stushare/core/di/RepositoryModule.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..665d8e7[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/core/di/RepositoryModule.kt[m
[36m@@ -0,0 +1,32 @@[m
[32m+[m[32mpackage com.example.stushare.core.di[m
[32m+[m
[32m+[m[32mimport com.example.stushare.core.data.repository.AdminRepository[m
[32m+[m[32mimport com.example.stushare.core.data.repository.AdminRepositoryImpl[m
[32m+[m[32mimport com.example.stushare.core.data.repository.RequestRepository[m
[32m+[m[32mimport com.example.stushare.core.data.repository.RequestRepositoryImpl[m
[32m+[m[32m// import com.example.stushare.core.data.repository.DocumentRepository[m
[32m+[m[32m// import com.example.stushare.core.data.repository.DocumentRepositoryImpl[m
[32m+[m[32mimport dagger.Binds[m
[32m+[m[32mimport dagger.Module[m
[32m+[m[32mimport dagger.hilt.InstallIn[m
[32m+[m[32mimport dagger.hilt.components.SingletonComponent[m
[32m+[m[32mimport javax.inject.Singleton[m
[32m+[m
[32m+[m[32m@Module[m
[32m+[m[32m@InstallIn(SingletonComponent::class)[m
[32m+[m[32mabstract class RepositoryModule {[m
[32m+[m
[32m+[m[32m    // üü¢ Bind AdminRepository t·∫°i ƒë√¢y (Duy nh·∫•t 1 ch·ªó n√†y th√¥i)[m
[32m+[m[32m    @Binds[m
[32m+[m[32m    @Singleton[m
[32m+[m[32m    abstract fun bindAdminRepository([m
[32m+[m[32m        adminRepositoryImpl: AdminRepositoryImpl[m
[32m+[m[32m    ): AdminRepository[m
[32m+[m
[32m+[m[32m    // üü¢ Bind RequestRepository (B·∫°n ƒëang c√≥ s·∫µn)[m
[32m+[m[32m    @Binds[m
[32m+[m[32m    @Singleton[m
[32m+[m[32m    abstract fun bindRequestRepository([m
[32m+[m[32m        requestRepositoryImpl: RequestRepositoryImpl[m
[32m+[m[32m    ): RequestRepository[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/core/domain/usecase/GetExamDocumentsUseCase.kt b/app/src/main/java/com/example/stushare/core/domain/usecase/GetExamDocumentsUseCase.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..b37e892[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/core/domain/usecase/GetExamDocumentsUseCase.kt[m
[36m@@ -0,0 +1,16 @@[m
[32m+[m[32mpackage com.example.stushare.core.domain.usecase[m
[32m+[m
[32m+[m[32mimport com.example.stushare.core.data.models.Document[m
[32m+[m[32mimport com.example.stushare.core.data.repository.DocumentRepository[m
[32m+[m[32mimport com.example.stushare.core.utils.AppConstants[m
[32m+[m[32mimport kotlinx.coroutines.flow.Flow[m
[32m+[m[32mimport javax.inject.Inject[m
[32m+[m
[32m+[m[32mclass GetExamDocumentsUseCase @Inject constructor([m
[32m+[m[32m    private val repository: DocumentRepository[m
[32m+[m[32m) {[m
[32m+[m[32m    operator fun invoke(): Flow<List<Document>> {[m
[32m+[m[32m        // C·∫¢I TI·∫æN: G·ªçi tr·ª±c ti·∫øp Query l·ªçc theo Type t·ª´ DAO (Nhanh h∆°n)[m
[32m+[m[32m        return repository.getDocumentsByType(AppConstants.TYPE_EXAM_PREP)[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/core/domain/usecase/GetNewDocumentsUseCase.kt b/app/src/main/java/com/example/stushare/core/domain/usecase/GetNewDocumentsUseCase.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..30bb37c[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/core/domain/usecase/GetNewDocumentsUseCase.kt[m
[36m@@ -0,0 +1,23 @@[m
[32m+[m[32mpackage com.example.stushare.core.domain.usecase[m
[32m+[m
[32m+[m[32mimport com.example.stushare.core.data.models.Document[m
[32m+[m[32mimport com.example.stushare.core.data.repository.DocumentRepository[m
[32m+[m[32mimport kotlinx.coroutines.flow.Flow[m
[32m+[m[32mimport kotlinx.coroutines.flow.map[m
[32m+[m[32mimport javax.inject.Inject[m
[32m+[m
[32m+[m[32mclass GetNewDocumentsUseCase @Inject constructor([m
[32m+[m[32m    private val repository: DocumentRepository[m
[32m+[m[32m) {[m
[32m+[m[32m    operator fun invoke(): Flow<List<Document>> {[m
[32m+[m[32m        // L·∫•y danh s√°ch t·ªïng h·ª£p t·ª´ Database[m
[32m+[m[32m        return repository.getAllDocuments()[m
[32m+[m[32m            .map { documents ->[m
[32m+[m[32m                documents[m
[32m+[m[32m                    // 1. S·∫Øp x·∫øp gi·∫£m d·∫ßn theo th·ªùi gian (M·ªõi nh·∫•t l√™n ƒë·∫ßu)[m
[32m+[m[32m                    .sortedByDescending { it.createdAt }[m
[32m+[m[32m                    // 2. Ch·ªâ l·∫•y 10 t√†i li·ªáu m·ªõi nh·∫•t (ƒë·ªÉ hi·ªÉn th·ªã ·ªü m·ª•c Hot)[m
[32m+[m[32m                    .take(10)[m
[32m+[m[32m            }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/core/navigation/NavRoute.kt b/app/src/main/java/com/example/stushare/core/navigation/NavRoute.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..d69590d[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/core/navigation/NavRoute.kt[m
[36m@@ -0,0 +1,49 @@[m
[32m+[m[32mpackage com.example.stushare.core.navigation[m
[32m+[m
[32m+[m[32mimport kotlinx.serialization.Serializable[m
[32m+[m
[32m+[m[32msealed interface NavRoute {[m
[32m+[m[32m    // --- AUTHENTICATION ---[m
[32m+[m[32m    @Serializable data object Intro : NavRoute[m
[32m+[m[32m    @Serializable data object Onboarding : NavRoute[m
[32m+[m[32m    @Serializable data object Login : NavRoute[m
[32m+[m[32m    @Serializable data object Register : NavRoute[m
[32m+[m[32m    @Serializable data object ForgotPassword : NavRoute[m
[32m+[m[32m    @Serializable data object LoginSMS : NavRoute[m
[32m+[m[32m    @Serializable data class VerifyOTP(val verificationId: String) : NavRoute[m
[32m+[m
[32m+[m[32m    // --- MAIN FEATURES ---[m
[32m+[m[32m    @Serializable data object Profile : NavRoute[m
[32m+[m[32m    @Serializable data object Home : NavRoute[m
[32m+[m[32m    @Serializable data object Search : NavRoute[m
[32m+[m[32m    @Serializable data object RequestList : NavRoute[m
[32m+[m[32m    @Serializable data object CreateRequest : NavRoute[m
[32m+[m[32m    @Serializable data class DocumentDetail(val documentId: String) : NavRoute[m
[32m+[m[32m    @Serializable data class ViewAll(val category: String) : NavRoute[m
[32m+[m[32m    @Serializable data class SearchResult(val query: String) : NavRoute[m
[32m+[m[32m    @Serializable data object Upload : NavRoute[m
[32m+[m[32m    @Serializable data object Notification : NavRoute[m
[32m+[m[32m    @Serializable data object Leaderboard : NavRoute[m
[32m+[m[32m    @Serializable data class RequestDetail(val requestId: String) : NavRoute[m
[32m+[m[32m    @Serializable data class PdfViewer(val url: String, val title: String) : NavRoute[m
[32m+[m
[32m+[m[32m    // --- ADMIN FEATURES ---[m
[32m+[m[32m    @Serializable data object AdminDashboard : NavRoute[m
[32m+[m[32m    @Serializable data object AdminReports : NavRoute[m
[32m+[m
[32m+[m[32m    // --- SETTINGS ---[m
[32m+[m[32m    @Serializable data object Settings : NavRoute[m
[32m+[m[32m    @Serializable data object AccountSecurity : NavRoute[m
[32m+[m[41m    [m
[32m+[m[32m    @Serializable data object EditPhone : NavRoute[m
[32m+[m[32m    @Serializable data object EditEmail : NavRoute[m
[32m+[m
[32m+[m[32m    @Serializable data object ChangePassword : NavRoute[m
[32m+[m[32m    @Serializable data object NotificationSettings : NavRoute[m
[32m+[m[32m    @Serializable data object AppearanceSettings : NavRoute[m
[32m+[m[32m    @Serializable data object AboutApp : NavRoute[m
[32m+[m[32m    @Serializable data object ContactSupport : NavRoute[m
[32m+[m[32m    @Serializable data object ReportViolation : NavRoute[m
[32m+[m[32m    @Serializable data object SwitchAccount : NavRoute[m
[32m+[m[32m    @Serializable data object PersonalInfo : NavRoute[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/core/utils/AndroidDownloader.kt b/app/src/main/java/com/example/stushare/core/utils/AndroidDownloader.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..0dc4f4f[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/core/utils/AndroidDownloader.kt[m
[36m@@ -0,0 +1,53 @@[m
[32m+[m[32mpackage com.example.stushare.core.utils[m
[32m+[m
[32m+[m[32mimport android.app.DownloadManager[m
[32m+[m[32mimport android.content.Context[m
[32m+[m[32mimport android.net.Uri[m
[32m+[m[32mimport android.os.Environment[m
[32m+[m[32mimport android.util.Log // üü¢ Th√™m Log[m
[32m+[m[32mimport android.widget.Toast[m
[32m+[m[32mimport dagger.hilt.android.qualifiers.ApplicationContext[m
[32m+[m[32mimport javax.inject.Inject[m
[32m+[m
[32m+[m[32mclass AndroidDownloader @Inject constructor([m
[32m+[m[32m    @ApplicationContext private val context: Context[m
[32m+[m[32m) {[m
[32m+[m
[32m+[m[32m    fun downloadFile(url: String, fileName: String): Long {[m
[32m+[m[32m        // üü¢ 1. In ra Log ƒë·ªÉ xem URL c√≥ ƒë√∫ng kh√¥ng[m
[32m+[m[32m        Log.d("DOWNLOAD_DEBUG", "--------------------------------------")[m
[32m+[m[32m        Log.d("DOWNLOAD_DEBUG", "B·∫Øt ƒë·∫ßu t·∫£i file: $fileName")[m
[32m+[m[32m        Log.d("DOWNLOAD_DEBUG", "URL g·ªëc: '$url'")[m
[32m+[m
[32m+[m[32m        if (url.isBlank() || !url.startsWith("http")) {[m
[32m+[m[32m            Log.e("DOWNLOAD_DEBUG", "‚ùå L·ªñI: URL kh√¥ng h·ª£p l·ªá (R·ªóng ho·∫∑c kh√¥ng ph·∫£i http)")[m
[32m+[m[32m            Toast.makeText(context, "L·ªói: Link t·∫£i kh√¥ng h·ª£p l·ªá", Toast.LENGTH_SHORT).show()[m
[32m+[m[32m            return -1L[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        return try {[m
[32m+[m[32m            val manager = context.getSystemService(DownloadManager::class.java)[m
[32m+[m[32m            val uri = Uri.parse(url)[m
[32m+[m
[32m+[m[32m            val request = DownloadManager.Request(uri)[m
[32m+[m[32m                .setNotificationVisibility(DownloadManager.Request.VISIBILITY_VISIBLE_NOTIFY_COMPLETED)[m
[32m+[m[32m                .setTitle(fileName)[m
[32m+[m[32m                .setDestinationInExternalPublicDir(Environment.DIRECTORY_DOWNLOADS, fileName)[m
[32m+[m[32m                .setAllowedOverMetered(true)[m
[32m+[m[32m                .setAllowedOverRoaming(true)[m
[32m+[m
[32m+[m[32m            val downloadId = manager.enqueue(request)[m
[32m+[m
[32m+[m[32m            // üü¢ 2. Ki·ªÉm tra xem DownloadManager c√≥ nh·∫≠n ƒë∆°n kh√¥ng[m
[32m+[m[32m            Log.d("DOWNLOAD_DEBUG", "‚úÖ ƒê√£ g·ª≠i y√™u c·∫ßu t·∫£i. ID: $downloadId")[m
[32m+[m[32m            Toast.makeText(context, "ƒêang b·∫Øt ƒë·∫ßu t·∫£i xu·ªëng...", Toast.LENGTH_SHORT).show()[m
[32m+[m
[32m+[m[32m            downloadId[m
[32m+[m[32m        } catch (e: Exception) {[m
[32m+[m[32m            e.printStackTrace()[m
[32m+[m[32m            Log.e("DOWNLOAD_DEBUG", "‚ùå CRASH: ${e.message}")[m
[32m+[m[32m            Toast.makeText(context, "L·ªói t·∫£i xu·ªëng: ${e.message}", Toast.LENGTH_SHORT).show()[m
[32m+[m[32m            -1L[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/core/utils/AndroidFileOpener.kt b/app/src/main/java/com/example/stushare/core/utils/AndroidFileOpener.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..6cf22dc[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/core/utils/AndroidFileOpener.kt[m
[36m@@ -0,0 +1,38 @@[m
[32m+[m[32mpackage com.example.stushare.core.utils[m
[32m+[m
[32m+[m[32mimport android.content.Context[m
[32m+[m[32mimport android.content.Intent[m
[32m+[m[32mimport android.net.Uri[m
[32m+[m[32mimport android.widget.Toast[m
[32m+[m[32mimport dagger.hilt.android.qualifiers.ApplicationContext[m
[32m+[m[32mimport javax.inject.Inject[m
[32m+[m
[32m+[m[32mclass AndroidFileOpener @Inject constructor([m
[32m+[m[32m    @ApplicationContext private val context: Context[m
[32m+[m[32m) {[m
[32m+[m[32m    fun openFile(url: String) {[m
[32m+[m[32m        try {[m
[32m+[m[32m            if (url.isBlank()) {[m
[32m+[m[32m                Toast.makeText(context, "Link t√†i li·ªáu b·ªã l·ªói", Toast.LENGTH_SHORT).show()[m
[32m+[m[32m                return[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            val uri = Uri.parse(url)[m
[32m+[m[32m            val intent = Intent(Intent.ACTION_VIEW)[m
[32m+[m[32m            intent.data = uri[m
[32m+[m
[32m+[m[32m            // C·ªù n√†y c·∫ßn thi·∫øt v√¨ ch√∫ng ta g·ªçi Intent t·ª´ ngo√†i Activity[m
[32m+[m[32m            intent.flags = Intent.FLAG_ACTIVITY_NEW_TASK or Intent.FLAG_ACTIVITY_CLEAR_TOP[m
[32m+[m
[32m+[m[32m            // T·∫°o menu "M·ªü b·∫±ng..." ƒë·ªÉ ng∆∞·ªùi d√πng ch·ªçn ·ª©ng d·ª•ng[m
[32m+[m[32m            val chooser = Intent.createChooser(intent, "Ch·ªçn ·ª©ng d·ª•ng ƒë·ªÉ m·ªü t√†i li·ªáu")[m
[32m+[m[32m            chooser.flags = Intent.FLAG_ACTIVITY_NEW_TASK[m
[32m+[m
[32m+[m[32m            context.startActivity(chooser)[m
[32m+[m
[32m+[m[32m        } catch (e: Exception) {[m
[32m+[m[32m            e.printStackTrace()[m
[32m+[m[32m            Toast.makeText(context, "Kh√¥ng t√¨m th·∫•y ·ª©ng d·ª•ng h·ªó tr·ª£ m·ªü file n√†y", Toast.LENGTH_LONG).show()[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/core/utils/Constants.kt b/app/src/main/java/com/example/stushare/core/utils/Constants.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..d059918[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/core/utils/Constants.kt[m
[36m@@ -0,0 +1,25 @@[m
[32m+[m[32mpackage com.example.stushare.core.utils[m
[32m+[m
[32m+[m[32mimport java.text.Normalizer[m
[32m+[m[32mimport java.util.regex.Pattern[m
[32m+[m[32mobject AppConstants {[m
[32m+[m
[32m+[m[32m    // --- Document Types (S·ª≠ d·ª•ng trong Database/API) ---[m
[32m+[m[32m    const val TYPE_BOOK = "S√°ch"[m
[32m+[m[32m    const val TYPE_EXAM_PREP = "exam_review"[m
[32m+[m
[32m+[m[32m    // --- Navigation Categories (S·ª≠ d·ª•ng trong UI/Navigation) ---[m
[32m+[m[32m    const val CATEGORY_NEW_UPLOADS = "new_uploads"[m
[32m+[m[32m    const val CATEGORY_EXAM_PREP = "exam_prep"[m
[32m+[m
[32m+[m[32m    // (Sau n√†y b·∫°n c√≥ th·ªÉ th√™m c√°c h·∫±ng s·ªë kh√°c ·ªü ƒë√¢y)[m
[32m+[m[32m}[m
[32m+[m[32mfun String.removeAccents(): String {[m
[32m+[m[32m    val temp = Normalizer.normalize(this, Normalizer.Form.NFD)[m
[32m+[m[32m    val pattern = Pattern.compile("\\p{InCombiningDiacriticalMarks}+")[m
[32m+[m[32m    return pattern.matcher(temp).replaceAll("")[m
[32m+[m[32m        .replace('ƒë', 'd').replace('ƒê', 'd')[m
[32m+[m[32m        .lowercase()[m
[32m+[m[32m        .trim()[m
[32m+[m[32m        .replace(" ", "")[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/core/utils/ContextExt.kt b/app/src/main/java/com/example/stushare/core/utils/ContextExt.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..aa88cca[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/core/utils/ContextExt.kt[m
[36m@@ -0,0 +1,14 @@[m
[32m+[m[32mpackage com.example.stushare.core.utils // Ho·∫∑c package utils c·ªßa b·∫°n[m
[32m+[m
[32m+[m[32mimport android.content.Context[m
[32m+[m[32mimport android.content.Intent[m
[32m+[m[32mimport com.example.stushare.MainActivity[m
[32m+[m
[32m+[m[32mfun Context.restartApp() {[m
[32m+[m[32m    val intent = Intent(this, MainActivity::class.java).apply {[m
[32m+[m[32m        addFlags(Intent.FLAG_ACTIVITY_NEW_TASK or Intent.FLAG_ACTIVITY_CLEAR_TASK)[m
[32m+[m[32m    }[m
[32m+[m[32m    startActivity(intent)[m
[32m+[m[32m    // K·∫øt th√∫c process hi·ªán t·∫°i ƒë·ªÉ ƒë·∫£m b·∫£o s·∫°ch s·∫Ω[m
[32m+[m[32m    Runtime.getRuntime().exit(0)[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/core/workers/DownloadWorker.kt b/app/src/main/java/com/example/stushare/core/workers/DownloadWorker.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..d80afa5[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/core/workers/DownloadWorker.kt[m
[36m@@ -0,0 +1,61 @@[m
[32m+[m[32mpackage com.example.stushare.core.workers[m
[32m+[m
[32m+[m[32mimport android.app.DownloadManager[m
[32m+[m[32mimport android.content.Context[m
[32m+[m[32mimport android.net.Uri[m
[32m+[m[32mimport android.os.Environment[m
[32m+[m[32mimport androidx.work.CoroutineWorker[m
[32m+[m[32mimport androidx.work.WorkerParameters[m
[32m+[m[32mimport androidx.work.workDataOf[m
[32m+[m[32mimport java.io.File[m
[32m+[m
[32m+[m[32mclass DownloadWorker([m
[32m+[m[32m    context: Context,[m
[32m+[m[32m    workerParams: WorkerParameters[m
[32m+[m[32m) : CoroutineWorker(context, workerParams) {[m
[32m+[m
[32m+[m[32m    override suspend fun doWork(): Result {[m
[32m+[m[32m        val fileUrl = inputData.getString(KEY_FILE_URL) ?: return Result.failure()[m
[32m+[m[32m        val fileName = inputData.getString(KEY_FILE_NAME) ?: "document"[m
[32m+[m
[32m+[m[32m        // ƒê·∫£m b·∫£o t√™n file c√≥ ƒëu√¥i .pdf[m
[32m+[m[32m        val finalFileName = if (fileName.endsWith(".pdf", ignoreCase = true)) fileName else "$fileName.pdf"[m
[32m+[m
[32m+[m[32m        return try {[m
[32m+[m[32m            // 1. Ki·ªÉm tra file ƒë√£ t·ªìn t·∫°i ch∆∞a ƒë·ªÉ tr√°nh t·∫£i tr√πng[m
[32m+[m[32m            val downloadDir = Environment.getExternalStoragePublicDirectory(Environment.DIRECTORY_DOWNLOADS)[m
[32m+[m[32m            val targetFile = File(downloadDir, finalFileName)[m
[32m+[m
[32m+[m[32m            if (targetFile.exists()) {[m
[32m+[m[32m                // N·∫øu file ƒë√£ c√≥, b√°o th√†nh c√¥ng ngay (ho·∫∑c b·∫°n c√≥ th·ªÉ b√°o l·ªói t√πy logic)[m
[32m+[m[32m                return Result.success()[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            // 2. T·∫°o y√™u c·∫ßu t·∫£i xu·ªëng[m
[32m+[m[32m            val downloadManager = applicationContext.getSystemService(Context.DOWNLOAD_SERVICE) as DownloadManager[m
[32m+[m[32m            val uri = Uri.parse(fileUrl)[m
[32m+[m
[32m+[m[32m            val request = DownloadManager.Request(uri).apply {[m
[32m+[m[32m                setTitle(fileName)[m
[32m+[m[32m                setDescription("ƒêang t·∫£i t√†i li·ªáu v·ªÅ m√°y...")[m
[32m+[m[32m                setNotificationVisibility(DownloadManager.Request.VISIBILITY_VISIBLE_NOTIFY_COMPLETED)[m
[32m+[m[32m                setDestinationInExternalPublicDir(Environment.DIRECTORY_DOWNLOADS, finalFileName)[m
[32m+[m[32m                setAllowedNetworkTypes(DownloadManager.Request.NETWORK_WIFI or DownloadManager.Request.NETWORK_MOBILE)[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            val downloadId = downloadManager.enqueue(request)[m
[32m+[m
[32m+[m[32m            val outputData = workDataOf("DOWNLOAD_ID" to downloadId)[m
[32m+[m[32m            Result.success(outputData)[m
[32m+[m
[32m+[m[32m        } catch (e: Exception) {[m
[32m+[m[32m            e.printStackTrace()[m
[32m+[m[32m            Result.failure()[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    companion object {[m
[32m+[m[32m        const val KEY_FILE_URL = "key_file_url"[m
[32m+[m[32m        const val KEY_FILE_NAME = "key_file_name"[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/feature_document_detail/ui/detail/DocumentDetailScreen.kt b/app/src/main/java/com/example/stushare/feature_document_detail/ui/detail/DocumentDetailScreen.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..9e431f4[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/feature_document_detail/ui/detail/DocumentDetailScreen.kt[m
[36m@@ -0,0 +1,484 @@[m
[32m+[m[32mpackage com.example.stushare.feature_document_detail.ui.detail[m
[32m+[m
[32m+[m[32mimport android.widget.Toast[m
[32m+[m[32mimport androidx.compose.foundation.BorderStroke[m
[32m+[m[32mimport androidx.compose.foundation.background[m
[32m+[m[32mimport androidx.compose.foundation.clickable[m
[32m+[m[32mimport androidx.compose.foundation.layout.*[m
[32m+[m[32mimport androidx.compose.foundation.lazy.LazyColumn[m
[32m+[m[32mimport androidx.compose.foundation.lazy.items[m
[32m+[m[32mimport androidx.compose.foundation.selection.selectable[m
[32m+[m[32mimport androidx.compose.foundation.shape.CircleShape[m
[32m+[m[32mimport androidx.compose.foundation.shape.RoundedCornerShape[m
[32m+[m[32mimport androidx.compose.foundation.text.KeyboardActions[m
[32m+[m[32mimport androidx.compose.foundation.text.KeyboardOptions[m
[32m+[m[32mimport androidx.compose.material.icons.Icons[m
[32m+[m[32mimport androidx.compose.material.icons.automirrored.filled.ArrowBack[m
[32m+[m[32mimport androidx.compose.material.icons.automirrored.filled.Send[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Bookmark[m
[32m+[m[32mimport androidx.compose.material.icons.filled.BookmarkBorder[m
[32m+[m[32mimport androidx.compose.material.icons.filled.ChatBubbleOutline[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Close[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Download[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Flag // üü¢ Icon B√°o c√°o[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Star[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Visibility[m
[32m+[m[32mimport androidx.compose.material3.*[m
[32m+[m[32mimport androidx.compose.runtime.*[m
[32m+[m[32mimport androidx.compose.ui.Alignment[m
[32m+[m[32mimport androidx.compose.ui.Modifier[m
[32m+[m[32mimport androidx.compose.ui.draw.clip[m
[32m+[m[32mimport androidx.compose.ui.graphics.Color[m
[32m+[m[32mimport androidx.compose.ui.layout.ContentScale[m
[32m+[m[32mimport androidx.compose.ui.platform.LocalContext[m
[32m+[m[32mimport androidx.compose.ui.text.font.FontWeight[m
[32m+[m[32mimport androidx.compose.ui.text.input.ImeAction[m
[32m+[m[32mimport androidx.compose.ui.unit.dp[m
[32m+[m[32mimport androidx.compose.ui.unit.sp[m
[32m+[m[32mimport androidx.hilt.navigation.compose.hiltViewModel[m
[32m+[m[32mimport androidx.lifecycle.compose.collectAsStateWithLifecycle[m
[32m+[m[32mimport coil.compose.AsyncImage[m
[32m+[m[32mimport com.example.stushare.core.data.models.CommentEntity[m
[32m+[m[32mimport com.example.stushare.core.data.models.Document[m
[32m+[m[32mimport com.example.stushare.features.feature_document_detail.ui.detail.DetailUiState[m
[32m+[m[32mimport com.example.stushare.features.feature_document_detail.ui.detail.DocumentDetailViewModel[m
[32m+[m[32mimport com.example.stushare.ui.theme.PrimaryGreen[m
[32m+[m[32mimport kotlinx.coroutines.flow.collectLatest[m
[32m+[m[32mimport com.google.firebase.auth.FirebaseAuth[m
[32m+[m[32mimport java.text.SimpleDateFormat[m
[32m+[m[32mimport java.util.Locale[m
[32m+[m
[32m+[m[32m@OptIn(ExperimentalMaterial3Api::class)[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun DocumentDetailScreen([m
[32m+[m[32m    documentId: String,[m
[32m+[m[32m    onBackClick: () -> Unit,[m
[32m+[m[32m    onLoginRequired: () -> Unit,[m
[32m+[m[32m    onReadPdf: (String, String) -> Unit,[m
[32m+[m[32m    viewModel: DocumentDetailViewModel = hiltViewModel()[m
[32m+[m[32m) {[m
[32m+[m[32m    val uiState by viewModel.uiState.collectAsStateWithLifecycle()[m
[32m+[m[32m    val isBookmarked by viewModel.isBookmarked.collectAsStateWithLifecycle()[m
[32m+[m[32m    val comments by viewModel.comments.collectAsStateWithLifecycle()[m
[32m+[m[32m    val isSendingComment by viewModel.isSendingComment.collectAsStateWithLifecycle()[m
[32m+[m
[32m+[m[32m    var showRatingDialog by remember { mutableStateOf(false) }[m
[32m+[m[32m    // üü¢ M·ªöI: Tr·∫°ng th√°i hi·ªÉn th·ªã h·ªôp tho·∫°i b√°o c√°o[m
[32m+[m[32m    var showReportDialog by remember { mutableStateOf(false) }[m
[32m+[m
[32m+[m[32m    val snackbarHostState = remember { SnackbarHostState() }[m
[32m+[m[32m    val context = LocalContext.current[m
[32m+[m[32m    val currentUser = remember { FirebaseAuth.getInstance().currentUser }[m
[32m+[m[32m    val isLoggedIn = currentUser != null[m
[32m+[m
[32m+[m[32m    LaunchedEffect(key1 = documentId) {[m
[32m+[m[32m        viewModel.getDocumentById(documentId)[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    LaunchedEffect(key1 = Unit) {[m
[32m+[m[32m        viewModel.snackbarEvent.collectLatest { message ->[m
[32m+[m[32m            snackbarHostState.showSnackbar(message)[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    Scaffold([m
[32m+[m[32m        topBar = {[m
[32m+[m[32m            CenterAlignedTopAppBar([m
[32m+[m[32m                title = { Text("Chi ti·∫øt t√†i li·ªáu", fontWeight = FontWeight.Bold) },[m
[32m+[m[32m                navigationIcon = {[m
[32m+[m[32m                    IconButton(onClick = onBackClick) {[m
[32m+[m[32m                        Icon(Icons.AutoMirrored.Filled.ArrowBack, contentDescription = "Quay v·ªÅ")[m
[32m+[m[32m                    }[m
[32m+[m[32m                },[m
[32m+[m[32m                actions = {[m
[32m+[m[32m                    // üü¢ N√∫t B√°o c√°o (Report)[m
[32m+[m[32m                    IconButton(onClick = {[m
[32m+[m[32m                        if (isLoggedIn) showReportDialog = true[m
[32m+[m[32m                        else onLoginRequired()[m
[32m+[m[32m                    }) {[m
[32m+[m[32m                        Icon([m
[32m+[m[32m                            imageVector = Icons.Filled.Flag,[m
[32m+[m[32m                            contentDescription = "B√°o c√°o",[m
[32m+[m[32m                            tint = Color.Red // M√†u ƒë·ªè c·∫£nh b√°o[m
[32m+[m[32m                        )[m
[32m+[m[32m                    }[m
[32m+[m
[32m+[m[32m                    IconButton(onClick = {[m
[32m+[m[32m                        if (isLoggedIn) {[m
[32m+[m[32m                            if (uiState is DetailUiState.Success) {[m
[32m+[m[32m                                val doc = (uiState as DetailUiState.Success).document[m
[32m+[m[32m                                viewModel.onBookmarkClick(doc.id)[m
[32m+[m[32m                            }[m
[32m+[m[32m                        } else {[m
[32m+[m[32m                            onLoginRequired()[m
[32m+[m[32m                        }[m
[32m+[m[32m                    }) {[m
[32m+[m[32m                        Icon([m
[32m+[m[32m                            imageVector = if (isBookmarked) Icons.Filled.Bookmark else Icons.Filled.BookmarkBorder,[m
[32m+[m[32m                            contentDescription = "L∆∞u",[m
[32m+[m[32m                            tint = if (isBookmarked) PrimaryGreen else Color.Gray[m
[32m+[m[32m                        )[m
[32m+[m[32m                    }[m
[32m+[m[32m                },[m
[32m+[m[32m                colors = TopAppBarDefaults.centerAlignedTopAppBarColors(containerColor = Color.White)[m
[32m+[m[32m            )[m
[32m+[m[32m        },[m
[32m+[m[32m        snackbarHost = { SnackbarHost(snackbarHostState) },[m
[32m+[m[32m        bottomBar = {[m
[32m+[m[32m            if (uiState is DetailUiState.Success) {[m
[32m+[m[32m                val document = (uiState as DetailUiState.Success).document[m
[32m+[m
[32m+[m[32m                Column {[m
[32m+[m[32m                    CommentInputSection([m
[32m+[m[32m                        isLoggedIn = isLoggedIn,[m
[32m+[m[32m                        isSending = isSendingComment,[m
[32m+[m[32m                        onSendComment = { content -> viewModel.sendComment(document.id, content) },[m
[32m+[m[32m                        onLoginRequired = onLoginRequired[m
[32m+[m[32m                    )[m
[32m+[m
[32m+[m[32m                    BottomActionSection([m
[32m+[m[32m                        onDownloadClick = {[m
[32m+[m[32m                            if (isLoggedIn) viewModel.startDownload(document.id, document.fileUrl, document.title, document.authorId)[m
[32m+[m[32m                            else onLoginRequired()[m
[32m+[m[32m                        },[m
[32m+[m[32m                        onReadClick = {[m
[32m+[m[32m                            if (isLoggedIn) {[m
[32m+[m[32m                                if (document.fileUrl.isNotBlank()) onReadPdf(document.fileUrl, document.title)[m
[32m+[m[32m                                else Toast.makeText(context, "L·ªói file", Toast.LENGTH_SHORT).show()[m
[32m+[m[32m                            } else onLoginRequired()[m
[32m+[m[32m                        }[m
[32m+[m[32m                    )[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    ) { paddingValues ->[m
[32m+[m[32m        Box(modifier = Modifier.fillMaxSize().background(Color.White).padding(paddingValues)) {[m
[32m+[m[32m            when (val state = uiState) {[m
[32m+[m[32m                is DetailUiState.Loading -> Box(Modifier.fillMaxSize(), contentAlignment = Alignment.Center) { CircularProgressIndicator(color = PrimaryGreen) }[m
[32m+[m[32m                is DetailUiState.Error -> Box(Modifier.fillMaxSize(), contentAlignment = Alignment.Center) { Text(state.message, color = Color.Red) }[m
[32m+[m[32m                is DetailUiState.Success -> {[m
[32m+[m[32m                    DocumentDetailContentWithComments([m
[32m+[m[32m                        document = state.document,[m
[32m+[m[32m                        comments = comments,[m
[32m+[m[32m                        onRatingClick = {[m
[32m+[m[32m                            if (isLoggedIn) showRatingDialog = true[m
[32m+[m[32m                            else onLoginRequired()[m
[32m+[m[32m                        },[m
[32m+[m[32m                        currentUserId = viewModel.currentUserId,[m
[32m+[m[32m                        onDeleteComment = { commentId ->[m
[32m+[m[32m                            viewModel.deleteComment(state.document.id, commentId)[m
[32m+[m[32m                        }[m
[32m+[m[32m                    )[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        // H·ªôp tho·∫°i ƒë√°nh gi√°[m
[32m+[m[32m        if (showRatingDialog && uiState is DetailUiState.Success) {[m
[32m+[m[32m            val doc = (uiState as DetailUiState.Success).document[m
[32m+[m[32m            RatingDialog([m
[32m+[m[32m                onDismiss = { showRatingDialog = false },[m
[32m+[m[32m                onRate = { rating ->[m
[32m+[m[32m                    viewModel.onRateDocument(doc.id, rating)[m
[32m+[m[32m                    showRatingDialog = false[m
[32m+[m[32m                }[m
[32m+[m[32m            )[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        // üü¢ M·ªöI: H·ªôp tho·∫°i b√°o c√°o[m
[32m+[m[32m        if (showReportDialog && uiState is DetailUiState.Success) {[m
[32m+[m[32m            val doc = (uiState as DetailUiState.Success).document[m
[32m+[m[32m            ReportDialog([m
[32m+[m[32m                onDismiss = { showReportDialog = false },[m
[32m+[m[32m                onSubmit = { reason ->[m
[32m+[m[32m                    viewModel.onReportDocument(doc.id, doc.title, reason)[m
[32m+[m[32m                    showReportDialog = false[m
[32m+[m[32m                }[m
[32m+[m[32m            )[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m// üü¢ M·ªöI: Composable ReportDialog t√°ch ri√™ng[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun ReportDialog([m
[32m+[m[32m    onDismiss: () -> Unit,[m
[32m+[m[32m    onSubmit: (String) -> Unit[m
[32m+[m[32m) {[m
[32m+[m[32m    val reasons = listOf([m
[32m+[m[32m        "N·ªôi dung sai s·ª± th·∫≠t/Kh√¥ng ch√≠nh x√°c",[m
[32m+[m[32m        "Vi ph·∫°m b·∫£n quy·ªÅn",[m
[32m+[m[32m        "N·ªôi dung ph·∫£n c·∫£m/Spam",[m
[32m+[m[32m        "T√†i li·ªáu b·ªã l·ªói kh√¥ng xem ƒë∆∞·ª£c",[m
[32m+[m[32m        "Kh√°c"[m
[32m+[m[32m    )[m
[32m+[m[32m    // M·∫∑c ƒë·ªãnh ch·ªçn l√Ω do ƒë·∫ßu ti√™n[m
[32m+[m[32m    var selectedReason by remember { mutableStateOf(reasons[0]) }[m
[32m+[m
[32m+[m[32m    AlertDialog([m
[32m+[m[32m        onDismissRequest = onDismiss,[m
[32m+[m[32m        title = { Text(text = "B√°o c√°o t√†i li·ªáu", fontWeight = FontWeight.Bold) },[m
[32m+[m[32m        text = {[m
[32m+[m[32m            Column {[m
[32m+[m[32m                Text("Vui l√≤ng ch·ªçn l√Ω do:", fontSize = 14.sp, color = Color.Gray)[m
[32m+[m[32m                Spacer(modifier = Modifier.height(12.dp))[m
[32m+[m
[32m+[m[32m                reasons.forEach { reason ->[m
[32m+[m[32m                    Row([m
[32m+[m[32m                        Modifier[m
[32m+[m[32m                            .fillMaxWidth()[m
[32m+[m[32m                            .selectable([m
[32m+[m[32m                                selected = (reason == selectedReason),[m
[32m+[m[32m                                onClick = { selectedReason = reason }[m
[32m+[m[32m                            )[m
[32m+[m[32m                            .padding(vertical = 4.dp),[m
[32m+[m[32m                        verticalAlignment = Alignment.CenterVertically[m
[32m+[m[32m                    ) {[m
[32m+[m[32m                        RadioButton([m
[32m+[m[32m                            selected = (reason == selectedReason),[m
[32m+[m[32m                            onClick = { selectedReason = reason },[m
[32m+[m[32m                            colors = RadioButtonDefaults.colors(selectedColor = Color.Red)[m
[32m+[m[32m                        )[m
[32m+[m[32m                        Text([m
[32m+[m[32m                            text = reason,[m
[32m+[m[32m                            style = MaterialTheme.typography.bodyMedium,[m
[32m+[m[32m                            modifier = Modifier.padding(start = 8.dp)[m
[32m+[m[32m                        )[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m[32m        },[m
[32m+[m[32m        confirmButton = {[m
[32m+[m[32m            TextButton([m
[32m+[m[32m                onClick = { onSubmit(selectedReason) },[m
[32m+[m[32m                colors = ButtonDefaults.textButtonColors(contentColor = Color.Red)[m
[32m+[m[32m            ) {[m
[32m+[m[32m                Text("G·ª≠i b√°o c√°o", fontWeight = FontWeight.Bold)[m
[32m+[m[32m            }[m
[32m+[m[32m        },[m
[32m+[m[32m        dismissButton = {[m
[32m+[m[32m            TextButton(onClick = onDismiss) {[m
[32m+[m[32m                Text("H·ªßy", color = Color.Gray)[m
[32m+[m[32m            }[m
[32m+[m[32m        },[m
[32m+[m[32m        containerColor = Color.White,[m
[32m+[m[32m        shape = RoundedCornerShape(16.dp)[m
[32m+[m[32m    )[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun DocumentDetailContentWithComments([m
[32m+[m[32m    document: Document,[m
[32m+[m[32m    comments: List<CommentEntity>,[m
[32m+[m[32m    onRatingClick: () -> Unit,[m
[32m+[m[32m    currentUserId: String?,[m
[32m+[m[32m    onDeleteComment: (String) -> Unit[m
[32m+[m[32m) {[m
[32m+[m[32m    LazyColumn([m
[32m+[m[32m        modifier = Modifier.fillMaxSize(),[m
[32m+[m[32m        contentPadding = PaddingValues(20.dp),[m
[32m+[m[32m        verticalArrangement = Arrangement.spacedBy(16.dp)[m
[32m+[m[32m    ) {[m
[32m+[m[32m        item {[m
[32m+[m[32m            Box(Modifier.fillMaxWidth(), contentAlignment = Alignment.Center) {[m
[32m+[m[32m                AsyncImage([m
[32m+[m[32m                    model = document.imageUrl,[m
[32m+[m[32m                    contentDescription = null,[m
[32m+[m[32m                    modifier = Modifier.width(160.dp).aspectRatio(0.7f).clip(RoundedCornerShape(16.dp)).background(Color.LightGray.copy(alpha = 0.2f)),[m
[32m+[m[32m                    contentScale = ContentScale.Crop[m
[32m+[m[32m                )[m
[32m+[m[32m            }[m
[32m+[m[32m            Spacer(Modifier.height(24.dp))[m
[32m+[m[32m            Text(document.title, style = MaterialTheme.typography.titleLarge, fontWeight = FontWeight.Bold)[m
[32m+[m[32m            Spacer(Modifier.height(8.dp))[m
[32m+[m[32m            Text("T√°c gi·∫£: ${document.author}", style = MaterialTheme.typography.bodyMedium, color = Color.Gray)[m
[32m+[m[32m            Spacer(Modifier.height(16.dp))[m
[32m+[m[32m            Row(horizontalArrangement = Arrangement.spacedBy(12.dp)) {[m
[32m+[m[32m                Surface([m
[32m+[m[32m                    onClick = onRatingClick,[m
[32m+[m[32m                    shape = RoundedCornerShape(8.dp),[m
[32m+[m[32m                    color = Color.Transparent[m
[32m+[m[32m                ) {[m
[32m+[m[32m                    BadgeInfo(Icons.Filled.Star, "%.1f".format(document.rating), Color(0xFFFFC107))[m
[32m+[m[32m                }[m
[32m+[m
[32m+[m[32m                BadgeInfo(Icons.Filled.Download, "${document.downloads} l∆∞·ª£t t·∫£i", PrimaryGreen)[m
[32m+[m[32m                BadgeInfo(Icons.Default.ChatBubbleOutline, "${comments.size} b√¨nh lu·∫≠n", Color.Gray)[m
[32m+[m[32m            }[m
[32m+[m[32m            Spacer(Modifier.height(24.dp))[m
[32m+[m[32m            Divider(color = Color.LightGray.copy(alpha = 0.2f))[m
[32m+[m[32m            Spacer(Modifier.height(24.dp))[m
[32m+[m[32m            DetailSection("M√¥ t·∫£ t√†i li·ªáu", document.description.ifBlank { "Ch∆∞a c√≥ m√¥ t·∫£." })[m
[32m+[m[32m            DetailSection("Th√¥ng tin th√™m", "‚Ä¢ M√£ m√¥n: ${document.courseCode}\n‚Ä¢ Lo·∫°i: ${document.type}")[m
[32m+[m[32m            Spacer(Modifier.height(24.dp))[m
[32m+[m[32m            Divider(color = Color.LightGray.copy(alpha = 0.2f))[m
[32m+[m[32m            Spacer(Modifier.height(16.dp))[m
[32m+[m[32m            Text("B√¨nh lu·∫≠n (${comments.size})", style = MaterialTheme.typography.titleMedium, fontWeight = FontWeight.Bold)[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        if (comments.isEmpty()) {[m
[32m+[m[32m            item {[m
[32m+[m[32m                Text("Ch∆∞a c√≥ b√¨nh lu·∫≠n n√†o.", style = MaterialTheme.typography.bodyMedium, color = Color.Gray, modifier = Modifier.padding(vertical = 16.dp))[m
[32m+[m[32m            }[m
[32m+[m[32m        } else {[m
[32m+[m[32m            items(comments) { comment ->[m
[32m+[m[32m                CommentItem([m
[32m+[m[32m                    comment = comment,[m
[32m+[m[32m                    isOwnComment = comment.userId == currentUserId,[m
[32m+[m[32m                    onDelete = { onDeleteComment(comment.id) }[m
[32m+[m[32m                )[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        item { Spacer(modifier = Modifier.height(80.dp)) }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun RatingDialog([m
[32m+[m[32m    onDismiss: () -> Unit,[m
[32m+[m[32m    onRate: (Int) -> Unit[m
[32m+[m[32m) {[m
[32m+[m[32m    AlertDialog([m
[32m+[m[32m        onDismissRequest = onDismiss,[m
[32m+[m[32m        title = { Text("ƒê√°nh gi√° t√†i li·ªáu", fontWeight = FontWeight.Bold, fontSize = 18.sp) },[m
[32m+[m[32m        text = {[m
[32m+[m[32m            Column([m
[32m+[m[32m                modifier = Modifier.fillMaxWidth(),[m
[32m+[m[32m                horizontalAlignment = Alignment.CenterHorizontally[m
[32m+[m[32m            ) {[m
[32m+[m[32m                Text("B·∫°n th·∫•y t√†i li·ªáu n√†y th·∫ø n√†o?", color = Color.Gray)[m
[32m+[m[32m                Spacer(modifier = Modifier.height(16.dp))[m
[32m+[m[32m                RatingBar(currentRating = 0, onRatingChanged = onRate)[m
[32m+[m[32m            }[m
[32m+[m[32m        },[m
[32m+[m[32m        confirmButton = {[m
[32m+[m[32m            TextButton(onClick = onDismiss) { Text("ƒê√≥ng", color = Color.Gray) }[m
[32m+[m[32m        },[m
[32m+[m[32m        containerColor = Color.White[m
[32m+[m[32m    )[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun RatingBar([m
[32m+[m[32m    currentRating: Int,[m
[32m+[m[32m    onRatingChanged: (Int) -> Unit[m
[32m+[m[32m) {[m
[32m+[m[32m    var rating by remember { mutableIntStateOf(currentRating) }[m
[32m+[m
[32m+[m[32m    Row(horizontalArrangement = Arrangement.Center) {[m
[32m+[m[32m        for (i in 1..5) {[m
[32m+[m[32m            IconButton([m
[32m+[m[32m                onClick = {[m
[32m+[m[32m                    rating = i[m
[32m+[m[32m                    onRatingChanged(i)[m
[32m+[m[32m                }[m
[32m+[m[32m            ) {[m
[32m+[m[32m                Icon([m
[32m+[m[32m                    imageVector = Icons.Filled.Star,[m
[32m+[m[32m                    contentDescription = "$i Star",[m
[32m+[m[32m                    tint = if (i <= rating) Color(0xFFFFC107) else Color.LightGray.copy(alpha = 0.5f),[m
[32m+[m[32m                    modifier = Modifier.size(36.dp)[m
[32m+[m[32m                )[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun CommentItem([m
[32m+[m[32m    comment: CommentEntity,[m
[32m+[m[32m    isOwnComment: Boolean,[m
[32m+[m[32m    onDelete: () -> Unit[m
[32m+[m[32m) {[m
[32m+[m[32m    Row(modifier = Modifier.fillMaxWidth().padding(vertical = 8.dp)) {[m
[32m+[m[32m        AsyncImage([m
[32m+[m[32m            model = comment.userAvatar ?: "https://ui-avatars.com/api/?name=${comment.userName}",[m
[32m+[m[32m            contentDescription = null,[m
[32m+[m[32m            modifier = Modifier.size(40.dp).clip(CircleShape).background(Color.LightGray),[m
[32m+[m[32m            contentScale = ContentScale.Crop[m
[32m+[m[32m        )[m
[32m+[m[32m        Spacer(modifier = Modifier.width(12.dp))[m
[32m+[m[32m        Column(modifier = Modifier.weight(1f)) {[m
[32m+[m[32m            Row([m
[32m+[m[32m                verticalAlignment = Alignment.CenterVertically,[m
[32m+[m[32m                horizontalArrangement = Arrangement.SpaceBetween,[m
[32m+[m[32m                modifier = Modifier.fillMaxWidth()[m
[32m+[m[32m            ) {[m
[32m+[m[32m                Row(verticalAlignment = Alignment.CenterVertically) {[m
[32m+[m[32m                    Text(comment.userName, fontWeight = FontWeight.Bold, fontSize = 14.sp)[m
[32m+[m[32m                    Spacer(modifier = Modifier.width(8.dp))[m
[32m+[m[32m                    val dateStr = comment.timestamp?.let {[m
[32m+[m[32m                        SimpleDateFormat("dd/MM/yyyy", Locale.getDefault()).format(it)[m
[32m+[m[32m                    } ?: "V·ª´a xong"[m
[32m+[m[32m                    Text(dateStr, fontSize = 12.sp, color = Color.Gray)[m
[32m+[m[32m                }[m
[32m+[m
[32m+[m[32m                if (isOwnComment) {[m
[32m+[m[32m                    IconButton(onClick = onDelete, modifier = Modifier.size(24.dp)) {[m
[32m+[m[32m                        Icon([m
[32m+[m[32m                            imageVector = Icons.Default.Close,[m
[32m+[m[32m                            contentDescription = "X√≥a",[m
[32m+[m[32m                            tint = Color.Gray.copy(alpha = 0.6f),[m
[32m+[m[32m                            modifier = Modifier.size(16.dp)[m
[32m+[m[32m                        )[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m[32m            Spacer(modifier = Modifier.height(4.dp))[m
[32m+[m[32m            Text(comment.content, fontSize = 14.sp, color = MaterialTheme.colorScheme.onSurface)[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun CommentInputSection(isLoggedIn: Boolean, isSending: Boolean, onSendComment: (String) -> Unit, onLoginRequired: () -> Unit) {[m
[32m+[m[32m    var text by remember { mutableStateOf("") }[m
[32m+[m[32m    Surface(shadowElevation = 8.dp, color = Color.White, modifier = Modifier.fillMaxWidth()) {[m
[32m+[m[32m        Row(modifier = Modifier.padding(horizontal = 16.dp, vertical = 12.dp).navigationBarsPadding(), verticalAlignment = Alignment.CenterVertically) {[m
[32m+[m[32m            OutlinedTextField([m
[32m+[m[32m                value = text, onValueChange = { text = it }, placeholder = { Text("Vi·∫øt b√¨nh lu·∫≠n...") },[m
[32m+[m[32m                modifier = Modifier.weight(1f), shape = RoundedCornerShape(24.dp), maxLines = 3, enabled = !isSending,[m
[32m+[m[32m                keyboardOptions = KeyboardOptions(imeAction = ImeAction.Send),[m
[32m+[m[32m                keyboardActions = KeyboardActions(onSend = { if (isLoggedIn) { if (text.isNotBlank()) { onSendComment(text); text = "" } } else onLoginRequired() })[m
[32m+[m[32m            )[m
[32m+[m[32m            Spacer(Modifier.width(8.dp))[m
[32m+[m[32m            IconButton(onClick = { if (isLoggedIn) { if (text.isNotBlank()) { onSendComment(text); text = "" } } else onLoginRequired() }, enabled = text.isNotBlank() && !isSending, modifier = Modifier.background(if (text.isNotBlank()) PrimaryGreen else Color.LightGray, CircleShape)) {[m
[32m+[m[32m                if (isSending) CircularProgressIndicator(Modifier.size(24.dp), Color.White, 2.dp) else Icon(Icons.AutoMirrored.Filled.Send, "G·ª≠i", tint = Color.White)[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun BadgeInfo(icon: androidx.compose.ui.graphics.vector.ImageVector, text: String, color: Color) {[m
[32m+[m[32m    Row(verticalAlignment = Alignment.CenterVertically, modifier = Modifier.background(color.copy(alpha = 0.1f), RoundedCornerShape(8.dp)).padding(horizontal = 12.dp, vertical = 8.dp)) {[m
[32m+[m[32m        Icon(imageVector = icon, contentDescription = null, tint = color, modifier = Modifier.size(18.dp))[m
[32m+[m[32m        Spacer(modifier = Modifier.width(6.dp))[m
[32m+[m[32m        Text(text = text, style = MaterialTheme.typography.labelMedium, color = Color.Black.copy(alpha = 0.8f), fontWeight = FontWeight.Medium)[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun DetailSection(title: String, content: String) {[m
[32m+[m[32m    Column(modifier = Modifier.fillMaxWidth()) {[m
[32m+[m[32m        Text(text = title, style = MaterialTheme.typography.titleMedium, fontWeight = FontWeight.Bold, color = MaterialTheme.colorScheme.onSurface)[m
[32m+[m[32m        Spacer(modifier = Modifier.height(8.dp))[m
[32m+[m[32m        Text(text = content, style = MaterialTheme.typography.bodyMedium, color = MaterialTheme.colorScheme.onSurfaceVariant, lineHeight = 24.sp)[m
[32m+[m[32m        Spacer(modifier = Modifier.height(24.dp))[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun BottomActionSection(onDownloadClick: () -> Unit, onReadClick: () -> Unit) {[m
[32m+[m[32m    Surface(modifier = Modifier.fillMaxWidth(), shadowElevation = 16.dp, color = Color.White) {[m
[32m+[m[32m        Row(modifier = Modifier.padding(20.dp).navigationBarsPadding(), verticalAlignment = Alignment.CenterVertically, horizontalArrangement = Arrangement.spacedBy(16.dp)) {[m
[32m+[m[32m            OutlinedButton(onClick = onReadClick, modifier = Modifier.weight(1f).height(54.dp), shape = RoundedCornerShape(16.dp), border = BorderStroke(1.dp, PrimaryGreen)) {[m
[32m+[m[32m                Icon(Icons.Default.Visibility, null, tint = PrimaryGreen); Spacer(Modifier.width(8.dp)); Text("ƒê·ªçc th·ª≠", style = MaterialTheme.typography.titleSmall, color = PrimaryGreen, fontWeight = FontWeight.Bold)[m
[32m+[m[32m            }[m
[32m+[m[32m            Button(onClick = onDownloadClick, modifier = Modifier.weight(1f).height(54.dp), shape = RoundedCornerShape(16.dp), colors = ButtonDefaults.buttonColors(containerColor = PrimaryGreen), elevation = ButtonDefaults.buttonElevation(4.dp)) {[m
[32m+[m[32m                Icon(Icons.Filled.Download, null); Spacer(Modifier.width(8.dp)); Text("T·∫£i v·ªÅ", style = MaterialTheme.typography.titleSmall, color = Color.White, fontWeight = FontWeight.Bold)[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/feature_document_detail/ui/detail/DocumentDetailViewModel.kt b/app/src/main/java/com/example/stushare/feature_document_detail/ui/detail/DocumentDetailViewModel.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..1915e87[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/feature_document_detail/ui/detail/DocumentDetailViewModel.kt[m
[36m@@ -0,0 +1,176 @@[m
[32m+[m[32mpackage com.example.stushare.features.feature_document_detail.ui.detail[m
[32m+[m
[32m+[m[32mimport androidx.lifecycle.ViewModel[m
[32m+[m[32mimport androidx.lifecycle.viewModelScope[m
[32m+[m[32mimport com.example.stushare.core.data.models.CommentEntity[m
[32m+[m[32mimport com.example.stushare.core.data.models.Document[m
[32m+[m[32mimport com.example.stushare.core.data.repository.DocumentRepository[m
[32m+[m[32mimport com.example.stushare.core.utils.AndroidDownloader[m
[32m+[m[32mimport com.example.stushare.core.utils.AndroidFileOpener[m
[32m+[m[32mimport com.google.firebase.auth.FirebaseAuth[m
[32m+[m[32mimport dagger.hilt.android.lifecycle.HiltViewModel[m
[32m+[m[32mimport kotlinx.coroutines.flow.MutableSharedFlow[m
[32m+[m[32mimport kotlinx.coroutines.flow.MutableStateFlow[m
[32m+[m[32mimport kotlinx.coroutines.flow.StateFlow[m
[32m+[m[32mimport kotlinx.coroutines.flow.asSharedFlow[m
[32m+[m[32mimport kotlinx.coroutines.flow.asStateFlow[m
[32m+[m[32mimport kotlinx.coroutines.flow.catch[m
[32m+[m[32mimport kotlinx.coroutines.launch[m
[32m+[m[32mimport javax.inject.Inject[m
[32m+[m
[32m+[m[32msealed interface DetailUiState {[m
[32m+[m[32m    data object Loading : DetailUiState[m
[32m+[m[32m    data class Success(val document: Document) : DetailUiState[m
[32m+[m[32m    data class Error(val message: String) : DetailUiState[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m@HiltViewModel[m
[32m+[m[32mclass DocumentDetailViewModel @Inject constructor([m
[32m+[m[32m    private val repository: DocumentRepository,[m
[32m+[m[32m    private val downloader: AndroidDownloader,[m
[32m+[m[32m    private val fileOpener: AndroidFileOpener,[m
[32m+[m[32m    private val auth: FirebaseAuth[m
[32m+[m[32m) : ViewModel() {[m
[32m+[m
[32m+[m[32m    private val _uiState = MutableStateFlow<DetailUiState>(DetailUiState.Loading)[m
[32m+[m[32m    val uiState: StateFlow<DetailUiState> = _uiState.asStateFlow()[m
[32m+[m
[32m+[m[32m    private val _isBookmarked = MutableStateFlow(false)[m
[32m+[m[32m    val isBookmarked = _isBookmarked.asStateFlow()[m
[32m+[m
[32m+[m[32m    private val _comments = MutableStateFlow<List<CommentEntity>>(emptyList())[m
[32m+[m[32m    val comments: StateFlow<List<CommentEntity>> = _comments.asStateFlow()[m
[32m+[m
[32m+[m[32m    private val _isSendingComment = MutableStateFlow(false)[m
[32m+[m[32m    val isSendingComment = _isSendingComment.asStateFlow()[m
[32m+[m
[32m+[m[32m    private val _snackbarEvent = MutableSharedFlow<String>()[m
[32m+[m[32m    val snackbarEvent = _snackbarEvent.asSharedFlow()[m
[32m+[m
[32m+[m[32m    val currentUserId = auth.currentUser?.uid[m
[32m+[m
[32m+[m[32m    fun getDocumentById(documentId: String) {[m
[32m+[m[32m        viewModelScope.launch {[m
[32m+[m[32m            _uiState.value = DetailUiState.Loading[m
[32m+[m[32m            repository.getDocumentById(documentId).collect { documentFromDb ->[m
[32m+[m[32m                if (documentFromDb == null) {[m
[32m+[m[32m                    _uiState.value = DetailUiState.Error("ƒêang t·∫£i d·ªØ li·ªáu...")[m
[32m+[m[32m                    repository.refreshDocumentsIfStale()[m
[32m+[m[32m                } else {[m
[32m+[m[32m                    _uiState.value = DetailUiState.Success(documentFromDb)[m
[32m+[m[32m                    checkIfBookmarked(documentId)[m
[32m+[m[32m                    getComments(documentId)[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    private fun getComments(documentId: String) {[m
[32m+[m[32m        viewModelScope.launch {[m
[32m+[m[32m            repository.getComments(documentId)[m
[32m+[m[32m                .catch { e ->[m[41m [m
[32m+[m[32m                    e.printStackTrace()[m[41m [m
[32m+[m[32m                    emit(emptyList())[m
[32m+[m[32m                }[m
[32m+[m[32m                .collect { list ->[m
[32m+[m[32m                    _comments.value = list[m
[32m+[m[32m                }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    fun sendComment(documentId: String, content: String) {[m
[32m+[m[32m        if (content.isBlank()) return[m
[32m+[m[32m        viewModelScope.launch {[m
[32m+[m[32m            _isSendingComment.value = true[m
[32m+[m[32m            val result = repository.sendComment(documentId, content)[m
[32m+[m[32m            _isSendingComment.value = false[m
[32m+[m[32m            if (result.isFailure) {[m
[32m+[m[32m                _snackbarEvent.emit("G·ª≠i th·∫•t b·∫°i: ${result.exceptionOrNull()?.message}")[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    fun deleteComment(documentId: String, commentId: String) {[m
[32m+[m[32m        viewModelScope.launch {[m
[32m+[m[32m            val result = repository.deleteComment(documentId, commentId)[m
[32m+[m[32m            if (result.isSuccess) {[m
[32m+[m[32m                _snackbarEvent.emit("ƒê√£ x√≥a b√¨nh lu·∫≠n")[m
[32m+[m[32m            } else {[m
[32m+[m[32m                _snackbarEvent.emit("X√≥a th·∫•t b·∫°i: ${result.exceptionOrNull()?.message}")[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    private fun checkIfBookmarked(documentId: String) {[m
[32m+[m[32m        viewModelScope.launch {[m
[32m+[m[32m            val result = repository.isDocumentBookmarked(documentId)[m
[32m+[m[32m            if (result.isSuccess) _isBookmarked.value = result.getOrDefault(false)[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    fun onBookmarkClick(documentId: String) {[m
[32m+[m[32m        viewModelScope.launch {[m
[32m+[m[32m            val newState = !_isBookmarked.value[m
[32m+[m[32m            _isBookmarked.value = newState[m
[32m+[m[32m            val result = repository.toggleBookmark(documentId, newState)[m
[32m+[m[32m            if (result.isFailure) {[m
[32m+[m[32m                _isBookmarked.value = !newState[m
[32m+[m[32m                _snackbarEvent.emit("L·ªói: Kh√¥ng th·ªÉ l∆∞u tr·∫°ng th√°i")[m
[32m+[m[32m            } else {[m
[32m+[m[32m                val msg = if (newState) "ƒê√£ l∆∞u v√†o danh s√°ch xem sau" else "ƒê√£ b·ªè l∆∞u"[m
[32m+[m[32m                _snackbarEvent.emit(msg)[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    fun startDownload(documentId: String, url: String, title: String, authorId: String?) {[m
[32m+[m[32m        if (url.isBlank()) {[m
[32m+[m[32m            viewModelScope.launch { _snackbarEvent.emit("L·ªói: Link t·∫£i b·ªã h·ªèng") }[m
[32m+[m[32m            return[m
[32m+[m[32m        }[m
[32m+[m[32m        val fileExtension = getFileExtension(url)[m
[32m+[m[32m        val fileName = "[StuShare] $title.$fileExtension"[m
[32m+[m[32m        downloader.downloadFile(url, fileName)[m
[32m+[m[32m        viewModelScope.launch {[m
[32m+[m[32m            _snackbarEvent.emit("ƒêang b·∫Øt ƒë·∫ßu t·∫£i xu·ªëng...")[m
[32m+[m[32m            repository.incrementDownloadCount(documentId, authorId, title)[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    fun openDocumentOnline(url: String) {[m
[32m+[m[32m        fileOpener.openFile(url)[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    fun onRateDocument(documentId: String, rating: Int) {[m
[32m+[m[32m        viewModelScope.launch {[m
[32m+[m[32m            val result = repository.rateDocument(documentId, rating)[m
[32m+[m[32m            if (result.isSuccess) {[m
[32m+[m[32m                _snackbarEvent.emit("C·∫£m ∆°n b·∫°n ƒë√£ ƒë√°nh gi√° $rating sao! ‚≠êÔ∏è")[m
[32m+[m[32m                getDocumentById(documentId)[m
[32m+[m[32m            } else {[m
[32m+[m[32m                _snackbarEvent.emit("L·ªói ƒë√°nh gi√°: ${result.exceptionOrNull()?.message}")[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    fun onReportDocument(documentId: String, documentTitle: String, reason: String) {[m
[32m+[m[32m        viewModelScope.launch {[m
[32m+[m[32m            val result = repository.reportDocument(documentId, documentTitle, reason)[m
[32m+[m[32m            if (result.isSuccess) {[m
[32m+[m[32m                _snackbarEvent.emit("ƒê√£ g·ª≠i b√°o c√°o. C·∫£m ∆°n ƒë√≥ng g√≥p c·ªßa b·∫°n! ‚úÖ")[m
[32m+[m[32m            } else {[m
[32m+[m[32m                _snackbarEvent.emit("L·ªói g·ª≠i b√°o c√°o: ${result.exceptionOrNull()?.message}")[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    private fun getFileExtension(url: String): String {[m
[32m+[m[32m        return when {[m
[32m+[m[32m            url.contains(".pdf", ignoreCase = true) -> "pdf"[m
[32m+[m[32m            url.contains(".doc", ignoreCase = true) -> "docx"[m
[32m+[m[32m            url.contains(".ppt", ignoreCase = true) -> "pptx"[m
[32m+[m[32m            url.contains(".xls", ignoreCase = true) -> "xlsx"[m
[32m+[m[32m            else -> "bin"[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/feature_document_detail/ui/detail/DocumentSectionHeader.kt b/app/src/main/java/com/example/stushare/feature_document_detail/ui/detail/DocumentSectionHeader.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..c750773[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/feature_document_detail/ui/detail/DocumentSectionHeader.kt[m
[36m@@ -0,0 +1,43 @@[m
[32m+[m[32m// File: DocumentSectionHeader.kt[m
[32m+[m[32mpackage com.example.stushare.features.feature_home.ui.home[m
[32m+[m
[32m+[m[32mimport androidx.compose.foundation.layout.Arrangement[m
[32m+[m[32mimport androidx.compose.foundation.layout.Row[m
[32m+[m[32mimport androidx.compose.foundation.layout.fillMaxWidth[m
[32m+[m[32mimport androidx.compose.foundation.layout.padding[m
[32m+[m[32mimport androidx.compose.material3.MaterialTheme[m
[32m+[m[32mimport androidx.compose.material3.Text[m
[32m+[m[32mimport androidx.compose.material3.TextButton[m
[32m+[m[32mimport androidx.compose.runtime.Composable[m
[32m+[m[32mimport androidx.compose.ui.Alignment[m
[32m+[m[32mimport androidx.compose.ui.Modifier[m
[32m+[m[32mimport androidx.compose.ui.graphics.Color[m
[32m+[m[32mimport androidx.compose.ui.text.font.FontWeight[m
[32m+[m[32mimport androidx.compose.ui.unit.dp[m
[32m+[m[32mimport androidx.compose.ui.unit.sp[m
[32m+[m[32mimport com.example.stushare.ui.theme.PrimaryGreen[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun DocumentSectionHeader([m
[32m+[m[32m    title: String,[m
[32m+[m[32m    onViewAllClick: () -> Unit,[m
[32m+[m[32m    modifier: Modifier = Modifier[m
[32m+[m[32m) {[m
[32m+[m[32m    Row([m
[32m+[m[32m        modifier = modifier[m
[32m+[m[32m            .fillMaxWidth()[m
[32m+[m[32m            .padding(horizontal = 16.dp), // Th√™m padding ngang[m
[32m+[m[32m        verticalAlignment = Alignment.CenterVertically,[m
[32m+[m[32m        horizontalArrangement = Arrangement.SpaceBetween[m
[32m+[m[32m    ) {[m
[32m+[m[32m        Text([m
[32m+[m[32m            text = title,[m
[32m+[m[32m            fontSize = 18.sp,[m
[32m+[m[32m            fontWeight = FontWeight.Bold,[m
[32m+[m[32m            color = Color.Black // Ho·∫∑c d√πng MaterialTheme.colorScheme.onSurface[m
[32m+[m[32m        )[m
[32m+[m[32m        TextButton(onClick = onViewAllClick) {[m
[32m+[m[32m            Text("Xem t·∫•t c·∫£", color = PrimaryGreen)[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/feature_document_detail/ui/pdf/PdfViewerScreen.kt b/app/src/main/java/com/example/stushare/feature_document_detail/ui/pdf/PdfViewerScreen.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..5662c90[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/feature_document_detail/ui/pdf/PdfViewerScreen.kt[m
[36m@@ -0,0 +1,202 @@[m
[32m+[m[32mpackage com.example.stushare.features.feature_document_detail.ui.pdf[m
[32m+[m
[32m+[m[32mimport android.graphics.Bitmap[m
[32m+[m[32mimport android.graphics.pdf.PdfRenderer[m
[32m+[m[32mimport android.os.ParcelFileDescriptor[m
[32m+[m[32mimport android.widget.Toast[m
[32m+[m[32mimport androidx.compose.foundation.Image[m
[32m+[m[32mimport androidx.compose.foundation.background[m
[32m+[m[32mimport androidx.compose.foundation.layout.*[m
[32m+[m[32mimport androidx.compose.foundation.lazy.LazyColumn[m
[32m+[m[32mimport androidx.compose.material.icons.Icons[m
[32m+[m[32mimport androidx.compose.material.icons.automirrored.filled.ArrowBack[m
[32m+[m[32mimport androidx.compose.material3.*[m
[32m+[m[32mimport androidx.compose.runtime.*[m
[32m+[m[32mimport androidx.compose.ui.Alignment[m
[32m+[m[32mimport androidx.compose.ui.Modifier[m
[32m+[m[32mimport androidx.compose.ui.graphics.Color[m
[32m+[m[32mimport androidx.compose.ui.graphics.asImageBitmap[m
[32m+[m[32mimport androidx.compose.ui.layout.ContentScale[m
[32m+[m[32mimport androidx.compose.ui.platform.LocalContext[m
[32m+[m[32mimport androidx.compose.ui.platform.LocalDensity[m
[32m+[m[32mimport androidx.compose.ui.unit.dp[m
[32m+[m[32mimport com.example.stushare.ui.theme.PrimaryGreen[m
[32m+[m[32mimport kotlinx.coroutines.Dispatchers[m
[32m+[m[32mimport kotlinx.coroutines.launch[m
[32m+[m[32mimport kotlinx.coroutines.withContext[m
[32m+[m[32mimport java.io.File[m
[32m+[m[32mimport java.net.URL[m
[32m+[m[32mimport java.net.URLDecoder[m
[32m+[m[32mimport java.nio.charset.StandardCharsets[m
[32m+[m
[32m+[m[32m@OptIn(ExperimentalMaterial3Api::class)[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun PdfViewerScreen([m
[32m+[m[32m    url: String,[m
[32m+[m[32m    title: String,[m
[32m+[m[32m    onBackClick: () -> Unit[m
[32m+[m[32m) {[m
[32m+[m[32m    val context = LocalContext.current[m
[32m+[m[32m    val scope = rememberCoroutineScope()[m
[32m+[m
[32m+[m[32m    // State qu·∫£n l√Ω PdfRenderer v√† s·ªë trang[m
[32m+[m[32m    var pdfRenderer by remember { mutableStateOf<PdfRenderer?>(null) }[m
[32m+[m[32m    var pageCount by remember { mutableIntStateOf(0) }[m
[32m+[m[32m    var isLoading by remember { mutableStateOf(true) }[m
[32m+[m[32m    var errorMessage by remember { mutableStateOf<String?>(null) }[m
[32m+[m
[32m+[m[32m    // T·∫£i file v√† kh·ªüi t·∫°o PdfRenderer[m
[32m+[m[32m    LaunchedEffect(url) {[m
[32m+[m[32m        withContext(Dispatchers.IO) {[m
[32m+[m[32m            try {[m
[32m+[m[32m                // 1. Gi·∫£i m√£ URL v√† t·∫£i file v·ªÅ Cache[m
[32m+[m[32m                val decodedUrl = URLDecoder.decode(url, StandardCharsets.UTF_8.toString())[m
[32m+[m[32m                val connection = URL(decodedUrl).openConnection()[m
[32m+[m[32m                connection.connect()[m
[32m+[m[32m                val inputStream = connection.getInputStream()[m
[32m+[m
[32m+[m[32m                // L∆∞u v√†o file t·∫°m trong b·ªô nh·ªõ cache c·ªßa ·ª©ng d·ª•ng[m
[32m+[m[32m                val file = File(context.cacheDir, "temp_pdf_${System.currentTimeMillis()}.pdf")[m
[32m+[m[32m                file.outputStream().use { output ->[m
[32m+[m[32m                    inputStream.copyTo(output)[m
[32m+[m[32m                }[m
[32m+[m
[32m+[m[32m                // 2. M·ªü file b·∫±ng PdfRenderer[m
[32m+[m[32m                val fileDescriptor = ParcelFileDescriptor.open(file, ParcelFileDescriptor.MODE_READ_ONLY)[m
[32m+[m[32m                val renderer = PdfRenderer(fileDescriptor)[m
[32m+[m
[32m+[m[32m                pdfRenderer = renderer[m
[32m+[m[32m                pageCount = renderer.pageCount[m
[32m+[m[32m                isLoading = false[m
[32m+[m
[32m+[m[32m            } catch (e: Exception) {[m
[32m+[m[32m                e.printStackTrace()[m
[32m+[m[32m                errorMessage = "Kh√¥ng th·ªÉ t·∫£i t√†i li·ªáu: ${e.localizedMessage}"[m
[32m+[m[32m                isLoading = false[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    // D·ªçn d·∫πp b·ªô nh·ªõ khi tho√°t m√†n h√¨nh[m
[32m+[m[32m    DisposableEffect(Unit) {[m
[32m+[m[32m        onDispose {[m
[32m+[m[32m            try {[m
[32m+[m[32m                pdfRenderer?.close()[m
[32m+[m[32m            } catch (e: Exception) {[m
[32m+[m[32m                e.printStackTrace()[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    Scaffold([m
[32m+[m[32m        topBar = {[m
[32m+[m[32m            TopAppBar([m
[32m+[m[32m                title = {[m
[32m+[m[32m                    Text([m
[32m+[m[32m                        text = title,[m
[32m+[m[32m                        style = MaterialTheme.typography.titleMedium,[m
[32m+[m[32m                        maxLines = 1[m
[32m+[m[32m                    )[m
[32m+[m[32m                },[m
[32m+[m[32m                navigationIcon = {[m
[32m+[m[32m                    IconButton(onClick = onBackClick) {[m
[32m+[m[32m                        Icon(Icons.AutoMirrored.Filled.ArrowBack, contentDescription = "Back", tint = Color.White)[m
[32m+[m[32m                    }[m
[32m+[m[32m                },[m
[32m+[m[32m                colors = TopAppBarDefaults.topAppBarColors([m
[32m+[m[32m                    containerColor = PrimaryGreen,[m
[32m+[m[32m                    titleContentColor = Color.White[m
[32m+[m[32m                )[m
[32m+[m[32m            )[m
[32m+[m[32m        }[m
[32m+[m[32m    ) { paddingValues ->[m
[32m+[m[32m        Box([m
[32m+[m[32m            modifier = Modifier[m
[32m+[m[32m                .fillMaxSize()[m
[32m+[m[32m                .padding(paddingValues)[m
[32m+[m[32m                .background(Color.LightGray) // M√†u n·ªÅn x√°m cho d·ªÖ nh√¨n trang gi·∫•y[m
[32m+[m[32m        ) {[m
[32m+[m[32m            if (isLoading) {[m
[32m+[m[32m                CircularProgressIndicator([m
[32m+[m[32m                    modifier = Modifier.align(Alignment.Center),[m
[32m+[m[32m                    color = PrimaryGreen[m
[32m+[m[32m                )[m
[32m+[m[32m            } else if (errorMessage != null) {[m
[32m+[m[32m                Text([m
[32m+[m[32m                    text = errorMessage ?: "L·ªói kh√¥ng x√°c ƒë·ªãnh",[m
[32m+[m[32m                    color = Color.Red,[m
[32m+[m[32m                    modifier = Modifier.align(Alignment.Center).padding(16.dp)[m
[32m+[m[32m                )[m
[32m+[m[32m            } else if (pdfRenderer != null) {[m
[32m+[m[32m                // Hi·ªÉn th·ªã danh s√°ch c√°c trang PDF[m
[32m+[m[32m                LazyColumn([m
[32m+[m[32m                    modifier = Modifier.fillMaxSize(),[m
[32m+[m[32m                    verticalArrangement = Arrangement.spacedBy(8.dp), // Kho·∫£ng c√°ch gi·ªØa c√°c trang[m
[32m+[m[32m                    contentPadding = PaddingValues(16.dp)[m
[32m+[m[32m                ) {[m
[32m+[m[32m                    items(pageCount) { index ->[m
[32m+[m[32m                        PdfPage(renderer = pdfRenderer!!, pageIndex = index)[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun PdfPage(renderer: PdfRenderer, pageIndex: Int) {[m
[32m+[m[32m    // T√≠nh to√°n k√≠ch th∆∞·ªõc m√†n h√¨nh ƒë·ªÉ render trang PDF cho v·ª´a v·∫∑n[m
[32m+[m[32m    val density = LocalDensity.current[m
[32m+[m[32m    val screenWidth = with(density) {[m
[32m+[m[32m        LocalContext.current.resources.displayMetrics.widthPixels[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    var bitmap by remember { mutableStateOf<Bitmap?>(null) }[m
[32m+[m
[32m+[m[32m    // Render trang PDF ra Bitmap (·∫¢nh)[m
[32m+[m[32m    LaunchedEffect(pageIndex) {[m
[32m+[m[32m        withContext(Dispatchers.IO) {[m
[32m+[m[32m            // ƒê·ªìng b·ªô h√≥a ƒë·ªÉ tr√°nh l·ªói render c√πng l√∫c nhi·ªÅu trang[m
[32m+[m[32m            synchronized(renderer) {[m
[32m+[m[32m                try {[m
[32m+[m[32m                    val page = renderer.openPage(pageIndex)[m
[32m+[m
[32m+[m[32m                    // T√≠nh t·ª∑ l·ªá ƒë·ªÉ ·∫£nh s·∫Øc n√©t[m
[32m+[m[32m                    val width = screenWidth[m
[32m+[m[32m                    val height = (screenWidth.toFloat() / page.width * page.height).toInt()[m
[32m+[m
[32m+[m[32m                    val bmp = Bitmap.createBitmap(width, height, Bitmap.Config.ARGB_8888)[m
[32m+[m[32m                    page.render(bmp, null, null, PdfRenderer.Page.RENDER_MODE_FOR_DISPLAY)[m
[32m+[m
[32m+[m[32m                    page.close()[m
[32m+[m[32m                    bitmap = bmp[m
[32m+[m[32m                } catch (e: Exception) {[m
[32m+[m[32m                    e.printStackTrace()[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    if (bitmap != null) {[m
[32m+[m[32m        Image([m
[32m+[m[32m            bitmap = bitmap!!.asImageBitmap(),[m
[32m+[m[32m            contentDescription = "Page ${pageIndex + 1}",[m
[32m+[m[32m            modifier = Modifier[m
[32m+[m[32m                .fillMaxWidth()[m
[32m+[m[32m                .background(Color.White) // Trang gi·∫•y m√†u tr·∫Øng[m
[32m+[m[32m                .wrapContentHeight(),[m
[32m+[m[32m            contentScale = ContentScale.FillWidth[m
[32m+[m[32m        )[m
[32m+[m[32m    } else {[m
[32m+[m[32m        // Placeholder khi ƒëang load trang[m
[32m+[m[32m        Box([m
[32m+[m[32m            modifier = Modifier[m
[32m+[m[32m                .fillMaxWidth()[m
[32m+[m[32m                .height(300.dp)[m
[32m+[m[32m                .background(Color.White),[m
[32m+[m[32m            contentAlignment = Alignment.Center[m
[32m+[m[32m        ) {[m
[32m+[m[32m            CircularProgressIndicator(modifier = Modifier.size(24.dp), strokeWidth = 2.dp)[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/feature_request/ui/create/CreateRequestScreen.kt b/app/src/main/java/com/example/stushare/feature_request/ui/create/CreateRequestScreen.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..8cbf885[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/feature_request/ui/create/CreateRequestScreen.kt[m
[36m@@ -0,0 +1,205 @@[m
[32m+[m[32mpackage com.example.stushare.features.feature_request.ui.create[m
[32m+[m
[32m+[m[32mimport androidx.compose.foundation.background[m
[32m+[m[32mimport androidx.compose.foundation.layout.*[m
[32m+[m[32mimport androidx.compose.foundation.rememberScrollState[m
[32m+[m[32mimport androidx.compose.foundation.shape.RoundedCornerShape[m
[32m+[m[32mimport androidx.compose.foundation.text.KeyboardActions[m
[32m+[m[32mimport androidx.compose.foundation.text.KeyboardOptions[m
[32m+[m[32mimport androidx.compose.foundation.verticalScroll[m
[32m+[m[32mimport androidx.compose.material.icons.Icons[m
[32m+[m[32mimport androidx.compose.material.icons.automirrored.filled.ArrowBack[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Check[m
[32m+[m[32mimport androidx.compose.material3.*[m
[32m+[m[32mimport androidx.compose.runtime.*[m
[32m+[m[32mimport androidx.compose.ui.Alignment[m
[32m+[m[32mimport androidx.compose.ui.Modifier[m
[32m+[m[32mimport androidx.compose.ui.draw.clip[m
[32m+[m[32mimport androidx.compose.ui.graphics.Color[m
[32m+[m[32mimport androidx.compose.ui.platform.LocalFocusManager[m
[32m+[m[32mimport androidx.compose.ui.text.font.FontWeight[m
[32m+[m[32mimport androidx.compose.ui.text.input.ImeAction[m
[32m+[m[32mimport androidx.compose.ui.text.input.KeyboardCapitalization[m
[32m+[m[32mimport androidx.compose.ui.unit.dp[m
[32m+[m[32mimport androidx.compose.ui.unit.sp[m
[32m+[m[32mimport androidx.hilt.navigation.compose.hiltViewModel[m
[32m+[m[32mimport com.example.stushare.ui.theme.PrimaryGreen[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun CreateRequestScreen([m
[32m+[m[32m    onBackClick: () -> Unit,[m
[32m+[m[32m    onSubmitClick: () -> Unit,[m
[32m+[m[32m    viewModel: CreateRequestViewModel = hiltViewModel()[m
[32m+[m[32m) {[m
[32m+[m[32m    var title by remember { mutableStateOf("") }[m
[32m+[m[32m    var subject by remember { mutableStateOf("") }[m
[32m+[m[32m    var description by remember { mutableStateOf("") }[m
[32m+[m
[32m+[m[32m    val focusManager = LocalFocusManager.current[m
[32m+[m[32m    // Logic ƒë∆°n gi·∫£n: Ph·∫£i nh·∫≠p Ti√™u ƒë·ªÅ v√† M√¥n h·ªçc m·ªõi cho G·ª≠i[m
[32m+[m[32m    val isFormValid = title.isNotBlank() && subject.isNotBlank()[m
[32m+[m
[32m+[m[32m    Scaffold([m
[32m+[m[32m        // Thumb Zone: N√∫t G·ª≠i n·∫±m c·ªë ƒë·ªãnh ·ªü ƒë√°y[m
[32m+[m[32m        bottomBar = {[m
[32m+[m[32m            Surface([m
[32m+[m[32m                modifier = Modifier.fillMaxWidth(),[m
[32m+[m[32m                shadowElevation = 16.dp,[m
[32m+[m[32m                color = Color.White,[m
[32m+[m[32m                shape = RoundedCornerShape(topStart = 24.dp, topEnd = 24.dp)[m
[32m+[m[32m            ) {[m
[32m+[m[32m                Button([m
[32m+[m[32m                    onClick = {[m
[32m+[m[32m                        viewModel.submitRequest(title, subject, description)[m
[32m+[m[32m                        onSubmitClick()[m
[32m+[m[32m                    },[m
[32m+[m[32m                    enabled = isFormValid,[m
[32m+[m[32m                    modifier = Modifier[m
[32m+[m[32m                        .padding(20.dp)[m
[32m+[m[32m                        .navigationBarsPadding() // Tr√°nh thanh ƒëi·ªÅu h∆∞·ªõng ·∫£o[m
[32m+[m[32m                        .height(54.dp)[m
[32m+[m[32m                        .fillMaxWidth(),[m
[32m+[m[32m                    shape = RoundedCornerShape(16.dp),[m
[32m+[m[32m                    colors = ButtonDefaults.buttonColors([m
[32m+[m[32m                        containerColor = PrimaryGreen, // N√∫t c≈©ng m√†u xanh[m
[32m+[m[32m                        disabledContainerColor = Color.LightGray[m
[32m+[m[32m                    )[m
[32m+[m[32m                ) {[m
[32m+[m[32m                    Icon(Icons.Default.Check, contentDescription = null)[m
[32m+[m[32m                    Spacer(modifier = Modifier.width(8.dp))[m
[32m+[m[32m                    Text([m
[32m+[m[32m                        "G·ª≠i y√™u c·∫ßu ngay",[m
[32m+[m[32m                        fontSize = 16.sp,[m
[32m+[m[32m                        fontWeight = FontWeight.Bold[m
[32m+[m[32m                    )[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    ) { paddingValues ->[m
[32m+[m[32m        Column([m
[32m+[m[32m            modifier = Modifier[m
[32m+[m[32m                .fillMaxSize()[m
[32m+[m[32m                .background(Color.White)[m
[32m+[m[32m                .padding(paddingValues) // Padding cho bottomBar[m
[32m+[m[32m        ) {[m
[32m+[m[32m            // 1. HEADER M√ÄU XANH (ƒê√£ mang tr·ªü l·∫°i!)[m
[32m+[m[32m            Box([m
[32m+[m[32m                modifier = Modifier[m
[32m+[m[32m                    .fillMaxWidth()[m
[32m+[m[32m                    .clip(RoundedCornerShape(bottomStart = 24.dp, bottomEnd = 24.dp))[m
[32m+[m[32m                    .background(PrimaryGreen)[m
[32m+[m[32m                    .statusBarsPadding() // ƒê·∫©y xu·ªëng d∆∞·ªõi thanh tr·∫°ng th√°i[m
[32m+[m[32m                    .padding(vertical = 16.dp, horizontal = 8.dp)[m
[32m+[m[32m            ) {[m
[32m+[m[32m                // N√∫t Back[m
[32m+[m[32m                IconButton([m
[32m+[m[32m                    onClick = onBackClick,[m
[32m+[m[32m                    modifier = Modifier.align(Alignment.CenterStart)[m
[32m+[m[32m                ) {[m
[32m+[m[32m                    Icon([m
[32m+[m[32m                        imageVector = Icons.AutoMirrored.Filled.ArrowBack,[m
[32m+[m[32m                        contentDescription = "Quay v·ªÅ",[m
[32m+[m[32m                        tint = Color.White[m
[32m+[m[32m                    )[m
[32m+[m[32m                }[m
[32m+[m
[32m+[m[32m                // Ti√™u ƒë·ªÅ[m
[32m+[m[32m                Text([m
[32m+[m[32m                    text = "T·∫°o y√™u c·∫ßu m·ªõi",[m
[32m+[m[32m                    style = MaterialTheme.typography.titleMedium,[m
[32m+[m[32m                    fontWeight = FontWeight.Bold,[m
[32m+[m[32m                    color = Color.White,[m
[32m+[m[32m                    modifier = Modifier.align(Alignment.Center)[m
[32m+[m[32m                )[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            // 2. N·ªòI DUNG FORM[m
[32m+[m[32m            Column([m
[32m+[m[32m                modifier = Modifier[m
[32m+[m[32m                    .fillMaxWidth()[m
[32m+[m[32m                    .weight(1f) // Chi·∫øm ph·∫ßn c√≤n l·∫°i[m
[32m+[m[32m                    .verticalScroll(rememberScrollState())[m
[32m+[m[32m                    .padding(20.dp),[m
[32m+[m[32m                verticalArrangement = Arrangement.spacedBy(20.dp)[m
[32m+[m[32m            ) {[m
[32m+[m[32m                Text([m
[32m+[m[32m                    text = "H√£y m√¥ t·∫£ chi ti·∫øt t√†i li·ªáu b·∫°n c·∫ßn t√¨m ƒë·ªÉ c·ªông ƒë·ªìng h·ªó tr·ª£ nhanh nh·∫•t nh√©!",[m
[32m+[m[32m                    style = MaterialTheme.typography.bodyMedium,[m
[32m+[m[32m                    color = Color.Gray[m
[32m+[m[32m                )[m
[32m+[m
[32m+[m[32m                // Input: Ti√™u ƒë·ªÅ[m
[32m+[m[32m                InputGroup([m
[32m+[m[32m                    label = "Ti√™u ƒë·ªÅ y√™u c·∫ßu (*)",[m
[32m+[m[32m                    value = title,[m
[32m+[m[32m                    onValueChange = { title = it },[m
[32m+[m[32m                    placeholder = "VD: C·∫ßn t√¨m ƒë·ªÅ thi cu·ªëi k·ª≥ m√¥n To√°n",[m
[32m+[m[32m                    imeAction = ImeAction.Next[m
[32m+[m[32m                )[m
[32m+[m
[32m+[m[32m                // Input: M√¥n h·ªçc[m
[32m+[m[32m                InputGroup([m
[32m+[m[32m                    label = "M√¥n h·ªçc (*)",[m
[32m+[m[32m                    value = subject,[m
[32m+[m[32m                    onValueChange = { subject = it },[m
[32m+[m[32m                    placeholder = "VD: Gi·∫£i t√≠ch 1",[m
[32m+[m[32m                    imeAction = ImeAction.Next[m
[32m+[m[32m                )[m
[32m+[m
[32m+[m[32m                // Input: M√¥ t·∫£[m
[32m+[m[32m                InputGroup([m
[32m+[m[32m                    label = "M√¥ t·∫£ chi ti·∫øt",[m
[32m+[m[32m                    value = description,[m
[32m+[m[32m                    onValueChange = { description = it },[m
[32m+[m[32m                    placeholder = "VD: D√†nh cho h·ªá kh√¥ng chuy√™n, nƒÉm 2023...",[m
[32m+[m[32m                    singleLine = false,[m
[32m+[m[32m                    minLines = 5,[m
[32m+[m[32m                    imeAction = ImeAction.Done,[m
[32m+[m[32m                    keyboardActions = KeyboardActions(onDone = { focusManager.clearFocus() })[m
[32m+[m[32m                )[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun InputGroup([m
[32m+[m[32m    label: String,[m
[32m+[m[32m    value: String,[m
[32m+[m[32m    onValueChange: (String) -> Unit,[m
[32m+[m[32m    placeholder: String,[m
[32m+[m[32m    singleLine: Boolean = true,[m
[32m+[m[32m    minLines: Int = 1,[m
[32m+[m[32m    imeAction: ImeAction = ImeAction.Default,[m
[32m+[m[32m    keyboardActions: KeyboardActions = KeyboardActions.Default[m
[32m+[m[32m) {[m
[32m+[m[32m    Column(modifier = Modifier.fillMaxWidth()) {[m
[32m+[m[32m        Text([m
[32m+[m[32m            text = label,[m
[32m+[m[32m            style = MaterialTheme.typography.labelLarge,[m
[32m+[m[32m            fontWeight = FontWeight.SemiBold,[m
[32m+[m[32m            color = Color.Black[m
[32m+[m[32m        )[m
[32m+[m[32m        Spacer(modifier = Modifier.height(8.dp))[m
[32m+[m[32m        OutlinedTextField([m
[32m+[m[32m            value = value,[m
[32m+[m[32m            onValueChange = onValueChange,[m
[32m+[m[32m            placeholder = { Text(placeholder, color = Color.LightGray) },[m
[32m+[m[32m            modifier = Modifier.fillMaxWidth(),[m
[32m+[m[32m            shape = RoundedCornerShape(12.dp),[m
[32m+[m[32m            colors = OutlinedTextFieldDefaults.colors([m
[32m+[m[32m                focusedBorderColor = PrimaryGreen,[m
[32m+[m[32m                unfocusedBorderColor = Color.LightGray.copy(alpha = 0.5f),[m
[32m+[m[32m                focusedContainerColor = Color.White,[m
[32m+[m[32m                unfocusedContainerColor = Color(0xFFFAFAFA)[m
[32m+[m[32m            ),[m
[32m+[m[32m            singleLine = singleLine,[m
[32m+[m[32m            minLines = minLines,[m
[32m+[m[32m            keyboardOptions = KeyboardOptions([m
[32m+[m[32m                capitalization = KeyboardCapitalization.Sentences,[m
[32m+[m[32m                imeAction = imeAction[m
[32m+[m[32m            ),[m
[32m+[m[32m            keyboardActions = keyboardActions[m
[32m+[m[32m        )[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/feature_request/ui/create/CreateRequestViewModel.kt b/app/src/main/java/com/example/stushare/feature_request/ui/create/CreateRequestViewModel.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..03c1d2c[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/feature_request/ui/create/CreateRequestViewModel.kt[m
[36m@@ -0,0 +1,20 @@[m
[32m+[m[32mpackage com.example.stushare.features.feature_request.ui.create[m
[32m+[m
[32m+[m[32mimport androidx.lifecycle.ViewModel[m
[32m+[m[32mimport androidx.lifecycle.viewModelScope[m
[32m+[m[32mimport com.example.stushare.core.data.repository.RequestRepository[m
[32m+[m[32mimport dagger.hilt.android.lifecycle.HiltViewModel[m
[32m+[m[32mimport kotlinx.coroutines.launch[m
[32m+[m[32mimport javax.inject.Inject[m
[32m+[m
[32m+[m[32m@HiltViewModel[m
[32m+[m[32mclass CreateRequestViewModel @Inject constructor([m
[32m+[m[32m    private val repository: RequestRepository[m
[32m+[m[32m) : ViewModel() {[m
[32m+[m
[32m+[m[32m    fun submitRequest(title: String, subject: String, description: String) {[m
[32m+[m[32m        viewModelScope.launch {[m
[32m+[m[32m            repository.createRequest(title, subject, description)[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/feature_request/ui/detail/RequestDetailScreen.kt b/app/src/main/java/com/example/stushare/feature_request/ui/detail/RequestDetailScreen.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..2ae137e[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/feature_request/ui/detail/RequestDetailScreen.kt[m
[36m@@ -0,0 +1,260 @@[m
[32m+[m[32mpackage com.example.stushare.feature_request.ui.detail[m
[32m+[m
[32m+[m[32mimport androidx.compose.foundation.background[m
[32m+[m[32mimport androidx.compose.foundation.layout.*[m
[32m+[m[32mimport androidx.compose.foundation.lazy.LazyColumn[m
[32m+[m[32mimport androidx.compose.foundation.lazy.items[m
[32m+[m[32mimport androidx.compose.foundation.shape.CircleShape[m
[32m+[m[32mimport androidx.compose.foundation.shape.RoundedCornerShape[m
[32m+[m[32mimport androidx.compose.foundation.text.KeyboardActions[m
[32m+[m[32mimport androidx.compose.foundation.text.KeyboardOptions[m
[32m+[m[32mimport androidx.compose.material.icons.Icons[m
[32m+[m[32mimport androidx.compose.material.icons.automirrored.filled.ArrowBack[m
[32m+[m[32mimport androidx.compose.material.icons.automirrored.filled.Send[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Person[m
[32m+[m[32mimport androidx.compose.material3.*[m
[32m+[m[32mimport androidx.compose.runtime.*[m
[32m+[m[32mimport androidx.compose.ui.Alignment[m
[32m+[m[32mimport androidx.compose.ui.Modifier[m
[32m+[m[32mimport androidx.compose.ui.draw.clip[m
[32m+[m[32mimport androidx.compose.ui.graphics.Color[m
[32m+[m[32mimport androidx.compose.ui.platform.LocalSoftwareKeyboardController[m
[32m+[m[32mimport androidx.compose.ui.text.font.FontWeight[m
[32m+[m[32mimport androidx.compose.ui.text.input.ImeAction[m
[32m+[m[32mimport androidx.compose.ui.unit.dp[m
[32m+[m[32mimport androidx.compose.ui.unit.sp[m
[32m+[m[32mimport androidx.hilt.navigation.compose.hiltViewModel[m
[32m+[m[32mimport androidx.lifecycle.compose.collectAsStateWithLifecycle[m
[32m+[m[32mimport com.example.stushare.core.data.models.CommentEntity[m
[32m+[m[32mimport com.example.stushare.core.data.models.DocumentRequest[m
[32m+[m[32mimport com.example.stushare.ui.theme.PrimaryGreen[m
[32m+[m[32mimport java.text.SimpleDateFormat[m
[32m+[m[32mimport java.util.Locale[m
[32m+[m
[32m+[m[32m@OptIn(ExperimentalMaterial3Api::class)[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun RequestDetailScreen([m
[32m+[m[32m    onBackClick: () -> Unit,[m
[32m+[m[32m    viewModel: RequestDetailViewModel = hiltViewModel()[m
[32m+[m[32m) {[m
[32m+[m[32m    val uiState by viewModel.uiState.collectAsStateWithLifecycle()[m
[32m+[m[32m    val commentText by viewModel.commentText.collectAsStateWithLifecycle()[m
[32m+[m[32m    val keyboardController = LocalSoftwareKeyboardController.current[m
[32m+[m
[32m+[m[32m    Scaffold([m
[32m+[m[32m        topBar = {[m
[32m+[m[32m            TopAppBar([m
[32m+[m[32m                title = { Text("Chi ti·∫øt & Th·∫£o lu·∫≠n", fontSize = 18.sp, fontWeight = FontWeight.Bold) },[m
[32m+[m[32m                navigationIcon = {[m
[32m+[m[32m                    IconButton(onClick = onBackClick) {[m
[32m+[m[32m                        Icon(Icons.AutoMirrored.Filled.ArrowBack, contentDescription = "Back")[m
[32m+[m[32m                    }[m
[32m+[m[32m                },[m
[32m+[m[32m                colors = TopAppBarDefaults.topAppBarColors([m
[32m+[m[32m                    containerColor = Color.White,[m
[32m+[m[32m                    titleContentColor = Color.Black[m
[32m+[m[32m                )[m
[32m+[m[32m            )[m
[32m+[m[32m        },[m
[32m+[m[32m        bottomBar = {[m
[32m+[m[32m            // Thanh nh·∫≠p chat[m
[32m+[m[32m            Surface([m
[32m+[m[32m                shadowElevation = 8.dp,[m
[32m+[m[32m                color = Color.White[m
[32m+[m[32m            ) {[m
[32m+[m[32m                Row([m
[32m+[m[32m                    modifier = Modifier[m
[32m+[m[32m                        .padding(horizontal = 8.dp, vertical = 8.dp)[m
[32m+[m[32m                        .navigationBarsPadding() // Tr√°nh b·ªã che b·ªüi thanh ƒëi·ªÅu h∆∞·ªõng h·ªá th·ªëng[m
[32m+[m[32m                        .imePadding(), // ƒê·∫©y l√™n khi b√†n ph√≠m hi·ªán[m
[32m+[m[32m                    verticalAlignment = Alignment.CenterVertically[m
[32m+[m[32m                ) {[m
[32m+[m[32m                    OutlinedTextField([m
[32m+[m[32m                        value = commentText,[m
[32m+[m[32m                        onValueChange = viewModel::onCommentChange,[m
[32m+[m[32m                        modifier = Modifier[m
[32m+[m[32m                            .weight(1f)[m
[32m+[m[32m                            .padding(end = 8.dp),[m
[32m+[m[32m                        placeholder = { Text("Nh·∫≠p b√¨nh lu·∫≠n ho·∫∑c link t√†i li·ªáu...") },[m
[32m+[m[32m                        shape = RoundedCornerShape(24.dp),[m
[32m+[m[32m                        colors = OutlinedTextFieldDefaults.colors([m
[32m+[m[32m                            focusedBorderColor = PrimaryGreen,[m
[32m+[m[32m                            unfocusedBorderColor = Color.LightGray[m
[32m+[m[32m                        ),[m
[32m+[m[32m                        maxLines = 3,[m
[32m+[m[32m                        keyboardOptions = KeyboardOptions(imeAction = ImeAction.Send),[m
[32m+[m[32m                        keyboardActions = KeyboardActions(onSend = {[m
[32m+[m[32m                            viewModel.sendComment()[m
[32m+[m[32m                            keyboardController?.hide()[m
[32m+[m[32m                        })[m
[32m+[m[32m                    )[m
[32m+[m
[32m+[m[32m                    IconButton([m
[32m+[m[32m                        onClick = {[m
[32m+[m[32m                            viewModel.sendComment()[m
[32m+[m[32m                            keyboardController?.hide()[m
[32m+[m[32m                        },[m
[32m+[m[32m                        enabled = commentText.isNotBlank() && !uiState.isSending[m
[32m+[m[32m                    ) {[m
[32m+[m[32m                        Icon([m
[32m+[m[32m                            imageVector = Icons.AutoMirrored.Filled.Send,[m
[32m+[m[32m                            contentDescription = "G·ª≠i",[m
[32m+[m[32m                            tint = if (commentText.isNotBlank()) PrimaryGreen else Color.Gray[m
[32m+[m[32m                        )[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    ) { paddingValues ->[m
[32m+[m[32m        Box([m
[32m+[m[32m            modifier = Modifier[m
[32m+[m[32m                .fillMaxSize()[m
[32m+[m[32m                .background(Color(0xFFF5F7F5))[m
[32m+[m[32m                .padding(paddingValues)[m
[32m+[m[32m        ) {[m
[32m+[m[32m            if (uiState.isLoadingRequest) {[m
[32m+[m[32m                CircularProgressIndicator([m
[32m+[m[32m                    modifier = Modifier.align(Alignment.Center),[m
[32m+[m[32m                    color = PrimaryGreen[m
[32m+[m[32m                )[m
[32m+[m[32m            } else {[m
[32m+[m[32m                LazyColumn([m
[32m+[m[32m                    modifier = Modifier.fillMaxSize(),[m
[32m+[m[32m                    contentPadding = PaddingValues(16.dp),[m
[32m+[m[32m                    verticalArrangement = Arrangement.spacedBy(16.dp)[m
[32m+[m[32m                ) {[m
[32m+[m[32m                    // 1. N·ªôi dung c√¢u h·ªèi (Ghim tr√™n c√πng)[m
[32m+[m[32m                    item {[m
[32m+[m[32m                        uiState.request?.let { request ->[m
[32m+[m[32m                            RequestContentHeader(request)[m
[32m+[m[32m                            Spacer(modifier = Modifier.height(8.dp))[m
[32m+[m[32m                            Divider(color = Color.LightGray.copy(alpha = 0.5f))[m
[32m+[m[32m                            Spacer(modifier = Modifier.height(8.dp))[m
[32m+[m[32m                            Text([m
[32m+[m[32m                                "B√¨nh lu·∫≠n (${uiState.comments.size})",[m
[32m+[m[32m                                style = MaterialTheme.typography.titleSmall,[m
[32m+[m[32m                                color = Color.Gray[m
[32m+[m[32m                            )[m
[32m+[m[32m                        }[m
[32m+[m[32m                    }[m
[32m+[m
[32m+[m[32m                    // 2. Danh s√°ch b√¨nh lu·∫≠n (Chat)[m
[32m+[m[32m                    if (uiState.comments.isEmpty()) {[m
[32m+[m[32m                        item {[m
[32m+[m[32m                            Box([m
[32m+[m[32m                                modifier = Modifier[m
[32m+[m[32m                                    .fillMaxWidth()[m
[32m+[m[32m                                    .padding(32.dp),[m
[32m+[m[32m                                contentAlignment = Alignment.Center[m
[32m+[m[32m                            ) {[m
[32m+[m[32m                                Text("Ch∆∞a c√≥ b√¨nh lu·∫≠n n√†o. H√£y l√† ng∆∞·ªùi ƒë·∫ßu ti√™n!", color = Color.Gray)[m
[32m+[m[32m                            }[m
[32m+[m[32m                        }[m
[32m+[m[32m                    } else {[m
[32m+[m[32m                        items(uiState.comments) { comment ->[m
[32m+[m[32m                            CommentItem([m
[32m+[m[32m                                comment = comment,[m
[32m+[m[32m                                isCurrentUser = comment.userId == uiState.currentUserId[m
[32m+[m[32m                            )[m
[32m+[m[32m                        }[m
[32m+[m[32m                    }[m
[32m+[m
[32m+[m[32m                    // Kho·∫£ng tr·ªëng d∆∞·ªõi c√πng ƒë·ªÉ kh√¥ng b·ªã thanh chat che[m
[32m+[m[32m                    item { Spacer(modifier = Modifier.height(60.dp)) }[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun RequestContentHeader(request: DocumentRequest) {[m
[32m+[m[32m    Card([m
[32m+[m[32m        colors = CardDefaults.cardColors(containerColor = Color.White),[m
[32m+[m[32m        elevation = CardDefaults.cardElevation(2.dp)[m
[32m+[m[32m    ) {[m
[32m+[m[32m        Column(modifier = Modifier.padding(16.dp)) {[m
[32m+[m[32m            // M√¥n h·ªçc[m
[32m+[m[32m            Surface([m
[32m+[m[32m                color = PrimaryGreen.copy(alpha = 0.1f),[m
[32m+[m[32m                shape = RoundedCornerShape(6.dp)[m
[32m+[m[32m            ) {[m
[32m+[m[32m                Text([m
[32m+[m[32m                    text = request.subject,[m
[32m+[m[32m                    color = PrimaryGreen,[m
[32m+[m[32m                    style = MaterialTheme.typography.labelMedium,[m
[32m+[m[32m                    modifier = Modifier.padding(horizontal = 8.dp, vertical = 4.dp)[m
[32m+[m[32m                )[m
[32m+[m[32m            }[m
[32m+[m[32m            Spacer(modifier = Modifier.height(8.dp))[m
[32m+[m[32m            Text([m
[32m+[m[32m                text = request.title,[m
[32m+[m[32m                style = MaterialTheme.typography.titleMedium,[m
[32m+[m[32m                fontWeight = FontWeight.Bold[m
[32m+[m[32m            )[m
[32m+[m[32m            Spacer(modifier = Modifier.height(8.dp))[m
[32m+[m[32m            Text([m
[32m+[m[32m                text = request.description,[m
[32m+[m[32m                style = MaterialTheme.typography.bodyMedium,[m
[32m+[m[32m                color = Color.DarkGray[m
[32m+[m[32m            )[m
[32m+[m[32m            Spacer(modifier = Modifier.height(12.dp))[m
[32m+[m[32m            Row(verticalAlignment = Alignment.CenterVertically) {[m
[32m+[m[32m                Icon(Icons.Default.Person, contentDescription = null, modifier = Modifier.size(16.dp), tint = Color.Gray)[m
[32m+[m[32m                Spacer(modifier = Modifier.width(4.dp))[m
[32m+[m[32m                Text([m
[32m+[m[32m                    text = "ƒêƒÉng b·ªüi ${request.authorName}",[m
[32m+[m[32m                    style = MaterialTheme.typography.labelSmall,[m
[32m+[m[32m                    color = Color.Gray[m
[32m+[m[32m                )[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun CommentItem(comment: CommentEntity, isCurrentUser: Boolean) {[m
[32m+[m[32m    val dateFormatter = SimpleDateFormat("HH:mm, dd/MM", Locale.getDefault())[m
[32m+[m[32m    val timeString = comment.timestamp?.let { dateFormatter.format(it) } ?: "V·ª´a xong"[m
[32m+[m
[32m+[m[32m    Column([m
[32m+[m[32m        modifier = Modifier.fillMaxWidth(),[m
[32m+[m[32m        horizontalAlignment = if (isCurrentUser) Alignment.End else Alignment.Start[m
[32m+[m[32m    ) {[m
[32m+[m[32m        // T√™n ng∆∞·ªùi d√πng[m
[32m+[m[32m        if (!isCurrentUser) {[m
[32m+[m[32m            Text([m
[32m+[m[32m                text = comment.userName,[m
[32m+[m[32m                style = MaterialTheme.typography.labelSmall,[m
[32m+[m[32m                color = Color.Gray,[m
[32m+[m[32m                modifier = Modifier.padding(start = 8.dp, bottom = 4.dp)[m
[32m+[m[32m            )[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        // Bong b√≥ng chat[m
[32m+[m[32m        Surface([m
[32m+[m[32m            shape = if (isCurrentUser)[m
[32m+[m[32m                RoundedCornerShape(16.dp, 16.dp, 4.dp, 16.dp)[m
[32m+[m[32m            else[m
[32m+[m[32m                RoundedCornerShape(16.dp, 16.dp, 16.dp, 4.dp),[m
[32m+[m[32m            color = if (isCurrentUser) PrimaryGreen else Color.White,[m
[32m+[m[32m            shadowElevation = 1.dp[m
[32m+[m[32m        ) {[m
[32m+[m[32m            Text([m
[32m+[m[32m                text = comment.content,[m
[32m+[m[32m                modifier = Modifier.padding(12.dp),[m
[32m+[m[32m                color = if (isCurrentUser) Color.White else Color.Black,[m
[32m+[m[32m                style = MaterialTheme.typography.bodyMedium[m
[32m+[m[32m            )[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        // Th·ªùi gian[m
[32m+[m[32m        Text([m
[32m+[m[32m            text = timeString,[m
[32m+[m[32m            style = MaterialTheme.typography.labelSmall,[m
[32m+[m[32m            color = Color.LightGray,[m
[32m+[m[32m            fontSize = 10.sp,[m
[32m+[m[32m            modifier = Modifier.padding(top = 4.dp, start = 8.dp, end = 8.dp)[m
[32m+[m[32m        )[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/feature_request/ui/detail/RequestDetailViewModel.kt b/app/src/main/java/com/example/stushare/feature_request/ui/detail/RequestDetailViewModel.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..24449b6[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/feature_request/ui/detail/RequestDetailViewModel.kt[m
[36m@@ -0,0 +1,82 @@[m
[32m+[m[32mpackage com.example.stushare.feature_request.ui.detail[m
[32m+[m
[32m+[m[32mimport androidx.lifecycle.SavedStateHandle[m
[32m+[m[32mimport androidx.lifecycle.ViewModel[m
[32m+[m[32mimport androidx.lifecycle.viewModelScope[m
[32m+[m[32mimport com.example.stushare.core.data.models.CommentEntity[m
[32m+[m[32mimport com.example.stushare.core.data.models.DocumentRequest[m
[32m+[m[32mimport com.example.stushare.core.data.repository.RequestRepository[m
[32m+[m[32mimport com.example.stushare.core.navigation.NavRoute[m
[32m+[m[32mimport com.google.firebase.auth.FirebaseAuth[m
[32m+[m[32mimport dagger.hilt.android.lifecycle.HiltViewModel[m
[32m+[m[32mimport kotlinx.coroutines.flow.*[m
[32m+[m[32mimport kotlinx.coroutines.launch[m
[32m+[m[32mimport androidx.navigation.toRoute[m
[32m+[m[32mimport javax.inject.Inject[m
[32m+[m
[32m+[m[32mdata class RequestDetailUiState([m
[32m+[m[32m    val request: DocumentRequest? = null,[m
[32m+[m[32m    val comments: List<CommentEntity> = emptyList(),[m
[32m+[m[32m    val isLoadingRequest: Boolean = true,[m
[32m+[m[32m    val isSending: Boolean = false,[m
[32m+[m[32m    val currentUserId: String = ""[m
[32m+[m[32m)[m
[32m+[m
[32m+[m[32m@HiltViewModel[m
[32m+[m[32mclass RequestDetailViewModel @Inject constructor([m
[32m+[m[32m    private val requestRepository: RequestRepository,[m
[32m+[m[32m    savedStateHandle: SavedStateHandle,[m
[32m+[m[32m    firebaseAuth: FirebaseAuth[m
[32m+[m[32m) : ViewModel() {[m
[32m+[m
[32m+[m[32m    // L·∫•y ID t·ª´ Navigation Argument m·ªôt c√°ch an to√†n[m
[32m+[m[32m    private val args = savedStateHandle.toRoute<NavRoute.RequestDetail>()[m
[32m+[m[32m    private val requestId = args.requestId[m
[32m+[m[32m    private val currentUserId = firebaseAuth.currentUser?.uid ?: ""[m
[32m+[m
[32m+[m[32m    private val _commentText = MutableStateFlow("")[m
[32m+[m[32m    val commentText = _commentText.asStateFlow()[m
[32m+[m
[32m+[m[32m    private val _isSending = MutableStateFlow(false)[m
[32m+[m
[32m+[m[32m    // K·∫øt h·ª£p lu·ªìng d·ªØ li·ªáu Request v√† Comment[m
[32m+[m[32m    val uiState: StateFlow<RequestDetailUiState> = combine([m
[32m+[m[32m        requestRepository.getRequestById(requestId),[m
[32m+[m[32m        requestRepository.getCommentsForRequest(requestId),[m
[32m+[m[32m        _isSending[m
[32m+[m[32m    ) { request, comments, isSending ->[m
[32m+[m[32m        RequestDetailUiState([m
[32m+[m[32m            request = request,[m
[32m+[m[32m            comments = comments,[m
[32m+[m[32m            isLoadingRequest = request == null, // N·∫øu ch∆∞a load ƒë∆∞·ª£c request th√¨ hi·ªán loading[m
[32m+[m[32m            isSending = isSending,[m
[32m+[m[32m            currentUserId = currentUserId[m
[32m+[m[32m        )[m
[32m+[m[32m    }.stateIn([m
[32m+[m[32m        scope = viewModelScope,[m
[32m+[m[32m        started = SharingStarted.WhileSubscribed(5000),[m
[32m+[m[32m        initialValue = RequestDetailUiState(currentUserId = currentUserId)[m
[32m+[m[32m    )[m
[32m+[m
[32m+[m[32m    fun onCommentChange(text: String) {[m
[32m+[m[32m        _commentText.value = text[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    fun sendComment() {[m
[32m+[m[32m        val content = _commentText.value.trim()[m
[32m+[m[32m        if (content.isBlank()) return[m
[32m+[m
[32m+[m[32m        viewModelScope.launch {[m
[32m+[m[32m            _isSending.value = true[m
[32m+[m[32m            try {[m
[32m+[m[32m                requestRepository.addCommentToRequest(requestId, content)[m
[32m+[m[32m                _commentText.value = "" // X√≥a √¥ nh·∫≠p sau khi g·ª≠i[m
[32m+[m[32m            } catch (e: Exception) {[m
[32m+[m[32m                // X·ª≠ l√Ω l·ªói n·∫øu c·∫ßn (VD: hi·ªán Toast)[m
[32m+[m[32m                e.printStackTrace()[m
[32m+[m[32m            } finally {[m
[32m+[m[32m                _isSending.value = false[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/feature_request/ui/list/RequestListScreen.kt b/app/src/main/java/com/example/stushare/feature_request/ui/list/RequestListScreen.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..f1ea891[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/feature_request/ui/list/RequestListScreen.kt[m
[36m@@ -0,0 +1,295 @@[m
[32m+[m[32mpackage com.example.stushare.feature_request.ui.list[m
[32m+[m
[32m+[m[32mimport androidx.compose.foundation.background[m
[32m+[m[32mimport androidx.compose.foundation.layout.*[m
[32m+[m[32mimport androidx.compose.foundation.lazy.LazyColumn[m
[32m+[m[32mimport androidx.compose.foundation.lazy.items[m
[32m+[m[32mimport androidx.compose.foundation.shape.CircleShape[m
[32m+[m[32mimport androidx.compose.foundation.shape.RoundedCornerShape[m
[32m+[m[32mimport androidx.compose.material.icons.Icons[m
[32m+[m[32mimport androidx.compose.material.icons.automirrored.filled.ArrowBack[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Add[m
[32m+[m[32mimport androidx.compose.material.icons.filled.ChatBubbleOutline[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Person[m
[32m+[m[32mimport androidx.compose.material3.*[m
[32m+[m[32mimport androidx.compose.runtime.Composable[m
[32m+[m[32mimport androidx.compose.runtime.getValue[m
[32m+[m[32mimport androidx.compose.ui.Alignment[m
[32m+[m[32mimport androidx.compose.ui.Modifier[m
[32m+[m[32mimport androidx.compose.ui.draw.clip[m
[32m+[m[32mimport androidx.compose.ui.graphics.Color[m
[32m+[m[32mimport androidx.compose.ui.text.font.FontWeight[m
[32m+[m[32mimport androidx.compose.ui.text.style.TextOverflow[m
[32m+[m[32mimport androidx.compose.ui.unit.dp[m
[32m+[m[32mimport androidx.compose.ui.unit.sp[m
[32m+[m[32mimport androidx.hilt.navigation.compose.hiltViewModel[m
[32m+[m[32mimport androidx.lifecycle.compose.collectAsStateWithLifecycle[m
[32m+[m[32mimport com.example.stushare.core.data.models.DocumentRequest[m
[32m+[m[32mimport com.example.stushare.features.feature_request.ui.list.RequestListViewModel[m
[32m+[m[32mimport com.example.stushare.ui.theme.LightGreen[m
[32m+[m[32mimport com.example.stushare.ui.theme.PrimaryGreen[m
[32m+[m[32mimport com.example.stushare.ui.theme.createShimmerBrush[m
[32m+[m
[32m+[m[32m@OptIn(ExperimentalMaterial3Api::class)[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun RequestListScreen([m
[32m+[m[32m    onBackClick: () -> Unit,[m
[32m+[m[32m    onCreateRequestClick: () -> Unit,[m
[32m+[m[32m    // üü¢ M·ªöI: Callback ƒë·ªÉ chuy·ªÉn sang m√†n h√¨nh chi ti·∫øt[m
[32m+[m[32m    onNavigateToDetail: (String) -> Unit,[m
[32m+[m[32m    viewModel: RequestListViewModel = hiltViewModel()[m
[32m+[m[32m) {[m
[32m+[m[32m    val uiState by viewModel.uiState.collectAsStateWithLifecycle()[m
[32m+[m
[32m+[m[32m    Scaffold([m
[32m+[m[32m        floatingActionButton = {[m
[32m+[m[32m            FloatingActionButton([m
[32m+[m[32m                onClick = onCreateRequestClick,[m
[32m+[m[32m                containerColor = PrimaryGreen,[m
[32m+[m[32m                contentColor = Color.White,[m
[32m+[m[32m                shape = CircleShape[m
[32m+[m[32m            ) {[m
[32m+[m[32m                Icon(Icons.Default.Add, contentDescription = "T·∫°o y√™u c·∫ßu m·ªõi")[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    ) { paddingValues ->[m
[32m+[m[32m        Column([m
[32m+[m[32m            modifier = Modifier[m
[32m+[m[32m                .fillMaxSize()[m
[32m+[m[32m                .background(Color(0xFFF9F9F9))[m
[32m+[m[32m                .padding(paddingValues)[m
[32m+[m[32m        ) {[m
[32m+[m[32m            // Header[m
[32m+[m[32m            Box([m
[32m+[m[32m                modifier = Modifier[m
[32m+[m[32m                    .fillMaxWidth()[m
[32m+[m[32m                    .clip(RoundedCornerShape(bottomStart = 24.dp, bottomEnd = 24.dp))[m
[32m+[m[32m                    .background(PrimaryGreen)[m
[32m+[m[32m                    .statusBarsPadding()[m
[32m+[m[32m                    .padding(vertical = 16.dp, horizontal = 8.dp)[m
[32m+[m[32m            ) {[m
[32m+[m[32m                IconButton([m
[32m+[m[32m                    onClick = onBackClick,[m
[32m+[m[32m                    modifier = Modifier.align(Alignment.CenterStart)[m
[32m+[m[32m                ) {[m
[32m+[m[32m                    Icon([m
[32m+[m[32m                        imageVector = Icons.AutoMirrored.Filled.ArrowBack,[m
[32m+[m[32m                        contentDescription = "Quay v·ªÅ",[m
[32m+[m[32m                        tint = Color.White[m
[32m+[m[32m                    )[m
[32m+[m[32m                }[m
[32m+[m
[32m+[m[32m                Text([m
[32m+[m[32m                    text = "C·ªông ƒë·ªìng h·ªèi ƒë√°p",[m
[32m+[m[32m                    style = MaterialTheme.typography.titleMedium,[m
[32m+[m[32m                    fontWeight = FontWeight.Bold,[m
[32m+[m[32m                    color = Color.White,[m
[32m+[m[32m                    modifier = Modifier.align(Alignment.Center)[m
[32m+[m[32m                )[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            // List Content[m
[32m+[m[32m            when {[m
[32m+[m[32m                uiState.isLoading -> {[m
[32m+[m[32m                    RequestListSkeleton()[m
[32m+[m[32m                }[m
[32m+[m[32m                uiState.requests.isEmpty() -> {[m
[32m+[m[32m                    EmptyRequestState(onCreateClick = onCreateRequestClick)[m
[32m+[m[32m                }[m
[32m+[m[32m                else -> {[m
[32m+[m[32m                    LazyColumn([m
[32m+[m[32m                        modifier = Modifier.fillMaxSize(),[m
[32m+[m[32m                        contentPadding = PaddingValues(16.dp),[m
[32m+[m[32m                        verticalArrangement = Arrangement.spacedBy(16.dp)[m
[32m+[m[32m                    ) {[m
[32m+[m[32m                        items(uiState.requests) { request ->[m
[32m+[m[32m                            RequestCard([m
[32m+[m[32m                                request = request,[m
[32m+[m[32m                                // üü¢ C·∫¨P NH·∫¨T: G·ªçi callback chuy·ªÉn trang k√®m ID[m
[32m+[m[32m                                onReplyClick = { onNavigateToDetail(request.id) }[m
[32m+[m[32m                            )[m
[32m+[m[32m                        }[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun RequestCard([m
[32m+[m[32m    request: DocumentRequest,[m
[32m+[m[32m    onReplyClick: () -> Unit[m
[32m+[m[32m) {[m
[32m+[m[32m    Card([m
[32m+[m[32m        modifier = Modifier.fillMaxWidth(),[m
[32m+[m[32m        shape = RoundedCornerShape(16.dp),[m
[32m+[m[32m        colors = CardDefaults.cardColors(containerColor = Color.White),[m
[32m+[m[32m        elevation = CardDefaults.cardElevation(defaultElevation = 2.dp)[m
[32m+[m[32m    ) {[m
[32m+[m[32m        Column([m
[32m+[m[32m            modifier = Modifier.padding(16.dp)[m
[32m+[m[32m        ) {[m
[32m+[m[32m            if (request.subject.isNotBlank()) {[m
[32m+[m[32m                Surface([m
[32m+[m[32m                    color = LightGreen,[m
[32m+[m[32m                    shape = RoundedCornerShape(8.dp),[m
[32m+[m[32m                    modifier = Modifier.padding(bottom = 12.dp)[m
[32m+[m[32m                ) {[m
[32m+[m[32m                    Text([m
[32m+[m[32m                        text = request.subject,[m
[32m+[m[32m                        color = PrimaryGreen,[m
[32m+[m[32m                        style = MaterialTheme.typography.labelSmall,[m
[32m+[m[32m                        fontWeight = FontWeight.Bold,[m
[32m+[m[32m                        modifier = Modifier.padding(horizontal = 10.dp, vertical = 6.dp)[m
[32m+[m[32m                    )[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            Text([m
[32m+[m[32m                text = request.title,[m
[32m+[m[32m                style = MaterialTheme.typography.titleMedium,[m
[32m+[m[32m                fontWeight = FontWeight.Bold,[m
[32m+[m[32m                color = Color(0xFF1A1A1A)[m
[32m+[m[32m            )[m
[32m+[m
[32m+[m[32m            Spacer(modifier = Modifier.height(8.dp))[m
[32m+[m
[32m+[m[32m            if (request.description.isNotBlank()) {[m
[32m+[m[32m                Text([m
[32m+[m[32m                    text = request.description,[m
[32m+[m[32m                    style = MaterialTheme.typography.bodyMedium,[m
[32m+[m[32m                    color = Color(0xFF666666),[m
[32m+[m[32m                    maxLines = 3,[m
[32m+[m[32m                    overflow = TextOverflow.Ellipsis,[m
[32m+[m[32m                    lineHeight = 22.sp[m
[32m+[m[32m                )[m
[32m+[m[32m                Spacer(modifier = Modifier.height(16.dp))[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            Divider(color = Color.LightGray.copy(alpha = 0.2f))[m
[32m+[m[32m            Spacer(modifier = Modifier.height(12.dp))[m
[32m+[m
[32m+[m[32m            Row([m
[32m+[m[32m                modifier = Modifier.fillMaxWidth(),[m
[32m+[m[32m                verticalAlignment = Alignment.CenterVertically,[m
[32m+[m[32m                horizontalArrangement = Arrangement.SpaceBetween[m
[32m+[m[32m            ) {[m
[32m+[m[32m                Row(verticalAlignment = Alignment.CenterVertically) {[m
[32m+[m[32m                    Icon([m
[32m+[m[32m                        imageVector = Icons.Default.Person,[m
[32m+[m[32m                        contentDescription = null,[m
[32m+[m[32m                        tint = Color.Gray,[m
[32m+[m[32m                        modifier = Modifier.size(16.dp)[m
[32m+[m[32m                    )[m
[32m+[m[32m                    Spacer(modifier = Modifier.width(4.dp))[m
[32m+[m[32m                    Text([m
[32m+[m[32m                        text = request.authorName.ifBlank { "Sinh vi√™n ·∫©n danh" },[m
[32m+[m[32m                        style = MaterialTheme.typography.labelMedium,[m
[32m+[m[32m                        color = Color.Gray[m
[32m+[m[32m                    )[m
[32m+[m[32m                }[m
[32m+[m
[32m+[m[32m                Button([m
[32m+[m[32m                    onClick = onReplyClick,[m
[32m+[m[32m                    contentPadding = PaddingValues(horizontal = 12.dp, vertical = 0.dp),[m
[32m+[m[32m                    modifier = Modifier.height(32.dp),[m
[32m+[m[32m                    shape = RoundedCornerShape(50),[m
[32m+[m[32m                    colors = ButtonDefaults.buttonColors([m
[32m+[m[32m                        containerColor = Color(0xFFF0F0F0),[m
[32m+[m[32m                        contentColor = Color.Black[m
[32m+[m[32m                    ),[m
[32m+[m[32m                    elevation = ButtonDefaults.buttonElevation(0.dp)[m
[32m+[m[32m                ) {[m
[32m+[m[32m                    Icon([m
[32m+[m[32m                        imageVector = Icons.Default.ChatBubbleOutline,[m
[32m+[m[32m                        contentDescription = null,[m
[32m+[m[32m                        modifier = Modifier.size(14.dp)[m
[32m+[m[32m                    )[m
[32m+[m[32m                    Spacer(modifier = Modifier.width(6.dp))[m
[32m+[m[32m                    Text("Tr·∫£ l·ªùi", style = MaterialTheme.typography.labelSmall)[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m// ... (Gi·ªØ nguy√™n ph·∫ßn EmptyRequestState v√† Skeleton)[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun EmptyRequestState(onCreateClick: () -> Unit) {[m
[32m+[m[32m    Column([m
[32m+[m[32m        modifier = Modifier[m
[32m+[m[32m            .fillMaxSize()[m
[32m+[m[32m            .padding(32.dp),[m
[32m+[m[32m        horizontalAlignment = Alignment.CenterHorizontally,[m
[32m+[m[32m        verticalArrangement = Arrangement.Center[m
[32m+[m[32m    ) {[m
[32m+[m[32m        Icon([m
[32m+[m[32m            imageVector = Icons.Default.ChatBubbleOutline,[m
[32m+[m[32m            contentDescription = null,[m
[32m+[m[32m            modifier = Modifier.size(100.dp),[m
[32m+[m[32m            tint = PrimaryGreen.copy(alpha = 0.3f)[m
[32m+[m[32m        )[m
[32m+[m[32m        Spacer(modifier = Modifier.height(24.dp))[m
[32m+[m[32m        Text([m
[32m+[m[32m            text = "Ch∆∞a c√≥ c√¢u h·ªèi n√†o",[m
[32m+[m[32m            style = MaterialTheme.typography.titleMedium,[m
[32m+[m[32m            fontWeight = FontWeight.Bold,[m
[32m+[m[32m            color = Color.Black[m
[32m+[m[32m        )[m
[32m+[m[32m        Spacer(modifier = Modifier.height(8.dp))[m
[32m+[m[32m        Text([m
[32m+[m[32m            text = "H√£y l√† ng∆∞·ªùi ƒë·∫ßu ti√™n ƒë·∫∑t c√¢u h·ªèi ƒë·ªÉ nh·∫≠n ƒë∆∞·ª£c s·ª± tr·ª£ gi√∫p t·ª´ c·ªông ƒë·ªìng!",[m
[32m+[m[32m            style = MaterialTheme.typography.bodyMedium,[m
[32m+[m[32m            color = Color.Gray,[m
[32m+[m[32m            textAlign = androidx.compose.ui.text.style.TextAlign.Center[m
[32m+[m[32m        )[m
[32m+[m[32m        Spacer(modifier = Modifier.height(32.dp))[m
[32m+[m[32m        Button([m
[32m+[m[32m            onClick = onCreateClick,[m
[32m+[m[32m            colors = ButtonDefaults.buttonColors(containerColor = PrimaryGreen),[m
[32m+[m[32m            shape = RoundedCornerShape(50)[m
[32m+[m[32m        ) {[m
[32m+[m[32m            Icon(Icons.Default.Add, contentDescription = null)[m
[32m+[m[32m            Spacer(modifier = Modifier.width(8.dp))[m
[32m+[m[32m            Text("T·∫°o y√™u c·∫ßu ngay")[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun RequestListSkeleton() {[m
[32m+[m[32m    LazyColumn([m
[32m+[m[32m        modifier = Modifier.fillMaxSize(),[m
[32m+[m[32m        contentPadding = PaddingValues(16.dp),[m
[32m+[m[32m        verticalArrangement = Arrangement.spacedBy(16.dp)[m
[32m+[m[32m    ) {[m
[32m+[m[32m        items(5) { RequestCardSkeleton() }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun RequestCardSkeleton() {[m
[32m+[m[32m    val brush = createShimmerBrush()[m
[32m+[m[32m    Card([m
[32m+[m[32m        modifier = Modifier.fillMaxWidth(),[m
[32m+[m[32m        shape = RoundedCornerShape(16.dp),[m
[32m+[m[32m        colors = CardDefaults.cardColors(containerColor = Color.White),[m
[32m+[m[32m        elevation = CardDefaults.cardElevation(defaultElevation = 2.dp)[m
[32m+[m[32m    ) {[m
[32m+[m[32m        Column(modifier = Modifier.padding(16.dp)) {[m
[32m+[m[32m            Box(modifier = Modifier.width(100.dp).height(24.dp).clip(RoundedCornerShape(8.dp)).background(brush))[m
[32m+[m[32m            Spacer(modifier = Modifier.height(12.dp))[m
[32m+[m[32m            Box(modifier = Modifier.fillMaxWidth(0.8f).height(20.dp).clip(RoundedCornerShape(4.dp)).background(brush))[m
[32m+[m[32m            Spacer(modifier = Modifier.height(8.dp))[m
[32m+[m[32m            Box(modifier = Modifier.fillMaxWidth(0.6f).height(20.dp).clip(RoundedCornerShape(4.dp)).background(brush))[m
[32m+[m[32m            Spacer(modifier = Modifier.height(16.dp))[m
[32m+[m[32m            Box(modifier = Modifier.fillMaxWidth().height(1.dp).background(Color.LightGray.copy(alpha = 0.3f)))[m
[32m+[m[32m            Spacer(modifier = Modifier.height(12.dp))[m
[32m+[m[32m            Row(modifier = Modifier.fillMaxWidth(), horizontalArrangement = Arrangement.SpaceBetween) {[m
[32m+[m[32m                Box(modifier = Modifier.width(100.dp).height(14.dp).clip(RoundedCornerShape(4.dp)).background(brush))[m
[32m+[m[32m                Box(modifier = Modifier.width(60.dp).height(32.dp).clip(RoundedCornerShape(50)).background(brush))[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/feature_request/ui/list/RequestListSkeleton.kt b/app/src/main/java/com/example/stushare/feature_request/ui/list/RequestListSkeleton.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..53d39ab[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/feature_request/ui/list/RequestListSkeleton.kt[m
[36m@@ -0,0 +1,119 @@[m
[32m+[m[32mpackage com.example.stushare.features.feature_request.ui.list[m
[32m+[m
[32m+[m[32mimport androidx.compose.foundation.background[m
[32m+[m[32mimport androidx.compose.foundation.layout.*[m
[32m+[m[32mimport androidx.compose.foundation.lazy.LazyColumn[m
[32m+[m[32mimport androidx.compose.foundation.shape.CircleShape[m
[32m+[m[32mimport androidx.compose.foundation.shape.RoundedCornerShape[m
[32m+[m[32mimport androidx.compose.material3.Card[m
[32m+[m[32mimport androidx.compose.material3.CardDefaults[m
[32m+[m[32mimport androidx.compose.runtime.Composable[m
[32m+[m[32mimport androidx.compose.ui.Alignment[m
[32m+[m[32mimport androidx.compose.ui.Modifier[m
[32m+[m[32mimport androidx.compose.ui.draw.clip[m
[32m+[m[32mimport androidx.compose.ui.graphics.Color[m
[32m+[m[32mimport androidx.compose.ui.unit.dp[m
[32m+[m[32mimport com.example.stushare.ui.theme.createShimmerBrush[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun RequestListSkeleton() {[m
[32m+[m[32m    LazyColumn([m
[32m+[m[32m        modifier = Modifier.fillMaxSize(),[m
[32m+[m[32m        contentPadding = PaddingValues(16.dp),[m
[32m+[m[32m        verticalArrangement = Arrangement.spacedBy(16.dp)[m
[32m+[m[32m    ) {[m
[32m+[m[32m        // Gi·∫£ l·∫≠p 5 th·∫ª ƒëang t·∫£i[m
[32m+[m[32m        items(5) {[m
[32m+[m[32m            RequestCardSkeleton()[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun RequestCardSkeleton() {[m
[32m+[m[32m    val brush = createShimmerBrush() // Hi·ªáu ·ª©ng l·∫•p l√°nh[m
[32m+[m
[32m+[m[32m    Card([m
[32m+[m[32m        modifier = Modifier.fillMaxWidth(),[m
[32m+[m[32m        shape = RoundedCornerShape(16.dp),[m
[32m+[m[32m        colors = CardDefaults.cardColors(containerColor = Color.White),[m
[32m+[m[32m        elevation = CardDefaults.cardElevation(defaultElevation = 2.dp)[m
[32m+[m[32m    ) {[m
[32m+[m[32m        Column([m
[32m+[m[32m            modifier = Modifier.padding(16.dp)[m
[32m+[m[32m        ) {[m
[32m+[m[32m            // 1. Badge M√¥n h·ªçc (Skeleton)[m
[32m+[m[32m            Box([m
[32m+[m[32m                modifier = Modifier[m
[32m+[m[32m                    .width(100.dp)[m
[32m+[m[32m                    .height(24.dp)[m
[32m+[m[32m                    .clip(RoundedCornerShape(8.dp))[m
[32m+[m[32m                    .background(brush)[m
[32m+[m[32m            )[m
[32m+[m[32m            Spacer(modifier = Modifier.height(12.dp))[m
[32m+[m
[32m+[m[32m            // 2. Ti√™u ƒë·ªÅ (Skeleton - 2 d√≤ng)[m
[32m+[m[32m            Box([m
[32m+[m[32m                modifier = Modifier[m
[32m+[m[32m                    .fillMaxWidth(0.8f)[m
[32m+[m[32m                    .height(20.dp)[m
[32m+[m[32m                    .clip(RoundedCornerShape(4.dp))[m
[32m+[m[32m                    .background(brush)[m
[32m+[m[32m            )[m
[32m+[m[32m            Spacer(modifier = Modifier.height(8.dp))[m
[32m+[m[32m            Box([m
[32m+[m[32m                modifier = Modifier[m
[32m+[m[32m                    .fillMaxWidth(0.6f)[m
[32m+[m[32m                    .height(20.dp)[m
[32m+[m[32m                    .clip(RoundedCornerShape(4.dp))[m
[32m+[m[32m                    .background(brush)[m
[32m+[m[32m            )[m
[32m+[m
[32m+[m[32m            Spacer(modifier = Modifier.height(16.dp))[m
[32m+[m
[32m+[m[32m            // ƒê∆∞·ªùng k·∫ª m·ªù[m
[32m+[m[32m            Box([m
[32m+[m[32m                modifier = Modifier[m
[32m+[m[32m                    .fillMaxWidth()[m
[32m+[m[32m                    .height(1.dp)[m
[32m+[m[32m                    .background(Color.LightGray.copy(alpha = 0.3f))[m
[32m+[m[32m            )[m
[32m+[m
[32m+[m[32m            Spacer(modifier = Modifier.height(12.dp))[m
[32m+[m
[32m+[m[32m            // 3. Footer (T√°c gi·∫£ + N√∫t)[m
[32m+[m[32m            Row([m
[32m+[m[32m                modifier = Modifier.fillMaxWidth(),[m
[32m+[m[32m                horizontalArrangement = Arrangement.SpaceBetween,[m
[32m+[m[32m                verticalAlignment = Alignment.CenterVertically[m
[32m+[m[32m            ) {[m
[32m+[m[32m                // T√°c gi·∫£[m
[32m+[m[32m                Row(verticalAlignment = Alignment.CenterVertically) {[m
[32m+[m[32m                    Box([m
[32m+[m[32m                        modifier = Modifier[m
[32m+[m[32m                            .size(24.dp)[m
[32m+[m[32m                            .clip(CircleShape)[m
[32m+[m[32m                            .background(brush)[m
[32m+[m[32m                    )[m
[32m+[m[32m                    Spacer(modifier = Modifier.width(8.dp))[m
[32m+[m[32m                    Box([m
[32m+[m[32m                        modifier = Modifier[m
[32m+[m[32m                            .width(80.dp)[m
[32m+[m[32m                            .height(14.dp)[m
[32m+[m[32m                            .clip(RoundedCornerShape(4.dp))[m
[32m+[m[32m                            .background(brush)[m
[32m+[m[32m                    )[m
[32m+[m[32m                }[m
[32m+[m
[32m+[m[32m                // N√∫t gi·∫£[m
[32m+[m[32m                Box([m
[32m+[m[32m                    modifier = Modifier[m
[32m+[m[32m                        .width(60.dp)[m
[32m+[m[32m                        .height(32.dp)[m
[32m+[m[32m                        .clip(RoundedCornerShape(50))[m
[32m+[m[32m                        .background(brush)[m
[32m+[m[32m                )[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/feature_request/ui/list/RequestListViewModel.kt b/app/src/main/java/com/example/stushare/feature_request/ui/list/RequestListViewModel.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..5e6b8ad[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/feature_request/ui/list/RequestListViewModel.kt[m
[36m@@ -0,0 +1,53 @@[m
[32m+[m[32mpackage com.example.stushare.features.feature_request.ui.list[m
[32m+[m
[32m+[m[32mimport androidx.lifecycle.ViewModel[m
[32m+[m[32mimport androidx.lifecycle.viewModelScope[m
[32m+[m[32mimport com.example.stushare.core.data.models.DocumentRequest[m
[32m+[m[32mimport com.example.stushare.core.data.repository.RequestRepository[m
[32m+[m[32mimport dagger.hilt.android.lifecycle.HiltViewModel[m
[32m+[m[32mimport kotlinx.coroutines.flow.MutableStateFlow[m
[32m+[m[32mimport kotlinx.coroutines.flow.StateFlow[m
[32m+[m[32mimport kotlinx.coroutines.flow.asStateFlow[m
[32m+[m[32mimport kotlinx.coroutines.flow.update // ‚≠êÔ∏è QUAN TR·ªåNG: Import update[m
[32m+[m[32mimport kotlinx.coroutines.flow.catch[m
[32m+[m[32mimport kotlinx.coroutines.launch[m
[32m+[m[32mimport javax.inject.Inject[m
[32m+[m
[32m+[m[32mdata class RequestListUiState([m
[32m+[m[32m    val requests: List<DocumentRequest> = emptyList(),[m
[32m+[m[32m    val isLoading: Boolean = true,[m
[32m+[m[32m    val errorMessage: String? = null[m
[32m+[m[32m)[m
[32m+[m
[32m+[m[32m@HiltViewModel[m
[32m+[m[32mclass RequestListViewModel @Inject constructor([m
[32m+[m[32m    private val repository: RequestRepository[m
[32m+[m[32m) : ViewModel() {[m
[32m+[m
[32m+[m[32m    private val _uiState = MutableStateFlow(RequestListUiState())[m
[32m+[m[32m    val uiState: StateFlow<RequestListUiState> = _uiState.asStateFlow()[m
[32m+[m
[32m+[m[32m    init {[m
[32m+[m[32m        viewModelScope.launch {[m
[32m+[m[32m            repository.getAllRequests()[m
[32m+[m[32m                .catch { e ->[m
[32m+[m[32m                    // ‚≠êÔ∏è C·∫¨P NH·∫¨T AN TO√ÄN: L·ªñI[m
[32m+[m[32m                    _uiState.update {[m
[32m+[m[32m                        RequestListUiState([m
[32m+[m[32m                            isLoading = false,[m
[32m+[m[32m                            errorMessage = "Kh√¥ng th·ªÉ t·∫£i y√™u c·∫ßu: ${e.message}"[m
[32m+[m[32m                        )[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m                .collect { requestsFromFirestore ->[m
[32m+[m[32m                    // ‚≠êÔ∏è C·∫¨P NH·∫¨T AN TO√ÄN: TH√ÄNH C√îNG[m
[32m+[m[32m                    _uiState.update {[m
[32m+[m[32m                        RequestListUiState([m
[32m+[m[32m                            requests = requestsFromFirestore,[m
[32m+[m[32m                            isLoading = false[m
[32m+[m[32m                        )[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/feature_search/ui/search/SearchResultCard.kt b/app/src/main/java/com/example/stushare/feature_search/ui/search/SearchResultCard.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..bf7b24b[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/feature_search/ui/search/SearchResultCard.kt[m
[36m@@ -0,0 +1,103 @@[m
[32m+[m[32mpackage com.example.stushare.features.feature_search.ui.components[m
[32m+[m
[32m+[m[32mimport androidx.compose.foundation.layout.*[m
[32m+[m[32mimport androidx.compose.foundation.shape.RoundedCornerShape[m
[32m+[m[32mimport androidx.compose.material.icons.Icons[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Download[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Star[m
[32m+[m[32mimport androidx.compose.material3.*[m
[32m+[m[32mimport androidx.compose.runtime.Composable[m
[32m+[m[32mimport androidx.compose.ui.Alignment[m
[32m+[m[32mimport androidx.compose.ui.Modifier[m
[32m+[m[32mimport androidx.compose.ui.draw.clip[m
[32m+[m[32mimport androidx.compose.ui.graphics.Color[m
[32m+[m[32mimport androidx.compose.ui.layout.ContentScale[m
[32m+[m[32mimport androidx.compose.ui.text.font.FontWeight[m
[32m+[m[32mimport androidx.compose.ui.text.style.TextOverflow[m
[32m+[m[32mimport androidx.compose.ui.unit.dp[m
[32m+[m[32mimport androidx.compose.ui.unit.sp[m
[32m+[m[32mimport coil.compose.AsyncImage[m
[32m+[m[32mimport com.example.stushare.core.data.models.Document[m
[32m+[m
[32m+[m[32m@OptIn(ExperimentalMaterial3Api::class)[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun SearchResultCard([m
[32m+[m[32m    document: Document,[m
[32m+[m[32m    onClick: () -> Unit,[m
[32m+[m[32m    modifier: Modifier = Modifier[m
[32m+[m[32m) {[m
[32m+[m[32m    // Thi·∫øt k·∫ø n√†y gi·ªëng h·ªát DocumentCard, ch·ªâ kh√°c c√°ch s·∫Øp x·∫øp[m
[32m+[m[32m    // Ch√∫ng ta c√≥ th·ªÉ t√°i s·ª≠ d·ª•ng 100% DocumentCard t·ª´ feature_home[m
[32m+[m[32m    // Nh∆∞ng n·∫øu thi·∫øt k·∫ø kh√°c (nh∆∞ ·∫£nh tr√°i, text ph·∫£i) th√¨ b·∫°n d√πng code d∆∞·ªõi:[m
[32m+[m
[32m+[m[32m    Card([m
[32m+[m[32m        onClick = onClick,[m
[32m+[m[32m        modifier = modifier.fillMaxWidth(),[m
[32m+[m[32m        shape = RoundedCornerShape(12.dp),[m
[32m+[m[32m        colors = CardDefaults.cardColors([m
[32m+[m[32m            containerColor = MaterialTheme.colorScheme.surfaceVariant[m
[32m+[m[32m        )[m
[32m+[m[32m    ) {[m
[32m+[m[32m        Row([m
[32m+[m[32m            modifier = Modifier[m
[32m+[m[32m                .fillMaxWidth()[m
[32m+[m[32m                .padding(8.dp),[m
[32m+[m[32m            verticalAlignment = Alignment.CenterVertically[m
[32m+[m[32m        ) {[m
[32m+[m[32m            // ·∫¢nh b√¨a[m
[32m+[m[32m            AsyncImage([m
[32m+[m[32m                model = document.imageUrl,[m
[32m+[m[32m                contentDescription = document.title,[m
[32m+[m[32m                modifier = Modifier[m
[32m+[m[32m                    .size(100.dp, 120.dp) // K√≠ch th∆∞·ªõc ·∫£nh[m
[32m+[m[32m                    .clip(RoundedCornerShape(8.dp)),[m
[32m+[m[32m                contentScale = ContentScale.Crop[m
[32m+[m[32m            )[m
[32m+[m
[32m+[m[32m            Spacer(modifier = Modifier.width(12.dp))[m
[32m+[m
[32m+[m[32m            // C·ª•m th√¥ng tin[m
[32m+[m[32m            Column([m
[32m+[m[32m                modifier = Modifier.weight(1f),[m
[32m+[m[32m                verticalArrangement = Arrangement.SpaceBetween[m
[32m+[m[32m            ) {[m
[32m+[m[32m                Text([m
[32m+[m[32m                    text = document.title,[m
[32m+[m[32m                    style = MaterialTheme.typography.titleMedium,[m
[32m+[m[32m                    maxLines = 2,[m
[32m+[m[32m                    overflow = TextOverflow.Ellipsis[m
[32m+[m[32m                )[m
[32m+[m[32m                Spacer(modifier = Modifier.height(4.dp))[m
[32m+[m[32m                Text([m
[32m+[m[32m                    text = "T√°c gi·∫£: Ho√†ng VƒÉn Tu·∫•n", // (D·ªØ li·ªáu gi·∫£)[m
[32m+[m[32m                    style = MaterialTheme.typography.bodySmall,[m
[32m+[m[32m                    color = MaterialTheme.colorScheme.onSurfaceVariant[m
[32m+[m[32m                )[m
[32m+[m[32m                Text([m
[32m+[m[32m                    text = "Lo·∫°i: ${document.type}",[m
[32m+[m[32m                    style = MaterialTheme.typography.bodySmall,[m
[32m+[m[32m                    color = MaterialTheme.colorScheme.onSurfaceVariant[m
[32m+[m[32m                )[m
[32m+[m
[32m+[m[32m                Spacer(modifier = Modifier.height(8.dp))[m
[32m+[m
[32m+[m[32m                // Th√¥ng s·ªë[m
[32m+[m[32m                Row([m
[32m+[m[32m                    modifier = Modifier.fillMaxWidth(),[m
[32m+[m[32m                    horizontalArrangement = Arrangement.SpaceBetween[m
[32m+[m[32m                ) {[m
[32m+[m[32m                    Row(verticalAlignment = Alignment.CenterVertically) {[m
[32m+[m[32m                        Icon(Icons.Filled.Download, "T·∫£i v·ªÅ", Modifier.size(16.dp), Color.Gray)[m
[32m+[m[32m                        Spacer(Modifier.width(4.dp))[m
[32m+[m[32m                        Text(document.downloads.toString(), style = MaterialTheme.typography.bodySmall)[m
[32m+[m[32m                    }[m
[32m+[m[32m                    Row(verticalAlignment = Alignment.CenterVertically) {[m
[32m+[m[32m                        Icon(Icons.Filled.Star, "Rating", Modifier.size(16.dp), Color(0xFFFFC107))[m
[32m+[m[32m                        Spacer(Modifier.width(4.dp))[m
[32m+[m[32m                        Text(document.rating.toString(), style = MaterialTheme.typography.bodySmall)[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/feature_search/ui/search/SearchResultScreen.kt b/app/src/main/java/com/example/stushare/feature_search/ui/search/SearchResultScreen.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..986aa64[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/feature_search/ui/search/SearchResultScreen.kt[m
[36m@@ -0,0 +1,237 @@[m
[32m+[m[32mpackage com.example.stushare.feature_search.ui.search[m
[32m+[m
[32m+[m[32mimport androidx.compose.foundation.layout.Arrangement[m
[32m+[m[32mimport androidx.compose.foundation.layout.Box[m
[32m+[m[32mimport androidx.compose.foundation.layout.Column[m
[32m+[m[32mimport androidx.compose.foundation.layout.PaddingValues[m
[32m+[m[32mimport androidx.compose.foundation.layout.Spacer[m
[32m+[m[32mimport androidx.compose.foundation.layout.fillMaxSize[m
[32m+[m[32mimport androidx.compose.foundation.layout.height[m
[32m+[m[32mimport androidx.compose.foundation.layout.padding[m
[32m+[m[32mimport androidx.compose.foundation.layout.size[m
[32m+[m[32mimport androidx.compose.foundation.lazy.LazyColumn[m
[32m+[m[32mimport androidx.compose.foundation.lazy.items[m
[32m+[m[32mimport androidx.compose.material.icons.Icons[m
[32m+[m[32mimport androidx.compose.material.icons.automirrored.filled.ArrowBack[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Info[m
[32m+[m[32mimport androidx.compose.material.icons.filled.SearchOff[m
[32m+[m[32mimport androidx.compose.material3.Button[m
[32m+[m[32mimport androidx.compose.material3.ButtonDefaults[m
[32m+[m[32mimport androidx.compose.material3.CircularProgressIndicator[m
[32m+[m[32mimport androidx.compose.material3.ExperimentalMaterial3Api[m
[32m+[m[32mimport androidx.compose.material3.Icon[m
[32m+[m[32mimport androidx.compose.material3.IconButton[m
[32m+[m[32mimport androidx.compose.material3.MaterialTheme[m
[32m+[m[32mimport androidx.compose.material3.Scaffold[m
[32m+[m[32mimport androidx.compose.material3.Text[m
[32m+[m[32mimport androidx.compose.material3.TopAppBar[m
[32m+[m[32mimport androidx.compose.material3.TopAppBarDefaults[m
[32m+[m[32mimport androidx.compose.runtime.Composable[m
[32m+[m[32mimport androidx.compose.runtime.getValue[m
[32m+[m[32mimport androidx.compose.ui.Alignment[m
[32m+[m[32mimport androidx.compose.ui.Modifier[m
[32m+[m[32mimport androidx.compose.ui.graphics.Color[m
[32m+[m[32mimport androidx.compose.ui.text.font.FontWeight[m
[32m+[m[32mimport androidx.compose.ui.text.style.TextAlign[m
[32m+[m[32mimport androidx.compose.ui.unit.dp[m
[32m+[m[32mimport androidx.compose.ui.unit.sp[m
[32m+[m[32mimport androidx.hilt.navigation.compose.hiltViewModel[m
[32m+[m[32mimport androidx.lifecycle.compose.collectAsStateWithLifecycle[m
[32m+[m[32mimport com.example.stushare.core.data.models.Document[m
[32m+[m[32mimport com.example.stushare.features.feature_home.ui.components.DocumentCard[m
[32m+[m[32mimport com.example.stushare.ui.theme.PrimaryGreen[m
[32m+[m
[32m+[m[32m@OptIn(ExperimentalMaterial3Api::class)[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun SearchResultScreen([m
[32m+[m[32m    onBackClick: () -> Unit,[m
[32m+[m[32m    onDocumentClick: (Long) -> Unit,[m
[32m+[m[32m    onRequestClick: () -> Unit, // Gi·ªØ l·∫°i callback n√†y cho Empty State[m
[32m+[m[32m    viewModel: SearchResultViewModel = hiltViewModel()[m
[32m+[m[32m) {[m
[32m+[m[32m    val uiState by viewModel.uiState.collectAsStateWithLifecycle()[m
[32m+[m[32m    val query = viewModel.query[m
[32m+[m
[32m+[m[32m    Scaffold([m
[32m+[m[32m        topBar = {[m
[32m+[m[32m            SearchResultTopBar([m
[32m+[m[32m                query = query,[m
[32m+[m[32m                onBackClick = onBackClick[m
[32m+[m[32m            )[m
[32m+[m[32m        }[m
[32m+[m[32m        // ‚ùå ƒê√É X√ìA FloatingActionButton ·ªü ƒë√¢y theo y√™u c·∫ßu[m
[32m+[m[32m    ) { paddingValues ->[m
[32m+[m[32m        Box([m
[32m+[m[32m            modifier = Modifier[m
[32m+[m[32m                .fillMaxSize()[m
[32m+[m[32m                .padding(paddingValues)[m
[32m+[m[32m        ) {[m
[32m+[m[32m            when (val state = uiState) {[m
[32m+[m[32m                is SearchUiState.Loading -> {[m
[32m+[m[32m                    Box(Modifier.fillMaxSize(), contentAlignment = Alignment.Center) {[m
[32m+[m[32m                        CircularProgressIndicator(color = PrimaryGreen)[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m                is SearchUiState.Success -> {[m
[32m+[m[32m                    if (state.results.isEmpty()) {[m
[32m+[m[32m                        // G·ªçi Empty State khi danh s√°ch r·ªóng[m
[32m+[m[32m                        EmptyResult(query = query, onRequestClick = onRequestClick)[m
[32m+[m[32m                    } else {[m
[32m+[m[32m                        SearchResultList([m
[32m+[m[32m                            documents = state.results,[m
[32m+[m[32m                            onDocumentClick = onDocumentClick as (String) -> Unit[m
[32m+[m[32m                        )[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m                is SearchUiState.Empty -> {[m
[32m+[m[32m                    // G·ªçi Empty State khi search tr·∫£ v·ªÅ k·∫øt qu·∫£ Empty[m
[32m+[m[32m                    EmptyResult(query = query, onRequestClick = onRequestClick)[m
[32m+[m[32m                }[m
[32m+[m[32m                is SearchUiState.Error -> {[m
[32m+[m[32m                    ErrorMessage(message = state.message)[m
[32m+[m[32m                }[m
[32m+[m[32m                is SearchUiState.Initial -> {[m
[32m+[m[32m                    Box(Modifier.fillMaxSize(), contentAlignment = Alignment.Center) {[m
[32m+[m[32m                        CircularProgressIndicator(color = PrimaryGreen)[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m// --- Component TopBar ---[m
[32m+[m[32m@OptIn(ExperimentalMaterial3Api::class)[m
[32m+[m[32m@Composable[m
[32m+[m[32mprivate fun SearchResultTopBar(query: String, onBackClick: () -> Unit) {[m
[32m+[m[32m    TopAppBar([m
[32m+[m[32m        title = {[m
[32m+[m[32m            Text([m
[32m+[m[32m                text = "K·∫øt qu·∫£ cho \"$query\"",[m
[32m+[m[32m                fontWeight = FontWeight.SemiBold,[m
[32m+[m[32m                maxLines = 1[m
[32m+[m[32m            )[m
[32m+[m[32m        },[m
[32m+[m[32m        navigationIcon = {[m
[32m+[m[32m            IconButton(onClick = onBackClick) {[m
[32m+[m[32m                Icon([m
[32m+[m[32m                    imageVector = Icons.AutoMirrored.Filled.ArrowBack,[m
[32m+[m[32m                    contentDescription = "Quay l·∫°i"[m
[32m+[m[32m                )[m
[32m+[m[32m            }[m
[32m+[m[32m        },[m
[32m+[m[32m        colors = TopAppBarDefaults.topAppBarColors([m
[32m+[m[32m            containerColor = Color.White,[m
[32m+[m[32m            titleContentColor = Color.Black[m
[32m+[m[32m        )[m
[32m+[m[32m    )[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m// --- Component Hi·ªÉn th·ªã Danh s√°ch K·∫øt qu·∫£ ---[m
[32m+[m[32m@Composable[m
[32m+[m[32mprivate fun SearchResultList([m
[32m+[m[32m    documents: List<Document>,[m
[32m+[m[32m    onDocumentClick: (String) -> Unit[m
[32m+[m[32m) {[m
[32m+[m[32m    LazyColumn([m
[32m+[m[32m        // üõ† ƒê√£ ch·ªânh l·∫°i padding bottom v·ªÅ 16.dp (v√¨ kh√¥ng c√≤n FAB che n·ªØa)[m
[32m+[m[32m        contentPadding = PaddingValues(horizontal = 16.dp, vertical = 8.dp),[m
[32m+[m[32m        verticalArrangement = Arrangement.spacedBy(12.dp),[m
[32m+[m[32m        modifier = Modifier.fillMaxSize()[m
[32m+[m[32m    ) {[m
[32m+[m[32m        item {[m
[32m+[m[32m            Text([m
[32m+[m[32m                text = "T√¨m th·∫•y ${documents.size} t√†i li·ªáu",[m
[32m+[m[32m                color = Color.Gray,[m
[32m+[m[32m                modifier = Modifier.padding(bottom = 8.dp)[m
[32m+[m[32m            )[m
[32m+[m[32m        }[m
[32m+[m[32m        items(documents) { document ->[m
[32m+[m[32m            DocumentCard([m
[32m+[m[32m                document = document,[m
[32m+[m[32m                onClick = { onDocumentClick(document.id) }[m
[32m+[m[32m            )[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m// --- Component Kh√¥ng c√≥ K·∫øt qu·∫£ (ƒê√£ t√≠ch h·ª£p n√∫t Action) ---[m
[32m+[m[32m@Composable[m
[32m+[m[32mprivate fun EmptyResult([m
[32m+[m[32m    query: String,[m
[32m+[m[32m    onRequestClick: () -> Unit[m
[32m+[m[32m) {[m
[32m+[m[32m    Column([m
[32m+[m[32m        modifier = Modifier[m
[32m+[m[32m            .fillMaxSize()[m
[32m+[m[32m            .padding(32.dp),[m
[32m+[m[32m        horizontalAlignment = Alignment.CenterHorizontally,[m
[32m+[m[32m        verticalArrangement = Arrangement.Center[m
[32m+[m[32m    ) {[m
[32m+[m[32m        Icon([m
[32m+[m[32m            imageVector = Icons.Default.SearchOff,[m
[32m+[m[32m            contentDescription = "Kh√¥ng t√¨m th·∫•y",[m
[32m+[m[32m            tint = Color.Gray.copy(alpha = 0.5f),[m
[32m+[m[32m            modifier = Modifier.size(80.dp)[m
[32m+[m[32m        )[m
[32m+[m
[32m+[m[32m        Spacer(modifier = Modifier.height(16.dp))[m
[32m+[m
[32m+[m[32m        Text([m
[32m+[m[32m            text = "R·∫•t ti·∫øc, kh√¥ng t√¨m th·∫•y t√†i li·ªáu n√†o",[m
[32m+[m[32m            fontSize = 18.sp,[m
[32m+[m[32m            fontWeight = FontWeight.Bold,[m
[32m+[m[32m            textAlign = TextAlign.Center[m
[32m+[m[32m        )[m
[32m+[m
[32m+[m[32m        Spacer(modifier = Modifier.height(8.dp))[m
[32m+[m
[32m+[m[32m        Text([m
[32m+[m[32m            text = "Ch√∫ng t√¥i kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£ cho t·ª´ kh√≥a \"$query\".",[m
[32m+[m[32m            color = Color.Gray,[m
[32m+[m[32m            textAlign = TextAlign.Center[m
[32m+[m[32m        )[m
[32m+[m
[32m+[m[32m        Spacer(modifier = Modifier.height(24.dp))[m
[32m+[m
[32m+[m[32m        // N√∫t k√™u g·ªçi h√†nh ƒë·ªông (CTA)[m
[32m+[m[32m        Button([m
[32m+[m[32m            onClick = onRequestClick,[m
[32m+[m[32m            colors = ButtonDefaults.buttonColors(containerColor = PrimaryGreen),[m
[32m+[m[32m            modifier = Modifier.height(50.dp)[m
[32m+[m[32m        ) {[m
[32m+[m[32m            Text([m
[32m+[m[32m                text = "Nh·ªù c·ªông ƒë·ªìng t√¨m gi√∫p ngay!",[m
[32m+[m[32m                fontSize = 16.sp,[m
[32m+[m[32m                fontWeight = FontWeight.Medium[m
[32m+[m[32m            )[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m// --- Component L·ªói ---[m
[32m+[m[32m@Composable[m
[32m+[m[32mprivate fun ErrorMessage(message: String) {[m
[32m+[m[32m    Box([m
[32m+[m[32m        modifier = Modifier[m
[32m+[m[32m            .fillMaxSize()[m
[32m+[m[32m            .padding(16.dp),[m
[32m+[m[32m        contentAlignment = Alignment.Center[m
[32m+[m[32m    ) {[m
[32m+[m[32m        Column(horizontalAlignment = Alignment.CenterHorizontally) {[m
[32m+[m[32m            Icon([m
[32m+[m[32m                imageVector = Icons.Default.Info,[m
[32m+[m[32m                contentDescription = "L·ªói",[m
[32m+[m[32m                tint = Color.Red,[m
[32m+[m[32m                modifier = Modifier.size(48.dp)[m
[32m+[m[32m            )[m
[32m+[m[32m            Spacer(modifier = Modifier.height(8.dp))[m
[32m+[m[32m            Text([m
[32m+[m[32m                text = "ƒê√£ x·∫£y ra l·ªói: $message",[m
[32m+[m[32m                color = Color.Red,[m
[32m+[m[32m                fontWeight = FontWeight.Bold,[m
[32m+[m[32m                textAlign = TextAlign.Center[m
[32m+[m[32m            )[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/feature_search/ui/search/SearchResultViewModel.kt b/app/src/main/java/com/example/stushare/feature_search/ui/search/SearchResultViewModel.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..873f34c[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/feature_search/ui/search/SearchResultViewModel.kt[m
[36m@@ -0,0 +1,92 @@[m
[32m+[m[32mpackage com.example.stushare.feature_search.ui.search[m
[32m+[m
[32m+[m[32mimport androidx.lifecycle.SavedStateHandle[m
[32m+[m[32mimport androidx.lifecycle.ViewModel[m
[32m+[m[32mimport androidx.lifecycle.viewModelScope[m
[32m+[m[32mimport com.example.stushare.core.data.models.DataFailureException[m
[32m+[m[32mimport com.example.stushare.core.data.repository.DocumentRepository[m
[32m+[m[32mimport com.example.stushare.core.data.repository.SettingsRepository[m
[32m+[m[32mimport dagger.hilt.android.lifecycle.HiltViewModel[m
[32m+[m[32mimport kotlinx.coroutines.Job[m
[32m+[m[32mimport kotlinx.coroutines.flow.MutableStateFlow[m
[32m+[m[32mimport kotlinx.coroutines.flow.StateFlow[m
[32m+[m[32mimport kotlinx.coroutines.flow.asStateFlow[m
[32m+[m[32mimport kotlinx.coroutines.flow.catch[m
[32m+[m[32mimport kotlinx.coroutines.flow.onStart[m
[32m+[m[32mimport kotlinx.coroutines.launch[m
[32m+[m[32mimport javax.inject.Inject[m
[32m+[m
[32m+[m[32m@HiltViewModel[m
[32m+[m[32mclass SearchResultViewModel @Inject constructor([m
[32m+[m[32m    private val repository: DocumentRepository,[m
[32m+[m[32m    private val settingsRepository: SettingsRepository,[m
[32m+[m[32m    savedStateHandle: SavedStateHandle[m
[32m+[m[32m) : ViewModel() {[m
[32m+[m
[32m+[m[32m    private val _uiState = MutableStateFlow<SearchUiState>(SearchUiState.Loading)[m
[32m+[m[32m    val uiState: StateFlow<SearchUiState> = _uiState.asStateFlow()[m
[32m+[m
[32m+[m[32m    // L·∫•y t·ª´ kh√≥a t·ª´ m√†n h√¨nh tr∆∞·ªõc truy·ªÅn sang[m
[32m+[m[32m    val query: String = savedStateHandle.get<String>("query") ?: ""[m
[32m+[m
[32m+[m[32m    // Bi·∫øn ƒë·ªÉ qu·∫£n l√Ω lu·ªìng t√¨m ki·∫øm (gi√∫p h·ªßy t√¨m ki·∫øm c≈© n·∫øu g·ªçi l·∫°i)[m
[32m+[m[32m    private var searchJob: Job? = null[m
[32m+[m
[32m+[m[32m    init {[m
[32m+[m[32m        if (query.isNotBlank()) {[m
[32m+[m[32m            performSearch(query)[m
[32m+[m[32m            saveRecentSearch(query)[m
[32m+[m[32m        } else {[m
[32m+[m[32m            _uiState.value = SearchUiState.Error("Kh√¥ng nh·∫≠n ƒë∆∞·ª£c t·ª´ kh√≥a t√¨m ki·∫øm.")[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    private fun saveRecentSearch(query: String) {[m
[32m+[m[32m        viewModelScope.launch {[m
[32m+[m[32m            settingsRepository.addRecentSearch(query)[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    fun performSearch(query: String) {[m
[32m+[m[32m        // 1. H·ªßy job c≈© n·∫øu ƒëang ch·∫°y (tr√°nh xung ƒë·ªôt)[m
[32m+[m[32m        searchJob?.cancel()[m
[32m+[m
[32m+[m[32m        // 2. B·∫Øt ƒë·∫ßu job m·ªõi[m
[32m+[m[32m        searchJob = viewModelScope.launch {[m
[32m+[m
[32m+[m[32m            // A. C·ªë g·∫Øng l√†m m·ªõi d·ªØ li·ªáu t·ª´ Server (n·∫øu c·∫ßn)[m
[32m+[m[32m            // Ch·∫°y c√°i n√†y trong try-catch ri√™ng ƒë·ªÉ n·∫øu m·∫•t m·∫°ng th√¨ v·∫´n t√¨m ƒë∆∞·ª£c offline[m
[32m+[m[32m            try {[m
[32m+[m[32m                repository.refreshDocumentsIfStale()[m
[32m+[m[32m            } catch (e: Exception) {[m
[32m+[m[32m                e.printStackTrace()[m
[32m+[m[32m                // Kh√¥ng set Error ·ªü ƒë√¢y, ƒë·ªÉ code ch·∫°y ti·∫øp xu·ªëng l·∫•y data offline[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            // B. L·∫Øng nghe d·ªØ li·ªáu t·ª´ Database (Flow)[m
[32m+[m[32m            // üü¢ QUAN TR·ªåNG: D√πng collect thay v√¨ g√°n tr·ª±c ti·∫øp[m
[32m+[m[32m            repository.searchDocuments(query.trim())[m
[32m+[m[32m                .onStart {[m
[32m+[m[32m                    // Khi b·∫Øt ƒë·∫ßu t√¨m th√¨ hi·ªán Loading[m
[32m+[m[32m                    _uiState.value = SearchUiState.Loading[m
[32m+[m[32m                }[m
[32m+[m[32m                .catch { e ->[m
[32m+[m[32m                    // X·ª≠ l√Ω l·ªói n·∫øu qu√° tr√¨nh l·∫•y tin t·ª´ DB b·ªã fail[m
[32m+[m[32m                    e.printStackTrace()[m
[32m+[m[32m                    val errorMessage = when (e) {[m
[32m+[m[32m                        is DataFailureException.NetworkError -> "M·∫•t k·∫øt n·ªëi m·∫°ng"[m
[32m+[m[32m                        else -> "L·ªói t√¨m ki·∫øm: ${e.message}"[m
[32m+[m[32m                    }[m
[32m+[m[32m                    _uiState.value = SearchUiState.Error(errorMessage)[m
[32m+[m[32m                }[m
[32m+[m[32m                .collect { results ->[m
[32m+[m[32m                    // üü¢ Khi c√≥ k·∫øt qu·∫£ (ho·∫∑c khi c√≥ b√†i b·ªã x√≥a), code n√†y t·ª± ch·∫°y l·∫°i[m
[32m+[m[32m                    if (results.isEmpty()) {[m
[32m+[m[32m                        _uiState.value = SearchUiState.Empty[m
[32m+[m[32m                    } else {[m
[32m+[m[32m                        _uiState.value = SearchUiState.Success(results, results.size)[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/feature_search/ui/search/SearchScreen.kt b/app/src/main/java/com/example/stushare/feature_search/ui/search/SearchScreen.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..a1deec0[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/feature_search/ui/search/SearchScreen.kt[m
[36m@@ -0,0 +1,297 @@[m
[32m+[m[32mpackage com.example.stushare.features.feature_search.ui.search[m
[32m+[m
[32m+[m[32mimport androidx.compose.foundation.background[m
[32m+[m[32mimport androidx.compose.foundation.clickable[m
[32m+[m[32mimport androidx.compose.foundation.layout.*[m
[32m+[m[32mimport androidx.compose.foundation.lazy.LazyColumn[m
[32m+[m[32mimport androidx.compose.foundation.lazy.items[m
[32m+[m[32mimport androidx.compose.foundation.shape.CircleShape[m
[32m+[m[32mimport androidx.compose.foundation.shape.RoundedCornerShape[m
[32m+[m[32mimport androidx.compose.foundation.text.KeyboardActions[m
[32m+[m[32mimport androidx.compose.foundation.text.KeyboardOptions[m
[32m+[m[32mimport androidx.compose.material.icons.Icons[m
[32m+[m[32mimport androidx.compose.material.icons.automirrored.filled.ArrowBack[m
[32m+[m[32mimport androidx.compose.material.icons.automirrored.filled.ArrowForward[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Close[m
[32m+[m[32mimport androidx.compose.material.icons.filled.History[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Search[m
[32m+[m[32mimport androidx.compose.material3.*[m
[32m+[m[32mimport androidx.compose.runtime.*[m
[32m+[m[32mimport androidx.compose.ui.Alignment[m
[32m+[m[32mimport androidx.compose.ui.Modifier[m
[32m+[m[32mimport androidx.compose.ui.draw.clip[m
[32m+[m[32mimport androidx.compose.ui.draw.rotate[m
[32m+[m[32mimport androidx.compose.ui.graphics.Color[m
[32m+[m[32mimport androidx.compose.ui.platform.LocalSoftwareKeyboardController[m
[32m+[m[32mimport androidx.compose.ui.res.stringResource // ‚≠êÔ∏è QUAN TR·ªåNG: Import c√°i n√†y[m
[32m+[m[32mimport androidx.compose.ui.text.font.FontWeight[m
[32m+[m[32mimport androidx.compose.ui.text.input.ImeAction[m
[32m+[m[32mimport androidx.compose.ui.unit.dp[m
[32m+[m[32mimport androidx.compose.ui.unit.sp[m
[32m+[m[32mimport androidx.hilt.navigation.compose.hiltViewModel[m
[32m+[m[32mimport androidx.lifecycle.compose.collectAsStateWithLifecycle[m
[32m+[m[32mimport com.example.stushare.R // ‚≠êÔ∏è QUAN TR·ªåNG: Import R c·ªßa project[m
[32m+[m[32mimport com.example.stushare.features.feature_search.ui.components.SearchTagChip[m
[32m+[m[32mimport com.example.stushare.ui.theme.PrimaryGreen[m
[32m+[m
[32m+[m[32m@OptIn(ExperimentalLayoutApi::class)[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun SearchScreen([m
[32m+[m[32m    onBackClick: () -> Unit,[m
[32m+[m[32m    onSearchSubmit: (String) -> Unit,[m
[32m+[m[32m    viewModel: SearchViewModel = hiltViewModel()[m
[32m+[m[32m) {[m
[32m+[m[32m    val currentQuery by viewModel.searchQuery.collectAsStateWithLifecycle()[m
[32m+[m[32m    val recentSearches by viewModel.recentSearchesState.collectAsStateWithLifecycle()[m
[32m+[m
[32m+[m[32m    val keyboardController = LocalSoftwareKeyboardController.current[m
[32m+[m
[32m+[m[32m    // List g·ª£i √Ω (ƒê√£ d√πng stringResource -> OK)[m
[32m+[m[32m    val suggestions = listOf([m
[32m+[m[32m        stringResource(R.string.sugg_law),[m
[32m+[m[32m        stringResource(R.string.sugg_se),[m
[32m+[m[32m        stringResource(R.string.sugg_it),[m
[32m+[m[32m        stringResource(R.string.sugg_exam)[m
[32m+[m[32m    )[m
[32m+[m
[32m+[m[32m    // M√†u ƒë·ªông (ƒê√£ OK)[m
[32m+[m[32m    val backgroundColor = MaterialTheme.colorScheme.background[m
[32m+[m[32m    val contentColor = MaterialTheme.colorScheme.onBackground[m
[32m+[m
[32m+[m[32m    LaunchedEffect(Unit) {[m
[32m+[m[32m        viewModel.navigationEvent.collect { query ->[m
[32m+[m[32m            onSearchSubmit(query)[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    Column([m
[32m+[m[32m        modifier = Modifier[m
[32m+[m[32m            .fillMaxSize()[m
[32m+[m[32m            .background(backgroundColor)[m
[32m+[m[32m            .statusBarsPadding()[m
[32m+[m[32m    ) {[m
[32m+[m[32m        // 1. Header[m
[32m+[m[32m        SearchHeader([m
[32m+[m[32m            query = currentQuery,[m
[32m+[m[32m            onQueryChange = viewModel::onQueryChanged,[m
[32m+[m[32m            onBackClick = onBackClick,[m
[32m+[m[32m            onClearClick = { viewModel.onQueryChanged("") },[m
[32m+[m[32m            onSearch = {[m
[32m+[m[32m                keyboardController?.hide()[m
[32m+[m[32m                if (currentQuery.isNotBlank()) {[m
[32m+[m[32m                    viewModel.onSearchTriggered(currentQuery)[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m[32m        )[m
[32m+[m
[32m+[m[32m        // 2. N·ªôi dung ch√≠nh[m
[32m+[m[32m        Column([m
[32m+[m[32m            modifier = Modifier[m
[32m+[m[32m                .fillMaxWidth()[m
[32m+[m[32m                .weight(1f)[m
[32m+[m[32m                .clip(RoundedCornerShape(topStart = 24.dp, topEnd = 24.dp))[m
[32m+[m[32m                .background(backgroundColor)[m
[32m+[m[32m        ) {[m
[32m+[m[32m            LazyColumn([m
[32m+[m[32m                modifier = Modifier.fillMaxSize(),[m
[32m+[m[32m                contentPadding = PaddingValues(20.dp)[m
[32m+[m[32m            ) {[m
[32m+[m[32m                // Section: L·ªãch s·ª≠ t√¨m ki·∫øm[m
[32m+[m[32m                if (recentSearches.isNotEmpty()) {[m
[32m+[m[32m                    item {[m
[32m+[m[32m                        Row([m
[32m+[m[32m                            modifier = Modifier.fillMaxWidth(),[m
[32m+[m[32m                            horizontalArrangement = Arrangement.SpaceBetween,[m
[32m+[m[32m                            verticalAlignment = Alignment.CenterVertically[m
[32m+[m[32m                        ) {[m
[32m+[m[32m                            // ‚≠êÔ∏è S·ª¨A 1: Thay "T√¨m ki·∫øm g·∫ßn ƒë√¢y" b·∫±ng Resource[m
[32m+[m[32m                            Text([m
[32m+[m[32m                                text = stringResource(R.string.search_recent),[m
[32m+[m[32m                                style = MaterialTheme.typography.titleSmall,[m
[32m+[m[32m                                fontWeight = FontWeight.Bold,[m
[32m+[m[32m                                color = contentColor[m
[32m+[m[32m                            )[m
[32m+[m[32m                            TextButton(onClick = { viewModel.clearRecentSearches() }) {[m
[32m+[m[32m                                // ‚≠êÔ∏è S·ª¨A 2: Thay "X√≥a t·∫•t c·∫£" b·∫±ng Resource[m
[32m+[m[32m                                Text([m
[32m+[m[32m                                    text = stringResource(R.string.clear_all),[m
[32m+[m[32m                                    color = MaterialTheme.colorScheme.error,[m
[32m+[m[32m                                    style = MaterialTheme.typography.bodySmall[m
[32m+[m[32m                                )[m
[32m+[m[32m                            }[m
[32m+[m[32m                        }[m
[32m+[m[32m                        Spacer(modifier = Modifier.height(8.dp))[m
[32m+[m[32m                    }[m
[32m+[m
[32m+[m[32m                    items(recentSearches) { search ->[m
[32m+[m[32m                        RecentSearchItem([m
[32m+[m[32m                            text = search,[m
[32m+[m[32m                            onClick = {[m
[32m+[m[32m                                viewModel.onQueryChanged(search)[m
[32m+[m[32m                                viewModel.onSearchTriggered(search)[m
[32m+[m[32m                            }[m
[32m+[m[32m                        )[m
[32m+[m[32m                    }[m
[32m+[m
[32m+[m[32m                    item {[m
[32m+[m[32m                        Divider([m
[32m+[m[32m                            modifier = Modifier.padding(vertical = 24.dp),[m
[32m+[m[32m                            color = MaterialTheme.colorScheme.outlineVariant.copy(alpha = 0.3f)[m
[32m+[m[32m                        )[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m
[32m+[m[32m                // Section: G·ª£i √Ω[m
[32m+[m[32m                item {[m
[32m+[m[32m                    // ‚≠êÔ∏è S·ª¨A 3: Thay "G·ª£i √Ω cho b·∫°n" b·∫±ng Resource[m
[32m+[m[32m                    Text([m
[32m+[m[32m                        text = stringResource(R.string.search_suggestion),[m
[32m+[m[32m                        style = MaterialTheme.typography.titleSmall,[m
[32m+[m[32m                        fontWeight = FontWeight.Bold,[m
[32m+[m[32m                        color = contentColor,[m
[32m+[m[32m                        modifier = Modifier.padding(bottom = 16.dp)[m
[32m+[m[32m                    )[m
[32m+[m
[32m+[m[32m                    FlowRow([m
[32m+[m[32m                        horizontalArrangement = Arrangement.spacedBy(8.dp),[m
[32m+[m[32m                        verticalArrangement = Arrangement.spacedBy(12.dp)[m
[32m+[m[32m                    ) {[m
[32m+[m[32m                        suggestions.forEach { suggestion ->[m
[32m+[m[32m                            SearchTagChip([m
[32m+[m[32m                                text = suggestion,[m
[32m+[m[32m                                onClick = {[m
[32m+[m[32m                                    viewModel.onQueryChanged(suggestion)[m
[32m+[m[32m                                    viewModel.onSearchTriggered(suggestion)[m
[32m+[m[32m                                }[m
[32m+[m[32m                            )[m
[32m+[m[32m                        }[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mprivate fun SearchHeader([m
[32m+[m[32m    query: String,[m
[32m+[m[32m    onQueryChange: (String) -> Unit,[m
[32m+[m[32m    onBackClick: () -> Unit,[m
[32m+[m[32m    onClearClick: () -> Unit,[m
[32m+[m[32m    onSearch: () -> Unit[m
[32m+[m[32m) {[m
[32m+[m[32m    val inputBackgroundColor = MaterialTheme.colorScheme.surface[m
[32m+[m[32m    val inputTextColor = MaterialTheme.colorScheme.onSurface[m
[32m+[m
[32m+[m[32m    Column([m
[32m+[m[32m        modifier = Modifier[m
[32m+[m[32m            .fillMaxWidth()[m
[32m+[m[32m            .clip(RoundedCornerShape(bottomStart = 24.dp, bottomEnd = 24.dp))[m
[32m+[m[32m            .background(PrimaryGreen)[m
[32m+[m[32m            .padding(start = 16.dp, end = 16.dp, top = 8.dp, bottom = 24.dp)[m
[32m+[m[32m    ) {[m
[32m+[m[32m        // H√†ng ti√™u ƒë·ªÅ[m
[32m+[m[32m        Row(verticalAlignment = Alignment.CenterVertically) {[m
[32m+[m[32m            IconButton(onClick = onBackClick) {[m
[32m+[m[32m                Icon([m
[32m+[m[32m                    imageVector = Icons.AutoMirrored.Filled.ArrowBack,[m
[32m+[m[32m                    contentDescription = stringResource(R.string.cancel), // S·ª≠a description[m
[32m+[m[32m                    tint = Color.White[m
[32m+[m[32m                )[m
[32m+[m[32m            }[m
[32m+[m[32m            // ‚≠êÔ∏è S·ª¨A 4: Thay ti√™u ƒë·ªÅ "T√¨m ki·∫øm" b·∫±ng Resource[m
[32m+[m[32m            Text([m
[32m+[m[32m                text = stringResource(R.string.search_title),[m
[32m+[m[32m                color = Color.White,[m
[32m+[m[32m                fontSize = 20.sp,[m
[32m+[m[32m                fontWeight = FontWeight.Bold,[m
[32m+[m[32m                modifier = Modifier.weight(1f)[m
[32m+[m[32m            )[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        Spacer(modifier = Modifier.height(16.dp))[m
[32m+[m
[32m+[m[32m        // Thanh t√¨m ki·∫øm[m
[32m+[m[32m        TextField([m
[32m+[m[32m            value = query,[m
[32m+[m[32m            onValueChange = onQueryChange,[m
[32m+[m[32m            placeholder = {[m
[32m+[m[32m                // ‚≠êÔ∏è S·ª¨A 5: Thay "Nh·∫≠p t√™n t√†i li·ªáu..." b·∫±ng Resource[m
[32m+[m[32m                Text([m
[32m+[m[32m                    text = stringResource(R.string.search_hint),[m
[32m+[m[32m                    color = inputTextColor.copy(alpha = 0.6f),[m
[32m+[m[32m                    fontSize = 14.sp[m
[32m+[m[32m                )[m
[32m+[m[32m            },[m
[32m+[m[32m            modifier = Modifier[m
[32m+[m[32m                .fillMaxWidth()[m
[32m+[m[32m                .height(50.dp)[m
[32m+[m[32m                .clip(CircleShape),[m
[32m+[m[32m            shape = CircleShape,[m
[32m+[m[32m            colors = TextFieldDefaults.colors([m
[32m+[m[32m                focusedContainerColor = inputBackgroundColor,[m
[32m+[m[32m                unfocusedContainerColor = inputBackgroundColor,[m
[32m+[m[32m                disabledContainerColor = inputBackgroundColor,[m
[32m+[m[32m                focusedTextColor = inputTextColor,[m
[32m+[m[32m                unfocusedTextColor = inputTextColor,[m
[32m+[m[32m                focusedIndicatorColor = Color.Transparent,[m
[32m+[m[32m                unfocusedIndicatorColor = Color.Transparent,[m
[32m+[m[32m                cursorColor = PrimaryGreen[m
[32m+[m[32m            ),[m
[32m+[m[32m            leadingIcon = {[m
[32m+[m[32m                Icon(Icons.Default.Search, contentDescription = null, tint = PrimaryGreen)[m
[32m+[m[32m            },[m
[32m+[m[32m            trailingIcon = {[m
[32m+[m[32m                if (query.isNotEmpty()) {[m
[32m+[m[32m                    IconButton(onClick = onClearClick) {[m
[32m+[m[32m                        Icon([m
[32m+[m[32m                            imageVector = Icons.Default.Close,[m
[32m+[m[32m                            contentDescription = stringResource(R.string.delete),[m
[32m+[m[32m                            tint = inputTextColor.copy(alpha = 0.6f),[m
[32m+[m[32m                            modifier = Modifier.size(20.dp)[m
[32m+[m[32m                        )[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m            },[m
[32m+[m[32m            singleLine = true,[m
[32m+[m[32m            keyboardOptions = KeyboardOptions(imeAction = ImeAction.Search),[m
[32m+[m[32m            keyboardActions = KeyboardActions(onSearch = { onSearch() })[m
[32m+[m[32m        )[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m// ... (H√†m RecentSearchItem gi·ªØ nguy√™n v√¨ ƒë√£ chu·∫©n) ...[m
[32m+[m[32m@Composable[m
[32m+[m[32mprivate fun RecentSearchItem(text: String, onClick: () -> Unit) {[m
[32m+[m[32m    // ... code gi·ªØ nguy√™n ...[m
[32m+[m[32m    val textColor = MaterialTheme.colorScheme.onBackground[m
[32m+[m[32m    val iconColor = MaterialTheme.colorScheme.onSurface.copy(alpha = 0.5f)[m
[32m+[m
[32m+[m[32m    Row([m
[32m+[m[32m        modifier = Modifier[m
[32m+[m[32m            .fillMaxWidth()[m
[32m+[m[32m            .clickable(onClick = onClick)[m
[32m+[m[32m            .padding(vertical = 12.dp),[m
[32m+[m[32m        verticalAlignment = Alignment.CenterVertically[m
[32m+[m[32m    ) {[m
[32m+[m[32m        Icon([m
[32m+[m[32m            imageVector = Icons.Default.History,[m
[32m+[m[32m            contentDescription = null,[m
[32m+[m[32m            tint = iconColor,[m
[32m+[m[32m            modifier = Modifier.size(22.dp)[m
[32m+[m[32m        )[m
[32m+[m[32m        Spacer(modifier = Modifier.width(16.dp))[m
[32m+[m[32m        Text([m
[32m+[m[32m            text = text,[m
[32m+[m[32m            style = MaterialTheme.typography.bodyMedium,[m
[32m+[m[32m            color = textColor,[m
[32m+[m[32m            modifier = Modifier.weight(1f)[m
[32m+[m[32m        )[m
[32m+[m[32m        Icon([m
[32m+[m[32m            imageVector = Icons.AutoMirrored.Filled.ArrowForward,[m
[32m+[m[32m            contentDescription = null,[m
[32m+[m[32m            tint = iconColor,[m
[32m+[m[32m            modifier = Modifier.size(18.dp).rotate(-45f)[m
[32m+[m[32m        )[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/feature_search/ui/search/SearchTagChip.kt b/app/src/main/java/com/example/stushare/feature_search/ui/search/SearchTagChip.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..1cf63a6[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/feature_search/ui/search/SearchTagChip.kt[m
[36m@@ -0,0 +1,30 @@[m
[32m+[m[32mpackage com.example.stushare.features.feature_search.ui.components[m
[32m+[m
[32m+[m[32mimport androidx.compose.foundation.shape.RoundedCornerShape[m
[32m+[m[32mimport androidx.compose.material3.MaterialTheme[m
[32m+[m[32mimport androidx.compose.material3.SuggestionChip[m
[32m+[m[32mimport androidx.compose.material3.SuggestionChipDefaults[m
[32m+[m[32mimport androidx.compose.material3.Text[m
[32m+[m[32mimport androidx.compose.runtime.Composable[m
[32m+[m[32mimport androidx.compose.ui.Modifier[m
[32m+[m[32mimport androidx.compose.ui.unit.dp[m
[32m+[m[32mimport com.example.stushare.ui.theme.PrimaryGreen // Import m√†u xanh[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun SearchTagChip([m
[32m+[m[32m    text: String,[m
[32m+[m[32m    onClick: () -> Unit,[m
[32m+[m[32m    modifier: Modifier = Modifier[m
[32m+[m[32m) {[m
[32m+[m[32m    SuggestionChip([m
[32m+[m[32m        onClick = onClick,[m
[32m+[m[32m        label = { Text(text) },[m
[32m+[m[32m        shape = RoundedCornerShape(16.dp),[m
[32m+[m[32m        colors = SuggestionChipDefaults.suggestionChipColors([m
[32m+[m[32m            containerColor = PrimaryGreen.copy(alpha = 0.1f), // M√†u n·ªÅn xanh nh·∫°t[m
[32m+[m[32m            labelColor = MaterialTheme.colorScheme.onSurface[m
[32m+[m[32m        ),[m
[32m+[m[32m        border = null, // Kh√¥ng c√≥ vi·ªÅn[m
[32m+[m[32m        modifier = modifier[m
[32m+[m[32m    )[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/feature_search/ui/search/SearchUiState.kt b/app/src/main/java/com/example/stushare/feature_search/ui/search/SearchUiState.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..a227255[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/feature_search/ui/search/SearchUiState.kt[m
[36m@@ -0,0 +1,13 @@[m
[32m+[m[32m// File: features/feature_search/ui/search/SearchUiState.kt[m
[32m+[m[32mpackage com.example.stushare.feature_search.ui.search[m
[32m+[m
[32m+[m[32mimport com.example.stushare.core.data.models.Document[m
[32m+[m
[32m+[m[32m// ƒê√¢y l√† ƒë·ªãnh nghƒ©a DUY NH·∫§T[m
[32m+[m[32msealed interface SearchUiState {[m
[32m+[m[32m    data object Loading : SearchUiState[m
[32m+[m[32m    data class Success(val results: List<Document>, val resultCount: Int) : SearchUiState[m
[32m+[m[32m    data class Error(val message: String) : SearchUiState[m
[32m+[m[32m    data object Empty : SearchUiState[m
[32m+[m[32m    data object Initial : SearchUiState[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/feature_search/ui/search/SearchViewModel.kt b/app/src/main/java/com/example/stushare/feature_search/ui/search/SearchViewModel.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..edd2acf[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/feature_search/ui/search/SearchViewModel.kt[m
[36m@@ -0,0 +1,68 @@[m
[32m+[m[32mpackage com.example.stushare.features.feature_search.ui.search[m
[32m+[m
[32m+[m[32mimport androidx.lifecycle.ViewModel[m
[32m+[m[32mimport androidx.lifecycle.viewModelScope[m
[32m+[m[32mimport com.example.stushare.core.data.repository.SettingsRepository[m
[32m+[m[32mimport com.example.stushare.core.data.repository.DocumentRepository[m
[32m+[m[32mimport dagger.hilt.android.lifecycle.HiltViewModel[m
[32m+[m[32mimport kotlinx.coroutines.flow.* // ƒê√£ bao g·ªìm update[m
[32m+[m[32mimport kotlinx.coroutines.launch[m
[32m+[m[32mimport javax.inject.Inject[m
[32m+[m
[32m+[m[32m@HiltViewModel[m
[32m+[m[32mclass SearchViewModel @Inject constructor([m
[32m+[m[32m    private val repository: DocumentRepository,[m
[32m+[m[32m    private val settingsRepository: SettingsRepository[m
[32m+[m[32m) : ViewModel() {[m
[32m+[m
[32m+[m[32m    private val _navigationEvent = MutableSharedFlow<String>()[m
[32m+[m[32m    val navigationEvent: SharedFlow<String> = _navigationEvent.asSharedFlow()[m
[32m+[m
[32m+[m[32m    private val _searchQuery = MutableStateFlow("")[m
[32m+[m[32m    val searchQuery: StateFlow<String> = _searchQuery.asStateFlow()[m
[32m+[m
[32m+[m[32m    val recentSearchesState: StateFlow<List<String>> = settingsRepository.recentSearches[m
[32m+[m[32m        .stateIn([m
[32m+[m[32m            scope = viewModelScope,[m
[32m+[m[32m            started = SharingStarted.WhileSubscribed(5000),[m
[32m+[m[32m            initialValue = emptyList()[m
[32m+[m[32m        )[m
[32m+[m
[32m+[m[32m    fun onQueryChanged(newQuery: String) {[m
[32m+[m[32m        // ‚≠êÔ∏è C·∫¨P NH·∫¨T AN TO√ÄN[m
[32m+[m[32m        _searchQuery.update { newQuery }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    init {[m
[32m+[m[32m        _searchQuery[m
[32m+[m[32m            .debounce(500L)[m
[32m+[m[32m            .filter { it.length > 2 }[m
[32m+[m[32m            .distinctUntilChanged()[m
[32m+[m[32m            .onEach { query ->[m
[32m+[m[32m                onSearchTriggered(query)[m
[32m+[m[32m            }[m
[32m+[m[32m            .launchIn(viewModelScope)[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    fun clearRecentSearches() {[m
[32m+[m[32m        viewModelScope.launch {[m
[32m+[m[32m            settingsRepository.clearRecentSearches()[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    fun onSearchTriggered(query: String) {[m
[32m+[m[32m        viewModelScope.launch {[m
[32m+[m[32m            try {[m
[32m+[m[32m                try {[m
[32m+[m[32m                    repository.refreshDocumentsIfStale()[m
[32m+[m[32m                } catch (e: Exception) {[m
[32m+[m[32m                    e.printStackTrace()[m
[32m+[m[32m                }[m
[32m+[m[32m                _navigationEvent.emit(query)[m
[32m+[m
[32m+[m[32m            } catch (e: Exception) {[m
[32m+[m[32m                e.printStackTrace()[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/features/auth/ui/ManHinhCaNhan.kt b/app/src/main/java/com/example/stushare/features/auth/ui/ManHinhCaNhan.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..fde82fb[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/features/auth/ui/ManHinhCaNhan.kt[m
[36m@@ -0,0 +1,140 @@[m
[32m+[m[32mpackage com.example.stushare.features.auth.ui[m
[32m+[m
[32m+[m[32mimport androidx.compose.foundation.border[m
[32m+[m[32mimport androidx.compose.foundation.layout.*[m
[32m+[m[32mimport androidx.compose.foundation.shape.RoundedCornerShape[m
[32m+[m[32mimport androidx.compose.material.icons.Icons[m
[32m+[m[32mimport androidx.compose.material.icons.filled.AccountCircle[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Login[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Person[m
[32m+[m[32mimport androidx.compose.material.icons.filled.PersonAdd[m
[32m+[m[32mimport androidx.compose.material3.*[m
[32m+[m[32mimport androidx.compose.runtime.Composable[m
[32m+[m[32mimport androidx.compose.ui.Alignment[m
[32m+[m[32mimport androidx.compose.ui.Modifier[m
[32m+[m[32mimport androidx.compose.ui.graphics.Color[m
[32m+[m[32mimport androidx.compose.ui.text.font.FontWeight[m
[32m+[m[32mimport androidx.compose.ui.text.style.TextAlign[m
[32m+[m[32mimport androidx.compose.ui.unit.dp[m
[32m+[m[32mimport androidx.compose.ui.unit.sp[m
[32m+[m[32mimport androidx.navigation.NavController[m
[32m+[m[32mimport com.example.stushare.core.navigation.NavRoute[m
[32m+[m[32mimport com.google.firebase.auth.FirebaseAuth[m
[32m+[m
[32m+[m[32m// ƒê·ªãnh nghƒ©a m√†u (n·∫øu ch∆∞a c√≥ trong theme)[m
[32m+[m[32mval MauXanhProfile = Color(0xFF4CAF50) // ƒê√£ c√≥ trong file kh√°c c√πng package ho·∫∑c import t·ª´ Theme[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun ManHinhCaNhan(navController: NavController) {[m
[32m+[m[32m    val firebaseAuth = FirebaseAuth.getInstance()[m
[32m+[m[32m    val user = firebaseAuth.currentUser[m
[32m+[m[32m    val daDangNhap = user != null[m
[32m+[m
[32m+[m[32m    // ‚≠êÔ∏è C·∫¢I TI·∫æN QUAN TR·ªåNG: T·∫Øt s√≥ng d∆∞·ªõi (hienThiSongDuoi = false)[m
[32m+[m[32m    // ƒê·ªÉ tr√°nh xung ƒë·ªôt h√¨nh ·∫£nh v·ªõi thanh Bottom Bar m√†u xanh ·ªü Main Activity[m
[32m+[m[32m    NenHinhSong(hienThiSongDuoi = false) {[m
[32m+[m[32m        Column([m
[32m+[m[32m            modifier = Modifier[m
[32m+[m[32m                .fillMaxSize()[m
[32m+[m[32m                .padding(24.dp),[m
[32m+[m[32m            horizontalAlignment = Alignment.CenterHorizontally,[m
[32m+[m[32m            verticalArrangement = Arrangement.Center[m
[32m+[m[32m        ) {[m
[32m+[m[32m            if (daDangNhap) {[m
[32m+[m[32m                // === TR·∫†NG TH√ÅI: ƒê√É ƒêƒÇNG NH·∫¨P ===[m
[32m+[m[32m                Icon([m
[32m+[m[32m                    imageVector = Icons.Default.Person,[m
[32m+[m[32m                    contentDescription = null,[m
[32m+[m[32m                    modifier = Modifier.size(100.dp),[m
[32m+[m[32m                    tint = MauXanhProfile[m
[32m+[m[32m                )[m
[32m+[m
[32m+[m[32m                Spacer(modifier = Modifier.height(16.dp))[m
[32m+[m[32m                Text("Xin ch√†o,", fontSize = 20.sp, color = Color.Gray)[m
[32m+[m
[32m+[m[32m                Text([m
[32m+[m[32m                    text = user?.displayName ?: user?.email ?: "Sinh vi√™n",[m
[32m+[m[32m                    fontSize = 22.sp,[m
[32m+[m[32m                    fontWeight = FontWeight.Bold,[m
[32m+[m[32m                    color = Color.Black[m
[32m+[m[32m                )[m
[32m+[m
[32m+[m[32m                if (user?.email != null) {[m
[32m+[m[32m                    Text(text = user.email!!, fontSize = 16.sp, color = Color.Gray)[m
[32m+[m[32m                }[m
[32m+[m
[32m+[m[32m                Spacer(modifier = Modifier.height(48.dp))[m
[32m+[m
[32m+[m[32m                Button([m
[32m+[m[32m                    onClick = {[m
[32m+[m[32m                        firebaseAuth.signOut()[m
[32m+[m[32m                        // T·∫£i l·∫°i m√†n h√¨nh ƒë·ªÉ chuy·ªÉn v·ªÅ tr·∫°ng th√°i kh√°ch[m
[32m+[m[32m                        navController.navigate(NavRoute.Profile) {[m
[32m+[m[32m                            popUpTo(NavRoute.Profile) { inclusive = true }[m
[32m+[m[32m                        }[m
[32m+[m[32m                    },[m
[32m+[m[32m                    modifier = Modifier.fillMaxWidth().height(50.dp),[m
[32m+[m[32m                    colors = ButtonDefaults.buttonColors(containerColor = Color.Red),[m
[32m+[m[32m                    shape = RoundedCornerShape(25.dp)[m
[32m+[m[32m                ) {[m
[32m+[m[32m                    Text("ƒêƒÉng Xu·∫•t", fontSize = 18.sp, fontWeight = FontWeight.Bold)[m
[32m+[m[32m                }[m
[32m+[m
[32m+[m[32m            } else {[m
[32m+[m[32m                // === TR·∫†NG TH√ÅI: KH√ÅCH (GUEST) ===[m
[32m+[m[32m                Icon([m
[32m+[m[32m                    imageVector = Icons.Default.AccountCircle,[m
[32m+[m[32m                    contentDescription = null,[m
[32m+[m[32m                    modifier = Modifier.size(120.dp),[m
[32m+[m[32m                    tint = Color.Gray[m
[32m+[m[32m                )[m
[32m+[m
[32m+[m[32m                Spacer(modifier = Modifier.height(24.dp))[m
[32m+[m
[32m+[m[32m                Text([m
[32m+[m[32m                    text = "B·∫°n ch∆∞a ƒëƒÉng nh·∫≠p",[m
[32m+[m[32m                    fontSize = 24.sp,[m
[32m+[m[32m                    fontWeight = FontWeight.Bold,[m
[32m+[m[32m                    color = Color.Black[m
[32m+[m[32m                )[m
[32m+[m
[32m+[m[32m                Spacer(modifier = Modifier.height(8.dp))[m
[32m+[m
[32m+[m[32m                Text([m
[32m+[m[32m                    text = "ƒêƒÉng nh·∫≠p ƒë·ªÉ t·∫£i t√†i li·ªáu, ƒëƒÉng b√†i h·ªèi ƒë√°p v√† tham gia c·ªông ƒë·ªìng UTH.",[m
[32m+[m[32m                    fontSize = 16.sp,[m
[32m+[m[32m                    color = Color.Gray,[m
[32m+[m[32m                    textAlign = TextAlign.Center[m
[32m+[m[32m                )[m
[32m+[m
[32m+[m[32m                Spacer(modifier = Modifier.height(40.dp))[m
[32m+[m
[32m+[m[32m                // N√∫t ƒêƒÉng Nh·∫≠p[m
[32m+[m[32m                Button([m
[32m+[m[32m                    onClick = { navController.navigate(NavRoute.Login) },[m
[32m+[m[32m                    modifier = Modifier.fillMaxWidth().height(50.dp),[m
[32m+[m[32m                    colors = ButtonDefaults.buttonColors(containerColor = MauXanhProfile),[m
[32m+[m[32m                    shape = RoundedCornerShape(25.dp)[m
[32m+[m[32m                ) {[m
[32m+[m[32m                    Icon(Icons.Default.Login, contentDescription = null)[m
[32m+[m[32m                    Spacer(modifier = Modifier.width(8.dp))[m
[32m+[m[32m                    Text("ƒêƒÉng Nh·∫≠p Ngay", fontSize = 18.sp, fontWeight = FontWeight.Bold)[m
[32m+[m[32m                }[m
[32m+[m
[32m+[m[32m                Spacer(modifier = Modifier.height(16.dp))[m
[32m+[m
[32m+[m[32m                // N√∫t ƒêƒÉng K√Ω[m
[32m+[m[32m                OutlinedButton([m
[32m+[m[32m                    onClick = { navController.navigate(NavRoute.Register) },[m
[32m+[m[32m                    modifier = Modifier.fillMaxWidth().height(50.dp),[m
[32m+[m[32m                    shape = RoundedCornerShape(25.dp),[m
[32m+[m[32m                    border = androidx.compose.foundation.BorderStroke(1.dp, MauXanhProfile)[m
[32m+[m[32m                ) {[m
[32m+[m[32m                    Icon(Icons.Default.PersonAdd, contentDescription = null, tint = MauXanhProfile)[m
[32m+[m[32m                    Spacer(modifier = Modifier.width(8.dp))[m
[32m+[m[32m                    Text("T·∫°o t√†i kho·∫£n m·ªõi", fontSize = 18.sp, fontWeight = FontWeight.Bold, color = MauXanhProfile)[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/features/auth/ui/ManHinhChao.kt b/app/src/main/java/com/example/stushare/features/auth/ui/ManHinhChao.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..c14ca87[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/features/auth/ui/ManHinhChao.kt[m
[36m@@ -0,0 +1,58 @@[m
[32m+[m[32mpackage com.example.stushare.features.auth.ui[m
[32m+[m
[32m+[m[32mimport android.content.Context[m
[32m+[m[32mimport androidx.compose.foundation.Image[m
[32m+[m[32mimport androidx.compose.foundation.layout.Box[m
[32m+[m[32mimport androidx.compose.foundation.layout.fillMaxSize[m
[32m+[m[32mimport androidx.compose.foundation.layout.size[m
[32m+[m[32mimport androidx.compose.runtime.Composable[m
[32m+[m[32mimport androidx.compose.runtime.LaunchedEffect[m
[32m+[m[32mimport androidx.compose.ui.Alignment[m
[32m+[m[32mimport androidx.compose.ui.Modifier[m
[32m+[m[32mimport androidx.compose.ui.platform.LocalContext[m
[32m+[m[32mimport androidx.compose.ui.res.painterResource[m
[32m+[m[32mimport androidx.compose.ui.unit.dp[m
[32m+[m[32mimport androidx.navigation.NavController[m
[32m+[m[32mimport kotlinx.coroutines.delay[m
[32m+[m[32mimport com.example.stushare.R[m
[32m+[m[32mimport com.example.stushare.core.navigation.NavRoute[m
[32m+[m[32mimport androidx.core.content.edit[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun ManHinhChao(boDieuHuong: NavController) {[m
[32m+[m[32m    val context = LocalContext.current[m
[32m+[m
[32m+[m[32m    LaunchedEffect(Unit) {[m
[32m+[m[32m        delay(2000) // Ch·ªù 2 gi√¢y[m
[32m+[m
[32m+[m[32m        val sharedPreferences = context.getSharedPreferences("CauHinhApp", Context.MODE_PRIVATE)[m
[32m+[m[32m        val laLanDau = sharedPreferences.getBoolean("lanDauMoApp", true)[m
[32m+[m
[32m+[m[32m        if (laLanDau) {[m
[32m+[m[32m            // L·∫¶N ƒê·∫¶U: L∆∞u tr·∫°ng th√°i v√† sang m√†n h√¨nh GI·ªöI THI·ªÜU[m
[32m+[m[32m            sharedPreferences.edit { putBoolean("lanDauMoApp", false) }[m
[32m+[m
[32m+[m[32m            boDieuHuong.navigate(NavRoute.Onboarding) {[m
[32m+[m[32m                popUpTo(NavRoute.Intro) { inclusive = true }[m
[32m+[m[32m            }[m
[32m+[m[32m        } else {[m
[32m+[m[32m            // L·∫¶N SAU: Sang th·∫≥ng HOME ƒë·ªÉ kh√°ch tr·∫£i nghi·ªám ngay (Thay v√¨ Login)[m
[32m+[m[32m            boDieuHuong.navigate(NavRoute.Home) {[m
[32m+[m[32m                popUpTo(NavRoute.Intro) { inclusive = true }[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    NenHinhSong {[m
[32m+[m[32m        Box([m
[32m+[m[32m            modifier = Modifier.fillMaxSize(),[m
[32m+[m[32m            contentAlignment = Alignment.Center[m
[32m+[m[32m        ) {[m
[32m+[m[32m            Image([m
[32m+[m[32m                painter = painterResource(id = R.drawable.logo),[m
[32m+[m[32m                contentDescription = "Logo",[m
[32m+[m[32m                modifier = Modifier.size(400.dp)[m
[32m+[m[32m            )[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/features/auth/ui/ManHinhDangKy.kt b/app/src/main/java/com/example/stushare/features/auth/ui/ManHinhDangKy.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..725505e[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/features/auth/ui/ManHinhDangKy.kt[m
[36m@@ -0,0 +1,220 @@[m
[32m+[m[32mpackage com.example.stushare.features.auth.ui[m
[32m+[m
[32m+[m[32mimport android.widget.Toast[m
[32m+[m[32mimport androidx.compose.foundation.border[m
[32m+[m[32mimport androidx.compose.foundation.clickable[m
[32m+[m[32mimport androidx.compose.foundation.layout.*[m
[32m+[m[32mimport androidx.compose.foundation.shape.RoundedCornerShape[m
[32m+[m[32mimport androidx.compose.foundation.text.KeyboardOptions[m
[32m+[m[32mimport androidx.compose.material.icons.Icons[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Email[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Lock[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Visibility[m
[32m+[m[32mimport androidx.compose.material.icons.filled.VisibilityOff[m
[32m+[m[32mimport androidx.compose.material3.*[m
[32m+[m[32mimport androidx.compose.runtime.*[m
[32m+[m[32mimport androidx.compose.ui.Alignment[m
[32m+[m[32mimport androidx.compose.ui.Modifier[m
[32m+[m[32mimport androidx.compose.ui.draw.clip[m
[32m+[m[32mimport androidx.compose.ui.graphics.Color[m
[32m+[m[32mimport androidx.compose.ui.graphics.vector.ImageVector[m
[32m+[m[32mimport androidx.compose.ui.platform.LocalContext[m
[32m+[m[32mimport androidx.compose.ui.text.font.FontWeight[m
[32m+[m[32mimport androidx.compose.ui.text.input.KeyboardType[m
[32m+[m[32mimport androidx.compose.ui.text.input.PasswordVisualTransformation[m
[32m+[m[32mimport androidx.compose.ui.text.input.VisualTransformation[m
[32m+[m[32mimport androidx.compose.ui.text.style.TextAlign[m
[32m+[m[32mimport androidx.compose.ui.unit.dp[m
[32m+[m[32mimport androidx.compose.ui.unit.sp[m
[32m+[m[32mimport androidx.navigation.NavController[m
[32m+[m[32mimport com.example.stushare.core.navigation.NavRoute[m
[32m+[m[32mimport com.google.firebase.auth.FirebaseAuth[m
[32m+[m[32mimport com.google.firebase.auth.FirebaseAuthUserCollisionException[m
[32m+[m[32mimport com.google.firebase.auth.FirebaseAuthWeakPasswordException[m
[32m+[m[32mimport com.google.firebase.auth.FirebaseAuthInvalidCredentialsException[m
[32m+[m
[32m+[m[32m// --- KHAI B√ÅO M√ÄU NGAY ƒê·∫¶U FILE ---[m
[32m+[m[32mval MauXanhDangKy = Color(0xFF4CAF50)[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun ManHinhDangKy(boDieuHuong: NavController) {[m
[32m+[m[32m    var email by remember { mutableStateOf("") }[m
[32m+[m[32m    var matKhau by remember { mutableStateOf("") }[m
[32m+[m[32m    var xacNhanMatKhau by remember { mutableStateOf("") }[m
[32m+[m[32m    var dangXuLy by remember { mutableStateOf(false) }[m
[32m+[m[32m    var thongBaoLoi by remember { mutableStateOf("") }[m
[32m+[m
[32m+[m[32m    val context = LocalContext.current[m
[32m+[m[32m    val firebaseAuth = FirebaseAuth.getInstance()[m
[32m+[m
[32m+[m[32m    fun thucHienDangKy() {[m
[32m+[m[32m        thongBaoLoi = ""[m
[32m+[m[32m        if (email.isEmpty() || matKhau.isEmpty() || xacNhanMatKhau.isEmpty()) {[m
[32m+[m[32m            thongBaoLoi = "Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin"[m
[32m+[m[32m            return[m
[32m+[m[32m        }[m
[32m+[m[32m        if (!android.util.Patterns.EMAIL_ADDRESS.matcher(email).matches()) {[m
[32m+[m[32m            thongBaoLoi = "ƒê·ªãnh d·∫°ng email kh√¥ng h·ª£p l·ªá"[m
[32m+[m[32m            return[m
[32m+[m[32m        }[m
[32m+[m[32m        if (matKhau != xacNhanMatKhau) {[m
[32m+[m[32m            thongBaoLoi = "M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng kh·ªõp"[m
[32m+[m[32m            return[m
[32m+[m[32m        }[m
[32m+[m[32m        if (matKhau.length < 6) {[m
[32m+[m[32m            thongBaoLoi = "M·∫≠t kh·∫©u ph·∫£i t·ª´ 6 k√Ω t·ª± tr·ªü l√™n"[m
[32m+[m[32m            return[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        dangXuLy = true[m
[32m+[m[32m        firebaseAuth.createUserWithEmailAndPassword(email, matKhau)[m
[32m+[m[32m            .addOnCompleteListener { tacVu ->[m
[32m+[m[32m                dangXuLy = false[m
[32m+[m[32m                if (tacVu.isSuccessful) {[m
[32m+[m[32m                    Toast.makeText(context, "ƒêƒÉng k√Ω th√†nh c√¥ng!", Toast.LENGTH_SHORT).show()[m
[32m+[m[32m                    boDieuHuong.navigate(NavRoute.Home) {[m
[32m+[m[32m                        popUpTo(NavRoute.Register) { inclusive = true }[m
[32m+[m[32m                        popUpTo(NavRoute.Login) { inclusive = true }[m
[32m+[m[32m                    }[m
[32m+[m[32m                } else {[m
[32m+[m[32m                    val ngoaiLe = tacVu.exception[m
[32m+[m[32m                    thongBaoLoi = when (ngoaiLe) {[m
[32m+[m[32m                        is FirebaseAuthUserCollisionException -> "Email n√†y ƒë√£ ƒë∆∞·ª£c d√πng."[m
[32m+[m[32m                        is FirebaseAuthWeakPasswordException -> "M·∫≠t kh·∫©u qu√° y·∫øu."[m
[32m+[m[32m                        is FirebaseAuthInvalidCredentialsException -> "Email kh√¥ng h·ª£p l·ªá."[m
[32m+[m[32m                        else -> "L·ªói: ${ngoaiLe?.message}"[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    // ƒê·∫£m b·∫£o NenHinhSong ƒë√£ ƒë∆∞·ª£c s·ª≠a package th√†nh c√¥ng ·ªü b∆∞·ªõc 1[m
[32m+[m[32m    NenHinhSong {[m
[32m+[m[32m        Column([m
[32m+[m[32m            modifier = Modifier[m
[32m+[m[32m                .fillMaxSize()[m
[32m+[m[32m                .padding(24.dp),[m
[32m+[m[32m            horizontalAlignment = Alignment.CenterHorizontally,[m
[32m+[m[32m            verticalArrangement = Arrangement.Center[m
[32m+[m[32m        ) {[m
[32m+[m[32m            Text([m
[32m+[m[32m                text = "ƒêƒÉng K√Ω",[m
[32m+[m[32m                fontSize = 32.sp,[m
[32m+[m[32m                fontWeight = FontWeight.Bold,[m
[32m+[m[32m                color = MauXanhDangKy[m
[32m+[m[32m            )[m
[32m+[m
[32m+[m[32m            Spacer(modifier = Modifier.height(40.dp))[m
[32m+[m
[32m+[m[32m            ONhapLieuTuyChinh([m
[32m+[m[32m                giaTri = email,[m
[32m+[m[32m                khiThayDoi = { email = it; thongBaoLoi = "" },[m
[32m+[m[32m                nhanDan = "Email",[m
[32m+[m[32m                icon = Icons.Default.Email,[m
[32m+[m[32m                loaiBanPhim = KeyboardType.Email,[m
[32m+[m[32m                coLoi = thongBaoLoi.contains("email", ignoreCase = true)[m
[32m+[m[32m            )[m
[32m+[m
[32m+[m[32m            Spacer(modifier = Modifier.height(16.dp))[m
[32m+[m
[32m+[m[32m            ONhapLieuTuyChinh([m
[32m+[m[32m                giaTri = matKhau,[m
[32m+[m[32m                khiThayDoi = { matKhau = it; thongBaoLoi = "" },[m
[32m+[m[32m                nhanDan = "M·∫≠t kh·∫©u",[m
[32m+[m[32m                icon = Icons.Default.Lock,[m
[32m+[m[32m                laMatKhau = true,[m
[32m+[m[32m                loaiBanPhim = KeyboardType.Password,[m
[32m+[m[32m                coLoi = thongBaoLoi.contains("M·∫≠t kh·∫©u")[m
[32m+[m[32m            )[m
[32m+[m
[32m+[m[32m            Spacer(modifier = Modifier.height(16.dp))[m
[32m+[m
[32m+[m[32m            ONhapLieuTuyChinh([m
[32m+[m[32m                giaTri = xacNhanMatKhau,[m
[32m+[m[32m                khiThayDoi = { xacNhanMatKhau = it; thongBaoLoi = "" },[m
[32m+[m[32m                nhanDan = "X√°c nh·∫≠n M·∫≠t kh·∫©u",[m
[32m+[m[32m                icon = Icons.Default.Lock,[m
[32m+[m[32m                laMatKhau = true,[m
[32m+[m[32m                loaiBanPhim = KeyboardType.Password,[m
[32m+[m[32m                coLoi = thongBaoLoi.contains("kh·ªõp")[m
[32m+[m[32m            )[m
[32m+[m
[32m+[m[32m            Spacer(modifier = Modifier.height(16.dp))[m
[32m+[m
[32m+[m[32m            if (thongBaoLoi.isNotEmpty()) {[m
[32m+[m[32m                Text([m
[32m+[m[32m                    text = thongBaoLoi,[m
[32m+[m[32m                    color = Color.Red,[m
[32m+[m[32m                    fontSize = 14.sp,[m
[32m+[m[32m                    textAlign = TextAlign.Center,[m
[32m+[m[32m                    modifier = Modifier.padding(bottom = 8.dp)[m
[32m+[m[32m                )[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            Button([m
[32m+[m[32m                onClick = { thucHienDangKy() },[m
[32m+[m[32m                modifier = Modifier.fillMaxWidth().height(50.dp),[m
[32m+[m[32m                colors = ButtonDefaults.buttonColors(containerColor = MauXanhDangKy),[m
[32m+[m[32m                shape = RoundedCornerShape(25.dp),[m
[32m+[m[32m                enabled = !dangXuLy[m
[32m+[m[32m            ) {[m
[32m+[m[32m                if (dangXuLy) CircularProgressIndicator(color = Color.White, modifier = Modifier.size(24.dp))[m
[32m+[m[32m                else Text("ƒêƒÉng K√Ω Ngay", fontSize = 18.sp, fontWeight = FontWeight.Bold)[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            Spacer(modifier = Modifier.height(24.dp))[m
[32m+[m
[32m+[m[32m            Row(verticalAlignment = Alignment.CenterVertically) {[m
[32m+[m[32m                Text("ƒê√£ c√≥ t√†i kho·∫£n? ", color = Color.Black)[m
[32m+[m[32m                Text([m
[32m+[m[32m                    text = "ƒêƒÉng nh·∫≠p",[m
[32m+[m[32m                    color = MauXanhDangKy,[m
[32m+[m[32m                    fontWeight = FontWeight.Bold,[m
[32m+[m[32m                    modifier = Modifier.clickable { boDieuHuong.popBackStack() }[m
[32m+[m[32m                )[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun ONhapLieuTuyChinh([m
[32m+[m[32m    giaTri: String,[m
[32m+[m[32m    khiThayDoi: (String) -> Unit,[m
[32m+[m[32m    nhanDan: String,[m
[32m+[m[32m    icon: ImageVector,[m
[32m+[m[32m    laMatKhau: Boolean = false,[m
[32m+[m[32m    loaiBanPhim: KeyboardType = KeyboardType.Text,[m
[32m+[m[32m    coLoi: Boolean = false[m
[32m+[m[32m) {[m
[32m+[m[32m    var hienThi by remember { mutableStateOf(false) }[m
[32m+[m[32m    TextField([m
[32m+[m[32m        value = giaTri,[m
[32m+[m[32m        onValueChange = khiThayDoi,[m
[32m+[m[32m        placeholder = { Text(nhanDan, color = Color.Gray) },[m
[32m+[m[32m        leadingIcon = { Icon(icon, null, tint = Color.Gray) },[m
[32m+[m[32m        trailingIcon = if (laMatKhau) {[m
[32m+[m[32m            {[m
[32m+[m[32m                IconButton(onClick = { hienThi = !hienThi }) {[m
[32m+[m[32m                    Icon([m
[32m+[m[32m                        if (hienThi) Icons.Filled.Visibility else Icons.Filled.VisibilityOff,[m
[32m+[m[32m                        null, tint = Color.Gray[m
[32m+[m[32m                    )[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m[32m        } else null,[m
[32m+[m[32m        modifier = Modifier[m
[32m+[m[32m            .fillMaxWidth()[m
[32m+[m[32m            .border(1.dp, if (coLoi) Color.Red else Color.Transparent, RoundedCornerShape(16.dp))[m
[32m+[m[32m            .clip(RoundedCornerShape(16.dp)),[m
[32m+[m[32m        colors = TextFieldDefaults.colors([m
[32m+[m[32m            focusedContainerColor = Color(0xFFE0E0E0),[m
[32m+[m[32m            unfocusedContainerColor = Color(0xFFE0E0E0),[m
[32m+[m[32m            focusedIndicatorColor = Color.Transparent,[m
[32m+[m[32m            unfocusedIndicatorColor = Color.Transparent[m
[32m+[m[32m        ),[m
[32m+[m[32m        visualTransformation = if (laMatKhau && !hienThi) PasswordVisualTransformation() else VisualTransformation.None,[m
[32m+[m[32m        keyboardOptions = KeyboardOptions(keyboardType = loaiBanPhim),[m
[32m+[m[32m        singleLine = true[m
[32m+[m[32m    )[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/features/auth/ui/ManHinhDangNhap.kt b/app/src/main/java/com/example/stushare/features/auth/ui/ManHinhDangNhap.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..e29d0a9[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/features/auth/ui/ManHinhDangNhap.kt[m
[36m@@ -0,0 +1,284 @@[m
[32m+[m[32mpackage com.example.stushare.features.auth.ui[m
[32m+[m
[32m+[m[32mimport android.widget.Toast[m
[32m+[m[32mimport androidx.compose.foundation.Image[m
[32m+[m[32mimport androidx.compose.foundation.background[m
[32m+[m[32mimport androidx.compose.foundation.border[m
[32m+[m[32mimport androidx.compose.foundation.clickable[m
[32m+[m[32mimport androidx.compose.foundation.layout.*[m
[32m+[m[32mimport androidx.compose.foundation.shape.CircleShape[m
[32m+[m[32mimport androidx.compose.foundation.shape.RoundedCornerShape[m
[32m+[m[32mimport androidx.compose.foundation.text.KeyboardOptions[m
[32m+[m[32mimport androidx.compose.material.icons.Icons[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Email[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Lock[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Visibility[m
[32m+[m[32mimport androidx.compose.material.icons.filled.VisibilityOff[m
[32m+[m[32mimport androidx.compose.material3.*[m
[32m+[m[32mimport androidx.compose.runtime.*[m
[32m+[m[32mimport androidx.compose.ui.Alignment[m
[32m+[m[32mimport androidx.compose.ui.Modifier[m
[32m+[m[32mimport androidx.compose.ui.draw.clip[m
[32m+[m[32mimport androidx.compose.ui.graphics.Color[m
[32m+[m[32mimport androidx.compose.ui.layout.ContentScale[m
[32m+[m[32mimport androidx.compose.ui.platform.LocalContext[m
[32m+[m[32mimport androidx.compose.ui.res.painterResource[m
[32m+[m[32mimport androidx.compose.ui.text.font.FontWeight[m
[32m+[m[32mimport androidx.compose.ui.text.input.KeyboardType[m
[32m+[m[32mimport androidx.compose.ui.text.input.PasswordVisualTransformation[m
[32m+[m[32mimport androidx.compose.ui.text.input.VisualTransformation[m
[32m+[m[32mimport androidx.compose.ui.text.style.TextAlign[m
[32m+[m[32mimport androidx.compose.ui.unit.dp[m
[32m+[m[32mimport androidx.compose.ui.unit.sp[m
[32m+[m[32mimport androidx.navigation.NavController[m
[32m+[m[32mimport com.example.stushare.R[m
[32m+[m[32mimport com.example.stushare.core.navigation.NavRoute[m
[32m+[m[32mimport com.google.firebase.auth.FirebaseAuth[m
[32m+[m[32mimport com.google.firebase.auth.FirebaseAuthInvalidCredentialsException[m
[32m+[m[32mimport com.google.firebase.auth.FirebaseAuthInvalidUserException[m
[32m+[m
[32m+[m[32m// --- ƒê·ªäNH NGHƒ®A M√ÄU TR·ª∞C TI·∫æP (Kh√¥ng c·∫ßn import PrimaryGreen) ---[m
[32m+[m[32mval MauXanhDangNhap = Color(0xFF4CAF50)[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun ManHinhDangNhap(boDieuHuong: NavController) {[m
[32m+[m[32m    // C√°c bi·∫øn tr·∫°ng th√°i[m
[32m+[m[32m    var email by remember { mutableStateOf("") }[m
[32m+[m[32m    var matKhau by remember { mutableStateOf("") }[m
[32m+[m[32m    var hienThiMatKhau by remember { mutableStateOf(false) }[m
[32m+[m[32m    var dangXuLy by remember { mutableStateOf(false) }[m
[32m+[m[32m    var thongBaoLoi by remember { mutableStateOf("") }[m
[32m+[m
[32m+[m[32m    val context = LocalContext.current[m
[32m+[m[32m    val firebaseAuth = FirebaseAuth.getInstance()[m
[32m+[m
[32m+[m[32m    // H√†m x·ª≠ l√Ω ƒëƒÉng nh·∫≠p[m
[32m+[m[32m    fun thucHienDangNhap() {[m
[32m+[m[32m        thongBaoLoi = ""[m
[32m+[m[32m        if (email.isEmpty() || matKhau.isEmpty()) {[m
[32m+[m[32m            thongBaoLoi = "Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß th√¥ng tin"[m
[32m+[m[32m            return[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        dangXuLy = true[m
[32m+[m[32m        firebaseAuth.signInWithEmailAndPassword(email, matKhau)[m
[32m+[m[32m            .addOnCompleteListener { tacVu ->[m
[32m+[m[32m                dangXuLy = false[m
[32m+[m[32m                if (tacVu.isSuccessful) {[m
[32m+[m[32m                    Toast.makeText(context, "ƒêƒÉng nh·∫≠p th√†nh c√¥ng!", Toast.LENGTH_SHORT).show()[m
[32m+[m
[32m+[m[32m                    // --- ƒêI·ªÄU H∆Ø·ªöNG V·ªÄ HOME ---[m
[32m+[m[32m                    boDieuHuong.navigate(NavRoute.Home) {[m
[32m+[m[32m                        popUpTo(NavRoute.Login) { inclusive = true }[m
[32m+[m[32m                    }[m
[32m+[m[32m                } else {[m
[32m+[m[32m                    val ngoaiLe = tacVu.exception[m
[32m+[m[32m                    thongBaoLoi = when (ngoaiLe) {[m
[32m+[m[32m                        is FirebaseAuthInvalidUserException -> "T√†i kho·∫£n kh√¥ng t·ªìn t·∫°i."[m
[32m+[m[32m                        is FirebaseAuthInvalidCredentialsException -> "Sai email ho·∫∑c m·∫≠t kh·∫©u."[m
[32m+[m[32m                        else -> "L·ªói: ${ngoaiLe?.message}"[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    // ƒê·∫£m b·∫£o file NenHinhSong.kt ƒë√£ s·ª≠a package ƒë√∫ng[m
[32m+[m[32m    NenHinhSong {[m
[32m+[m[32m        Column([m
[32m+[m[32m            modifier = Modifier[m
[32m+[m[32m                .fillMaxSize()[m
[32m+[m[32m                .padding(24.dp),[m
[32m+[m[32m            horizontalAlignment = Alignment.CenterHorizontally,[m
[32m+[m[32m            verticalArrangement = Arrangement.Center[m
[32m+[m[32m        ) {[m
[32m+[m[32m            // Logo[m
[32m+[m[32m            Image([m
[32m+[m[32m                painter = painterResource(id = R.drawable.logo),[m
[32m+[m[32m                contentDescription = "Logo",[m
[32m+[m[32m                modifier = Modifier.size(120.dp)[m
[32m+[m[32m            )[m
[32m+[m
[32m+[m[32m            Spacer(modifier = Modifier.height(24.dp))[m
[32m+[m
[32m+[m[32m            Text([m
[32m+[m[32m                text = "ƒêƒÉng Nh·∫≠p",[m
[32m+[m[32m                fontSize = 32.sp,[m
[32m+[m[32m                fontWeight = FontWeight.Bold,[m
[32m+[m[32m                color = MauXanhDangNhap[m
[32m+[m[32m            )[m
[32m+[m
[32m+[m[32m            Spacer(modifier = Modifier.height(32.dp))[m
[32m+[m
[32m+[m[32m            // Input Email[m
[32m+[m[32m            TextField([m
[32m+[m[32m                value = email,[m
[32m+[m[32m                onValueChange = {[m
[32m+[m[32m                    email = it[m
[32m+[m[32m                    thongBaoLoi = ""[m
[32m+[m[32m                },[m
[32m+[m[32m                placeholder = { Text("Email") },[m
[32m+[m[32m                leadingIcon = { Icon(Icons.Default.Email, contentDescription = null, tint = Color.Gray) },[m
[32m+[m[32m                modifier = Modifier[m
[32m+[m[32m                    .fillMaxWidth()[m
[32m+[m[32m                    .clip(RoundedCornerShape(16.dp))[m
[32m+[m[32m                    .border(1.dp, if (thongBaoLoi.isNotEmpty()) Color.Red else Color.Transparent, RoundedCornerShape(16.dp)),[m
[32m+[m[32m                colors = TextFieldDefaults.colors([m
[32m+[m[32m                    focusedContainerColor = Color(0xFFE0E0E0),[m
[32m+[m[32m                    unfocusedContainerColor = Color(0xFFE0E0E0),[m
[32m+[m[32m                    focusedIndicatorColor = Color.Transparent,[m
[32m+[m[32m                    unfocusedIndicatorColor = Color.Transparent[m
[32m+[m[32m                ),[m
[32m+[m[32m                singleLine = true,[m
[32m+[m[32m                keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Email)[m
[32m+[m[32m            )[m
[32m+[m
[32m+[m[32m            Spacer(modifier = Modifier.height(16.dp))[m
[32m+[m
[32m+[m[32m            // Input M·∫≠t kh·∫©u[m
[32m+[m[32m            TextField([m
[32m+[m[32m                value = matKhau,[m
[32m+[m[32m                onValueChange = {[m
[32m+[m[32m                    matKhau = it[m
[32m+[m[32m                    thongBaoLoi = ""[m
[32m+[m[32m                },[m
[32m+[m[32m                placeholder = { Text("M·∫≠t kh·∫©u") },[m
[32m+[m[32m                leadingIcon = { Icon(Icons.Default.Lock, contentDescription = null, tint = Color.Gray) },[m
[32m+[m[32m                trailingIcon = {[m
[32m+[m[32m                    IconButton(onClick = { hienThiMatKhau = !hienThiMatKhau }) {[m
[32m+[m[32m                        Icon([m
[32m+[m[32m                            imageVector = if (hienThiMatKhau) Icons.Default.Visibility else Icons.Default.VisibilityOff,[m
[32m+[m[32m                            contentDescription = null,[m
[32m+[m[32m                            tint = Color.Gray[m
[32m+[m[32m                        )[m
[32m+[m[32m                    }[m
[32m+[m[32m                },[m
[32m+[m[32m                modifier = Modifier[m
[32m+[m[32m                    .fillMaxWidth()[m
[32m+[m[32m                    .clip(RoundedCornerShape(16.dp))[m
[32m+[m[32m                    .border(1.dp, if (thongBaoLoi.isNotEmpty()) Color.Red else Color.Transparent, RoundedCornerShape(16.dp)),[m
[32m+[m[32m                visualTransformation = if (hienThiMatKhau) VisualTransformation.None else PasswordVisualTransformation(),[m
[32m+[m[32m                colors = TextFieldDefaults.colors([m
[32m+[m[32m                    focusedContainerColor = Color(0xFFE0E0E0),[m
[32m+[m[32m                    unfocusedContainerColor = Color(0xFFE0E0E0),[m
[32m+[m[32m                    focusedIndicatorColor = Color.Transparent,[m
[32m+[m[32m                    unfocusedIndicatorColor = Color.Transparent[m
[32m+[m[32m                ),[m
[32m+[m[32m                singleLine = true,[m
[32m+[m[32m                keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Password)[m
[32m+[m[32m            )[m
[32m+[m
[32m+[m[32m            // Hi·ªÉn th·ªã l·ªói[m
[32m+[m[32m            if (thongBaoLoi.isNotEmpty()) {[m
[32m+[m[32m                Text([m
[32m+[m[32m                    text = thongBaoLoi,[m
[32m+[m[32m                    color = Color.Red,[m
[32m+[m[32m                    modifier = Modifier.padding(top = 8.dp)[m
[32m+[m[32m                )[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            Spacer(modifier = Modifier.height(8.dp))[m
[32m+[m
[32m+[m[32m            // Qu√™n m·∫≠t kh·∫©u[m
[32m+[m[32m            Box(modifier = Modifier.fillMaxWidth(), contentAlignment = Alignment.CenterEnd) {[m
[32m+[m[32m                Text([m
[32m+[m[32m                    text = "Qu√™n m·∫≠t kh·∫©u?",[m
[32m+[m[32m                    color = MauXanhDangNhap,[m
[32m+[m[32m                    fontWeight = FontWeight.Bold,[m
[32m+[m[32m                    modifier = Modifier.clickable {[m
[32m+[m[32m                        boDieuHuong.navigate(NavRoute.ForgotPassword)[m
[32m+[m[32m                    }[m
[32m+[m[32m                )[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            Spacer(modifier = Modifier.height(24.dp))[m
[32m+[m
[32m+[m[32m            // N√∫t ƒêƒÉng nh·∫≠p[m
[32m+[m[32m            Button([m
[32m+[m[32m                onClick = { thucHienDangNhap() },[m
[32m+[m[32m                modifier = Modifier[m
[32m+[m[32m                    .fillMaxWidth()[m
[32m+[m[32m                    .height(50.dp),[m
[32m+[m[32m                colors = ButtonDefaults.buttonColors(containerColor = MauXanhDangNhap),[m
[32m+[m[32m                shape = RoundedCornerShape(25.dp),[m
[32m+[m[32m                enabled = !dangXuLy[m
[32m+[m[32m            ) {[m
[32m+[m[32m                if (dangXuLy) {[m
[32m+[m[32m                    CircularProgressIndicator(color = Color.White, modifier = Modifier.size(24.dp))[m
[32m+[m[32m                } else {[m
[32m+[m[32m                    Text("ƒêƒÉng Nh·∫≠p", fontSize = 18.sp, fontWeight = FontWeight.Bold)[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            Spacer(modifier = Modifier.height(24.dp))[m
[32m+[m
[32m+[m[32m            // ƒêƒÉng nh·∫≠p b·∫±ng c√°ch kh√°c[m
[32m+[m[32m            Text("Ho·∫∑c ƒëƒÉng nh·∫≠p b·∫±ng", color = Color.Gray)[m
[32m+[m[32m            Spacer(modifier = Modifier.height(16.dp))[m
[32m+[m
[32m+[m[32m            Row([m
[32m+[m[32m                horizontalArrangement = Arrangement.SpaceEvenly,[m
[32m+[m[32m                modifier = Modifier.fillMaxWidth()[m
[32m+[m[32m            ) {[m
[32m+[m[32m                // N√∫t Google[m
[32m+[m[32m                IconButton([m
[32m+[m[32m                    onClick = { /* TODO: Google Sign In */ },[m
[32m+[m[32m                    modifier = Modifier[m
[32m+[m[32m                        .size(50.dp)[m
[32m+[m[32m                        .background(Color.White, CircleShape)[m
[32m+[m[32m                        .border(1.dp, Color.LightGray, CircleShape)[m
[32m+[m[32m                ) {[m
[32m+[m[32m                    Image([m
[32m+[m[32m                        painter = painterResource(id = R.drawable.ic_google),[m
[32m+[m[32m                        contentDescription = "Google",[m
[32m+[m[32m                        modifier = Modifier.padding(8.dp)[m
[32m+[m[32m                    )[m
[32m+[m[32m                }[m
[32m+[m
[32m+[m[32m                IconButton([m
[32m+[m[32m                    onClick = { boDieuHuong.navigate(NavRoute.LoginSMS) },[m
[32m+[m[32m                    modifier = Modifier[m
[32m+[m[32m                        .size(50.dp)[m
[32m+[m[32m                        .background(Color.White, CircleShape)[m
[32m+[m[32m                        .border(1.dp, Color.LightGray, CircleShape)[m
[32m+[m[32m                ) {[m
[32m+[m[32m                    Image([m
[32m+[m[32m                        painter = painterResource(id = R.drawable.ic_dienthoai1),[m
[32m+[m[32m                        contentDescription = "Phone",[m
[32m+[m[32m                        modifier = Modifier.padding(8.dp)[m
[32m+[m[32m                    )[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            Spacer(modifier = Modifier.height(32.dp))[m
[32m+[m
[32m+[m[32m            Row {[m
[32m+[m[32m                Text("Ch∆∞a c√≥ t√†i kho·∫£n? ", color = Color.Black)[m
[32m+[m[32m                Text([m
[32m+[m[32m                    text = "ƒêƒÉng k√Ω ngay",[m
[32m+[m[32m                    color = MauXanhDangNhap,[m
[32m+[m[32m                    fontWeight = FontWeight.Bold,[m
[32m+[m[32m                    modifier = Modifier.clickable {[m
[32m+[m[32m                        boDieuHuong.navigate(NavRoute.Register)[m
[32m+[m[32m                    }[m
[32m+[m[32m                )[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            Spacer(modifier = Modifier.height(16.dp))[m
[32m+[m[32m            TextButton([m
[32m+[m[32m                onClick = {[m
[32m+[m[32m                    boDieuHuong.navigate(NavRoute.Home) {[m
[32m+[m[32m                        popUpTo(NavRoute.Login) { inclusive = true }[m
[32m+[m[32m                    }[m
[32m+[m[32m                },[m
[32m+[m[32m                modifier = Modifier.padding(bottom = 16.dp)[m
[32m+[m[32m            ) {[m
[32m+[m[32m                Text([m
[32m+[m[32m                    text = "Ti·∫øp t·ª•c v·ªõi vai tr√≤ Kh√°ch üë§",[m
[32m+[m[32m                    color = Color.Gray,[m
[32m+[m[32m                    fontSize = 16.sp,[m
[32m+[m[32m                    fontWeight = FontWeight.Medium[m
[32m+[m[32m                )[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/features/auth/ui/ManHinhDangNhapSDT.kt b/app/src/main/java/com/example/stushare/features/auth/ui/ManHinhDangNhapSDT.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..bfa8cd2[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/features/auth/ui/ManHinhDangNhapSDT.kt[m
[36m@@ -0,0 +1,203 @@[m
[32m+[m[32mpackage com.example.stushare.features.auth.ui[m
[32m+[m
[32m+[m[32mimport android.app.Activity[m
[32m+[m[32mimport android.widget.Toast[m
[32m+[m[32mimport androidx.compose.foundation.background[m
[32m+[m[32mimport androidx.compose.foundation.border[m
[32m+[m[32mimport androidx.compose.foundation.layout.*[m
[32m+[m[32mimport androidx.compose.foundation.shape.RoundedCornerShape[m
[32m+[m[32mimport androidx.compose.foundation.text.KeyboardOptions[m
[32m+[m[32mimport androidx.compose.material.icons.Icons[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Phone[m
[32m+[m[32mimport androidx.compose.material3.*[m
[32m+[m[32mimport androidx.compose.runtime.*[m
[32m+[m[32mimport androidx.compose.ui.Alignment[m
[32m+[m[32mimport androidx.compose.ui.Modifier[m
[32m+[m[32mimport androidx.compose.ui.graphics.Color[m
[32m+[m[32mimport androidx.compose.ui.platform.LocalContext[m
[32m+[m[32mimport androidx.compose.ui.text.font.FontWeight[m
[32m+[m[32mimport androidx.compose.ui.text.input.KeyboardType[m
[32m+[m[32mimport androidx.compose.ui.unit.dp[m
[32m+[m[32mimport androidx.compose.ui.unit.sp[m
[32m+[m[32mimport androidx.navigation.NavController[m
[32m+[m[32mimport com.example.stushare.core.navigation.NavRoute // Import Route m·ªõi[m
[32m+[m[32mimport com.google.firebase.FirebaseException[m
[32m+[m[32mimport com.google.firebase.FirebaseTooManyRequestsException[m
[32m+[m[32mimport com.google.firebase.auth.FirebaseAuth[m
[32m+[m[32mimport com.google.firebase.auth.FirebaseAuthInvalidCredentialsException[m
[32m+[m[32mimport com.google.firebase.auth.PhoneAuthCredential[m
[32m+[m[32mimport com.google.firebase.auth.PhoneAuthOptions[m
[32m+[m[32mimport com.google.firebase.auth.PhoneAuthProvider[m
[32m+[m[32mimport java.util.concurrent.TimeUnit[m
[32m+[m
[32m+[m[32m// --- ƒê·ªäNH NGHƒ®A M√ÄU RI√äNG ---[m
[32m+[m[32mval MauXanhSDT = Color(0xFF4CAF50)[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun ManHinhDangNhapSDT(boDieuHuong: NavController) {[m
[32m+[m[32m    var soDienThoai by remember { mutableStateOf("") }[m
[32m+[m[32m    var loiSdt by remember { mutableStateOf(false) }[m
[32m+[m[32m    var thongBaoLoi by remember { mutableStateOf("") }[m
[32m+[m[32m    var dangXuLy by remember { mutableStateOf(false) }[m
[32m+[m
[32m+[m[32m    val context = LocalContext.current[m
[32m+[m[32m    val firebaseAuth = FirebaseAuth.getInstance()[m
[32m+[m
[32m+[m[32m    fun kiemTraDinhDangSDT(sdt: String): Boolean {[m
[32m+[m[32m        val pattern = Regex("^0[0-9]{9}$")[m
[32m+[m[32m        return pattern.matches(sdt)[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    fun guiMaOTP() {[m
[32m+[m[32m        loiSdt = false[m
[32m+[m[32m        thongBaoLoi = ""[m
[32m+[m
[32m+[m[32m        if (soDienThoai.isEmpty()) {[m
[32m+[m[32m            thongBaoLoi = "Vui l√≤ng nh·∫≠p s·ªë ƒëi·ªán tho·∫°i"[m
[32m+[m[32m            return[m
[32m+[m[32m        }[m
[32m+[m[32m        if (!kiemTraDinhDangSDT(soDienThoai)) {[m
[32m+[m[32m            loiSdt = true[m
[32m+[m[32m            return[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        dangXuLy = true[m
[32m+[m[32m        // Chuy·ªÉn ƒë·ªïi s·ªë ƒëi·ªán tho·∫°i v·ªÅ ƒë·ªãnh d·∫°ng qu·ªëc t·∫ø +84[m
[32m+[m[32m        val soDienThoaiChuan = "+84${soDienThoai.substring(1)}"[m
[32m+[m
[32m+[m[32m        val callbacks = object : PhoneAuthProvider.OnVerificationStateChangedCallbacks() {[m
[32m+[m[32m            override fun onVerificationCompleted(credential: PhoneAuthCredential) {[m
[32m+[m[32m                dangXuLy = false[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            override fun onVerificationFailed(e: FirebaseException) {[m
[32m+[m[32m                dangXuLy = false[m
[32m+[m[32m                val thongBaoGoc = e.message ?: ""[m
[32m+[m[32m                thongBaoLoi = when {[m
[32m+[m[32m                    e is FirebaseAuthInvalidCredentialsException -> "S·ªë ƒëi·ªán tho·∫°i kh√¥ng h·ª£p l·ªá."[m
[32m+[m[32m                    e is FirebaseTooManyRequestsException -> "Qu√° nhi·ªÅu y√™u c·∫ßu. Vui l√≤ng ƒë·ª£i l√°t sau."[m
[32m+[m[32m                    thongBaoGoc.contains("BILLING_NOT_ENABLED") -> "Vui l√≤ng b·∫≠t Phone Auth tr√™n Firebase Console."[m
[32m+[m[32m                    else -> "L·ªói: $thongBaoGoc"[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            override fun onCodeSent([m
[32m+[m[32m                verificationId: String,[m
[32m+[m[32m                token: PhoneAuthProvider.ForceResendingToken[m
[32m+[m[32m            ) {[m
[32m+[m[32m                dangXuLy = false[m
[32m+[m[32m                Toast.makeText(context, "ƒê√£ g·ª≠i m√£ OTP", Toast.LENGTH_SHORT).show()[m
[32m+[m
[32m+[m[32m                // --- S·ª¨A NAVIGATE: D√πng NavRoute.VerifyOTP ---[m
[32m+[m[32m                boDieuHuong.navigate(NavRoute.VerifyOTP(verificationId))[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        val options = PhoneAuthOptions.newBuilder(firebaseAuth)[m
[32m+[m[32m            .setPhoneNumber(soDienThoaiChuan)[m
[32m+[m[32m            .setTimeout(60L, TimeUnit.SECONDS)[m
[32m+[m[32m            .setActivity(context as Activity)[m
[32m+[m[32m            .setCallbacks(callbacks)[m
[32m+[m[32m            .build()[m
[32m+[m
[32m+[m[32m        PhoneAuthProvider.verifyPhoneNumber(options)[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    NenHinhSong {[m
[32m+[m[32m        Column([m
[32m+[m[32m            modifier = Modifier[m
[32m+[m[32m                .fillMaxSize()[m
[32m+[m[32m                .padding(24.dp),[m
[32m+[m[32m            horizontalAlignment = Alignment.CenterHorizontally,[m
[32m+[m[32m            verticalArrangement = Arrangement.Center[m
[32m+[m[32m        ) {[m
[32m+[m[32m            Text([m
[32m+[m[32m                text = "ƒêƒÉng Nh·∫≠p",[m
[32m+[m[32m                fontSize = 32.sp,[m
[32m+[m[32m                fontWeight = FontWeight.Bold,[m
[32m+[m[32m                color = MauXanhSDT // D√πng m√†u m·ªõi ƒë·ªãnh nghƒ©a[m
[32m+[m[32m            )[m
[32m+[m
[32m+[m[32m            Spacer(modifier = Modifier.height(30.dp))[m
[32m+[m
[32m+[m[32m            TextField([m
[32m+[m[32m                value = soDienThoai,[m
[32m+[m[32m                onValueChange = {[m
[32m+[m[32m                    if (it.length <= 10 && it.all { char -> char.isDigit() }) {[m
[32m+[m[32m                        soDienThoai = it[m
[32m+[m[32m                        loiSdt = false[m
[32m+[m[32m                        thongBaoLoi = ""[m
[32m+[m[32m                    }[m
[32m+[m[32m                },[m
[32m+[m[32m                placeholder = { Text("S·ªë ƒëi·ªán tho·∫°i (10 s·ªë)", color = Color.Gray) },[m
[32m+[m[32m                leadingIcon = {[m
[32m+[m[32m                    Icon(Icons.Default.Phone, contentDescription = null, tint = Color.Gray)[m
[32m+[m[32m                },[m
[32m+[m[32m                modifier = Modifier[m
[32m+[m[32m                    .fillMaxWidth()[m
[32m+[m[32m                    .border([m
[32m+[m[32m                        width = 1.dp,[m
[32m+[m[32m                        color = if (loiSdt) Color.Red else Color.Transparent,[m
[32m+[m[32m                        shape = RoundedCornerShape(16.dp)[m
[32m+[m[32m                    )[m
[32m+[m[32m                    .background(Color.Transparent),[m
[32m+[m[32m                colors = TextFieldDefaults.colors([m
[32m+[m[32m                    focusedContainerColor = Color(0xFFE0E0E0),[m
[32m+[m[32m                    unfocusedContainerColor = Color(0xFFE0E0E0),[m
[32m+[m[32m                    focusedIndicatorColor = Color.Transparent,[m
[32m+[m[32m                    unfocusedIndicatorColor = Color.Transparent,[m
[32m+[m[32m                    errorIndicatorColor = Color.Transparent[m
[32m+[m[32m                ),[m
[32m+[m[32m                shape = RoundedCornerShape(16.dp),[m
[32m+[m[32m                keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Phone),[m
[32m+[m[32m                singleLine = true,[m
[32m+[m[32m                isError = loiSdt[m
[32m+[m[32m            )[m
[32m+[m
[32m+[m[32m            if (loiSdt) {[m
[32m+[m[32m                Text([m
[32m+[m[32m                    text = "S·ªë ƒëi·ªán tho·∫°i kh√¥ng ƒë√∫ng ƒë·ªãnh d·∫°ng (c·∫ßn 10 s·ªë, b·∫Øt ƒë·∫ßu l√† 0)",[m
[32m+[m[32m                    color = Color.Red,[m
[32m+[m[32m                    fontSize = 12.sp,[m
[32m+[m[32m                    modifier = Modifier[m
[32m+[m[32m                        .align(Alignment.Start)[m
[32m+[m[32m                        .padding(start = 8.dp, top = 4.dp)[m
[32m+[m[32m                )[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            Spacer(modifier = Modifier.height(16.dp))[m
[32m+[m
[32m+[m[32m            if (thongBaoLoi.isNotEmpty()) {[m
[32m+[m[32m                Text([m
[32m+[m[32m                    text = thongBaoLoi,[m
[32m+[m[32m                    color = Color.Red,[m
[32m+[m[32m                    fontSize = 14.sp,[m
[32m+[m[32m                    fontWeight = FontWeight.Medium,[m
[32m+[m[32m                    modifier = Modifier.padding(bottom = 8.dp)[m
[32m+[m[32m                )[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            Button([m
[32m+[m[32m                onClick = { guiMaOTP() },[m
[32m+[m[32m                modifier = Modifier[m
[32m+[m[32m                    .fillMaxWidth()[m
[32m+[m[32m                    .height(50.dp),[m
[32m+[m[32m                colors = ButtonDefaults.buttonColors(containerColor = MauXanhSDT),[m
[32m+[m[32m                shape = RoundedCornerShape(25.dp),[m
[32m+[m[32m                enabled = !dangXuLy[m
[32m+[m[32m            ) {[m
[32m+[m[32m                if (dangXuLy) {[m
[32m+[m[32m                    CircularProgressIndicator(color = Color.White, modifier = Modifier.size(24.dp))[m
[32m+[m[32m                } else {[m
[32m+[m[32m                    Text("G·ª≠i m√£ OTP", fontSize = 16.sp, fontWeight = FontWeight.Bold)[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            Spacer(modifier = Modifier.height(16.dp))[m
[32m+[m
[32m+[m[32m            TextButton(onClick = { boDieuHuong.popBackStack() }) {[m
[32m+[m[32m                Text("Quay l·∫°i", color = Color.Gray)[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/features/auth/ui/ManHinhGioiThieu.kt b/app/src/main/java/com/example/stushare/features/auth/ui/ManHinhGioiThieu.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..78d920a[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/features/auth/ui/ManHinhGioiThieu.kt[m
[36m@@ -0,0 +1,155 @@[m
[32m+[m[32mpackage com.example.stushare.features.auth.ui[m
[32m+[m
[32m+[m[32mimport androidx.compose.foundation.ExperimentalFoundationApi[m
[32m+[m[32mimport androidx.compose.foundation.Image[m
[32m+[m[32mimport androidx.compose.foundation.background[m
[32m+[m[32mimport androidx.compose.foundation.layout.*[m
[32m+[m[32mimport androidx.compose.foundation.pager.HorizontalPager[m
[32m+[m[32mimport androidx.compose.foundation.pager.rememberPagerState[m
[32m+[m[32mimport androidx.compose.foundation.shape.CircleShape[m
[32m+[m[32mimport androidx.compose.foundation.shape.RoundedCornerShape[m
[32m+[m[32mimport androidx.compose.material3.*[m
[32m+[m[32mimport androidx.compose.runtime.Composable[m
[32m+[m[32mimport androidx.compose.runtime.rememberCoroutineScope[m
[32m+[m[32mimport androidx.compose.ui.Alignment[m
[32m+[m[32mimport androidx.compose.ui.Modifier[m
[32m+[m[32mimport androidx.compose.ui.draw.clip[m
[32m+[m[32mimport androidx.compose.ui.graphics.Color[m
[32m+[m[32mimport androidx.compose.ui.res.painterResource[m
[32m+[m[32mimport androidx.compose.ui.text.font.FontWeight[m
[32m+[m[32mimport androidx.compose.ui.text.style.TextAlign[m
[32m+[m[32mimport androidx.compose.ui.unit.dp[m
[32m+[m[32mimport androidx.compose.ui.unit.sp[m
[32m+[m[32mimport androidx.navigation.NavController[m
[32m+[m[32mimport kotlinx.coroutines.launch[m
[32m+[m[32mimport com.example.stushare.R[m
[32m+[m[32mimport com.example.stushare.core.navigation.NavRoute[m
[32m+[m
[32m+[m[32mdata class DuLieuGioiThieu(val tieuDe: String, val moTa: String, val hinhAnh: Int)[m
[32m+[m
[32m+[m[32m@OptIn(ExperimentalFoundationApi::class)[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun ManHinhGioiThieu(boDieuHuong: NavController) {[m
[32m+[m[32m    val danhSachTrang = listOf([m
[32m+[m[32m        DuLieuGioiThieu([m
[32m+[m[32m            "T√¨m ki·∫øm th√¥ng minh",[m
[32m+[m[32m            "Truy c·∫≠p kho t√†i li·ªáu kh·ªïng l·ªì t·ª´ m·ªçi khoa v√† m√¥n h·ªçc t·∫°i UTH. T√¨m ki·∫øm ƒë·ªÅ thi, slide b√†i gi·∫£ng nhanh ch√≥ng.",[m
[32m+[m[32m            R.drawable.intro1[m
[32m+[m[32m        ),[m
[32m+[m[32m        DuLieuGioiThieu([m
[32m+[m[32m            "Chia s·∫ª tri th·ª©c",[m
[32m+[m[32m            "Tr·ªü th√†nh m·ªôt ph·∫ßn c·ªßa c·ªông ƒë·ªìng sinh vi√™n UTH. ƒêƒÉng t·∫£i t√†i li·ªáu, gi√∫p ƒë·ª° b·∫°n b√® v√† t√≠ch l≈©y ƒëi·ªÉm.",[m
[32m+[m[32m            R.drawable.intro2[m
[32m+[m[32m        ),[m
[32m+[m[32m        DuLieuGioiThieu([m
[32m+[m[32m            "√în t·∫≠p hi·ªáu qu·∫£",[m
[32m+[m[32m            "T·∫•t c·∫£ t√†i li·ªáu b·∫°n c·∫ßn cho c√°c k·ª≥ thi ƒë·ªÅu ·ªü ƒë√¢y. H·ªçc t·∫≠p th√¥ng minh h∆°n v√† s·∫µn s√†ng cho m·ªçi th·ª≠ th√°ch.",[m
[32m+[m[32m            R.drawable.intro3[m
[32m+[m[32m        )[m
[32m+[m[32m    )[m
[32m+[m
[32m+[m[32m    val trangThaiPager = rememberPagerState(pageCount = { danhSachTrang.size })[m
[32m+[m[32m    val phamViCoroutine = rememberCoroutineScope()[m
[32m+[m
[32m+[m[32m    // H√ÄM M·ªöI: Chuy·ªÉn sang Trang ch·ªß[m
[32m+[m[32m    fun denManHinhChinh() {[m
[32m+[m[32m        boDieuHuong.navigate(NavRoute.Home) {[m
[32m+[m[32m            popUpTo(NavRoute.Onboarding) { inclusive = true }[m
[32m+[m[32m            popUpTo(NavRoute.Intro) { inclusive = true }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    NenHinhSong {[m
[32m+[m[32m        Column([m
[32m+[m[32m            modifier = Modifier[m
[32m+[m[32m                .fillMaxSize()[m
[32m+[m[32m                .padding(top = 100.dp, bottom = 50.dp, start = 16.dp, end = 16.dp),[m
[32m+[m[32m            horizontalAlignment = Alignment.CenterHorizontally[m
[32m+[m[32m        ) {[m
[32m+[m[32m            HorizontalPager([m
[32m+[m[32m                state = trangThaiPager,[m
[32m+[m[32m                modifier = Modifier.weight(1f)[m
[32m+[m[32m            ) { viTri ->[m
[32m+[m[32m                NoiDungTrang(danhSachTrang[viTri])[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            Row([m
[32m+[m[32m                Modifier[m
[32m+[m[32m                    .height(30.dp)[m
[32m+[m[32m                    .fillMaxWidth(),[m
[32m+[m[32m                horizontalArrangement = Arrangement.Center[m
[32m+[m[32m            ) {[m
[32m+[m[32m                repeat(danhSachTrang.size) { iteration ->[m
[32m+[m[32m                    val mauSac = if (trangThaiPager.currentPage == iteration) MauXanhSong else Color.LightGray[m
[32m+[m[32m                    Box([m
[32m+[m[32m                        modifier = Modifier[m
[32m+[m[32m                            .padding(4.dp)[m
[32m+[m[32m                            .clip(CircleShape)[m
[32m+[m[32m                            .background(mauSac)[m
[32m+[m[32m                            .size(10.dp)[m
[32m+[m[32m                    )[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            Spacer(modifier = Modifier.height(24.dp))[m
[32m+[m
[32m+[m[32m            Button([m
[32m+[m[32m                onClick = {[m
[32m+[m[32m                    if (trangThaiPager.currentPage < danhSachTrang.size - 1) {[m
[32m+[m[32m                        phamViCoroutine.launch {[m
[32m+[m[32m                            trangThaiPager.animateScrollToPage(trangThaiPager.currentPage + 1)[m
[32m+[m[32m                        }[m
[32m+[m[32m                    } else {[m
[32m+[m[32m                        denManHinhChinh() // G·ªçi h√†m v√†o trang ch·ªß[m
[32m+[m[32m                    }[m
[32m+[m[32m                },[m
[32m+[m[32m                modifier = Modifier[m
[32m+[m[32m                    .fillMaxWidth()[m
[32m+[m[32m                    .height(50.dp),[m
[32m+[m[32m                colors = ButtonDefaults.buttonColors(containerColor = MauXanhSong),[m
[32m+[m[32m                shape = RoundedCornerShape(25.dp)[m
[32m+[m[32m            ) {[m
[32m+[m[32m                Text([m
[32m+[m[32m                    text = if (trangThaiPager.currentPage == danhSachTrang.size - 1) "B·∫Øt ƒë·∫ßu ngay" else "Ti·∫øp T·ª•c",[m
[32m+[m[32m                    fontSize = 18.sp,[m
[32m+[m[32m                    fontWeight = FontWeight.Bold[m
[32m+[m[32m                )[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            TextButton(onClick = { denManHinhChinh() }) {[m
[32m+[m[32m                Text("B·ªè qua", color = Color.Gray)[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun NoiDungTrang(duLieu: DuLieuGioiThieu) {[m
[32m+[m[32m    Column([m
[32m+[m[32m        modifier = Modifier.fillMaxSize(),[m
[32m+[m[32m        horizontalAlignment = Alignment.CenterHorizontally,[m
[32m+[m[32m        verticalArrangement = Arrangement.Center[m
[32m+[m[32m    ) {[m
[32m+[m[32m        Image([m
[32m+[m[32m            painter = painterResource(id = duLieu.hinhAnh),[m
[32m+[m[32m            contentDescription = null,[m
[32m+[m[32m            modifier = Modifier.size(280.dp)[m
[32m+[m[32m        )[m
[32m+[m[32m        Spacer(modifier = Modifier.height(32.dp))[m
[32m+[m[32m        Text([m
[32m+[m[32m            text = duLieu.tieuDe,[m
[32m+[m[32m            fontSize = 24.sp,[m
[32m+[m[32m            fontWeight = FontWeight.Bold,[m
[32m+[m[32m            textAlign = TextAlign.Center,[m
[32m+[m[32m            color = Color.Black[m
[32m+[m[32m        )[m
[32m+[m[32m        Spacer(modifier = Modifier.height(16.dp))[m
[32m+[m[32m        Text([m
[32m+[m[32m            text = duLieu.moTa,[m
[32m+[m[32m            fontSize = 16.sp,[m
[32m+[m[32m            textAlign = TextAlign.Center,[m
[32m+[m[32m            color = Color.Gray,[m
[32m+[m[32m            lineHeight = 24.sp[m
[32m+[m[32m        )[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/features/auth/ui/ManHinhQuenMatKhau.kt b/app/src/main/java/com/example/stushare/features/auth/ui/ManHinhQuenMatKhau.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..17463c1[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/features/auth/ui/ManHinhQuenMatKhau.kt[m
[36m@@ -0,0 +1,149 @@[m
[32m+[m[32mpackage com.example.stushare.features.auth.ui[m
[32m+[m
[32m+[m[32mimport android.widget.Toast[m
[32m+[m[32mimport androidx.compose.foundation.layout.*[m
[32m+[m[32mimport androidx.compose.foundation.shape.RoundedCornerShape[m
[32m+[m[32mimport androidx.compose.foundation.text.KeyboardOptions[m
[32m+[m[32mimport androidx.compose.material.icons.Icons[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Email[m
[32m+[m[32mimport androidx.compose.material3.*[m
[32m+[m[32mimport androidx.compose.runtime.*[m
[32m+[m[32mimport androidx.compose.ui.Alignment[m
[32m+[m[32mimport androidx.compose.ui.Modifier[m
[32m+[m[32mimport androidx.compose.ui.graphics.Color[m
[32m+[m[32mimport androidx.compose.ui.platform.LocalContext[m
[32m+[m[32mimport androidx.compose.ui.text.font.FontWeight[m
[32m+[m[32mimport androidx.compose.ui.text.input.KeyboardType[m
[32m+[m[32mimport androidx.compose.ui.text.style.TextAlign[m
[32m+[m[32mimport androidx.compose.ui.unit.dp[m
[32m+[m[32mimport androidx.compose.ui.unit.sp[m
[32m+[m[32mimport androidx.navigation.NavController[m
[32m+[m[32mimport com.google.firebase.auth.FirebaseAuth[m
[32m+[m[32mimport com.google.firebase.auth.FirebaseAuthInvalidUserException[m
[32m+[m
[32m+[m[32m// --- TH√äM D√íNG N√ÄY ƒê·ªÇ H·∫æT L·ªñI ---[m
[32m+[m[32mval MauXanhQuenMatKhau = Color(0xFF4CAF50)[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun ManHinhQuenMatKhau(boDieuHuong: NavController) {[m
[32m+[m[32m    var email by remember { mutableStateOf("") }[m
[32m+[m[32m    var dangXuLy by remember { mutableStateOf(false) }[m
[32m+[m[32m    var thongBaoLoi by remember { mutableStateOf("") }[m
[32m+[m
[32m+[m[32m    val context = LocalContext.current[m
[32m+[m[32m    val firebaseAuth = FirebaseAuth.getInstance()[m
[32m+[m
[32m+[m[32m    fun guiEmailKhoiPhuc() {[m
[32m+[m[32m        thongBaoLoi = ""[m
[32m+[m
[32m+[m[32m        if (email.isEmpty()) {[m
[32m+[m[32m            thongBaoLoi = "Vui l√≤ng nh·∫≠p email"[m
[32m+[m[32m            return[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        if (!android.util.Patterns.EMAIL_ADDRESS.matcher(email).matches()) {[m
[32m+[m[32m            thongBaoLoi = "ƒê·ªãnh d·∫°ng email kh√¥ng h·ª£p l·ªá"[m
[32m+[m[32m            return[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        dangXuLy = true[m
[32m+[m[32m        firebaseAuth.sendPasswordResetEmail(email.trim())[m
[32m+[m[32m            .addOnCompleteListener { tacVu ->[m
[32m+[m[32m                dangXuLy = false[m
[32m+[m[32m                if (tacVu.isSuccessful) {[m
[32m+[m[32m                    Toast.makeText(context, "ƒê√£ g·ª≠i email ƒë·∫∑t l·∫°i m·∫≠t kh·∫©u. Vui l√≤ng ki·ªÉm tra h·ªôp th∆∞ (c·∫£ m·ª•c Spam).", Toast.LENGTH_LONG).show()[m
[32m+[m[32m                    boDieuHuong.popBackStack()[m
[32m+[m[32m                } else {[m
[32m+[m[32m                    val ngoaiLe = tacVu.exception[m
[32m+[m[32m                    thongBaoLoi = when (ngoaiLe) {[m
[32m+[m[32m                        is FirebaseAuthInvalidUserException -> "Email n√†y ch∆∞a ƒë∆∞·ª£c ƒëƒÉng k√Ω t√†i kho·∫£n."[m
[32m+[m[32m                        else -> "L·ªói: ${ngoaiLe?.message}"[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    NenHinhSong {[m
[32m+[m[32m        Column([m
[32m+[m[32m            modifier = Modifier[m
[32m+[m[32m                .fillMaxSize()[m
[32m+[m[32m                .padding(24.dp),[m
[32m+[m[32m            horizontalAlignment = Alignment.CenterHorizontally,[m
[32m+[m[32m            verticalArrangement = Arrangement.Center[m
[32m+[m[32m        ) {[m
[32m+[m
[32m+[m[32m            Text([m
[32m+[m[32m                text = "Qu√™n M·∫≠t Kh·∫©u",[m
[32m+[m[32m                fontSize = 30.sp,[m
[32m+[m[32m                fontWeight = FontWeight.Bold,[m
[32m+[m[32m                color = MauXanhQuenMatKhau // ƒê√£ s·ª≠a bi·∫øn m√†u[m
[32m+[m[32m            )[m
[32m+[m
[32m+[m[32m            Spacer(modifier = Modifier.height(16.dp))[m
[32m+[m
[32m+[m[32m            Text([m
[32m+[m[32m                text = "Nh·∫≠p email c·ªßa b·∫°n ƒë·ªÉ nh·∫≠n ƒë∆∞·ªùng d·∫´n ƒë·∫∑t l·∫°i m·∫≠t kh·∫©u.",[m
[32m+[m[32m                textAlign = TextAlign.Center,[m
[32m+[m[32m                color = Color.Gray,[m
[32m+[m[32m                modifier = Modifier.fillMaxWidth()[m
[32m+[m[32m            )[m
[32m+[m
[32m+[m[32m            Spacer(modifier = Modifier.height(32.dp))[m
[32m+[m
[32m+[m[32m            TextField([m
[32m+[m[32m                value = email,[m
[32m+[m[32m                onValueChange = {[m
[32m+[m[32m                    email = it[m
[32m+[m[32m                    thongBaoLoi = ""[m
[32m+[m[32m                },[m
[32m+[m[32m                placeholder = { Text("Email", color = Color.Gray) },[m
[32m+[m[32m                leadingIcon = { Icon(Icons.Default.Email, contentDescription = null, tint = Color.Gray) },[m
[32m+[m[32m                modifier = Modifier.fillMaxWidth(),[m
[32m+[m[32m                colors = TextFieldDefaults.colors([m
[32m+[m[32m                    focusedContainerColor = Color(0xFFE0E0E0),[m
[32m+[m[32m                    unfocusedContainerColor = Color(0xFFE0E0E0),[m
[32m+[m[32m                    focusedIndicatorColor = Color.Transparent,[m
[32m+[m[32m                    unfocusedIndicatorColor = Color.Transparent[m
[32m+[m[32m                ),[m
[32m+[m[32m                shape = RoundedCornerShape(16.dp),[m
[32m+[m[32m                keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.Email),[m
[32m+[m[32m                singleLine = true,[m
[32m+[m[32m                isError = thongBaoLoi.isNotEmpty()[m
[32m+[m[32m            )[m
[32m+[m
[32m+[m[32m            Spacer(modifier = Modifier.height(16.dp))[m
[32m+[m
[32m+[m[32m            if (thongBaoLoi.isNotEmpty()) {[m
[32m+[m[32m                Text([m
[32m+[m[32m                    text = thongBaoLoi,[m
[32m+[m[32m                    color = Color.Red,[m
[32m+[m[32m                    fontSize = 14.sp,[m
[32m+[m[32m                    textAlign = TextAlign.Center,[m
[32m+[m[32m                    modifier = Modifier.padding(bottom = 8.dp)[m
[32m+[m[32m                )[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            Button([m
[32m+[m[32m                onClick = { guiEmailKhoiPhuc() },[m
[32m+[m[32m                modifier = Modifier[m
[32m+[m[32m                    .fillMaxWidth()[m
[32m+[m[32m                    .height(50.dp),[m
[32m+[m[32m                colors = ButtonDefaults.buttonColors(containerColor = MauXanhQuenMatKhau), // ƒê√£ s·ª≠a bi·∫øn m√†u[m
[32m+[m[32m                shape = RoundedCornerShape(25.dp),[m
[32m+[m[32m                enabled = !dangXuLy[m
[32m+[m[32m            ) {[m
[32m+[m[32m                if (dangXuLy) {[m
[32m+[m[32m                    CircularProgressIndicator(color = Color.White, modifier = Modifier.size(24.dp))[m
[32m+[m[32m                } else {[m
[32m+[m[32m                    Text("G·ª≠i Y√™u C·∫ßu", fontSize = 18.sp, fontWeight = FontWeight.Bold)[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            Spacer(modifier = Modifier.height(16.dp))[m
[32m+[m
[32m+[m[32m            TextButton(onClick = { boDieuHuong.popBackStack() }) {[m
[32m+[m[32m                Text("Quay l·∫°i", color = Color.Gray)[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/features/auth/ui/ManHinhXacThucOTP.kt b/app/src/main/java/com/example/stushare/features/auth/ui/ManHinhXacThucOTP.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..650d8ed[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/features/auth/ui/ManHinhXacThucOTP.kt[m
[36m@@ -0,0 +1,198 @@[m
[32m+[m[32mpackage com.example.stushare.features.auth.ui[m
[32m+[m
[32m+[m[32mimport android.widget.Toast[m
[32m+[m[32mimport androidx.compose.foundation.background[m
[32m+[m[32mimport androidx.compose.foundation.border[m
[32m+[m[32mimport androidx.compose.foundation.layout.*[m
[32m+[m[32mimport androidx.compose.foundation.shape.RoundedCornerShape[m
[32m+[m[32mimport androidx.compose.foundation.text.BasicTextField[m
[32m+[m[32mimport androidx.compose.foundation.text.KeyboardOptions[m
[32m+[m[32mimport androidx.compose.material3.*[m
[32m+[m[32mimport androidx.compose.runtime.*[m
[32m+[m[32mimport androidx.compose.ui.Alignment[m
[32m+[m[32mimport androidx.compose.ui.Modifier[m
[32m+[m[32mimport androidx.compose.ui.graphics.Color[m
[32m+[m[32mimport androidx.compose.ui.platform.LocalContext[m
[32m+[m[32mimport androidx.compose.ui.text.font.FontWeight[m
[32m+[m[32mimport androidx.compose.ui.text.input.KeyboardType[m
[32m+[m[32mimport androidx.compose.ui.unit.dp[m
[32m+[m[32mimport androidx.compose.ui.unit.sp[m
[32m+[m[32mimport androidx.navigation.NavController[m
[32m+[m[32mimport com.example.stushare.core.navigation.NavRoute // Import Route m·ªõi[m
[32m+[m[32mimport com.google.firebase.auth.FirebaseAuth[m
[32m+[m[32mimport com.google.firebase.auth.FirebaseAuthInvalidCredentialsException[m
[32m+[m[32mimport com.google.firebase.auth.PhoneAuthProvider[m
[32m+[m[32mimport kotlinx.coroutines.delay[m
[32m+[m
[32m+[m[32m// --- ƒê·ªäNH NGHƒ®A M√ÄU TR·ª∞C TI·∫æP ---[m
[32m+[m[32mval MauXanhOTP = Color(0xFF4CAF50)[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun ManHinhXacThucOTP(boDieuHuong: NavController, verificationId: String) {[m
[32m+[m[32m    var maOTP by remember { mutableStateOf("") }[m
[32m+[m[32m    var thoiGianDemNguoc by remember { mutableStateOf(59) }[m
[32m+[m[32m    var dangXuLy by remember { mutableStateOf(false) }[m
[32m+[m[32m    var thongBaoLoi by remember { mutableStateOf("") }[m
[32m+[m
[32m+[m[32m    val context = LocalContext.current[m
[32m+[m[32m    val firebaseAuth = FirebaseAuth.getInstance()[m
[32m+[m
[32m+[m[32m    // Logic ƒë·∫øm ng∆∞·ª£c th·ªùi gian[m
[32m+[m[32m    LaunchedEffect(Unit) {[m
[32m+[m[32m        while (thoiGianDemNguoc > 0) {[m
[32m+[m[32m            delay(1000)[m
[32m+[m[32m            thoiGianDemNguoc--[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    fun xacNhanMaOTP() {[m
[32m+[m[32m        thongBaoLoi = ""[m
[32m+[m[32m        if (maOTP.length != 6) {[m
[32m+[m[32m            thongBaoLoi = "M√£ OTP ph·∫£i ƒë·ªß 6 s·ªë"[m
[32m+[m[32m            return[m
[32m+[m[32m        }[m
[32m+[m[32m        dangXuLy = true[m
[32m+[m
[32m+[m[32m        val credential = PhoneAuthProvider.getCredential(verificationId, maOTP)[m
[32m+[m
[32m+[m[32m        firebaseAuth.signInWithCredential(credential)[m
[32m+[m[32m            .addOnCompleteListener { tacVu ->[m
[32m+[m[32m                dangXuLy = false[m
[32m+[m[32m                if (tacVu.isSuccessful) {[m
[32m+[m[32m                    Toast.makeText(context, "ƒêƒÉng nh·∫≠p th√†nh c√¥ng!", Toast.LENGTH_SHORT).show()[m
[32m+[m
[32m+[m[32m                    // --- ƒêI·ªÄU H∆Ø·ªöNG V·ªÄ HOME (ƒê√∫ng chu·∫©n Route m·ªõi) ---[m
[32m+[m[32m                    boDieuHuong.navigate(NavRoute.Home) {[m
[32m+[m[32m                        // X√≥a h·∫øt c√°c m√†n h√¨nh ƒëƒÉng nh·∫≠p tr∆∞·ªõc ƒë√≥ kh·ªèi stack[m
[32m+[m[32m                        popUpTo(NavRoute.Login) { inclusive = true }[m
[32m+[m[32m                    }[m
[32m+[m[32m                } else {[m
[32m+[m[32m                    val ngoaiLe = tacVu.exception[m
[32m+[m[32m                    thongBaoLoi = if (ngoaiLe is FirebaseAuthInvalidCredentialsException) {[m
[32m+[m[32m                        "M√£ OTP kh√¥ng ƒë√∫ng. Vui l√≤ng ki·ªÉm tra l·∫°i."[m
[32m+[m[32m                    } else {[m
[32m+[m[32m                        "L·ªói: ${ngoaiLe?.message}"[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    NenHinhSong {[m
[32m+[m[32m        Column([m
[32m+[m[32m            modifier = Modifier[m
[32m+[m[32m                .fillMaxSize()[m
[32m+[m[32m                .padding(24.dp),[m
[32m+[m[32m            horizontalAlignment = Alignment.CenterHorizontally,[m
[32m+[m[32m            verticalArrangement = Arrangement.Center[m
[32m+[m[32m        ) {[m
[32m+[m[32m            Text([m
[32m+[m[32m                text = "X√°c th·ª±c OTP",[m
[32m+[m[32m                fontSize = 30.sp,[m
[32m+[m[32m                fontWeight = FontWeight.Bold,[m
[32m+[m[32m                color = MauXanhOTP, // D√πng m√†u m·ªõi[m
[32m+[m[32m                modifier = Modifier.align(Alignment.CenterHorizontally)[m
[32m+[m[32m            )[m
[32m+[m
[32m+[m[32m            Spacer(modifier = Modifier.height(32.dp))[m
[32m+[m
[32m+[m[32m            // Giao di·ªán nh·∫≠p OTP 6 s·ªë[m
[32m+[m[32m            BasicTextField([m
[32m+[m[32m                value = maOTP,[m
[32m+[m[32m                onValueChange = {[m
[32m+[m[32m                    if (it.length <= 6 && it.all { char -> char.isDigit() }) {[m
[32m+[m[32m                        maOTP = it[m
[32m+[m[32m                        thongBaoLoi = ""[m
[32m+[m[32m                    }[m
[32m+[m[32m                },[m
[32m+[m[32m                keyboardOptions = KeyboardOptions(keyboardType = KeyboardType.NumberPassword),[m
[32m+[m[32m                decorationBox = {[m
[32m+[m[32m                    Row([m
[32m+[m[32m                        horizontalArrangement = Arrangement.Center,[m
[32m+[m[32m                        verticalAlignment = Alignment.CenterVertically[m
[32m+[m[32m                    ) {[m
[32m+[m[32m                        repeat(6) { index ->[m
[32m+[m[32m                            val char = if (index < maOTP.length) maOTP[index].toString() else ""[m
[32m+[m
[32m+[m[32m                            if (index == 3) {[m
[32m+[m[32m                                Text([m
[32m+[m[32m                                    text = "-",[m
[32m+[m[32m                                    fontSize = 24.sp,[m
[32m+[m[32m                                    fontWeight = FontWeight.Bold,[m
[32m+[m[32m                                    modifier = Modifier.padding(horizontal = 8.dp)[m
[32m+[m[32m                                )[m
[32m+[m[32m                            }[m
[32m+[m
[32m+[m[32m                            Box([m
[32m+[m[32m                                modifier = Modifier[m
[32m+[m[32m                                    .width(45.dp)[m
[32m+[m[32m                                    .height(55.dp)[m
[32m+[m[32m                                    .padding(4.dp)[m
[32m+[m[32m                                    .background(Color(0xFFE0E0E0), RoundedCornerShape(8.dp))[m
[32m+[m[32m                                    .border([m
[32m+[m[32m                                        width = 1.dp,[m
[32m+[m[32m                                        // Vi·ªÅn ƒë·ªè n·∫øu c√≥ l·ªói, ng∆∞·ª£c l·∫°i vi·ªÅn xanh ho·∫∑c trong su·ªët[m
[32m+[m[32m                                        color = if (thongBaoLoi.isNotEmpty()) Color.Red else if (index < maOTP.length) MauXanhOTP else Color.Transparent,[m
[32m+[m[32m                                        shape = RoundedCornerShape(8.dp)[m
[32m+[m[32m                                    ),[m
[32m+[m[32m                                contentAlignment = Alignment.Center[m
[32m+[m[32m                            ) {[m
[32m+[m[32m                                Text([m
[32m+[m[32m                                    text = char,[m
[32m+[m[32m                                    fontSize = 24.sp,[m
[32m+[m[32m                                    fontWeight = FontWeight.Bold,[m
[32m+[m[32m                                    color = Color.Black[m
[32m+[m[32m                                )[m
[32m+[m[32m                            }[m
[32m+[m[32m                        }[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m            )[m
[32m+[m
[32m+[m[32m            Spacer(modifier = Modifier.height(16.dp))[m
[32m+[m
[32m+[m[32m            // D√≤ng g·ª≠i l·∫°i m√£[m
[32m+[m[32m            Row(verticalAlignment = Alignment.CenterVertically) {[m
[32m+[m[32m                Text(text = "G·ª≠i l·∫°i m√£ ", color = MauXanhOTP, fontSize = 14.sp)[m
[32m+[m[32m                Text([m
[32m+[m[32m                    text = "(${String.format("00:%02d", thoiGianDemNguoc)})",[m
[32m+[m[32m                    color = MauXanhOTP,[m
[32m+[m[32m                    fontSize = 14.sp[m
[32m+[m[32m                )[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            Spacer(modifier = Modifier.height(16.dp))[m
[32m+[m
[32m+[m[32m            if (thongBaoLoi.isNotEmpty()) {[m
[32m+[m[32m                Text([m
[32m+[m[32m                    text = thongBaoLoi,[m
[32m+[m[32m                    color = Color.Red,[m
[32m+[m[32m                    fontSize = 14.sp,[m
[32m+[m[32m                    fontWeight = FontWeight.Medium,[m
[32m+[m[32m                    modifier = Modifier.padding(bottom = 8.dp)[m
[32m+[m[32m                )[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            Button([m
[32m+[m[32m                onClick = { xacNhanMaOTP() },[m
[32m+[m[32m                modifier = Modifier[m
[32m+[m[32m                    .fillMaxWidth()[m
[32m+[m[32m                    .height(50.dp),[m
[32m+[m[32m                colors = ButtonDefaults.buttonColors(containerColor = MauXanhOTP),[m
[32m+[m[32m                shape = RoundedCornerShape(25.dp),[m
[32m+[m[32m                enabled = !dangXuLy[m
[32m+[m[32m            ) {[m
[32m+[m[32m                if (dangXuLy) {[m
[32m+[m[32m                    CircularProgressIndicator(color = Color.White, modifier = Modifier.size(24.dp))[m
[32m+[m[32m                } else {[m
[32m+[m[32m                    Text("X√°c nh·∫≠n", fontSize = 16.sp, fontWeight = FontWeight.Bold)[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            Spacer(modifier = Modifier.height(16.dp))[m
[32m+[m
[32m+[m[32m            TextButton(onClick = { boDieuHuong.popBackStack() }) {[m
[32m+[m[32m                Text("Quay l·∫°i", color = Color.Gray)[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/features/auth/ui/NenHinhSong.kt b/app/src/main/java/com/example/stushare/features/auth/ui/NenHinhSong.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..78fe12e[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/features/auth/ui/NenHinhSong.kt[m
[36m@@ -0,0 +1,80 @@[m
[32m+[m[32mpackage com.example.stushare.features.auth.ui[m
[32m+[m
[32m+[m[32mimport androidx.compose.foundation.Canvas[m
[32m+[m[32mimport androidx.compose.foundation.background[m
[32m+[m[32mimport androidx.compose.foundation.layout.Box[m
[32m+[m[32mimport androidx.compose.foundation.layout.fillMaxSize[m
[32m+[m[32mimport androidx.compose.runtime.Composable[m
[32m+[m[32mimport androidx.compose.ui.Modifier[m
[32m+[m[32mimport androidx.compose.ui.graphics.Brush[m
[32m+[m[32mimport androidx.compose.ui.graphics.Color[m
[32m+[m[32mimport androidx.compose.ui.graphics.Path[m
[32m+[m
[32m+[m[32m// ƒê·ªãnh nghƒ©a m√†u[m
[32m+[m[32mval MauXanhSong = Color(0xFF2ecc71)[m
[32m+[m[32mval MauXanhDam = Color(0xFF27ae60)[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun NenHinhSong([m
[32m+[m[32m    // ‚≠êÔ∏è C·∫¢I TI·∫æN: Th√™m tham s·ªë b·∫≠t/t·∫Øt s√≥ng d∆∞·ªõi (M·∫∑c ƒë·ªãnh l√† true ƒë·ªÉ hi·ªán)[m
[32m+[m[32m    hienThiSongDuoi: Boolean = true,[m
[32m+[m[32m    noiDung: @Composable () -> Unit[m
[32m+[m[32m) {[m
[32m+[m[32m    Box([m
[32m+[m[32m        modifier = Modifier[m
[32m+[m[32m            .fillMaxSize()[m
[32m+[m[32m            .background(Color.White)[m
[32m+[m[32m    ) {[m
[32m+[m[32m        Canvas(modifier = Modifier.fillMaxSize()) {[m
[32m+[m[32m            val chieuRong = size.width[m
[32m+[m[32m            val chieuCao = size.height[m
[32m+[m
[32m+[m[32m            // --- 1. V·∫º S√ìNG TR√äN (Lu√¥n lu√¥n v·∫Ω) ---[m
[32m+[m[32m            val duongDanTren = Path().apply {[m
[32m+[m[32m                moveTo(0f, 0f)[m
[32m+[m[32m                lineTo(chieuRong, 0f)[m
[32m+[m[32m                lineTo(chieuRong, chieuCao * 0.1f)[m
[32m+[m[32m                cubicTo([m
[32m+[m[32m                    chieuRong * 0.5f, chieuCao * 0.2f,[m
[32m+[m[32m                    chieuRong * 0.2f, chieuCao * 0.05f,[m
[32m+[m[32m                    0f, chieuCao * 0.15f[m
[32m+[m[32m                )[m
[32m+[m[32m                close()[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            drawPath([m
[32m+[m[32m                path = duongDanTren,[m
[32m+[m[32m                brush = Brush.verticalGradient([m
[32m+[m[32m                    colors = listOf(MauXanhDam, MauXanhSong),[m
[32m+[m[32m                    startY = 0f,[m
[32m+[m[32m                    endY = chieuCao * 0.25f[m
[32m+[m[32m                )[m
[32m+[m[32m            )[m
[32m+[m
[32m+[m[32m            // --- 2. V·∫º S√ìNG D∆Ø·ªöI (V·∫Ω c√≥ ƒëi·ªÅu ki·ªán) ---[m
[32m+[m[32m            // Ch·ªâ v·∫Ω khi hienThiSongDuoi = true.[m
[32m+[m[32m            // Gi√∫p tr√°nh xung ƒë·ªôt (ƒë√® l√™n nhau) v·ªõi thanh NavigationBar m√†u xanh ·ªü m√†n h√¨nh ch√≠nh.[m
[32m+[m[32m            if (hienThiSongDuoi) {[m
[32m+[m[32m                val duongDanDuoi = Path().apply {[m
[32m+[m[32m                    moveTo(0f, chieuCao)[m
[32m+[m[32m                    lineTo(chieuRong, chieuCao)[m
[32m+[m[32m                    val chieuCaoSong = chieuCao * 0.9f[m
[32m+[m[32m                    lineTo(chieuRong, chieuCaoSong)[m
[32m+[m[32m                    quadraticBezierTo([m
[32m+[m[32m                        chieuRong * 0.5f, chieuCao * 1f,[m
[32m+[m[32m                        0f, chieuCaoSong[m
[32m+[m[32m                    )[m
[32m+[m[32m                    close()[m
[32m+[m[32m                }[m
[32m+[m
[32m+[m[32m                drawPath([m
[32m+[m[32m                    path = duongDanDuoi,[m
[32m+[m[32m                    color = MauXanhSong[m
[32m+[m[32m                )[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        // Hi·ªÉn th·ªã n·ªôi dung m√†n h√¨nh l√™n tr√™n[m
[32m+[m[32m        noiDung()[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/features/feature_admin/ui/AdminDashboardScreen.kt b/app/src/main/java/com/example/stushare/features/feature_admin/ui/AdminDashboardScreen.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..84b9a70[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/features/feature_admin/ui/AdminDashboardScreen.kt[m
[36m@@ -0,0 +1,151 @@[m
[32m+[m[32mpackage com.example.stushare.features.feature_admin.ui[m
[32m+[m
[32m+[m[32mimport androidx.compose.foundation.background[m
[32m+[m[32mimport androidx.compose.foundation.clickable[m
[32m+[m[32mimport androidx.compose.foundation.layout.*[m
[32m+[m[32mimport androidx.compose.foundation.rememberScrollState[m
[32m+[m[32mimport androidx.compose.foundation.shape.RoundedCornerShape[m
[32m+[m[32mimport androidx.compose.foundation.verticalScroll[m
[32m+[m[32mimport androidx.compose.material.icons.Icons[m
[32m+[m[32mimport androidx.compose.material.icons.automirrored.filled.ArrowBack[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Group[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Description[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Notifications[m
[32m+[m[32mimport androidx.compose.material.icons.filled.ReportProblem // Icon d·∫•u ch·∫•m than[m
[32m+[m[32mimport androidx.compose.material3.*[m
[32m+[m[32mimport androidx.compose.runtime.Composable[m
[32m+[m[32mimport androidx.compose.runtime.collectAsState[m
[32m+[m[32mimport androidx.compose.runtime.getValue[m
[32m+[m[32mimport androidx.compose.ui.Alignment[m
[32m+[m[32mimport androidx.compose.ui.Modifier[m
[32m+[m[32mimport androidx.compose.ui.draw.clip[m
[32m+[m[32mimport androidx.compose.ui.graphics.Color[m
[32m+[m[32mimport androidx.compose.ui.graphics.vector.ImageVector[m
[32m+[m[32mimport androidx.compose.ui.text.font.FontWeight[m
[32m+[m[32mimport androidx.compose.ui.unit.dp[m
[32m+[m[32mimport androidx.compose.ui.unit.sp[m
[32m+[m[32mimport androidx.hilt.navigation.compose.hiltViewModel[m
[32m+[m[32mimport com.example.stushare.ui.theme.PrimaryGreen // Ho·∫∑c thay b·∫±ng Color(0xFF4CAF50)[m
[32m+[m
[32m+[m[32m@OptIn(ExperimentalMaterial3Api::class)[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun AdminScreen([m
[32m+[m[32m    onBackClick: () -> Unit,[m
[32m+[m[32m    onNavigateToReports: () -> Unit, // üü¢ Callback ƒë·ªÉ chuy·ªÉn sang m√†n Report[m
[32m+[m[32m    viewModel: AdminViewModel = hiltViewModel()[m
[32m+[m[32m) {[m
[32m+[m[32m    val uiState by viewModel.uiState.collectAsState()[m
[32m+[m
[32m+[m[32m    Scaffold([m
[32m+[m[32m        topBar = {[m
[32m+[m[32m            TopAppBar([m
[32m+[m[32m                title = { Text("Admin Dashboard", fontWeight = FontWeight.Bold) },[m
[32m+[m[32m                navigationIcon = {[m
[32m+[m[32m                    IconButton(onClick = onBackClick) {[m
[32m+[m[32m                        Icon(Icons.AutoMirrored.Filled.ArrowBack, contentDescription = "Back")[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m            )[m
[32m+[m[32m        }[m
[32m+[m[32m    ) { padding ->[m
[32m+[m[32m        Column([m
[32m+[m[32m            modifier = Modifier[m
[32m+[m[32m                .fillMaxSize()[m
[32m+[m[32m                .padding(padding)[m
[32m+[m[32m                .verticalScroll(rememberScrollState())[m
[32m+[m[32m                .padding(16.dp)[m
[32m+[m[32m        ) {[m
[32m+[m[32m            // 1. Ph·∫ßn Th·ªëng k√™ (Stats)[m
[32m+[m[32m            Card([m
[32m+[m[32m                colors = CardDefaults.cardColors(containerColor = Color.White),[m
[32m+[m[32m                elevation = CardDefaults.cardElevation(4.dp),[m
[32m+[m[32m                modifier = Modifier.fillMaxWidth()[m
[32m+[m[32m            ) {[m
[32m+[m[32m                Column(Modifier.padding(16.dp)) {[m
[32m+[m[32m                    Text("T·ªïng quan h·ªá th·ªëng", fontWeight = FontWeight.Bold, fontSize = 16.sp)[m
[32m+[m[32m                    Spacer(Modifier.height(16.dp))[m
[32m+[m[32m                    Row([m
[32m+[m[32m                        modifier = Modifier.fillMaxWidth(),[m
[32m+[m[32m                        horizontalArrangement = Arrangement.SpaceBetween[m
[32m+[m[32m                    ) {[m
[32m+[m[32m                        StatItem(count = uiState.userCount, label = "Ng∆∞·ªùi d√πng", color = PrimaryGreen)[m
[32m+[m[32m                        StatItem(count = uiState.docCount, label = "T√†i li·ªáu", color = Color(0xFFFF9800))[m
[32m+[m[32m                        StatItem(count = uiState.requestCount, label = "Y√™u c·∫ßu", color = Color(0xFFF44336))[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            Spacer(Modifier.height(24.dp))[m
[32m+[m[32m            Text("Ch·ª©c nƒÉng qu·∫£n l√Ω", fontWeight = FontWeight.Bold, fontSize = 18.sp)[m
[32m+[m[32m            Spacer(Modifier.height(12.dp))[m
[32m+[m
[32m+[m[32m            // 2. C√°c n√∫t ch·ª©c nƒÉng[m
[32m+[m
[32m+[m[32m            // N√∫t Qu·∫£n l√Ω ng∆∞·ªùi d√πng (Demo)[m
[32m+[m[32m            DashboardActionItem([m
[32m+[m[32m                icon = Icons.Default.Group,[m
[32m+[m[32m                title = "Qu·∫£n l√Ω ng∆∞·ªùi d√πng",[m
[32m+[m[32m                color = Color.Blue,[m
[32m+[m[32m                onClick = { /* TODO */ }[m
[32m+[m[32m            )[m
[32m+[m
[32m+[m[32m            // üü¢ N√öT DUY·ªÜT B√ÅO C√ÅO (Quan tr·ªçng nh·∫•t)[m
[32m+[m[32m            DashboardActionItem([m
[32m+[m[32m                icon = Icons.Default.ReportProblem,[m
[32m+[m[32m                title = "Duy·ªát t√†i li·ªáu / B√°o c√°o vi ph·∫°m",[m
[32m+[m[32m                color = Color.Red,[m
[32m+[m[32m                onClick = onNavigateToReports // G·ªçi callback ƒëi·ªÅu h∆∞·ªõng[m
[32m+[m[32m            )[m
[32m+[m
[32m+[m[32m            // N√∫t G·ª≠i th√¥ng b√°o (Demo)[m
[32m+[m[32m            DashboardActionItem([m
[32m+[m[32m                icon = Icons.Default.Notifications,[m
[32m+[m[32m                title = "G·ª≠i th√¥ng b√°o h·ªá th·ªëng",[m
[32m+[m[32m                color = PrimaryGreen,[m
[32m+[m[32m                onClick = { /* TODO */ }[m
[32m+[m[32m            )[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun StatItem(count: String, label: String, color: Color) {[m
[32m+[m[32m    Column(horizontalAlignment = Alignment.CenterHorizontally) {[m
[32m+[m[32m        Text(text = count, fontSize = 20.sp, fontWeight = FontWeight.Bold, color = color)[m
[32m+[m[32m        Text(text = label, fontSize = 12.sp, color = Color.Gray)[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun DashboardActionItem([m
[32m+[m[32m    icon: ImageVector,[m
[32m+[m[32m    title: String,[m
[32m+[m[32m    color: Color,[m
[32m+[m[32m    onClick: () -> Unit[m
[32m+[m[32m) {[m
[32m+[m[32m    Card([m
[32m+[m[32m        modifier = Modifier[m
[32m+[m[32m            .fillMaxWidth()[m
[32m+[m[32m            .padding(vertical = 8.dp)[m
[32m+[m[32m            .clickable { onClick() },[m
[32m+[m[32m        colors = CardDefaults.cardColors(containerColor = Color.White),[m
[32m+[m[32m        elevation = CardDefaults.cardElevation(2.dp)[m
[32m+[m[32m    ) {[m
[32m+[m[32m        Row([m
[32m+[m[32m            modifier = Modifier.padding(16.dp),[m
[32m+[m[32m            verticalAlignment = Alignment.CenterVertically[m
[32m+[m[32m        ) {[m
[32m+[m[32m            Box([m
[32m+[m[32m                modifier = Modifier[m
[32m+[m[32m                    .size(40.dp)[m
[32m+[m[32m                    .clip(RoundedCornerShape(8.dp))[m
[32m+[m[32m                    .background(color.copy(alpha = 0.1f)),[m
[32m+[m[32m                contentAlignment = Alignment.Center[m
[32m+[m[32m            ) {[m
[32m+[m[32m                Icon(imageVector = icon, contentDescription = null, tint = color)[m
[32m+[m[32m            }[m
[32m+[m[32m            Spacer(Modifier.width(16.dp))[m
[32m+[m[32m            Text(text = title, fontWeight = FontWeight.Medium)[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/features/feature_admin/ui/AdminReportScreen.kt b/app/src/main/java/com/example/stushare/features/feature_admin/ui/AdminReportScreen.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..6f6e29e[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/features/feature_admin/ui/AdminReportScreen.kt[m
[36m@@ -0,0 +1,154 @@[m
[32m+[m[32mpackage com.example.stushare.features.feature_admin.ui[m
[32m+[m
[32m+[m[32mimport android.widget.Toast[m
[32m+[m[32mimport androidx.compose.foundation.background[m
[32m+[m[32mimport androidx.compose.foundation.layout.*[m
[32m+[m[32mimport androidx.compose.foundation.lazy.LazyColumn[m
[32m+[m[32mimport androidx.compose.foundation.lazy.items[m
[32m+[m[32mimport androidx.compose.foundation.shape.RoundedCornerShape[m
[32m+[m[32mimport androidx.compose.material.icons.Icons[m
[32m+[m[32mimport androidx.compose.material.icons.automirrored.filled.ArrowBack[m
[32m+[m[32mimport androidx.compose.material.icons.filled.DeleteForever[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Done[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Visibility[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Warning[m
[32m+[m[32mimport androidx.compose.material3.*[m
[32m+[m[32mimport androidx.compose.runtime.*[m
[32m+[m[32mimport androidx.compose.ui.Alignment[m
[32m+[m[32mimport androidx.compose.ui.Modifier[m
[32m+[m[32mimport androidx.compose.ui.graphics.Color[m
[32m+[m[32mimport androidx.compose.ui.platform.LocalContext[m
[32m+[m[32mimport androidx.compose.ui.text.font.FontWeight[m
[32m+[m[32mimport androidx.compose.ui.text.style.TextOverflow[m
[32m+[m[32mimport androidx.compose.ui.unit.dp[m
[32m+[m[32mimport androidx.compose.ui.unit.sp[m
[32m+[m[32mimport androidx.hilt.navigation.compose.hiltViewModel[m
[32m+[m[32mimport com.example.stushare.core.data.models.Report[m
[32m+[m[32mimport kotlinx.coroutines.flow.collectLatest[m
[32m+[m[32mimport java.text.SimpleDateFormat[m
[32m+[m[32mimport java.util.Locale[m
[32m+[m
[32m+[m[32m@OptIn(ExperimentalMaterial3Api::class)[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun AdminReportScreen([m
[32m+[m[32m    onBackClick: () -> Unit,[m
[32m+[m[32m    onDocumentClick: (String) -> Unit, // Callback m·ªü t√†i li·ªáu[m
[32m+[m[32m    viewModel: AdminViewModel = hiltViewModel()[m
[32m+[m[32m) {[m
[32m+[m[32m    val reports by viewModel.reports.collectAsState()[m
[32m+[m[32m    val isProcessing by viewModel.isProcessing.collectAsState() // üü¢ D√πng ƒë√∫ng bi·∫øn isProcessing[m
[32m+[m[32m    val context = LocalContext.current[m
[32m+[m
[32m+[m[32m    // L·∫Øng nghe Toast th√¥ng b√°o k·∫øt qu·∫£[m
[32m+[m[32m    LaunchedEffect(Unit) {[m
[32m+[m[32m        viewModel.toastMessage.collectLatest { message ->[m
[32m+[m[32m            Toast.makeText(context, message, Toast.LENGTH_SHORT).show()[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    Scaffold([m
[32m+[m[32m        topBar = {[m
[32m+[m[32m            TopAppBar([m
[32m+[m[32m                title = { Text("Qu·∫£n l√Ω vi ph·∫°m", fontWeight = FontWeight.Bold) },[m
[32m+[m[32m                navigationIcon = {[m
[32m+[m[32m                    IconButton(onClick = onBackClick) {[m
[32m+[m[32m                        Icon(Icons.AutoMirrored.Filled.ArrowBack, contentDescription = "Back")[m
[32m+[m[32m                    }[m
[32m+[m[32m                },[m
[32m+[m[32m                colors = TopAppBarDefaults.topAppBarColors([m
[32m+[m[32m                    containerColor = Color(0xFFFFF0F0), // M√†u ƒë·ªè nh·∫°t[m
[32m+[m[32m                    titleContentColor = Color.Red[m
[32m+[m[32m                )[m
[32m+[m[32m            )[m
[32m+[m[32m        }[m
[32m+[m[32m    ) { padding ->[m
[32m+[m[32m        Box([m
[32m+[m[32m            modifier = Modifier[m
[32m+[m[32m                .fillMaxSize()[m
[32m+[m[32m                .padding(padding)[m
[32m+[m[32m                .background(Color(0xFFF5F5F5))[m
[32m+[m[32m        ) {[m
[32m+[m[32m            if (isProcessing) {[m
[32m+[m[32m                CircularProgressIndicator(modifier = Modifier.align(Alignment.Center))[m
[32m+[m[32m            } else if (reports.isEmpty()) {[m
[32m+[m[32m                Column([m
[32m+[m[32m                    modifier = Modifier.align(Alignment.Center),[m
[32m+[m[32m                    horizontalAlignment = Alignment.CenterHorizontally[m
[32m+[m[32m                ) {[m
[32m+[m[32m                    Icon(Icons.Default.Done, null, tint = Color.Green, modifier = Modifier.size(64.dp))[m
[32m+[m[32m                    Spacer(Modifier.height(16.dp))[m
[32m+[m[32m                    Text("S·∫°ch b√≥ng! Kh√¥ng c√≥ b√°o c√°o n√†o.", color = Color.Gray)[m
[32m+[m[32m                }[m
[32m+[m[32m            } else {[m
[32m+[m[32m                LazyColumn([m
[32m+[m[32m                    contentPadding = PaddingValues(16.dp),[m
[32m+[m[32m                    verticalArrangement = Arrangement.spacedBy(12.dp)[m
[32m+[m[32m                ) {[m
[32m+[m[32m                    items(reports) { report ->[m
[32m+[m[32m                        ReportItem([m
[32m+[m[32m                            report = report,[m
[32m+[m[32m                            onDelete = { viewModel.deleteDocument(report.documentId, report.id) },[m
[32m+[m[32m                            onDismiss = { viewModel.dismissReport(report.id) },[m
[32m+[m[32m                            onViewDocument = { onDocumentClick(report.documentId) }[m
[32m+[m[32m                        )[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun ReportItem([m
[32m+[m[32m    report: Report,[m
[32m+[m[32m    onDelete: () -> Unit,[m
[32m+[m[32m    onDismiss: () -> Unit,[m
[32m+[m[32m    onViewDocument: () -> Unit[m
[32m+[m[32m) {[m
[32m+[m[32m    Card([m
[32m+[m[32m        colors = CardDefaults.cardColors(containerColor = Color.White),[m
[32m+[m[32m        elevation = CardDefaults.cardElevation(2.dp),[m
[32m+[m[32m        shape = RoundedCornerShape(12.dp)[m
[32m+[m[32m    ) {[m
[32m+[m[32m        Column(Modifier.padding(16.dp)) {[m
[32m+[m[32m            // Header: L√Ω do[m
[32m+[m[32m            Row(verticalAlignment = Alignment.CenterVertically) {[m
[32m+[m[32m                Icon(Icons.Default.Warning, null, tint = Color.Red, modifier = Modifier.size(20.dp))[m
[32m+[m[32m                Spacer(Modifier.width(8.dp))[m
[32m+[m[32m                Text(report.reason, fontWeight = FontWeight.Bold, color = Color.Red)[m
[32m+[m[32m            }[m
[32m+[m[32m            Spacer(Modifier.height(12.dp))[m
[32m+[m
[32m+[m[32m            // Content[m
[32m+[m[32m            Text("T√†i li·ªáu: ${report.documentTitle.ifBlank { "ID: ${report.documentId}" }}", fontWeight = FontWeight.Medium, maxLines = 1, overflow = TextOverflow.Ellipsis)[m
[32m+[m[32m            Text("Ng∆∞·ªùi b√°o c√°o: ${report.reporterEmail}", style = MaterialTheme.typography.bodySmall, color = Color.Gray)[m
[32m+[m
[32m+[m[32m            val date = try { SimpleDateFormat("dd/MM/yyyy HH:mm", Locale.getDefault()).format(report.timestamp) } catch (e: Exception) { "" }[m
[32m+[m[32m            Text("Ng√†y: $date", style = MaterialTheme.typography.bodySmall, color = Color.Gray)[m
[32m+[m
[32m+[m[32m            HorizontalDivider(Modifier.padding(vertical = 12.dp))[m
[32m+[m
[32m+[m[32m            // Buttons[m
[32m+[m[32m            Row(Modifier.fillMaxWidth(), horizontalArrangement = Arrangement.SpaceBetween) {[m
[32m+[m[32m                TextButton(onClick = onViewDocument) {[m
[32m+[m[32m                    Icon(Icons.Default.Visibility, null, Modifier.size(18.dp))[m
[32m+[m[32m                    Spacer(Modifier.width(4.dp))[m
[32m+[m[32m                    Text("Xem th·ª≠")[m
[32m+[m[32m                }[m
[32m+[m[32m                Row {[m
[32m+[m[32m                    OutlinedButton(onClick = onDismiss, contentPadding = PaddingValues(horizontal = 12.dp)) {[m
[32m+[m[32m                        Text("B·ªè qua", color = Color.Gray)[m
[32m+[m[32m                    }[m
[32m+[m[32m                    Spacer(Modifier.width(8.dp))[m
[32m+[m[32m                    Button([m
[32m+[m[32m                        onClick = onDelete,[m
[32m+[m[32m                        colors = ButtonDefaults.buttonColors(containerColor = Color.Red),[m
[32m+[m[32m                        contentPadding = PaddingValues(horizontal = 12.dp)[m
[32m+[m[32m                    ) {[m
[32m+[m[32m                        Text("X√≥a")[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/features/feature_admin/ui/AdminScreen.kt b/app/src/main/java/com/example/stushare/features/feature_admin/ui/AdminScreen.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..9c7fa9e[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/features/feature_admin/ui/AdminScreen.kt[m
[36m@@ -0,0 +1,127 @@[m
[32m+[m[32mpackage com.example.stushare.features.feature_admin.ui[m
[32m+[m
[32m+[m[32mimport androidx.compose.foundation.background[m
[32m+[m[32mimport androidx.compose.foundation.layout.*[m
[32m+[m[32mimport androidx.compose.foundation.shape.RoundedCornerShape[m
[32m+[m[32mimport androidx.compose.material.icons.Icons[m
[32m+[m[32mimport androidx.compose.material.icons.automirrored.filled.ArrowBack[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Notifications[m
[32m+[m[32mimport androidx.compose.material.icons.filled.People[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Report[m
[32m+[m[32mimport androidx.compose.material3.*[m
[32m+[m[32mimport androidx.compose.runtime.Composable[m
[32m+[m[32mimport androidx.compose.runtime.getValue[m
[32m+[m[32mimport androidx.compose.ui.Alignment[m
[32m+[m[32mimport androidx.compose.ui.Modifier[m
[32m+[m[32mimport androidx.compose.ui.graphics.Color[m
[32m+[m[32mimport androidx.compose.ui.graphics.vector.ImageVector[m
[32m+[m[32mimport androidx.compose.ui.text.font.FontWeight[m
[32m+[m[32mimport androidx.compose.ui.unit.dp[m
[32m+[m[32mimport androidx.compose.ui.unit.sp[m
[32m+[m[32mimport androidx.hilt.navigation.compose.hiltViewModel[m
[32m+[m[32mimport androidx.lifecycle.compose.collectAsStateWithLifecycle // Import n√†y quan tr·ªçng[m
[32m+[m[32mimport com.example.stushare.ui.theme.PrimaryGreen[m
[32m+[m
[32m+[m[32m@OptIn(ExperimentalMaterial3Api::class)[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun AdminScreen([m
[32m+[m[32m    onBackClick: () -> Unit,[m
[32m+[m[32m    // üü¢ Inject ViewModel[m
[32m+[m[32m    viewModel: AdminViewModel = hiltViewModel()[m
[32m+[m[32m) {[m
[32m+[m[32m    // üü¢ L·∫Øng nghe d·ªØ li·ªáu th·∫≠t[m
[32m+[m[32m    val uiState by viewModel.uiState.collectAsStateWithLifecycle()[m
[32m+[m
[32m+[m[32m    Scaffold([m
[32m+[m[32m        topBar = {[m
[32m+[m[32m            TopAppBar([m
[32m+[m[32m                title = { Text("Admin Dashboard", fontWeight = FontWeight.Bold) },[m
[32m+[m[32m                navigationIcon = {[m
[32m+[m[32m                    IconButton(onClick = onBackClick) {[m
[32m+[m[32m                        Icon(Icons.AutoMirrored.Filled.ArrowBack, contentDescription = null)[m
[32m+[m[32m                    }[m
[32m+[m[32m                },[m
[32m+[m[32m                colors = TopAppBarDefaults.topAppBarColors([m
[32m+[m[32m                    containerColor = Color.White,[m
[32m+[m[32m                    titleContentColor = Color.Black[m
[32m+[m[32m                )[m
[32m+[m[32m            )[m
[32m+[m[32m        },[m
[32m+[m[32m        containerColor = Color(0xFFF5F5F5)[m
[32m+[m[32m    ) { padding ->[m
[32m+[m[32m        Column([m
[32m+[m[32m            modifier = Modifier[m
[32m+[m[32m                .padding(padding)[m
[32m+[m[32m                .padding(16.dp)[m
[32m+[m[32m                .fillMaxSize()[m
[32m+[m[32m        ) {[m
[32m+[m[32m            // Th·∫ª th·ªëng k√™[m
[32m+[m[32m            Card([m
[32m+[m[32m                modifier = Modifier.fillMaxWidth().padding(bottom = 24.dp),[m
[32m+[m[32m                colors = CardDefaults.cardColors(containerColor = Color.White),[m
[32m+[m[32m                elevation = CardDefaults.cardElevation(2.dp)[m
[32m+[m[32m            ) {[m
[32m+[m[32m                Column(modifier = Modifier.padding(16.dp)) {[m
[32m+[m[32m                    Row([m
[32m+[m[32m                        modifier = Modifier.fillMaxWidth(),[m
[32m+[m[32m                        horizontalArrangement = Arrangement.SpaceBetween,[m
[32m+[m[32m                        verticalAlignment = Alignment.CenterVertically[m
[32m+[m[32m                    ) {[m
[32m+[m[32m                        Text("T·ªïng quan h·ªá th·ªëng", style = MaterialTheme.typography.titleMedium, fontWeight = FontWeight.Bold)[m
[32m+[m[32m                        // N√∫t refresh nh·ªè[m
[32m+[m[32m                        if (uiState.isLoading) {[m
[32m+[m[32m                            CircularProgressIndicator(modifier = Modifier.size(20.dp), strokeWidth = 2.dp, color = PrimaryGreen)[m
[32m+[m[32m                        }[m
[32m+[m[32m                    }[m
[32m+[m
[32m+[m[32m                    Spacer(Modifier.height(16.dp))[m
[32m+[m
[32m+[m[32m                    // üü¢ HI·ªÇN TH·ªä S·ªê LI·ªÜU TH·∫¨T T·ª™ STATE[m
[32m+[m[32m                    Row(Modifier.fillMaxWidth(), horizontalArrangement = Arrangement.SpaceBetween) {[m
[32m+[m[32m                        StatBox("Ng∆∞·ªùi d√πng", uiState.userCount, PrimaryGreen)[m
[32m+[m[32m                        StatBox("T√†i li·ªáu", uiState.docCount, Color(0xFFFF9800))[m
[32m+[m[32m                        StatBox("Y√™u c·∫ßu", uiState.requestCount, Color.Red)[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            Text("Ch·ª©c nƒÉng qu·∫£n l√Ω", style = MaterialTheme.typography.titleMedium, fontWeight = FontWeight.Bold)[m
[32m+[m[32m            Spacer(Modifier.height(12.dp))[m
[32m+[m
[32m+[m[32m            // C√°c n√∫t ch·ª©c nƒÉng (Hi·ªán t·∫°i v·∫´n ch∆∞a c√≥ logic, s·∫Ω l√†m ·ªü c√°c b√†i sau)[m
[32m+[m[32m            AdminActionButton("Qu·∫£n l√Ω ng∆∞·ªùi d√πng", Icons.Default.People, Color.Blue) { /* TODO */ }[m
[32m+[m[32m            AdminActionButton("Duy·ªát t√†i li·ªáu/Y√™u c·∫ßu", Icons.Default.Report, Color.Red) { /* TODO */ }[m
[32m+[m[32m            AdminActionButton("G·ª≠i th√¥ng b√°o h·ªá th·ªëng", Icons.Default.Notifications, Color(0xFF00796B)) { /* TODO */ }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m// ... (Gi·ªØ nguy√™n StatBox v√† AdminActionButton nh∆∞ c≈©)[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun StatBox(label: String, count: String, color: Color) {[m
[32m+[m[32m    Column(horizontalAlignment = Alignment.CenterHorizontally) {[m
[32m+[m[32m        Text(count, fontSize = 20.sp, fontWeight = FontWeight.Bold, color = color)[m
[32m+[m[32m        Text(label, fontSize = 12.sp, color = Color.Gray)[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun AdminActionButton(text: String, icon: ImageVector, iconColor: Color, onClick: () -> Unit) {[m
[32m+[m[32m    Button([m
[32m+[m[32m        onClick = onClick,[m
[32m+[m[32m        modifier = Modifier.fillMaxWidth().padding(vertical = 6.dp).height(56.dp),[m
[32m+[m[32m        colors = ButtonDefaults.buttonColors(containerColor = Color.White),[m
[32m+[m[32m        shape = RoundedCornerShape(12.dp),[m
[32m+[m[32m        elevation = ButtonDefaults.buttonElevation(2.dp)[m
[32m+[m[32m    ) {[m
[32m+[m[32m        Row([m
[32m+[m[32m            modifier = Modifier.fillMaxWidth(),[m
[32m+[m[32m            verticalAlignment = Alignment.CenterVertically,[m
[32m+[m[32m            horizontalArrangement = Arrangement.Start[m
[32m+[m[32m        ) {[m
[32m+[m[32m            Icon(icon, null, tint = iconColor)[m
[32m+[m[32m            Spacer(Modifier.width(16.dp))[m
[32m+[m[32m            Text(text, color = Color.Black, fontSize = 16.sp)[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/features/feature_admin/ui/AdminViewModel.kt b/app/src/main/java/com/example/stushare/features/feature_admin/ui/AdminViewModel.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..0c96e9c[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/features/feature_admin/ui/AdminViewModel.kt[m
[36m@@ -0,0 +1,121 @@[m
[32m+[m[32mpackage com.example.stushare.features.feature_admin.ui[m
[32m+[m
[32m+[m[32mimport androidx.lifecycle.ViewModel[m
[32m+[m[32mimport androidx.lifecycle.viewModelScope[m
[32m+[m[32mimport com.example.stushare.core.data.models.Report // üü¢ Import Model Report[m
[32m+[m[32mimport com.example.stushare.core.data.repository.AdminRepository[m
[32m+[m[32mimport dagger.hilt.android.lifecycle.HiltViewModel[m
[32m+[m[32mimport kotlinx.coroutines.flow.MutableSharedFlow[m
[32m+[m[32mimport kotlinx.coroutines.flow.MutableStateFlow[m
[32m+[m[32mimport kotlinx.coroutines.flow.asSharedFlow[m
[32m+[m[32mimport kotlinx.coroutines.flow.asStateFlow[m
[32m+[m[32mimport kotlinx.coroutines.launch[m
[32m+[m[32mimport javax.inject.Inject[m
[32m+[m
[32m+[m[32m// Gi·ªØ nguy√™n State c≈© cho ph·∫ßn th·ªëng k√™[m
[32m+[m[32mdata class AdminUiState([m
[32m+[m[32m    val userCount: String = "-",[m
[32m+[m[32m    val docCount: String = "-",[m
[32m+[m[32m    val requestCount: String = "-",[m
[32m+[m[32m    val isLoading: Boolean = true[m
[32m+[m[32m)[m
[32m+[m
[32m+[m[32m@HiltViewModel[m
[32m+[m[32mclass AdminViewModel @Inject constructor([m
[32m+[m[32m    private val adminRepository: AdminRepository[m
[32m+[m[32m) : ViewModel() {[m
[32m+[m
[32m+[m[32m    // 1. State cho Th·ªëng k√™ (Dashboard Stats)[m
[32m+[m[32m    private val _uiState = MutableStateFlow(AdminUiState())[m
[32m+[m[32m    val uiState = _uiState.asStateFlow()[m
[32m+[m
[32m+[m[32m    // 2. State cho Danh s√°ch B√°o c√°o (Report List) - üü¢ M·ªöI[m
[32m+[m[32m    private val _reports = MutableStateFlow<List<Report>>(emptyList())[m
[32m+[m[32m    val reports = _reports.asStateFlow()[m
[32m+[m
[32m+[m[32m    // 3. S·ª± ki·ªán th√¥ng b√°o (Toast) - üü¢ M·ªöI[m
[32m+[m[32m    private val _toastMessage = MutableSharedFlow<String>()[m
[32m+[m[32m    val toastMessage = _toastMessage.asSharedFlow()[m
[32m+[m
[32m+[m[32m    // 4. Loading ri√™ng cho c√°c thao t√°c x·ª≠ l√Ω report (ƒë·ªÉ kh√¥ng ·∫£nh h∆∞·ªüng UI th·ªëng k√™)[m
[32m+[m[32m    private val _isProcessing = MutableStateFlow(false)[m
[32m+[m[32m    val isProcessing = _isProcessing.asStateFlow()[m
[32m+[m
[32m+[m[32m    init {[m
[32m+[m[32m        loadStats()[m
[32m+[m[32m        loadReports() // üü¢ G·ªçi th√™m h√†m t·∫£i danh s√°ch b√°o c√°o[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    // ==========================================[m
[32m+[m[32m    // PH·∫¶N C≈®: TH·ªêNG K√ä[m
[32m+[m[32m    // ==========================================[m
[32m+[m[32m    fun loadStats() {[m
[32m+[m[32m        viewModelScope.launch {[m
[32m+[m[32m            _uiState.value = _uiState.value.copy(isLoading = true)[m
[32m+[m[32m            try {[m
[32m+[m[32m                val stats = adminRepository.getSystemStats()[m
[32m+[m[32m                _uiState.value = AdminUiState([m
[32m+[m[32m                    userCount = stats.userCount.toString(),[m
[32m+[m[32m                    docCount = stats.documentCount.toString(),[m
[32m+[m[32m                    requestCount = stats.requestCount.toString(),[m
[32m+[m[32m                    isLoading = false[m
[32m+[m[32m                )[m
[32m+[m[32m            } catch (e: Exception) {[m
[32m+[m[32m                e.printStackTrace()[m
[32m+[m[32m                _uiState.value = _uiState.value.copy(isLoading = false)[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    // ==========================================[m
[32m+[m[32m    // PH·∫¶N M·ªöI: QU·∫¢N L√ù B√ÅO C√ÅO[m
[32m+[m[32m    // ==========================================[m
[32m+[m
[32m+[m[32m    fun loadReports() {[m
[32m+[m[32m        viewModelScope.launch {[m
[32m+[m[32m            // Ch·ªâ hi·ªán loading n·∫øu danh s√°ch ƒëang r·ªóng (l·∫ßn ƒë·∫ßu t·∫£i)[m
[32m+[m[32m            if (_reports.value.isEmpty()) _isProcessing.value = true[m
[32m+[m
[32m+[m[32m            adminRepository.getPendingReports()[m
[32m+[m[32m                .onSuccess { list ->[m
[32m+[m[32m                    _reports.value = list[m
[32m+[m[32m                }[m
[32m+[m[32m                .onFailure { e ->[m
[32m+[m[32m                    _toastMessage.emit("L·ªói t·∫£i b√°o c√°o: ${e.message}")[m
[32m+[m[32m                }[m
[32m+[m[32m            _isProcessing.value = false[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    // X√≥a t√†i li·ªáu vi ph·∫°m[m
[32m+[m[32m    fun deleteDocument(docId: String, reportId: String) {[m
[32m+[m[32m        viewModelScope.launch {[m
[32m+[m[32m            _isProcessing.value = true[m
[32m+[m[32m            adminRepository.deleteDocumentAndResolveReport(docId, reportId)[m
[32m+[m[32m                .onSuccess {[m
[32m+[m[32m                    _toastMessage.emit("ƒê√£ x√≥a t√†i li·ªáu v√† x·ª≠ l√Ω b√°o c√°o ‚úÖ")[m
[32m+[m[32m                    // T·∫£i l·∫°i d·ªØ li·ªáu ƒë·ªÉ c·∫≠p nh·∫≠t danh s√°ch v√† s·ªë l∆∞·ª£ng[m
[32m+[m[32m                    loadReports()[m
[32m+[m[32m                    loadStats()[m
[32m+[m[32m                }[m
[32m+[m[32m                .onFailure { e ->[m
[32m+[m[32m                    _toastMessage.emit("L·ªói x√≥a: ${e.message}")[m
[32m+[m[32m                }[m
[32m+[m[32m            _isProcessing.value = false[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    // B·ªè qua b√°o c√°o (gi·ªØ l·∫°i t√†i li·ªáu)[m
[32m+[m[32m    fun dismissReport(reportId: String) {[m
[32m+[m[32m        viewModelScope.launch {[m
[32m+[m[32m            adminRepository.dismissReport(reportId)[m
[32m+[m[32m                .onSuccess {[m
[32m+[m[32m                    _toastMessage.emit("ƒê√£ b·ªè qua b√°o c√°o n√†y")[m
[32m+[m[32m                    loadReports() // Refresh list[m
[32m+[m[32m                }[m
[32m+[m[32m                .onFailure { e ->[m
[32m+[m[32m                    _toastMessage.emit("L·ªói: ${e.message}")[m
[32m+[m[32m                }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/features/feature_home/ui/components/BottomNavBar.kt b/app/src/main/java/com/example/stushare/features/feature_home/ui/components/BottomNavBar.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..830db14[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/features/feature_home/ui/components/BottomNavBar.kt[m
[36m@@ -0,0 +1,183 @@[m
[32m+[m[32mpackage com.example.stushare.features.feature_home.ui.components[m
[32m+[m
[32m+[m[32mimport androidx.compose.foundation.background[m
[32m+[m[32mimport androidx.compose.foundation.clickable[m
[32m+[m[32mimport androidx.compose.foundation.interaction.MutableInteractionSource[m
[32m+[m[32mimport androidx.compose.foundation.layout.*[m
[32m+[m[32mimport androidx.compose.foundation.shape.CircleShape[m
[32m+[m[32mimport androidx.compose.foundation.shape.RoundedCornerShape[m
[32m+[m[32mimport androidx.compose.material.icons.Icons[m
[32m+[m[32mimport androidx.compose.material.icons.filled.*[m
[32m+[m[32mimport androidx.compose.material.icons.outlined.*[m
[32m+[m[32mimport androidx.compose.material3.*[m
[32m+[m[32mimport androidx.compose.runtime.Composable[m
[32m+[m[32mimport androidx.compose.runtime.getValue[m
[32m+[m[32mimport androidx.compose.runtime.remember[m
[32m+[m[32mimport androidx.compose.ui.Alignment[m
[32m+[m[32mimport androidx.compose.ui.Modifier[m
[32m+[m[32mimport androidx.compose.ui.draw.clip[m
[32m+[m[32mimport androidx.compose.ui.draw.shadow[m
[32m+[m[32mimport androidx.compose.ui.graphics.Color[m
[32m+[m[32mimport androidx.compose.ui.graphics.vector.ImageVector[m
[32m+[m[32mimport androidx.compose.ui.res.stringResource[m
[32m+[m[32mimport androidx.compose.ui.unit.dp[m
[32m+[m[32mimport androidx.compose.ui.unit.sp[m
[32m+[m[32mimport androidx.navigation.NavController[m
[32m+[m[32mimport androidx.navigation.NavDestination.Companion.hasRoute[m
[32m+[m[32mimport androidx.navigation.NavGraph.Companion.findStartDestination[m
[32m+[m[32mimport androidx.navigation.compose.currentBackStackEntryAsState[m
[32m+[m[32mimport com.example.stushare.R[m
[32m+[m[32mimport com.example.stushare.core.navigation.NavRoute[m
[32m+[m[32mimport com.example.stushare.ui.theme.PrimaryGreen[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun BottomNavBar([m
[32m+[m[32m    navController: NavController,[m
[32m+[m[32m    unreadNotificationCount: Int = 0[m
[32m+[m[32m) {[m
[32m+[m[32m    val navBackStackEntry by navController.currentBackStackEntryAsState()[m
[32m+[m[32m    val currentDestination = navBackStackEntry?.destination[m
[32m+[m
[32m+[m[32m    // T·ªëi ∆∞u: Ch·ªâ t·∫°o l·∫°i danh s√°ch khi s·ªë l∆∞·ª£ng th√¥ng b√°o thay ƒë·ªïi[m
[32m+[m[32m    val leftItems = remember {[m
[32m+[m[32m        listOf([m
[32m+[m[32m            NavigationItem(title = "Trang ch·ªß", selectedIcon = Icons.Filled.Home, unselectedIcon = Icons.Outlined.Home, route = NavRoute.Home),[m
[32m+[m[32m            NavigationItem(title = "T√¨m ki·∫øm", selectedIcon = Icons.Filled.Search, unselectedIcon = Icons.Outlined.Search, route = NavRoute.Search)[m
[32m+[m[32m        )[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    val rightItems = remember(unreadNotificationCount) {[m
[32m+[m[32m        listOf([m
[32m+[m[32m            NavigationItem([m
[32m+[m[32m                title = "Th√¥ng b√°o",[m
[32m+[m[32m                selectedIcon = Icons.Filled.Notifications,[m
[32m+[m[32m                unselectedIcon = Icons.Outlined.Notifications,[m
[32m+[m[32m                route = NavRoute.Notification,[m
[32m+[m[32m                badgeCount = unreadNotificationCount[m
[32m+[m[32m            ),[m
[32m+[m[32m            NavigationItem(title = "C√° nh√¢n", selectedIcon = Icons.Filled.Person, unselectedIcon = Icons.Outlined.Person, route = NavRoute.Profile)[m
[32m+[m[32m        )[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    Box([m
[32m+[m[32m        modifier = Modifier.fillMaxWidth().height(100.dp),[m
[32m+[m[32m        contentAlignment = Alignment.BottomCenter[m
[32m+[m[32m    ) {[m
[32m+[m[32m        // 1. N·ªÅn thanh Bar[m
[32m+[m[32m        Surface([m
[32m+[m[32m            modifier = Modifier[m
[32m+[m[32m                .fillMaxWidth()[m
[32m+[m[32m                .height(64.dp)[m
[32m+[m[32m                .clip(RoundedCornerShape(topStart = 24.dp, topEnd = 24.dp)),[m
[32m+[m[32m            color = PrimaryGreen,[m
[32m+[m[32m            shadowElevation = 10.dp[m
[32m+[m[32m        ) {[m
[32m+[m[32m            Row([m
[32m+[m[32m                modifier = Modifier.fillMaxSize(),[m
[32m+[m[32m                horizontalArrangement = Arrangement.SpaceBetween,[m
[32m+[m[32m                verticalAlignment = Alignment.CenterVertically[m
[32m+[m[32m            ) {[m
[32m+[m[32m                // Tr√°i[m
[32m+[m[32m                Row(modifier = Modifier.weight(1f), horizontalArrangement = Arrangement.SpaceEvenly) {[m
[32m+[m[32m                    leftItems.forEach { item ->[m
[32m+[m[32m                        BottomNavItem(item, currentDestination?.hasRoute(item.route::class) == true) {[m
[32m+[m[32m                            navigateSafe(navController, item.route)[m
[32m+[m[32m                        }[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m                // Gi·ªØa (Kho·∫£ng tr·ªëng cho n√∫t Upload)[m
[32m+[m[32m                Spacer(modifier = Modifier.size(60.dp))[m
[32m+[m[32m                // Ph·∫£i[m
[32m+[m[32m                Row(modifier = Modifier.weight(1f), horizontalArrangement = Arrangement.SpaceEvenly) {[m
[32m+[m[32m                    rightItems.forEach { item ->[m
[32m+[m[32m                        BottomNavItem(item, currentDestination?.hasRoute(item.route::class) == true) {[m
[32m+[m[32m                            navigateSafe(navController, item.route)[m
[32m+[m[32m                        }[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        // 2. N√∫t Upload (N·ªïi ·ªü gi·ªØa)[m
[32m+[m[32m        Box([m
[32m+[m[32m            modifier = Modifier[m
[32m+[m[32m                .align(Alignment.TopCenter)[m
[32m+[m[32m                .offset(y = 10.dp)[m
[32m+[m[32m                .size(64.dp)[m
[32m+[m[32m                .clip(CircleShape)[m
[32m+[m[32m                .background(Color.White)[m
[32m+[m[32m                .clickable { navigateSafe(navController, NavRoute.Upload) }[m
[32m+[m[32m                .shadow(8.dp, CircleShape),[m
[32m+[m[32m            contentAlignment = Alignment.Center[m
[32m+[m[32m        ) {[m
[32m+[m[32m            Box([m
[32m+[m[32m                modifier = Modifier.size(54.dp).clip(CircleShape).background(PrimaryGreen),[m
[32m+[m[32m                contentAlignment = Alignment.Center[m
[32m+[m[32m            ) {[m
[32m+[m[32m                Icon([m
[32m+[m[32m                    imageVector = Icons.Default.Add,[m
[32m+[m[32m                    contentDescription = stringResource(R.string.upload_header),[m
[32m+[m[32m                    tint = Color.White,[m
[32m+[m[32m                    modifier = Modifier.size(32.dp)[m
[32m+[m[32m                )[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m@OptIn(ExperimentalMaterial3Api::class)[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun BottomNavItem(item: NavigationItem, isSelected: Boolean, onClick: () -> Unit) {[m
[32m+[m[32m    Column([m
[32m+[m[32m        horizontalAlignment = Alignment.CenterHorizontally,[m
[32m+[m[32m        verticalArrangement = Arrangement.Center,[m
[32m+[m[32m        modifier = Modifier[m
[32m+[m[32m            .clickable([m
[32m+[m[32m                interactionSource = remember { MutableInteractionSource() },[m
[32m+[m[32m                indication = null[m
[32m+[m[32m            ) { onClick() }[m
[32m+[m[32m            .padding(8.dp)[m
[32m+[m[32m    ) {[m
[32m+[m[32m        BadgedBox([m
[32m+[m[32m            badge = {[m
[32m+[m[32m                if (item.badgeCount > 0) {[m
[32m+[m[32m                    Badge([m
[32m+[m[32m                        containerColor = Color.Red, // M√†u ƒë·ªè n·ªïi b·∫≠t[m
[32m+[m[32m                        contentColor = Color.White,[m
[32m+[m[32m                        modifier = Modifier[m
[32m+[m[32m                            // ƒêi·ªÅu ch·ªânh offset ƒë·ªÉ ch·∫•m n·∫±m g√≥c tr√™n b√™n ph·∫£i ƒë·∫πp h∆°n[m
[32m+[m[32m                            .offset(x = 4.dp, y = (-4).dp)[m
[32m+[m[32m                            .size(8.dp)[m
[32m+[m[32m                    )[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m[32m        ) {[m
[32m+[m[32m            Icon([m
[32m+[m[32m                imageVector = if (isSelected) item.selectedIcon else item.unselectedIcon,[m
[32m+[m[32m                contentDescription = item.title,[m
[32m+[m[32m                tint = if (isSelected) Color.White else Color.White.copy(alpha = 0.6f),[m
[32m+[m[32m                modifier = Modifier.size(26.dp)[m
[32m+[m[32m            )[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        if (isSelected) {[m
[32m+[m[32m            Text(text = item.title, fontSize = 10.sp, color = Color.White)[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32mfun navigateSafe(navController: NavController, route: NavRoute) {[m
[32m+[m[32m    navController.navigate(route) {[m
[32m+[m[32m        popUpTo(navController.graph.findStartDestination().id) { saveState = true }[m
[32m+[m[32m        launchSingleTop = true[m
[32m+[m[32m        restoreState = true[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32mdata class NavigationItem([m
[32m+[m[32m    val title: String,[m
[32m+[m[32m    val selectedIcon: ImageVector,[m
[32m+[m[32m    val unselectedIcon: ImageVector,[m
[32m+[m[32m    val route: NavRoute,[m
[32m+[m[32m    val badgeCount: Int = 0[m
[32m+[m[32m)[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/features/feature_home/ui/components/DocumentCard.kt b/app/src/main/java/com/example/stushare/features/feature_home/ui/components/DocumentCard.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..adf0e18[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/features/feature_home/ui/components/DocumentCard.kt[m
[36m@@ -0,0 +1,138 @@[m
[32m+[m[32mpackage com.example.stushare.features.feature_home.ui.components[m
[32m+[m
[32m+[m[32mimport androidx.compose.foundation.background[m
[32m+[m[32mimport androidx.compose.foundation.layout.*[m
[32m+[m[32mimport androidx.compose.foundation.shape.RoundedCornerShape[m
[32m+[m[32mimport androidx.compose.material.icons.Icons[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Star[m
[32m+[m[32mimport androidx.compose.material3.*[m
[32m+[m[32mimport androidx.compose.runtime.Composable[m
[32m+[m[32mimport androidx.compose.runtime.remember[m
[32m+[m[32mimport androidx.compose.ui.Alignment[m
[32m+[m[32mimport androidx.compose.ui.Modifier[m
[32m+[m[32mimport androidx.compose.ui.draw.clip[m
[32m+[m[32mimport androidx.compose.ui.graphics.Color[m
[32m+[m[32mimport androidx.compose.ui.layout.ContentScale[m
[32m+[m[32mimport androidx.compose.ui.text.font.FontWeight[m
[32m+[m[32mimport androidx.compose.ui.text.style.TextOverflow[m
[32m+[m[32mimport androidx.compose.ui.unit.dp[m
[32m+[m[32mimport coil.compose.AsyncImage[m
[32m+[m[32mimport com.example.stushare.core.data.models.Document[m
[32m+[m[32mimport com.example.stushare.ui.theme.PrimaryGreen[m
[32m+[m
[32m+[m[32m@OptIn(ExperimentalMaterial3Api::class)[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun DocumentCard([m
[32m+[m[32m    document: Document,[m
[32m+[m[32m    onClick: () -> Unit,[m
[32m+[m[32m    modifier: Modifier = Modifier[m
[32m+[m[32m) {[m
[32m+[m[32m    // üü¢ C·∫¨P NH·∫¨T LOGIC D·ªäCH T√äN (Th√™m d√≤ng 'lecture')[m
[32m+[m[32m    val displayType = remember(document.type) {[m
[32m+[m[32m        when (document.type) {[m
[32m+[m[32m            "exam_review" -> "T√†i li·ªáu √¥n thi"[m
[32m+[m[32m            "book", "S√°ch" -> "S√°ch"[m
[32m+[m[32m            "lecture", "slide" -> "B√†i gi·∫£ng" // ‚úÖ ƒê√£ th√™m d√≤ng n√†y[m
[32m+[m[32m            else -> document.type // C√°c tr∆∞·ªùng h·ª£p kh√°c gi·ªØ nguy√™n[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    // Logic hi·ªÉn th·ªã Rating (Gi·ªØ nguy√™n)[m
[32m+[m[32m    val safeRating = document.rating ?: 0.0[m
[32m+[m[32m    val hasRating = safeRating > 0.0[m
[32m+[m
[32m+[m[32m    Card([m
[32m+[m[32m        onClick = onClick,[m
[32m+[m[32m        modifier = modifier[m
[32m+[m[32m            .width(160.dp)[m
[32m+[m[32m            .wrapContentHeight(),[m
[32m+[m[32m        shape = RoundedCornerShape(16.dp),[m
[32m+[m[32m        colors = CardDefaults.cardColors([m
[32m+[m[32m            containerColor = MaterialTheme.colorScheme.surface,[m
[32m+[m[32m        ),[m
[32m+[m[32m        elevation = CardDefaults.cardElevation(defaultElevation = 3.dp)[m
[32m+[m[32m    ) {[m
[32m+[m[32m        Column([m
[32m+[m[32m            modifier = Modifier[m
[32m+[m[32m                .fillMaxSize()[m
[32m+[m[32m                .padding(12.dp)[m
[32m+[m[32m        ) {[m
[32m+[m[32m            // ·∫¢nh b√¨a[m
[32m+[m[32m            AsyncImage([m
[32m+[m[32m                model = document.imageUrl,[m
[32m+[m[32m                contentDescription = document.title,[m
[32m+[m[32m                modifier = Modifier[m
[32m+[m[32m                    .fillMaxWidth()[m
[32m+[m[32m                    .aspectRatio(1f)[m
[32m+[m[32m                    .clip(RoundedCornerShape(12.dp)),[m
[32m+[m[32m                contentScale = ContentScale.Crop[m
[32m+[m[32m            )[m
[32m+[m
[32m+[m[32m            Spacer(modifier = Modifier.height(12.dp))[m
[32m+[m
[32m+[m[32m            // Ti√™u ƒë·ªÅ[m
[32m+[m[32m            Text([m
[32m+[m[32m                text = document.title,[m
[32m+[m[32m                style = MaterialTheme.typography.titleMedium.copy([m
[32m+[m[32m                    fontWeight = FontWeight.SemiBold[m
[32m+[m[32m                ),[m
[32m+[m[32m                maxLines = 2,[m
[32m+[m[32m                overflow = TextOverflow.Ellipsis,[m
[32m+[m[32m                modifier = Modifier.heightIn(min = 48.dp),[m
[32m+[m[32m                color = MaterialTheme.colorScheme.onSurface[m
[32m+[m[32m            )[m
[32m+[m
[32m+[m[32m            Spacer(modifier = Modifier.height(6.dp))[m
[32m+[m
[32m+[m[32m            // Lo·∫°i t√†i li·ªáu (ƒê√£ ƒë∆∞·ª£c d·ªãch)[m
[32m+[m[32m            Text([m
[32m+[m[32m                text = displayType, // ‚úÖ Hi·ªÉn th·ªã ti·∫øng Vi·ªát[m
[32m+[m[32m                style = MaterialTheme.typography.bodySmall,[m
[32m+[m[32m                color = PrimaryGreen,[m
[32m+[m[32m                fontWeight = FontWeight.Bold[m
[32m+[m[32m            )[m
[32m+[m
[32m+[m[32m            Spacer(modifier = Modifier.height(12.dp))[m
[32m+[m
[32m+[m[32m            // Footer (Rating & L∆∞·ª£t t·∫£i)[m
[32m+[m[32m            Row([m
[32m+[m[32m                modifier = Modifier.fillMaxWidth(),[m
[32m+[m[32m                verticalAlignment = Alignment.CenterVertically,[m
[32m+[m[32m                horizontalArrangement = Arrangement.SpaceBetween[m
[32m+[m[32m            ) {[m
[32m+[m[32m                if (hasRating) {[m
[32m+[m[32m                    Row(verticalAlignment = Alignment.CenterVertically) {[m
[32m+[m[32m                        Icon([m
[32m+[m[32m                            imageVector = Icons.Filled.Star,[m
[32m+[m[32m                            contentDescription = "Rating",[m
[32m+[m[32m                            modifier = Modifier.size(14.dp),[m
[32m+[m[32m                            tint = Color(0xFFFFC107)[m
[32m+[m[32m                        )[m
[32m+[m[32m                        Spacer(Modifier.width(4.dp))[m
[32m+[m[32m                        Text([m
[32m+[m[32m                            text = "%.1f".format(safeRating),[m
[32m+[m[32m                            style = MaterialTheme.typography.bodySmall,[m
[32m+[m[32m                            fontWeight = FontWeight.Bold,[m
[32m+[m[32m                            color = MaterialTheme.colorScheme.onSurface[m
[32m+[m[32m                        )[m
[32m+[m[32m                    }[m
[32m+[m[32m                } else {[m
[32m+[m[32m                    Text([m
[32m+[m[32m                        text = "M·ªõi",[m
[32m+[m[32m                        style = MaterialTheme.typography.labelSmall,[m
[32m+[m[32m                        color = Color.White,[m
[32m+[m[32m                        modifier = Modifier[m
[32m+[m[32m                            .background(Color(0xFFFF9800), RoundedCornerShape(4.dp))[m
[32m+[m[32m                            .padding(horizontal = 6.dp, vertical = 2.dp)[m
[32m+[m[32m                    )[m
[32m+[m[32m                }[m
[32m+[m
[32m+[m[32m                Text([m
[32m+[m[32m                    text = "${document.downloads} t·∫£i",[m
[32m+[m[32m                    style = MaterialTheme.typography.labelSmall,[m
[32m+[m[32m                    color = MaterialTheme.colorScheme.onSurfaceVariant[m
[32m+[m[32m                )[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/features/feature_home/ui/components/DocumentCardSkeleton.kt b/app/src/main/java/com/example/stushare/features/feature_home/ui/components/DocumentCardSkeleton.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..090d645[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/features/feature_home/ui/components/DocumentCardSkeleton.kt[m
[36m@@ -0,0 +1,116 @@[m
[32m+[m[32mpackage com.example.stushare.features.feature_home.ui.components[m
[32m+[m
[32m+[m[32mimport androidx.compose.animation.core.*[m
[32m+[m[32mimport androidx.compose.foundation.background[m
[32m+[m[32mimport androidx.compose.foundation.layout.*[m
[32m+[m[32mimport androidx.compose.foundation.shape.RoundedCornerShape[m
[32m+[m[32mimport androidx.compose.material3.Card[m
[32m+[m[32mimport androidx.compose.material3.CardDefaults[m
[32m+[m[32mimport androidx.compose.runtime.Composable[m
[32m+[m[32mimport androidx.compose.ui.Modifier[m
[32m+[m[32mimport androidx.compose.ui.draw.clip[m
[32m+[m[32mimport androidx.compose.ui.geometry.Offset[m
[32m+[m[32mimport androidx.compose.ui.graphics.Brush[m
[32m+[m[32mimport androidx.compose.ui.graphics.Color[m
[32m+[m[32mimport androidx.compose.ui.tooling.preview.Preview[m
[32m+[m[32mimport androidx.compose.ui.unit.dp[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun DocumentCardSkeleton(modifier: Modifier = Modifier) {[m
[32m+[m[32m    // Shimmer effect[m
[32m+[m[32m    val shimmerColors = listOf([m
[32m+[m[32m        Color.LightGray.copy(alpha = 0.6f),[m
[32m+[m[32m        Color.LightGray.copy(alpha = 0.2f),[m
[32m+[m[32m        Color.LightGray.copy(alpha = 0.6f),[m
[32m+[m[32m    )[m
[32m+[m
[32m+[m[32m    val transition = rememberInfiniteTransition(label = "ShimmerTransition")[m
[32m+[m[32m    val translateAnim = transition.animateFloat([m
[32m+[m[32m        initialValue = 0f,[m
[32m+[m[32m        targetValue = 1000f,[m
[32m+[m[32m        animationSpec = infiniteRepeatable([m
[32m+[m[32m            animation = tween([m
[32m+[m[32m                durationMillis = 1000,[m
[32m+[m[32m                easing = LinearEasing[m
[32m+[m[32m            ),[m
[32m+[m[32m            repeatMode = RepeatMode.Reverse // Ho·∫∑c RepeatMode.Restart ƒë·ªÉ l·∫∑p l·∫°i t·ª´ ƒë·∫ßu[m
[32m+[m[32m        ), label = "ShimmerTranslate"[m
[32m+[m[32m    )[m
[32m+[m
[32m+[m[32m    val brush = Brush.linearGradient([m
[32m+[m[32m        colors = shimmerColors,[m
[32m+[m[32m        start = Offset(x = translateAnim.value - 200, y = translateAnim.value - 200),[m
[32m+[m[32m        end = Offset(x = translateAnim.value + 200, y = translateAnim.value + 200)[m
[32m+[m[32m    )[m
[32m+[m
[32m+[m[32m    Card([m
[32m+[m[32m        modifier = modifier[m
[32m+[m[32m            .fillMaxWidth()[m
[32m+[m[32m            .height(120.dp), // Gi·∫£ ƒë·ªãnh chi·ªÅu cao c·ªßa DocumentCard[m
[32m+[m[32m        shape = RoundedCornerShape(8.dp),[m
[32m+[m[32m        elevation = CardDefaults.cardElevation(defaultElevation = 2.dp),[m
[32m+[m[32m        colors = CardDefaults.cardColors(containerColor = Color.White)[m
[32m+[m[32m    ) {[m
[32m+[m[32m        Row([m
[32m+[m[32m            modifier = Modifier[m
[32m+[m[32m                .fillMaxSize()[m
[32m+[m[32m                .padding(16.dp),[m
[32m+[m[32m            horizontalArrangement = Arrangement.spacedBy(16.dp)[m
[32m+[m[32m        ) {[m
[32m+[m[32m            // Placeholder cho ·∫£nh thumbnail[m
[32m+[m[32m            Box([m
[32m+[m[32m                modifier = Modifier[m
[32m+[m[32m                    .size(80.dp)[m
[32m+[m[32m                    .clip(RoundedCornerShape(4.dp))[m
[32m+[m[32m                    .background(brush) // √Åp d·ª•ng shimmer[m
[32m+[m[32m            )[m
[32m+[m
[32m+[m[32m            // Placeholder cho vƒÉn b·∫£n[m
[32m+[m[32m            Column([m
[32m+[m[32m                modifier = Modifier.weight(1f),[m
[32m+[m[32m                verticalArrangement = Arrangement.spacedBy(8.dp)[m
[32m+[m[32m            ) {[m
[32m+[m[32m                // Ti√™u ƒë·ªÅ[m
[32m+[m[32m                Box([m
[32m+[m[32m                    modifier = Modifier[m
[32m+[m[32m                        .fillMaxWidth(0.8f) // Chi·ªÅu r·ªông t∆∞∆°ng t·ª± ti√™u ƒë·ªÅ th·∫≠t[m
[32m+[m[32m                        .height(20.dp)[m
[32m+[m[32m                        .clip(RoundedCornerShape(4.dp))[m
[32m+[m[32m                        .background(brush)[m
[32m+[m[32m                )[m
[32m+[m[32m                // M√¥ t·∫£/M√¥n h·ªçc[m
[32m+[m[32m                Box([m
[32m+[m[32m                    modifier = Modifier[m
[32m+[m[32m                        .fillMaxWidth(0.6f)[m
[32m+[m[32m                        .height(16.dp)[m
[32m+[m[32m                        .clip(RoundedCornerShape(4.dp))[m
[32m+[m[32m                        .background(brush)[m
[32m+[m[32m                )[m
[32m+[m[32m                // Ng∆∞·ªùi ƒëƒÉng/Ng√†y[m
[32m+[m[32m                Box([m
[32m+[m[32m                    modifier = Modifier[m
[32m+[m[32m                        .fillMaxWidth(0.4f)[m
[32m+[m[32m                        .height(16.dp)[m
[32m+[m[32m                        .clip(RoundedCornerShape(4.dp))[m
[32m+[m[32m                        .background(brush)[m
[32m+[m[32m                )[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m@Preview(showBackground = true)[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun DocumentCardSkeletonPreview() {[m
[32m+[m[32m    Column([m
[32m+[m[32m        modifier = Modifier[m
[32m+[m[32m            .fillMaxSize()[m
[32m+[m[32m            .background(Color.White)[m
[32m+[m[32m            .padding(16.dp),[m
[32m+[m[32m        verticalArrangement = Arrangement.spacedBy(12.dp)[m
[32m+[m[32m    ) {[m
[32m+[m[32m        DocumentCardSkeleton()[m
[32m+[m[32m        DocumentCardSkeleton()[m
[32m+[m[32m        DocumentCardSkeleton()[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[1mdiff --git a/app/src/main/java/com/example/stushare/features/feature_home/ui/components/DocumentSectionHeader.kt b/app/src/main/java/com/example/stushare/features/feature_home/ui/components/DocumentSectionHeader.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..a861af2[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/features/feature_home/ui/components/DocumentSectionHeader.kt[m
[36m@@ -0,0 +1,46 @@[m
[32m+[m[32mpackage com.example.stushare.features.feature_home.ui.components[m
[32m+[m
[32m+[m[32mimport androidx.compose.foundation.clickable[m
[32m+[m[32mimport androidx.compose.foundation.layout.Arrangement[m
[32m+[m[32mimport androidx.compose.foundation.layout.Row[m
[32m+[m[32mimport androidx.compose.foundation.layout.fillMaxWidth[m
[32m+[m[32mimport androidx.compose.foundation.layout.padding[m
[32m+[m[32mimport androidx.compose.material3.MaterialTheme[m
[32m+[m[32mimport androidx.compose.material3.Text[m
[32m+[m[32mimport androidx.compose.runtime.Composable[m
[32m+[m[32mimport androidx.compose.ui.Alignment[m
[32m+[m[32mimport androidx.compose.ui.Modifier[m
[32m+[m[32mimport androidx.compose.ui.text.font.FontWeight[m
[32m+[m[32mimport androidx.compose.ui.unit.dp[m
[32m+[m[32mimport com.example.stushare.ui.theme.PrimaryGreen[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun DocumentSectionHeader([m
[32m+[m[32m    title: String,[m
[32m+[m[32m    onViewAllClick: () -> Unit[m
[32m+[m[32m) {[m
[32m+[m[32m    Row([m
[32m+[m[32m        modifier = Modifier[m
[32m+[m[32m            .fillMaxWidth()[m
[32m+[m[32m            .padding(horizontal = 16.dp, vertical = 12.dp),[m
[32m+[m[32m        horizontalArrangement = Arrangement.SpaceBetween,[m
[32m+[m[32m        verticalAlignment = Alignment.CenterVertically[m
[32m+[m[32m    ) {[m
[32m+[m[32m        // Ti√™u ƒë·ªÅ: ƒê·ªïi sang onBackground ƒë·ªÉ t·ª± ƒë·ªông tr·∫Øng khi n·ªÅn ƒëen[m
[32m+[m[32m        Text([m
[32m+[m[32m            text = title,[m
[32m+[m[32m            style = MaterialTheme.typography.titleMedium,[m
[32m+[m[32m            fontWeight = FontWeight.Bold,[m
[32m+[m[32m            color = MaterialTheme.colorScheme.onBackground // ‚úÖ ƒê√£ s·ª≠a[m
[32m+[m[32m        )[m
[32m+[m
[32m+[m[32m        // N√∫t Xem t·∫•t c·∫£[m
[32m+[m[32m        Text([m
[32m+[m[32m            text = "Xem t·∫•t c·∫£",[m
[32m+[m[32m            style = MaterialTheme.typography.bodyMedium,[m
[32m+[m[32m            color = PrimaryGreen,[m
[32m+[m[32m            fontWeight = FontWeight.SemiBold,[m
[32m+[m[32m            modifier = Modifier.clickable { onViewAllClick() }[m
[32m+[m[32m        )[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/features/feature_home/ui/components/DocumentSectionHeaderSkeleton.kt b/app/src/main/java/com/example/stushare/features/feature_home/ui/components/DocumentSectionHeaderSkeleton.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..c5fb340[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/features/feature_home/ui/components/DocumentSectionHeaderSkeleton.kt[m
[36m@@ -0,0 +1,39 @@[m
[32m+[m[32mpackage com.example.stushare.features.feature_home.ui.components[m
[32m+[m
[32m+[m[32m// File: features/feature_home/ui/components/DocumentSectionHeaderSkeleton.kt[m
[32m+[m[32mimport androidx.compose.foundation.background[m
[32m+[m[32mimport androidx.compose.foundation.layout.*[m
[32m+[m[32mimport androidx.compose.foundation.shape.RoundedCornerShape[m
[32m+[m[32mimport androidx.compose.runtime.Composable[m
[32m+[m[32mimport androidx.compose.ui.Alignment[m
[32m+[m[32mimport androidx.compose.ui.Modifier[m
[32m+[m[32mimport androidx.compose.ui.unit.dp[m
[32m+[m[32mimport com.example.stushare.ui.theme.createShimmerBrush[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun DocumentSectionHeaderSkeleton(modifier: Modifier = Modifier) {[m
[32m+[m[32m    val brush = createShimmerBrush()[m
[32m+[m
[32m+[m[32m    Row([m
[32m+[m[32m        modifier = modifier[m
[32m+[m[32m            .fillMaxWidth()[m
[32m+[m[32m            .padding(horizontal = 16.dp),[m
[32m+[m[32m        verticalAlignment = Alignment.CenterVertically,[m
[32m+[m[32m        horizontalArrangement = Arrangement.SpaceBetween[m
[32m+[m[32m    ) {[m
[32m+[m[32m        // Ti√™u ƒë·ªÅ section[m
[32m+[m[32m        Box([m
[32m+[m[32m            modifier = Modifier[m
[32m+[m[32m                .width(180.dp)[m
[32m+[m[32m                .height(22.dp)[m
[32m+[m[32m                .background(brush, RoundedCornerShape(4.dp))[m
[32m+[m[32m        )[m
[32m+[m[32m        // N√∫t "Xem t·∫•t c·∫£"[m
[32m+[m[32m        Box([m
[32m+[m[32m            modifier = Modifier[m
[32m+[m[32m                .width(80.dp)[m
[32m+[m[32m                .height(18.dp)[m
[32m+[m[32m                .background(brush, RoundedCornerShape(4.dp))[m
[32m+[m[32m        )[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/features/feature_home/ui/components/GridDocumentCard.kt b/app/src/main/java/com/example/stushare/features/feature_home/ui/components/GridDocumentCard.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..4198c63[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/features/feature_home/ui/components/GridDocumentCard.kt[m
[36m@@ -0,0 +1,99 @@[m
[32m+[m[32mpackage com.example.stushare.features.feature_home.ui.components[m
[32m+[m
[32m+[m[32mimport androidx.compose.foundation.layout.*[m
[32m+[m[32mimport androidx.compose.foundation.shape.RoundedCornerShape[m
[32m+[m[32mimport androidx.compose.material.icons.Icons[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Download[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Star[m
[32m+[m[32mimport androidx.compose.material3.*[m
[32m+[m[32mimport androidx.compose.runtime.Composable[m
[32m+[m[32mimport androidx.compose.ui.Alignment[m
[32m+[m[32mimport androidx.compose.ui.Modifier[m
[32m+[m[32mimport androidx.compose.ui.draw.clip[m
[32m+[m[32mimport androidx.compose.ui.graphics.Color[m
[32m+[m[32mimport androidx.compose.ui.layout.ContentScale[m
[32m+[m[32mimport androidx.compose.ui.text.font.FontWeight[m
[32m+[m[32mimport androidx.compose.ui.text.style.TextOverflow[m
[32m+[m[32mimport androidx.compose.ui.unit.dp[m
[32m+[m[32mimport androidx.compose.ui.unit.sp[m
[32m+[m[32mimport coil.compose.AsyncImage[m
[32m+[m[32mimport com.example.stushare.core.data.models.Document[m
[32m+[m
[32m+[m[32m@OptIn(ExperimentalMaterial3Api::class)[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun GridDocumentCard( // ƒê·ªïi t√™n[m
[32m+[m[32m    document: Document,[m
[32m+[m[32m    onClick: () -> Unit,[m
[32m+[m[32m    modifier: Modifier = Modifier[m
[32m+[m[32m) {[m
[32m+[m[32m    Card([m
[32m+[m[32m        onClick = onClick,[m
[32m+[m[32m        modifier = modifier, // Grid s·∫Ω t·ª± quy·∫øt ƒë·ªãnh k√≠ch th∆∞·ªõc[m
[32m+[m[32m        shape = RoundedCornerShape(12.dp),[m
[32m+[m[32m        colors = CardDefaults.cardColors([m
[32m+[m[32m            containerColor = MaterialTheme.colorScheme.surfaceVariant[m
[32m+[m[32m        )[m
[32m+[m[32m    ) {[m
[32m+[m[32m        Column([m
[32m+[m[32m            modifier = Modifier.padding(8.dp)[m
[32m+[m[32m        ) {[m
[32m+[m[32m            AsyncImage([m
[32m+[m[32m                model = document.imageUrl,[m
[32m+[m[32m                contentDescription = document.title,[m
[32m+[m[32m                modifier = Modifier[m
[32m+[m[32m                    .fillMaxWidth()[m
[32m+[m[32m                    .aspectRatio(1f / 1.2f) // T·ª∑ l·ªá ·∫£nh[m
[32m+[m[32m                    .clip(RoundedCornerShape(8.dp)),[m
[32m+[m[32m                contentScale = ContentScale.Crop[m
[32m+[m[32m            )[m
[32m+[m[32m            Spacer(modifier = Modifier.height(8.dp))[m
[32m+[m
[32m+[m[32m            // --- PH·∫¶N TEXT M·ªöI ---[m
[32m+[m[32m            Text([m
[32m+[m[32m                text = document.title,[m
[32m+[m[32m                style = MaterialTheme.typography.titleSmall,[m
[32m+[m[32m                maxLines = 2,[m
[32m+[m[32m                overflow = TextOverflow.Ellipsis[m
[32m+[m[32m            )[m
[32m+[m[32m            Spacer(modifier = Modifier.height(4.dp))[m
[32m+[m[32m            Text([m
[32m+[m[32m                text = "T√™n t√°c gi·∫£: ${document.author}",[m
[32m+[m[32m                style = MaterialTheme.typography.labelSmall,[m
[32m+[m[32m                color = Color.Red, // (M√†u ƒë·ªè gi·ªëng Figma)[m
[32m+[m[32m                maxLines = 1[m
[32m+[m[32m            )[m
[32m+[m[32m            Text([m
[32m+[m[32m                text = "M√£ m√¥n h·ªçc: ${document.courseCode}",[m
[32m+[m[32m                style = MaterialTheme.typography.labelSmall,[m
[32m+[m[32m                color = Color.Red, // (M√†u ƒë·ªè gi·ªëng Figma)[m
[32m+[m[32m                maxLines = 1[m
[32m+[m[32m            )[m
[32m+[m[32m            Text([m
[32m+[m[32m                text = "Lo·∫°i: ${document.type}",[m
[32m+[m[32m                style = MaterialTheme.typography.labelSmall,[m
[32m+[m[32m                color = MaterialTheme.colorScheme.onSurfaceVariant,[m
[32m+[m[32m                maxLines = 1[m
[32m+[m[32m            )[m
[32m+[m
[32m+[m[32m            Spacer(modifier = Modifier.height(8.dp))[m
[32m+[m
[32m+[m[32m            // Th√¥ng s·ªë (chia l√†m 2 h√†ng)[m
[32m+[m[32m            Row([m
[32m+[m[32m                modifier = Modifier.fillMaxWidth(),[m
[32m+[m[32m                verticalAlignment = Alignment.CenterVertically[m
[32m+[m[32m            ) {[m
[32m+[m[32m                Icon(Icons.Filled.Star, "Rating", Modifier.size(16.dp), Color(0xFFFFC107))[m
[32m+[m[32m                Spacer(Modifier.width(4.dp))[m
[32m+[m[32m                Text(document.rating.toString(), style = MaterialTheme.typography.bodySmall)[m
[32m+[m[32m            }[m
[32m+[m[32m            Row([m
[32m+[m[32m                modifier = Modifier.fillMaxWidth(),[m
[32m+[m[32m                verticalAlignment = Alignment.CenterVertically[m
[32m+[m[32m            ) {[m
[32m+[m[32m                Icon(Icons.Filled.Download, "T·∫£i v·ªÅ", Modifier.size(16.dp), Color.Gray)[m
[32m+[m[32m                Spacer(Modifier.width(4.dp))[m
[32m+[m[32m                Text(document.downloads.toString(), style = MaterialTheme.typography.bodySmall)[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/features/feature_home/ui/home/HomeHeaderSectionSkeleton.kt b/app/src/main/java/com/example/stushare/features/feature_home/ui/home/HomeHeaderSectionSkeleton.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..a7866bb[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/features/feature_home/ui/home/HomeHeaderSectionSkeleton.kt[m
[36m@@ -0,0 +1,62 @@[m
[32m+[m[32mpackage com.example.stushare.features.feature_home.ui.home[m
[32m+[m
[32m+[m[32m// File: features/feature_home/ui/components/HomeHeaderSectionSkeleton.kt[m
[32m+[m
[32m+[m[32mimport androidx.compose.foundation.background[m
[32m+[m[32mimport androidx.compose.foundation.layout.*[m
[32m+[m[32mimport androidx.compose.foundation.shape.CircleShape[m
[32m+[m[32mimport androidx.compose.foundation.shape.RoundedCornerShape[m
[32m+[m[32mimport androidx.compose.runtime.Composable[m
[32m+[m[32mimport androidx.compose.ui.Alignment[m
[32m+[m[32mimport androidx.compose.ui.Modifier[m
[32m+[m[32mimport androidx.compose.ui.draw.clip[m
[32m+[m[32mimport androidx.compose.ui.unit.dp[m
[32m+[m[32mimport com.example.stushare.ui.theme.PrimaryGreen[m
[32m+[m[32mimport com.example.stushare.ui.theme.createShimmerBrush[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun HomeHeaderSectionSkeleton() {[m
[32m+[m[32m    val brush = createShimmerBrush()[m
[32m+[m
[32m+[m[32m    Column([m
[32m+[m[32m        modifier = Modifier[m
[32m+[m[32m            .fillMaxWidth()[m
[32m+[m[32m            .clip(RoundedCornerShape(bottomStart = 24.dp, bottomEnd = 24.dp))[m
[32m+[m[32m            .background(PrimaryGreen) // Gi·ªØ m√†u n·ªÅn th·∫≠t[m
[32m+[m[32m            .padding(start = 16.dp, end = 16.dp, top = 16.dp, bottom = 24.dp)[m
[32m+[m[32m    ) {[m
[32m+[m[32m        // Avatar[m
[32m+[m[32m        Row(verticalAlignment = Alignment.CenterVertically) {[m
[32m+[m[32m            Box([m
[32m+[m[32m                modifier = Modifier[m
[32m+[m[32m                    .size(50.dp)[m
[32m+[m[32m                    .clip(CircleShape)[m
[32m+[m[32m                    .background(brush)[m
[32m+[m[32m            )[m
[32m+[m[32m            Spacer(modifier = Modifier.width(12.dp))[m
[32m+[m[32m            // T√™n[m
[32m+[m[32m            Column(verticalArrangement = Arrangement.spacedBy(8.dp)) {[m
[32m+[m[32m                Box([m
[32m+[m[32m                    modifier = Modifier[m
[32m+[m[32m                        .width(100.dp)[m
[32m+[m[32m                        .height(16.dp)[m
[32m+[m[32m                        .background(brush, RoundedCornerShape(4.dp))[m
[32m+[m[32m                )[m
[32m+[m[32m                Box([m
[32m+[m[32m                    modifier = Modifier[m
[32m+[m[32m                        .width(150.dp)[m
[32m+[m[32m                        .height(20.dp)[m
[32m+[m[32m                        .background(brush, RoundedCornerShape(4.dp))[m
[32m+[m[32m                )[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m        Spacer(modifier = Modifier.height(20.dp))[m
[32m+[m[32m        // Thanh t√¨m ki·∫øm[m
[32m+[m[32m        Box([m
[32m+[m[32m            modifier = Modifier[m
[32m+[m[32m                .fillMaxWidth()[m
[32m+[m[32m                .height(50.dp)[m
[32m+[m[32m                .background(brush, RoundedCornerShape(12.dp))[m
[32m+[m[32m        )[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/features/feature_home/ui/home/HomeScreen.kt b/app/src/main/java/com/example/stushare/features/feature_home/ui/home/HomeScreen.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..c8d4660[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/features/feature_home/ui/home/HomeScreen.kt[m
[36m@@ -0,0 +1,481 @@[m
[32m+[m[32mpackage com.example.stushare.features.feature_home.ui.home[m
[32m+[m
[32m+[m[32mimport androidx.compose.foundation.background[m
[32m+[m[32mimport androidx.compose.foundation.clickable[m
[32m+[m[32mimport androidx.compose.foundation.layout.*[m
[32m+[m[32mimport androidx.compose.foundation.lazy.LazyColumn[m
[32m+[m[32mimport androidx.compose.foundation.lazy.LazyRow[m
[32m+[m[32mimport androidx.compose.foundation.lazy.items[m
[32m+[m[32mimport androidx.compose.foundation.shape.CircleShape[m
[32m+[m[32mimport androidx.compose.foundation.shape.RoundedCornerShape[m
[32m+[m[32mimport androidx.compose.material.ExperimentalMaterialApi[m
[32m+[m[32mimport androidx.compose.material.icons.Icons[m
[32m+[m[32mimport androidx.compose.material.icons.automirrored.filled.Help[m
[32m+[m[32mimport androidx.compose.material.icons.filled.*[m
[32m+[m[32mimport androidx.compose.material.pullrefresh.PullRefreshIndicator[m
[32m+[m[32mimport androidx.compose.material.pullrefresh.pullRefresh[m
[32m+[m[32mimport androidx.compose.material.pullrefresh.rememberPullRefreshState[m
[32m+[m[32mimport androidx.compose.material3.*[m
[32m+[m[32mimport androidx.compose.material3.windowsizeclass.WindowSizeClass[m
[32m+[m[32mimport androidx.compose.runtime.Composable[m
[32m+[m[32mimport androidx.compose.runtime.LaunchedEffect[m
[32m+[m[32mimport androidx.compose.runtime.getValue[m
[32m+[m[32mimport androidx.compose.runtime.remember[m
[32m+[m[32mimport androidx.compose.ui.Alignment[m
[32m+[m[32mimport androidx.compose.ui.Modifier[m
[32m+[m[32mimport androidx.compose.ui.draw.clip[m
[32m+[m[32mimport androidx.compose.ui.draw.shadow[m
[32m+[m[32mimport androidx.compose.ui.graphics.Color[m
[32m+[m[32mimport androidx.compose.ui.layout.ContentScale[m
[32m+[m[32mimport androidx.compose.ui.res.stringResource[m
[32m+[m[32mimport androidx.compose.ui.text.font.FontWeight[m
[32m+[m[32mimport androidx.compose.ui.text.style.TextOverflow[m
[32m+[m[32mimport androidx.compose.ui.unit.dp[m
[32m+[m[32mimport androidx.compose.ui.unit.sp[m
[32m+[m[32mimport androidx.hilt.navigation.compose.hiltViewModel[m
[32m+[m[32mimport androidx.lifecycle.compose.collectAsStateWithLifecycle[m
[32m+[m[32mimport coil.compose.AsyncImage[m
[32m+[m[32mimport com.example.stushare.R[m
[32m+[m[32mimport com.example.stushare.core.data.models.Document[m
[32m+[m[32mimport com.example.stushare.core.data.models.DocumentRequest // üü¢ Import[m
[32m+[m[32mimport com.example.stushare.features.feature_home.ui.components.DocumentCard[m
[32m+[m[32mimport com.example.stushare.ui.theme.LightGreen[m
[32m+[m[32mimport com.example.stushare.ui.theme.PrimaryGreen[m
[32m+[m
[32m+[m[32m@OptIn(ExperimentalMaterialApi::class, ExperimentalMaterial3Api::class)[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun HomeScreen([m
[32m+[m[32m    windowSizeClass: WindowSizeClass,[m
[32m+[m[32m    viewModel: HomeViewModel = hiltViewModel(),[m
[32m+[m[32m    onSearchClick: () -> Unit,[m
[32m+[m[32m    onViewAllClick: (String) -> Unit,[m
[32m+[m[32m    onDocumentClick: (String) -> Unit,[m
[32m+[m[32m    onCreateRequestClick: () -> Unit,[m
[32m+[m[32m    onUploadClick: () -> Unit,[m
[32m+[m[32m    onLeaderboardClick: () -> Unit,[m
[32m+[m[32m    onNotificationClick: () -> Unit,[m
[32m+[m[32m    onRequestListClick: () -> Unit[m
[32m+[m[32m) {[m
[32m+[m[32m    val uiState by viewModel.uiState.collectAsStateWithLifecycle()[m
[32m+[m[32m    val snackbarHostState = remember { SnackbarHostState() }[m
[32m+[m
[32m+[m[32m    LaunchedEffect(uiState.errorMessage) {[m
[32m+[m[32m        if (uiState.errorMessage != null && uiState.newDocuments.isNotEmpty()) {[m
[32m+[m[32m            snackbarHostState.showSnackbar(message = uiState.errorMessage ?: "Error")[m
[32m+[m[32m            viewModel.clearError()[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    val swipeRefreshState = rememberPullRefreshState([m
[32m+[m[32m        refreshing = uiState.isRefreshing,[m
[32m+[m[32m        onRefresh = { viewModel.refreshData() }[m
[32m+[m[32m    )[m
[32m+[m
[32m+[m[32m    Scaffold([m
[32m+[m[32m        snackbarHost = { SnackbarHost(snackbarHostState) },[m
[32m+[m[32m        containerColor = MaterialTheme.colorScheme.background,[m
[32m+[m[32m        floatingActionButton = {[m
[32m+[m[32m            FloatingActionButton([m
[32m+[m[32m                onClick = onCreateRequestClick,[m
[32m+[m[32m                containerColor = PrimaryGreen,[m
[32m+[m[32m                contentColor = Color.White[m
[32m+[m[32m            ) {[m
[32m+[m[32m                Icon(Icons.Filled.Add, contentDescription = "T·∫°o y√™u c·∫ßu m·ªõi")[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    ) { paddingValues ->[m
[32m+[m[32m        Box([m
[32m+[m[32m            modifier = Modifier[m
[32m+[m[32m                .fillMaxSize()[m
[32m+[m[32m                .padding(paddingValues)[m
[32m+[m[32m                .pullRefresh(swipeRefreshState)[m
[32m+[m[32m        ) {[m
[32m+[m[32m            if (uiState.isLoading && uiState.newDocuments.isEmpty()) {[m
[32m+[m[32m                Box(Modifier.fillMaxSize(), contentAlignment = Alignment.Center) {[m
[32m+[m[32m                    CircularProgressIndicator(color = PrimaryGreen)[m
[32m+[m[32m                }[m
[32m+[m[32m            } else {[m
[32m+[m[32m                HomeContent([m
[32m+[m[32m                    uiState = uiState,[m
[32m+[m[32m                    onSearchClick = onSearchClick,[m
[32m+[m[32m                    onViewAllClick = onViewAllClick,[m
[32m+[m[32m                    onDocumentClick = onDocumentClick,[m
[32m+[m[32m                    onUploadClick = onUploadClick,[m
[32m+[m[32m                    onLeaderboardClick = onLeaderboardClick,[m
[32m+[m[32m                    onNotificationClick = onNotificationClick,[m
[32m+[m[32m                    onRequestListClick = onRequestListClick[m
[32m+[m[32m                )[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            PullRefreshIndicator([m
[32m+[m[32m                refreshing = uiState.isRefreshing,[m
[32m+[m[32m                state = swipeRefreshState,[m
[32m+[m[32m                modifier = Modifier.align(Alignment.TopCenter),[m
[32m+[m[32m                contentColor = PrimaryGreen[m
[32m+[m[32m            )[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mprivate fun HomeContent([m
[32m+[m[32m    uiState: HomeUiState,[m
[32m+[m[32m    onSearchClick: () -> Unit,[m
[32m+[m[32m    onViewAllClick: (String) -> Unit,[m
[32m+[m[32m    onDocumentClick: (String) -> Unit,[m
[32m+[m[32m    onUploadClick: () -> Unit,[m
[32m+[m[32m    onLeaderboardClick: () -> Unit,[m
[32m+[m[32m    onNotificationClick: () -> Unit,[m
[32m+[m[32m    onRequestListClick: () -> Unit[m
[32m+[m[32m) {[m
[32m+[m[32m    LazyColumn([m
[32m+[m[32m        contentPadding = PaddingValues(bottom = 100.dp),[m
[32m+[m[32m        verticalArrangement = Arrangement.spacedBy(16.dp)[m
[32m+[m[32m    ) {[m
[32m+[m[32m        // 1. Header Section[m
[32m+[m[32m        item {[m
[32m+[m[32m            HomeHeaderSection([m
[32m+[m[32m                userName = uiState.userName,[m
[32m+[m[32m                avatarUrl = uiState.avatarUrl,[m
[32m+[m[32m                unreadCount = uiState.unreadNotificationCount,[m
[32m+[m[32m                onSearchClick = onSearchClick,[m
[32m+[m[32m                onUploadClick = onUploadClick,[m
[32m+[m[32m                onLeaderboardClick = onLeaderboardClick,[m
[32m+[m[32m                onNotificationClick = onNotificationClick,[m
[32m+[m[32m                onRequestListClick = onRequestListClick[m
[32m+[m[32m            )[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        // 2. Section: M·ªõi ƒë∆∞·ª£c t·∫£i l√™n[m
[32m+[m[32m        item {[m
[32m+[m[32m            DocumentSection([m
[32m+[m[32m                title = stringResource(R.string.section_new_uploads),[m
[32m+[m[32m                documents = uiState.newDocuments,[m
[32m+[m[32m                onViewAllClick = { onViewAllClick("new_uploads") },[m
[32m+[m[32m                onDocumentClick = onDocumentClick[m
[32m+[m[32m            )[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        // üü¢ 3. Section: C·ªòNG ƒê·ªíNG C·∫¶N GI√öP (M·ªöI)[m
[32m+[m[32m        item {[m
[32m+[m[32m            if (uiState.requestDocuments.isNotEmpty()) {[m
[32m+[m[32m                Column(modifier = Modifier.fillMaxWidth()) {[m
[32m+[m[32m                    // Ti√™u ƒë·ªÅ[m
[32m+[m[32m                    Row([m
[32m+[m[32m                        modifier = Modifier[m
[32m+[m[32m                            .fillMaxWidth()[m
[32m+[m[32m                            .padding(horizontal = 16.dp, vertical = 8.dp),[m
[32m+[m[32m                        horizontalArrangement = Arrangement.SpaceBetween,[m
[32m+[m[32m                        verticalAlignment = Alignment.CenterVertically[m
[32m+[m[32m                    ) {[m
[32m+[m[32m                        Row(verticalAlignment = Alignment.CenterVertically) {[m
[32m+[m[32m                            Icon([m
[32m+[m[32m                                imageVector = Icons.Default.LiveHelp,[m
[32m+[m[32m                                contentDescription = null,[m
[32m+[m[32m                                tint = Color(0xFFFF9800), // M√†u cam[m
[32m+[m[32m                                modifier = Modifier.size(20.dp)[m
[32m+[m[32m                            )[m
[32m+[m[32m                            Spacer(modifier = Modifier.width(8.dp))[m
[32m+[m[32m                            Text([m
[32m+[m[32m                                text = "C·ªông ƒë·ªìng c·∫ßn gi√∫p",[m
[32m+[m[32m                                style = MaterialTheme.typography.titleMedium.copy(fontWeight = FontWeight.Bold),[m
[32m+[m[32m                                color = Color.Black[m
[32m+[m[32m                            )[m
[32m+[m[32m                        }[m
[32m+[m
[32m+[m[32m                        Text([m
[32m+[m[32m                            text = "Xem t·∫•t c·∫£",[m
[32m+[m[32m                            style = MaterialTheme.typography.bodySmall,[m
[32m+[m[32m                            color = PrimaryGreen,[m
[32m+[m[32m                            modifier = Modifier.clickable { onRequestListClick() }[m
[32m+[m[32m                        )[m
[32m+[m[32m                    }[m
[32m+[m
[32m+[m[32m                    // Danh s√°ch l∆∞·ªõt ngang[m
[32m+[m[32m                    LazyRow([m
[32m+[m[32m                        contentPadding = PaddingValues(horizontal = 16.dp),[m
[32m+[m[32m                        horizontalArrangement = Arrangement.spacedBy(12.dp)[m
[32m+[m[32m                    ) {[m
[32m+[m[32m                        items(uiState.requestDocuments) { req ->[m
[32m+[m[32m                            MiniRequestCard([m
[32m+[m[32m                                request = req,[m
[32m+[m[32m                                onClick = { onRequestListClick() } // B·∫•m v√†o th√¨ m·ªü danh s√°ch[m
[32m+[m[32m                            )[m
[32m+[m[32m                        }[m
[32m+[m
[32m+[m[32m                        // Th·∫ª "Th√™m y√™u c·∫ßu" ·ªü cu·ªëi danh s√°ch[m
[32m+[m[32m                        item {[m
[32m+[m[32m                            Button([m
[32m+[m[32m                                onClick = onRequestListClick,[m
[32m+[m[32m                                shape = RoundedCornerShape(12.dp),[m
[32m+[m[32m                                colors = ButtonDefaults.buttonColors(containerColor = Color(0xFFE0F2F1)), // M√†u xanh nh·∫°t[m
[32m+[m[32m                                modifier = Modifier.size(width = 100.dp, height = 130.dp),[m
[32m+[m[32m                                contentPadding = PaddingValues(0.dp)[m
[32m+[m[32m                            ) {[m
[32m+[m[32m                                Column(horizontalAlignment = Alignment.CenterHorizontally) {[m
[32m+[m[32m                                    Icon([m
[32m+[m[32m                                        imageVector = Icons.Filled.Add,[m
[32m+[m[32m                                        contentDescription = null,[m
[32m+[m[32m                                        tint = PrimaryGreen[m
[32m+[m[32m                                    )[m
[32m+[m[32m                                    Spacer(modifier = Modifier.height(4.dp))[m
[32m+[m[32m                                    Text("ƒêƒÉng b√†i", color = PrimaryGreen, fontSize = 12.sp)[m
[32m+[m[32m                                }[m
[32m+[m[32m                            }[m
[32m+[m[32m                        }[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        // 4. Section: T√†i li·ªáu √¥n thi[m
[32m+[m[32m        item {[m
[32m+[m[32m            DocumentSection([m
[32m+[m[32m                title = stringResource(R.string.section_exam_review),[m
[32m+[m[32m                documents = uiState.examDocuments,[m
[32m+[m[32m                onViewAllClick = { onViewAllClick("exam_review") },[m
[32m+[m[32m                onDocumentClick = onDocumentClick[m
[32m+[m[32m            )[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        // 5. Section: S√°ch / Gi√°o tr√¨nh[m
[32m+[m[32m        item {[m
[32m+[m[32m            DocumentSection([m
[32m+[m[32m                title = "S√°ch / Gi√°o tr√¨nh",[m
[32m+[m[32m                documents = uiState.bookDocuments,[m
[32m+[m[32m                onViewAllClick = { onViewAllClick("book") },[m
[32m+[m[32m                onDocumentClick = onDocumentClick[m
[32m+[m[32m            )[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        // 6. Section: B√†i gi·∫£ng / Slide[m
[32m+[m[32m        item {[m
[32m+[m[32m            DocumentSection([m
[32m+[m[32m                title = "B√†i gi·∫£ng / Slide",[m
[32m+[m[32m                documents = uiState.lectureDocuments,[m
[32m+[m[32m                onViewAllClick = { onViewAllClick("lecture") },[m
[32m+[m[32m                onDocumentClick = onDocumentClick[m
[32m+[m[32m            )[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m// üü¢ COMPONENT TH·∫∫ Y√äU C·∫¶U MINI[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun MiniRequestCard([m
[32m+[m[32m    request: DocumentRequest,[m
[32m+[m[32m    onClick: () -> Unit[m
[32m+[m[32m) {[m
[32m+[m[32m    Card([m
[32m+[m[32m        modifier = Modifier[m
[32m+[m[32m            .width(200.dp)[m
[32m+[m[32m            .height(130.dp)[m
[32m+[m[32m            .clickable { onClick() },[m
[32m+[m[32m        shape = RoundedCornerShape(12.dp),[m
[32m+[m[32m        colors = CardDefaults.cardColors(containerColor = Color(0xFFF5F9F5)), // Xanh si√™u nh·∫°t[m
[32m+[m[32m        elevation = CardDefaults.cardElevation(1.dp)[m
[32m+[m[32m    ) {[m
[32m+[m[32m        Column([m
[32m+[m[32m            modifier = Modifier[m
[32m+[m[32m                .padding(12.dp)[m
[32m+[m[32m                .fillMaxSize(),[m
[32m+[m[32m            verticalArrangement = Arrangement.SpaceBetween[m
[32m+[m[32m        ) {[m
[32m+[m[32m            Column {[m
[32m+[m[32m                // Badge M√¥n h·ªçc[m
[32m+[m[32m                Surface([m
[32m+[m[32m                    color = PrimaryGreen.copy(alpha = 0.1f),[m
[32m+[m[32m                    shape = RoundedCornerShape(4.dp)[m
[32m+[m[32m                ) {[m
[32m+[m[32m                    Text([m
[32m+[m[32m                        text = request.subject,[m
[32m+[m[32m                        color = PrimaryGreen,[m
[32m+[m[32m                        style = MaterialTheme.typography.labelSmall,[m
[32m+[m[32m                        modifier = Modifier.padding(horizontal = 6.dp, vertical = 2.dp),[m
[32m+[m[32m                        maxLines = 1,[m
[32m+[m[32m                        overflow = TextOverflow.Ellipsis[m
[32m+[m[32m                    )[m
[32m+[m[32m                }[m
[32m+[m[32m                Spacer(modifier = Modifier.height(8.dp))[m
[32m+[m[32m                // Ti√™u ƒë·ªÅ[m
[32m+[m[32m                Text([m
[32m+[m[32m                    text = request.title,[m
[32m+[m[32m                    style = MaterialTheme.typography.titleSmall,[m
[32m+[m[32m                    fontWeight = FontWeight.Bold,[m
[32m+[m[32m                    maxLines = 2,[m
[32m+[m[32m                    overflow = TextOverflow.Ellipsis,[m
[32m+[m[32m                    color = Color.Black[m
[32m+[m[32m                )[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            // T√°c gi·∫£[m
[32m+[m[32m            Row(verticalAlignment = Alignment.CenterVertically) {[m
[32m+[m[32m                Icon([m
[32m+[m[32m                    imageVector = Icons.Default.Person,[m
[32m+[m[32m                    contentDescription = null,[m
[32m+[m[32m                    modifier = Modifier.size(12.dp),[m
[32m+[m[32m                    tint = Color.Gray[m
[32m+[m[32m                )[m
[32m+[m[32m                Spacer(modifier = Modifier.width(4.dp))[m
[32m+[m[32m                Text([m
[32m+[m[32m                    text = request.authorName,[m
[32m+[m[32m                    style = MaterialTheme.typography.bodySmall,[m
[32m+[m[32m                    color = Color.Gray,[m
[32m+[m[32m                    fontSize = 11.sp,[m
[32m+[m[32m                    maxLines = 1,[m
[32m+[m[32m                    overflow = TextOverflow.Ellipsis[m
[32m+[m[32m                )[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mprivate fun DocumentSection([m
[32m+[m[32m    title: String,[m
[32m+[m[32m    documents: List<Document>,[m
[32m+[m[32m    onViewAllClick: () -> Unit,[m
[32m+[m[32m    onDocumentClick: (String) -> Unit[m
[32m+[m[32m) {[m
[32m+[m[32m    if (documents.isNotEmpty()) {[m
[32m+[m[32m        Column(modifier = Modifier.fillMaxWidth()) {[m
[32m+[m[32m            Row([m
[32m+[m[32m                modifier = Modifier[m
[32m+[m[32m                    .fillMaxWidth()[m
[32m+[m[32m                    .padding(horizontal = 16.dp, vertical = 8.dp),[m
[32m+[m[32m                horizontalArrangement = Arrangement.SpaceBetween,[m
[32m+[m[32m                verticalAlignment = Alignment.CenterVertically[m
[32m+[m[32m            ) {[m
[32m+[m[32m                Text([m
[32m+[m[32m                    text = title,[m
[32m+[m[32m                    style = MaterialTheme.typography.titleMedium.copy(fontWeight = FontWeight.Bold),[m
[32m+[m[32m                    color = Color.Black[m
[32m+[m[32m                )[m
[32m+[m[32m                Text([m
[32m+[m[32m                    text = stringResource(R.string.view_all),[m
[32m+[m[32m                    style = MaterialTheme.typography.bodySmall,[m
[32m+[m[32m                    color = PrimaryGreen,[m
[32m+[m[32m                    modifier = Modifier.clickable { onViewAllClick() }[m
[32m+[m[32m                )[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            LazyRow([m
[32m+[m[32m                contentPadding = PaddingValues(horizontal = 16.dp),[m
[32m+[m[32m                horizontalArrangement = Arrangement.spacedBy(12.dp)[m
[32m+[m[32m            ) {[m
[32m+[m[32m                items(documents) { doc ->[m
[32m+[m[32m                    DocumentCard([m
[32m+[m[32m                        document = doc,[m
[32m+[m[32m                        onClick = { onDocumentClick(doc.id.toString()) }[m
[32m+[m[32m                    )[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m// ... (Ph·∫ßn HomeHeaderSection gi·ªØ nguy√™n)[m
[32m+[m[32m@OptIn(ExperimentalMaterial3Api::class)[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun HomeHeaderSection([m
[32m+[m[32m    userName: String,[m
[32m+[m[32m    avatarUrl: String?,[m
[32m+[m[32m    unreadCount: Int = 0,[m
[32m+[m[32m    onSearchClick: () -> Unit,[m
[32m+[m[32m    onUploadClick: () -> Unit,[m
[32m+[m[32m    onLeaderboardClick: () -> Unit,[m
[32m+[m[32m    onNotificationClick: () -> Unit,[m
[32m+[m[32m    onRequestListClick: () -> Unit[m
[32m+[m[32m) {[m
[32m+[m[32m    Column([m
[32m+[m[32m        modifier = Modifier[m
[32m+[m[32m            .fillMaxWidth()[m
[32m+[m[32m            .clip(RoundedCornerShape(bottomStart = 24.dp, bottomEnd = 24.dp))[m
[32m+[m[32m            .background(PrimaryGreen)[m
[32m+[m[32m            .padding(start = 16.dp, end = 16.dp, top = 16.dp, bottom = 24.dp)[m
[32m+[m[32m    ) {[m
[32m+[m[32m        Row(verticalAlignment = Alignment.CenterVertically) {[m
[32m+[m[32m            AsyncImage([m
[32m+[m[32m                model = avatarUrl,[m
[32m+[m[32m                contentDescription = "Avatar",[m
[32m+[m[32m                modifier = Modifier[m
[32m+[m[32m                    .size(50.dp)[m
[32m+[m[32m                    .clip(CircleShape)[m
[32m+[m[32m                    .background(Color.White.copy(0.2f)),[m
[32m+[m[32m                contentScale = ContentScale.Crop[m
[32m+[m[32m            )[m
[32m+[m[32m            Spacer(Modifier.width(12.dp))[m
[32m+[m[32m            Column(modifier = Modifier.weight(1f)) {[m
[32m+[m[32m                Text([m
[32m+[m[32m                    text = stringResource(R.string.home_greeting),[m
[32m+[m[32m                    color = Color.White.copy(alpha = 0.9f),[m
[32m+[m[32m                    style = MaterialTheme.typography.bodyMedium[m
[32m+[m[32m                )[m
[32m+[m[32m                Text([m
[32m+[m[32m                    text = userName,[m
[32m+[m[32m                    color = Color.White,[m
[32m+[m[32m                    style = MaterialTheme.typography.titleLarge.copy(fontWeight = FontWeight.Bold),[m
[32m+[m[32m                    maxLines = 1[m
[32m+[m[32m                )[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            Row(verticalAlignment = Alignment.CenterVertically) {[m
[32m+[m[32m                IconButton(onClick = onLeaderboardClick) {[m
[32m+[m[32m                    Icon(Icons.Default.EmojiEvents, contentDescription = "Leaderboard", tint = Color.White)[m
[32m+[m[32m                }[m
[32m+[m[32m                IconButton(onClick = onRequestListClick) {[m
[32m+[m[32m                    Icon([m
[32m+[m[32m                        imageVector = Icons.Default.LiveHelp,[m
[32m+[m[32m                        contentDescription = "C·ªông ƒë·ªìng",[m
[32m+[m[32m                        tint = Color.White[m
[32m+[m[32m                    )[m
[32m+[m[32m                }[m
[32m+[m[32m                Box {[m
[32m+[m[32m                    IconButton(onClick = onNotificationClick) {[m
[32m+[m[32m                        Icon(Icons.Default.Notifications, contentDescription = "Notification", tint = Color.White)[m
[32m+[m[32m                    }[m
[32m+[m[32m                    if (unreadCount > 0) {[m
[32m+[m[32m                        Badge([m
[32m+[m[32m                            containerColor = Color.Red,[m
[32m+[m[32m                            contentColor = Color.White,[m
[32m+[m[32m                            modifier = Modifier[m
[32m+[m[32m                                .align(Alignment.TopEnd)[m
[32m+[m[32m                                .padding(top = 8.dp, end = 8.dp)[m
[32m+[m[32m                                .size(10.dp)[m
[32m+[m[32m                        )[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m                IconButton(onClick = onUploadClick) {[m
[32m+[m[32m                    Icon(Icons.Default.CloudUpload, contentDescription = "Upload", tint = Color.White)[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m        Spacer(Modifier.height(20.dp))[m
[32m+[m[32m        Surface([m
[32m+[m[32m            onClick = onSearchClick,[m
[32m+[m[32m            modifier = Modifier[m
[32m+[m[32m                .fillMaxWidth()[m
[32m+[m[32m                .height(50.dp),[m
[32m+[m[32m            shape = RoundedCornerShape(12.dp),[m
[32m+[m[32m            color = Color.White,[m
[32m+[m[32m            shadowElevation = 4.dp[m
[32m+[m[32m        ) {[m
[32m+[m[32m            Row([m
[32m+[m[32m                modifier = Modifier.padding(horizontal = 16.dp),[m
[32m+[m[32m                verticalAlignment = Alignment.CenterVertically[m
[32m+[m[32m            ) {[m
[32m+[m[32m                Text([m
[32m+[m[32m                    text = stringResource(R.string.home_search_hint),[m
[32m+[m[32m                    color = Color.Gray,[m
[32m+[m[32m                    style = MaterialTheme.typography.bodyMedium,[m
[32m+[m[32m                    modifier = Modifier.weight(1f)[m
[32m+[m[32m                )[m
[32m+[m[32m                Icon([m
[32m+[m[32m                    Icons.Default.Search,[m
[32m+[m[32m                    contentDescription = null,[m
[32m+[m[32m                    tint = PrimaryGreen[m
[32m+[m[32m                )[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/features/feature_home/ui/home/HomeScreenSkeleton.kt b/app/src/main/java/com/example/stushare/features/feature_home/ui/home/HomeScreenSkeleton.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..084cb95[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/features/feature_home/ui/home/HomeScreenSkeleton.kt[m
[36m@@ -0,0 +1,84 @@[m
[32m+[m[32mpackage com.example.stushare.features.feature_home.ui.home[m
[32m+[m
[32m+[m[32m// File: features/feature_home/ui/home/HomeScreenSkeleton.kt[m
[32m+[m
[32m+[m[32mimport androidx.compose.foundation.layout.*[m
[32m+[m[32mimport androidx.compose.foundation.lazy.LazyColumn[m
[32m+[m[32mimport androidx.compose.foundation.lazy.LazyRow[m
[32m+[m[32mimport androidx.compose.foundation.lazy.grid.GridCells[m
[32m+[m[32mimport androidx.compose.foundation.lazy.grid.GridItemSpan[m
[32m+[m[32mimport androidx.compose.foundation.lazy.grid.LazyVerticalGrid[m
[32m+[m[32mimport androidx.compose.runtime.Composable[m
[32m+[m[32mimport androidx.compose.ui.Modifier[m
[32m+[m[32mimport androidx.compose.ui.unit.dp[m
[32m+[m[32mimport com.example.stushare.features.feature_home.ui.components.DocumentCardSkeleton[m
[32m+[m[32mimport com.example.stushare.features.feature_home.ui.components.DocumentSectionHeaderSkeleton[m
[32m+[m[32mimport com.example.stushare.features.feature_home.ui.home.HomeHeaderSectionSkeleton[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun HomeScreenSkeleton([m
[32m+[m[32m    columns: Int,[m
[32m+[m[32m    modifier: Modifier = Modifier[m
[32m+[m[32m) {[m
[32m+[m[32m    if (columns == 1) {[m
[32m+[m[32m        // --- B·ªê C·ª§C SKELETON CHO M√ÄN H√åNH H·∫∏P (LAZYCOLUMN) ---[m
[32m+[m[32m        LazyColumn([m
[32m+[m[32m            modifier = modifier.fillMaxSize(),[m
[32m+[m[32m            verticalArrangement = Arrangement.spacedBy(16.dp),[m
[32m+[m[32m            contentPadding = PaddingValues(bottom = 16.dp)[m
[32m+[m[32m        ) {[m
[32m+[m[32m            item { HomeHeaderSectionSkeleton() }[m
[32m+[m
[32m+[m[32m            // Section 1[m
[32m+[m[32m            item { DocumentSectionHeaderSkeleton() }[m
[32m+[m[32m            item {[m
[32m+[m[32m                LazyRow([m
[32m+[m[32m                    horizontalArrangement = Arrangement.spacedBy(12.dp),[m
[32m+[m[32m                    contentPadding = PaddingValues(horizontal = 16.dp)[m
[32m+[m[32m                ) {[m
[32m+[m[32m                    items(3) { DocumentCardSkeleton() }[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            // Section 2[m
[32m+[m[32m            item { DocumentSectionHeaderSkeleton() }[m
[32m+[m[32m            item {[m
[32m+[m[32m                LazyRow([m
[32m+[m[32m                    horizontalArrangement = Arrangement.spacedBy(12.dp),[m
[32m+[m[32m                    contentPadding = PaddingValues(horizontal = 16.dp)[m
[32m+[m[32m                ) {[m
[32m+[m[32m                    items(3) { DocumentCardSkeleton() }[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    } else {[m
[32m+[m[32m        // --- B·ªê C·ª§C SKELETON CHO M√ÄN H√åNH R·ªòNG (LAZYVERTICALGRID) ---[m
[32m+[m[32m        LazyVerticalGrid([m
[32m+[m[32m            columns = GridCells.Fixed(columns),[m
[32m+[m[32m            modifier = modifier.fillMaxSize(),[m
[32m+[m[32m            contentPadding = PaddingValues(horizontal = 16.dp, vertical = 16.dp),[m
[32m+[m[32m            verticalArrangement = Arrangement.spacedBy(12.dp),[m
[32m+[m[32m            horizontalArrangement = Arrangement.spacedBy(12.dp)[m
[32m+[m[32m        ) {[m
[32m+[m[32m            // Header[m
[32m+[m[32m            item(span = { GridItemSpan(columns) }) { HomeHeaderSectionSkeleton() }[m
[32m+[m[32m            item(span = { GridItemSpan(columns) }) { Spacer(modifier = Modifier.height(16.dp)) }[m
[32m+[m
[32m+[m[32m            // Section 1[m
[32m+[m[32m            item(span = { GridItemSpan(columns) }) {[m
[32m+[m[32m                DocumentSectionHeaderSkeleton(modifier = Modifier.padding(horizontal = 0.dp))[m
[32m+[m[32m            }[m
[32m+[m[32m            items(columns) {[m
[32m+[m[32m                DocumentCardSkeleton(modifier = Modifier.fillMaxWidth())[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            // Section 2[m
[32m+[m[32m            item(span = { GridItemSpan(columns) }) {[m
[32m+[m[32m                DocumentSectionHeaderSkeleton(modifier = Modifier.padding(horizontal = 0.dp))[m
[32m+[m[32m            }[m
[32m+[m[32m            items(columns) {[m
[32m+[m[32m                DocumentCardSkeleton(modifier = Modifier.fillMaxWidth())[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/features/feature_home/ui/home/HomeViewModel.kt b/app/src/main/java/com/example/stushare/features/feature_home/ui/home/HomeViewModel.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..971fb2f[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/features/feature_home/ui/home/HomeViewModel.kt[m
[36m@@ -0,0 +1,135 @@[m
[32m+[m[32mpackage com.example.stushare.features.feature_home.ui.home[m
[32m+[m
[32m+[m[32mimport androidx.lifecycle.ViewModel[m
[32m+[m[32mimport androidx.lifecycle.viewModelScope[m
[32m+[m[32mimport com.example.stushare.core.data.models.DataFailureException[m
[32m+[m[32mimport com.example.stushare.core.data.models.Document[m
[32m+[m[32mimport com.example.stushare.core.data.models.DocumentRequest // üü¢ Import Model Y√™u c·∫ßu[m
[32m+[m[32mimport com.example.stushare.core.data.repository.DocumentRepository[m
[32m+[m[32mimport com.example.stushare.core.data.repository.NotificationRepository[m
[32m+[m[32mimport com.example.stushare.core.data.repository.RequestRepository // üü¢ Import Repo Y√™u c·∫ßu[m
[32m+[m[32mimport com.example.stushare.core.domain.usecase.GetExamDocumentsUseCase[m
[32m+[m[32mimport com.example.stushare.core.domain.usecase.GetNewDocumentsUseCase[m
[32m+[m[32mimport com.google.firebase.auth.FirebaseAuth[m
[32m+[m[32mimport dagger.hilt.android.lifecycle.HiltViewModel[m
[32m+[m[32mimport kotlinx.coroutines.flow.*[m
[32m+[m[32mimport kotlinx.coroutines.launch[m
[32m+[m[32mimport javax.inject.Inject[m
[32m+[m
[32m+[m[32mdata class HomeUiState([m
[32m+[m[32m    val userName: String = "Sinh Vi√™n",[m
[32m+[m[32m    val avatarUrl: String? = null,[m
[32m+[m[32m    val newDocuments: List<Document> = emptyList(),[m
[32m+[m[32m    val examDocuments: List<Document> = emptyList(),[m
[32m+[m[32m    val bookDocuments: List<Document> = emptyList(),[m
[32m+[m[32m    val lectureDocuments: List<Document> = emptyList(),[m
[32m+[m
[32m+[m[32m    // üü¢ M·ªöI: Danh s√°ch y√™u c·∫ßu t·ª´ c·ªông ƒë·ªìng[m
[32m+[m[32m    val requestDocuments: List<DocumentRequest> = emptyList(),[m
[32m+[m
[32m+[m[32m    val unreadNotificationCount: Int = 0,[m
[32m+[m[32m    val isLoading: Boolean = false,[m
[32m+[m[32m    val isRefreshing: Boolean = false,[m
[32m+[m[32m    val errorMessage: String? = null[m
[32m+[m[32m)[m
[32m+[m
[32m+[m[32m@HiltViewModel[m
[32m+[m[32mclass HomeViewModel @Inject constructor([m
[32m+[m[32m    private val repository: DocumentRepository,[m
[32m+[m[32m    private val getNewDocumentsUseCase: GetNewDocumentsUseCase,[m
[32m+[m[32m    private val getExamDocumentsUseCase: GetExamDocumentsUseCase,[m
[32m+[m[32m    private val notificationRepository: NotificationRepository,[m
[32m+[m[32m    private val requestRepository: RequestRepository, // üü¢ Inject th√™m Repo n√†y[m
[32m+[m[32m    private val firebaseAuth: FirebaseAuth[m
[32m+[m[32m) : ViewModel() {[m
[32m+[m
[32m+[m[32m    private val _isLoading = MutableStateFlow(false)[m
[32m+[m[32m    private val _isRefreshing = MutableStateFlow(false)[m
[32m+[m[32m    private val _errorMessage = MutableStateFlow<String?>(null)[m
[32m+[m
[32m+[m[32m    // T·ªïng h·ª£p t·∫•t c·∫£ c√°c lu·ªìng d·ªØ li·ªáu (B√¢y gi·ªù l√† 9 lu·ªìng)[m
[32m+[m[32m    val uiState: StateFlow<HomeUiState> = combine([m
[32m+[m[32m        getNewDocumentsUseCase().catch { emit(emptyList()) },       // 0[m
[32m+[m[32m        getExamDocumentsUseCase().catch { emit(emptyList()) },      // 1[m
[32m+[m[32m        repository.getDocumentsByType("book").catch { emit(emptyList()) }, // 2[m
[32m+[m[32m        repository.getDocumentsByType("lecture").catch { emit(emptyList()) }, // 3[m
[32m+[m[32m        _isLoading,                                                 // 4[m
[32m+[m[32m        _isRefreshing,                                              // 5[m
[32m+[m[32m        _errorMessage,                                              // 6[m
[32m+[m[32m        notificationRepository.getUnreadCount().catch { emit(0) }.onStart { emit(0) }, // 7[m
[32m+[m[32m        requestRepository.getAllRequests().catch { emit(emptyList()) } // 8 üü¢ Lu·ªìng Y√™u c·∫ßu[m
[32m+[m[32m    ) { args ->[m
[32m+[m[32m        @Suppress("UNCHECKED_CAST")[m
[32m+[m[32m        val newDocs = args[0] as List<Document>[m
[32m+[m[32m        @Suppress("UNCHECKED_CAST")[m
[32m+[m[32m        val examDocs = args[1] as List<Document>[m
[32m+[m[32m        @Suppress("UNCHECKED_CAST")[m
[32m+[m[32m        val bookDocs = args[2] as List<Document>[m
[32m+[m[32m        @Suppress("UNCHECKED_CAST")[m
[32m+[m[32m        val lectureDocs = args[3] as List<Document>[m
[32m+[m
[32m+[m[32m        val isLoading = args[4] as Boolean[m
[32m+[m[32m        val isRefreshing = args[5] as Boolean[m
[32m+[m[32m        val error = args[6] as? String[m
[32m+[m[32m        val unreadCount = args[7] as Int[m
[32m+[m
[32m+[m[32m        @Suppress("UNCHECKED_CAST")[m
[32m+[m[32m        val requests = args[8] as List<DocumentRequest> // üü¢ L·∫•y danh s√°ch y√™u c·∫ßu[m
[32m+[m
[32m+[m[32m        val currentUser = firebaseAuth.currentUser[m
[32m+[m[32m        val name = currentUser?.displayName ?: "Sinh Vi√™n"[m
[32m+[m[32m        val avatar = currentUser?.photoUrl?.toString()[m
[32m+[m
[32m+[m[32m        HomeUiState([m
[32m+[m[32m            userName = name,[m
[32m+[m[32m            avatarUrl = avatar,[m
[32m+[m[32m            newDocuments = newDocs,[m
[32m+[m[32m            examDocuments = examDocs,[m
[32m+[m[32m            bookDocuments = bookDocs,[m
[32m+[m[32m            lectureDocuments = lectureDocs,[m
[32m+[m[32m            requestDocuments = requests.take(10), // üü¢ Ch·ªâ l·∫•y 10 y√™u c·∫ßu m·ªõi nh·∫•t ƒë·ªÉ hi·ªÉn th·ªã Home[m
[32m+[m[32m            unreadNotificationCount = unreadCount,[m
[32m+[m[32m            isLoading = isLoading,[m
[32m+[m[32m            isRefreshing = isRefreshing,[m
[32m+[m[32m            errorMessage = error[m
[32m+[m[32m        )[m
[32m+[m[32m    }.stateIn([m
[32m+[m[32m        scope = viewModelScope,[m
[32m+[m[32m        started = SharingStarted.WhileSubscribed(5000),[m
[32m+[m[32m        initialValue = HomeUiState(isLoading = true)[m
[32m+[m[32m    )[m
[32m+[m
[32m+[m[32m    init {[m
[32m+[m[32m        loadData(isInitial = true)[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    fun refreshData() {[m
[32m+[m[32m        loadData(isInitial = false)[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    private fun loadData(isInitial: Boolean) {[m
[32m+[m[32m        viewModelScope.launch {[m
[32m+[m[32m            _errorMessage.value = null[m
[32m+[m[32m            if (isInitial) _isLoading.value = true else _isRefreshing.value = true[m
[32m+[m
[32m+[m[32m            try {[m
[32m+[m[32m                repository.refreshDocumentsIfStale()[m
[32m+[m[32m                // RequestRepository d√πng Realtime flow n√™n kh√¥ng c·∫ßn refresh th·ªß c√¥ng[m
[32m+[m[32m            } catch (e: Exception) {[m
[32m+[m[32m                e.printStackTrace()[m
[32m+[m[32m                _errorMessage.value = when (e) {[m
[32m+[m[32m                    is java.io.IOException -> "Vui l√≤ng ki·ªÉm tra k·∫øt n·ªëi m·∫°ng."[m
[32m+[m[32m                    is DataFailureException.NetworkError -> "L·ªói k·∫øt n·ªëi m√°y ch·ªß."[m
[32m+[m[32m                    else -> "Kh√¥ng th·ªÉ c·∫≠p nh·∫≠t d·ªØ li·ªáu m·ªõi nh·∫•t."[m
[32m+[m[32m                }[m
[32m+[m[32m            } finally {[m
[32m+[m[32m                _isLoading.value = false[m
[32m+[m[32m                _isRefreshing.value = false[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    fun clearError() {[m
[32m+[m[32m        _errorMessage.value = null[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/features/feature_home/ui/viewall/ViewAllScreen.kt b/app/src/main/java/com/example/stushare/features/feature_home/ui/viewall/ViewAllScreen.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..61aa93d[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/features/feature_home/ui/viewall/ViewAllScreen.kt[m
[36m@@ -0,0 +1,146 @@[m
[32m+[m[32mpackage com.example.stushare.features.feature_home.ui.viewall[m
[32m+[m
[32m+[m[32mimport androidx.compose.foundation.background[m
[32m+[m[32mimport androidx.compose.foundation.layout.*[m
[32m+[m[32mimport androidx.compose.foundation.lazy.grid.GridCells[m
[32m+[m[32mimport androidx.compose.foundation.lazy.grid.LazyVerticalGrid[m
[32m+[m[32mimport androidx.compose.foundation.lazy.grid.items[m
[32m+[m[32mimport androidx.compose.material.icons.Icons[m
[32m+[m[32mimport androidx.compose.material.icons.automirrored.filled.ArrowBack[m
[32m+[m[32mimport androidx.compose.material.icons.filled.FilterList[m
[32m+[m[32mimport androidx.compose.material3.*[m
[32m+[m[32mimport androidx.compose.runtime.Composable[m
[32m+[m[32mimport androidx.compose.runtime.LaunchedEffect[m
[32m+[m[32mimport androidx.compose.runtime.getValue[m
[32m+[m[32mimport androidx.compose.ui.Alignment[m
[32m+[m[32mimport androidx.compose.ui.Modifier[m
[32m+[m[32mimport androidx.compose.ui.graphics.Color[m
[32m+[m[32mimport androidx.compose.ui.text.font.FontWeight[m
[32m+[m[32mimport androidx.compose.ui.unit.dp[m
[32m+[m[32mimport androidx.hilt.navigation.compose.hiltViewModel[m
[32m+[m[32mimport androidx.lifecycle.compose.collectAsStateWithLifecycle[m
[32m+[m[32mimport com.example.stushare.core.data.models.Document[m
[32m+[m[32mimport com.example.stushare.features.feature_home.ui.components.DocumentCard[m
[32m+[m[32mimport com.example.stushare.ui.theme.PrimaryGreen[m
[32m+[m
[32m+[m[32m@OptIn(ExperimentalMaterial3Api::class)[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun ViewAllScreen([m
[32m+[m[32m    category: String, // Nh·∫≠n category id (v√≠ d·ª•: "new_uploads")[m
[32m+[m[32m    onBackClick: () -> Unit,[m
[32m+[m[32m    onDocumentClick: (String) -> Unit,[m
[32m+[m[32m    viewModel: ViewAllViewModel = hiltViewModel()[m
[32m+[m[32m) {[m
[32m+[m[32m    val uiState by viewModel.uiState.collectAsStateWithLifecycle()[m
[32m+[m
[32m+[m[32m    // D·ªãch category sang Ti·∫øng Vi·ªát ƒë·ªÉ l√†m ti√™u ƒë·ªÅ[m
[32m+[m[32m    val screenTitle = when(category) {[m
[32m+[m[32m        "new_uploads" -> "M·ªõi ƒë∆∞·ª£c t·∫£i l√™n"[m
[32m+[m[32m        "exam_prep" -> "T√†i li·ªáu √¥n thi"[m
[32m+[m[32m        else -> "Xem t·∫•t c·∫£"[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    // Load d·ªØ li·ªáu khi m√†n h√¨nh kh·ªüi t·∫°o[m
[32m+[m[32m    LaunchedEffect(key1 = category) {[m
[32m+[m[32m        viewModel.loadCategory(category)[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    Scaffold([m
[32m+[m[32m        // 1. Header: Clean & Simple (ƒê·ªìng b·ªô v·ªõi Detail Screen)[m
[32m+[m[32m        topBar = {[m
[32m+[m[32m            CenterAlignedTopAppBar([m
[32m+[m[32m                title = {[m
[32m+[m[32m                    Text([m
[32m+[m[32m                        text = screenTitle,[m
[32m+[m[32m                        style = MaterialTheme.typography.titleMedium,[m
[32m+[m[32m                        fontWeight = FontWeight.Bold[m
[32m+[m[32m                    )[m
[32m+[m[32m                },[m
[32m+[m[32m                navigationIcon = {[m
[32m+[m[32m                    IconButton(onClick = onBackClick) {[m
[32m+[m[32m                        Icon([m
[32m+[m[32m                            imageVector = Icons.AutoMirrored.Filled.ArrowBack,[m
[32m+[m[32m                            contentDescription = "Quay v·ªÅ"[m
[32m+[m[32m                        )[m
[32m+[m[32m                    }[m
[32m+[m[32m                },[m
[32m+[m[32m                actions = {[m
[32m+[m[32m                    // N√∫t L·ªçc (Visual Cue): G·ª£i √Ω t√≠nh nƒÉng l·ªçc/s·∫Øp x·∫øp[m
[32m+[m[32m                    IconButton(onClick = { /* TODO: M·ªü BottomSheet l·ªçc */ }) {[m
[32m+[m[32m                        Icon([m
[32m+[m[32m                            imageVector = Icons.Default.FilterList,[m
[32m+[m[32m                            contentDescription = "L·ªçc",[m
[32m+[m[32m                            tint = Color.Gray[m
[32m+[m[32m                        )[m
[32m+[m[32m                    }[m
[32m+[m[32m                },[m
[32m+[m[32m                colors = TopAppBarDefaults.centerAlignedTopAppBarColors([m
[32m+[m[32m                    containerColor = Color.White,[m
[32m+[m[32m                    titleContentColor = Color.Black,[m
[32m+[m[32m                    navigationIconContentColor = Color.Black[m
[32m+[m[32m                )[m
[32m+[m[32m            )[m
[32m+[m[32m        }[m
[32m+[m[32m    ) { paddingValues ->[m
[32m+[m[32m        Box([m
[32m+[m[32m            modifier = Modifier[m
[32m+[m[32m                .fillMaxSize()[m
[32m+[m[32m                .background(Color.White) // N·ªÅn tr·∫Øng s·∫°ch s·∫Ω[m
[32m+[m[32m                .padding(paddingValues)[m
[32m+[m[32m        ) {[m
[32m+[m[32m            when (val state = uiState) {[m
[32m+[m[32m                is ViewAllUiState.Loading -> {[m
[32m+[m[32m                    Box(Modifier.fillMaxSize(), contentAlignment = Alignment.Center) {[m
[32m+[m[32m                        CircularProgressIndicator(color = PrimaryGreen)[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m                is ViewAllUiState.Error -> {[m
[32m+[m[32m                    Box(Modifier.fillMaxSize(), contentAlignment = Alignment.Center) {[m
[32m+[m[32m                        Text([m
[32m+[m[32m                            text = "ƒê√£ x·∫£y ra l·ªói: ${state.message}",[m
[32m+[m[32m                            color = Color.Red,[m
[32m+[m[32m                            style = MaterialTheme.typography.bodyMedium[m
[32m+[m[32m                        )[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m                is ViewAllUiState.Success -> {[m
[32m+[m[32m                    if (state.documents.isEmpty()) {[m
[32m+[m[32m                        Box(Modifier.fillMaxSize(), contentAlignment = Alignment.Center) {[m
[32m+[m[32m                            Text("Kh√¥ng c√≥ t√†i li·ªáu n√†o trong m·ª•c n√†y", color = Color.Gray)[m
[32m+[m[32m                        }[m
[32m+[m[32m                    } else {[m
[32m+[m[32m                        // 2. Grid Layout: T·ªëi ∆∞u kho·∫£ng tr·∫Øng (Whitespace)[m
[32m+[m[32m                        DocumentGridContent([m
[32m+[m[32m                            documents = state.documents,[m
[32m+[m[32m                            onDocumentClick = onDocumentClick[m
[32m+[m[32m                        )[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun DocumentGridContent([m
[32m+[m[32m    documents: List<Document>,[m
[32m+[m[32m    onDocumentClick: (String) -> Unit[m
[32m+[m[32m) {[m
[32m+[m[32m    LazyVerticalGrid([m
[32m+[m[32m        columns = GridCells.Fixed(2), // 2 C·ªôt[m
[32m+[m[32m        contentPadding = PaddingValues(16.dp), // Padding b√™n ngo√†i (Tho√°ng)[m
[32m+[m[32m        horizontalArrangement = Arrangement.spacedBy(16.dp), // Kho·∫£ng c√°ch c·ªôt (R·ªông h∆°n c≈©)[m
[32m+[m[32m        verticalArrangement = Arrangement.spacedBy(20.dp),   // Kho·∫£ng c√°ch h√†ng[m
[32m+[m[32m        modifier = Modifier.fillMaxSize()[m
[32m+[m[32m    ) {[m
[32m+[m[32m        items(documents) { document ->[m
[32m+[m[32m            // 3. Component: T√°i s·ª≠ d·ª•ng DocumentCard ƒë√£ n√¢ng c·∫•p[m
[32m+[m[32m            // Card s·∫Ω t·ª± gi√£n chi·ªÅu ngang (fillMaxWidth) theo c·ªôt c·ªßa Grid[m
[32m+[m[32m            DocumentCard([m
[32m+[m[32m                document = document,[m
[32m+[m[32m                onClick = { onDocumentClick(document.id.toString()) },[m
[32m+[m[32m                modifier = Modifier.fillMaxWidth()[m
[32m+[m[32m            )[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/features/feature_home/ui/viewall/ViewAllViewModel.kt b/app/src/main/java/com/example/stushare/features/feature_home/ui/viewall/ViewAllViewModel.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..273316d[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/features/feature_home/ui/viewall/ViewAllViewModel.kt[m
[36m@@ -0,0 +1,103 @@[m
[32m+[m[32mpackage com.example.stushare.features.feature_home.ui.viewall[m
[32m+[m
[32m+[m[32mimport android.util.Log[m
[32m+[m[32mimport androidx.lifecycle.ViewModel[m
[32m+[m[32mimport androidx.lifecycle.viewModelScope[m
[32m+[m[32mimport com.example.stushare.core.data.models.DataFailureException[m
[32m+[m[32mimport com.example.stushare.core.data.models.Document[m
[32m+[m[32mimport com.example.stushare.core.data.repository.DocumentRepository[m
[32m+[m[32mimport com.example.stushare.core.utils.AppConstants[m
[32m+[m[32mimport dagger.hilt.android.lifecycle.HiltViewModel[m
[32m+[m[32mimport kotlinx.coroutines.flow.MutableStateFlow[m
[32m+[m[32mimport kotlinx.coroutines.flow.StateFlow[m
[32m+[m[32mimport kotlinx.coroutines.flow.asStateFlow[m
[32m+[m[32mimport kotlinx.coroutines.flow.catch[m
[32m+[m[32mimport kotlinx.coroutines.flow.onStart[m
[32m+[m[32mimport kotlinx.coroutines.launch[m
[32m+[m[32mimport javax.inject.Inject[m
[32m+[m
[32m+[m[32m// UiState[m
[32m+[m[32msealed interface ViewAllUiState {[m
[32m+[m[32m    data object Loading : ViewAllUiState[m
[32m+[m[32m    data class Success(val documents: List<Document>) : ViewAllUiState[m
[32m+[m[32m    data class Error(val message: String) : ViewAllUiState[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m@HiltViewModel[m
[32m+[m[32mclass ViewAllViewModel @Inject constructor([m
[32m+[m[32m    private val repository: DocumentRepository[m
[32m+[m[32m) : ViewModel() {[m
[32m+[m
[32m+[m[32m    private val _uiState: MutableStateFlow<ViewAllUiState> =[m
[32m+[m[32m        MutableStateFlow(ViewAllUiState.Loading)[m
[32m+[m
[32m+[m[32m    val uiState: StateFlow<ViewAllUiState> = _uiState.asStateFlow()[m
[32m+[m
[32m+[m[32m    /**[m
[32m+[m[32m     * T·∫£i t√†i li·ªáu theo DANH M·ª§C[m
[32m+[m[32m     */[m
[32m+[m[32m    fun loadCategory(category: String) {[m
[32m+[m[32m        Log.e("VIEWMODEL_TEST", "--- ƒêANG CH·∫†Y H√ÄM loadCategory V·ªöI: $category ---")[m
[32m+[m
[32m+[m[32m        viewModelScope.launch {[m
[32m+[m[32m            val databaseType = when (category) {[m
[32m+[m[32m                AppConstants.CATEGORY_NEW_UPLOADS -> AppConstants.TYPE_BOOK[m
[32m+[m[32m                AppConstants.CATEGORY_EXAM_PREP -> AppConstants.TYPE_EXAM_PREP[m
[32m+[m[32m                else -> ""[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            // 1. C·ªë g·∫Øng refresh d·ªØ li·ªáu t·ª´ API (Network)[m
[32m+[m[32m            try {[m
[32m+[m[32m                repository.refreshDocumentsIfStale()[m
[32m+[m[32m            } catch (e: Exception) {[m
[32m+[m[32m                // N·∫øu l·ªói m·∫°ng th√¨ ch·ªâ log, kh√¥ng ch·∫∑n lu·ªìng hi·ªÉn th·ªã offline[m
[32m+[m[32m                e.printStackTrace()[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            // 2. L·∫•y d·ªØ li·ªáu t·ª´ Database (Flow) - Realtime update[m
[32m+[m[32m            repository.getDocumentsByType(databaseType)[m
[32m+[m[32m                .onStart { _uiState.value = ViewAllUiState.Loading } // Hi·ªán loading khi b·∫Øt ƒë·∫ßu[m
[32m+[m[32m                .catch { e ->[m
[32m+[m[32m                    // X·ª≠ l√Ω l·ªói khi ƒë·ªçc DB[m
[32m+[m[32m                    _uiState.value = ViewAllUiState.Error(e.message ?: "L·ªói ƒë·ªçc d·ªØ li·ªáu n·ªôi b·ªô")[m
[32m+[m[32m                }[m
[32m+[m[32m                .collect { documentsFromDb ->[m
[32m+[m[32m                    // ‚úÖ TH√ÄNH C√îNG: Flow tr·∫£ v·ªÅ List -> C·∫≠p nh·∫≠t UI[m
[32m+[m[32m                    _uiState.value = ViewAllUiState.Success(documentsFromDb)[m
[32m+[m[32m                }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    /**[m
[32m+[m[32m     * T·∫£i t√†i li·ªáu theo T·ª™ KH√ìA (Search)[m
[32m+[m[32m     */[m
[32m+[m[32m    fun search(query: String) {[m
[32m+[m[32m        Log.e("VIEWMODEL_TEST", "--- ƒêANG CH·∫†Y H√ÄM search V·ªöI: $query ---")[m
[32m+[m
[32m+[m[32m        viewModelScope.launch {[m
[32m+[m[32m            // 1. Refresh d·ªØ li·ªáu (Network)[m
[32m+[m[32m            try {[m
[32m+[m[32m                repository.refreshDocumentsIfStale()[m
[32m+[m[32m            } catch (e: Exception) {[m
[32m+[m[32m                e.printStackTrace()[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            // 2. T√¨m ki·∫øm trong Database (Flow)[m
[32m+[m[32m            // üî¥ C≈® (L·ªñI): val searchResults = repository.searchDocuments(query)[m
[32m+[m[32m            // üü¢ M·ªöI (ƒê√öNG): D√πng .collect ƒë·ªÉ l·∫Øng nghe Flow[m
[32m+[m[32m            repository.searchDocuments(query)[m
[32m+[m[32m                .onStart { _uiState.value = ViewAllUiState.Loading }[m
[32m+[m[32m                .catch { e ->[m
[32m+[m[32m                    val errorMessage = when (e) {[m
[32m+[m[32m                        is DataFailureException.NetworkError -> "L·ªói k·∫øt n·ªëi m·∫°ng."[m
[32m+[m[32m                        else -> e.message ?: "L·ªói t√¨m ki·∫øm."[m
[32m+[m[32m                    }[m
[32m+[m[32m                    _uiState.value = ViewAllUiState.Error(errorMessage)[m
[32m+[m[32m                }[m
[32m+[m[32m                .collect { searchResults ->[m
[32m+[m[32m                    // ‚úÖ TH√ÄNH C√îNG: C·∫≠p nh·∫≠t UI m·ªói khi danh s√°ch thay ƒë·ªïi[m
[32m+[m[32m                    _uiState.value = ViewAllUiState.Success(searchResults)[m
[32m+[m[32m                }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/features/feature_leaderboard/ui/LeaderboardScreen.kt b/app/src/main/java/com/example/stushare/features/feature_leaderboard/ui/LeaderboardScreen.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..9401954[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/features/feature_leaderboard/ui/LeaderboardScreen.kt[m
[36m@@ -0,0 +1,177 @@[m
[32m+[m[32mpackage com.example.stushare.features.feature_leaderboard.ui[m
[32m+[m
[32m+[m[32mimport androidx.compose.foundation.ExperimentalFoundationApi[m
[32m+[m[32mimport androidx.compose.foundation.background[m
[32m+[m[32mimport androidx.compose.foundation.layout.*[m
[32m+[m[32mimport androidx.compose.foundation.lazy.LazyColumn[m
[32m+[m[32mimport androidx.compose.foundation.lazy.itemsIndexed[m
[32m+[m[32mimport androidx.compose.foundation.pager.HorizontalPager[m
[32m+[m[32mimport androidx.compose.foundation.pager.rememberPagerState[m
[32m+[m[32mimport androidx.compose.foundation.shape.RoundedCornerShape[m
[32m+[m[32mimport androidx.compose.material3.*[m
[32m+[m[32mimport androidx.compose.material3.TabRowDefaults.tabIndicatorOffset[m
[32m+[m[32mimport androidx.compose.runtime.*[m
[32m+[m[32mimport androidx.compose.ui.Alignment[m
[32m+[m[32mimport androidx.compose.ui.Modifier[m
[32m+[m[32mimport androidx.compose.ui.graphics.Color[m
[32m+[m[32mimport androidx.compose.ui.text.font.FontWeight[m
[32m+[m[32mimport androidx.compose.ui.unit.dp[m
[32m+[m[32mimport androidx.compose.ui.unit.sp[m
[32m+[m[32mimport androidx.hilt.navigation.compose.hiltViewModel[m
[32m+[m[32mimport androidx.lifecycle.compose.collectAsStateWithLifecycle[m
[32m+[m[32mimport com.example.stushare.core.data.models.Document[m
[32m+[m[32mimport com.example.stushare.core.data.models.UserEntity[m
[32m+[m[32mimport com.example.stushare.ui.theme.GreenPrimary[m
[32m+[m[32mimport kotlinx.coroutines.launch[m
[32m+[m
[32m+[m[32m@OptIn(ExperimentalFoundationApi::class)[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun LeaderboardScreen([m
[32m+[m[32m    viewModel: LeaderboardViewModel = hiltViewModel(),[m
[32m+[m[32m    onBackClick: () -> Unit[m
[32m+[m[32m) {[m
[32m+[m[32m    // 1. Setup Pager (2 trang)[m
[32m+[m[32m    val pagerState = rememberPagerState(pageCount = { 2 })[m
[32m+[m[32m    val coroutineScope = rememberCoroutineScope()[m
[32m+[m
[32m+[m[32m    // Ti√™u ƒë·ªÅ 2 tab[m
[32m+[m[32m    val titles = listOf("T√†i li·ªáu Hot", "Top Th√†nh vi√™n")[m
[32m+[m
[32m+[m[32m    // 2. L·∫•y d·ªØ li·ªáu t·ª´ ViewModel M·ªöI[m
[32m+[m[32m    val topUsers by viewModel.topUsers.collectAsStateWithLifecycle()[m
[32m+[m[32m    val topDocuments by viewModel.topDocuments.collectAsStateWithLifecycle()[m
[32m+[m
[32m+[m[32m    Column(modifier = Modifier.fillMaxSize().background(MaterialTheme.colorScheme.background)) {[m
[32m+[m[32m        // Header[m
[32m+[m[32m        Box([m
[32m+[m[32m            modifier = Modifier[m
[32m+[m[32m                .fillMaxWidth()[m
[32m+[m[32m                .height(100.dp) // Gi·∫£m chi·ªÅu cao ch√∫t cho c√¢n ƒë·ªëi[m
[32m+[m[32m                .background(GreenPrimary)[m
[32m+[m[32m                .padding(top = 32.dp, start = 16.dp)[m
[32m+[m[32m        ) {[m
[32m+[m[32m            Row(verticalAlignment = Alignment.CenterVertically) {[m
[32m+[m[32m                IconButton(onClick = onBackClick) {[m
[32m+[m[32m                    Text("üîô", fontSize = 24.sp, color = Color.White)[m
[32m+[m[32m                }[m
[32m+[m[32m                Text([m
[32m+[m[32m                    text = "B·∫£ng x·∫øp h·∫°ng",[m
[32m+[m[32m                    fontSize = 22.sp,[m
[32m+[m[32m                    fontWeight = FontWeight.Bold,[m
[32m+[m[32m                    color = Color.White,[m
[32m+[m[32m                    modifier = Modifier.padding(start = 8.dp)[m
[32m+[m[32m                )[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        // Tab Row (Thanh chuy·ªÉn tab)[m
[32m+[m[32m        TabRow([m
[32m+[m[32m            selectedTabIndex = pagerState.currentPage,[m
[32m+[m[32m            containerColor = MaterialTheme.colorScheme.surface,[m
[32m+[m[32m            contentColor = GreenPrimary,[m
[32m+[m[32m            indicator = { tabPositions ->[m
[32m+[m[32m                TabRowDefaults.SecondaryIndicator([m
[32m+[m[32m                    Modifier.tabIndicatorOffset(tabPositions[pagerState.currentPage]),[m
[32m+[m[32m                    color = GreenPrimary[m
[32m+[m[32m                )[m
[32m+[m[32m            }[m
[32m+[m[32m        ) {[m
[32m+[m[32m            titles.forEachIndexed { index, title ->[m
[32m+[m[32m                Tab([m
[32m+[m[32m                    selected = pagerState.currentPage == index,[m
[32m+[m[32m                    onClick = {[m
[32m+[m[32m                        coroutineScope.launch { pagerState.animateScrollToPage(index) }[m
[32m+[m[32m                    },[m
[32m+[m[32m                    text = { Text(text = title, fontWeight = FontWeight.Bold) }[m
[32m+[m[32m                )[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        // N·ªôi dung Pager[m
[32m+[m[32m        HorizontalPager(state = pagerState, modifier = Modifier.weight(1f)) { page ->[m
[32m+[m[32m            when (page) {[m
[32m+[m[32m                0 -> RankedDocsList(topDocuments) // Tab 0: T√†i li·ªáu[m
[32m+[m[32m                1 -> RankedUsersList(topUsers)    // Tab 1: Th√†nh vi√™n[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m// --- C√ÅC COMPONENT CON (ƒê√£ s·ª≠a ƒë·ªÉ nh·∫≠n Entity m·ªõi) ---[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun RankedUsersList(users: List<UserEntity>) {[m
[32m+[m[32m    LazyColumn(contentPadding = PaddingValues(16.dp)) {[m
[32m+[m[32m        // itemsIndexed gi√∫p ta l·∫•y s·ªë th·ª© t·ª± (rank) t·ª± ƒë·ªông: 0->1, 1->2...[m
[32m+[m[32m        itemsIndexed(users) { index, user ->[m
[32m+[m[32m            RankItem([m
[32m+[m[32m                rank = index + 1,[m
[32m+[m[32m                title = user.fullName,[m
[32m+[m[32m                subtitle = "${user.contributionPoints} ƒëi·ªÉm"[m
[32m+[m[32m            )[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun RankedDocsList(docs: List<Document>) {[m
[32m+[m[32m    LazyColumn(contentPadding = PaddingValues(16.dp)) {[m
[32m+[m[32m        itemsIndexed(docs) { index, doc ->[m
[32m+[m[32m            RankItem([m
[32m+[m[32m                rank = index + 1,[m
[32m+[m[32m                title = doc.title,[m
[32m+[m[32m                subtitle = "${doc.author} ‚Ä¢ ${doc.downloads} l∆∞·ª£t t·∫£i"[m
[32m+[m[32m            )[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun RankItem(rank: Int, title: String, subtitle: String) {[m
[32m+[m[32m    // M√†u huy ch∆∞∆°ng[m
[32m+[m[32m    val rankColor = when (rank) {[m
[32m+[m[32m        1 -> Color(0xFFFFD700) // V√†ng[m
[32m+[m[32m        2 -> Color(0xFFC0C0C0) // B·∫°c[m
[32m+[m[32m        3 -> Color(0xFFCD7F32) // ƒê·ªìng[m
[32m+[m[32m        else -> MaterialTheme.colorScheme.onSurface[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    Card([m
[32m+[m[32m        modifier = Modifier[m
[32m+[m[32m            .fillMaxWidth()[m
[32m+[m[32m            .padding(vertical = 6.dp),[m
[32m+[m[32m        shape = RoundedCornerShape(12.dp),[m
[32m+[m[32m        colors = CardDefaults.cardColors(containerColor = MaterialTheme.colorScheme.surface),[m
[32m+[m[32m        elevation = CardDefaults.cardElevation(2.dp)[m
[32m+[m[32m    ) {[m
[32m+[m[32m        Row([m
[32m+[m[32m            modifier = Modifier.padding(16.dp),[m
[32m+[m[32m            verticalAlignment = Alignment.CenterVertically[m
[32m+[m[32m        ) {[m
[32m+[m[32m            // S·ªë th·ª© t·ª±[m
[32m+[m[32m            Text([m
[32m+[m[32m                text = "$rank",[m
[32m+[m[32m                fontSize = 20.sp,[m
[32m+[m[32m                fontWeight = FontWeight.Bold,[m
[32m+[m[32m                color = rankColor,[m
[32m+[m[32m                modifier = Modifier.width(40.dp)[m
[32m+[m[32m            )[m
[32m+[m
[32m+[m[32m            // N·ªôi dung ch√≠nh[m
[32m+[m[32m            Column {[m
[32m+[m[32m                Text([m
[32m+[m[32m                    text = title,[m
[32m+[m[32m                    fontWeight = FontWeight.Bold,[m
[32m+[m[32m                    fontSize = 16.sp,[m
[32m+[m[32m                    color = MaterialTheme.colorScheme.onSurface,[m
[32m+[m[32m                    maxLines = 1[m
[32m+[m[32m                )[m
[32m+[m[32m                Text([m
[32m+[m[32m                    text = subtitle,[m
[32m+[m[32m                    color = MaterialTheme.colorScheme.onSurface.copy(alpha = 0.6f),[m
[32m+[m[32m                    fontSize = 14.sp[m
[32m+[m[32m                )[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/features/feature_leaderboard/ui/LeaderboardViewModel.kt b/app/src/main/java/com/example/stushare/features/feature_leaderboard/ui/LeaderboardViewModel.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..cc4cfe9[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/features/feature_leaderboard/ui/LeaderboardViewModel.kt[m
[36m@@ -0,0 +1,46 @@[m
[32m+[m[32mpackage com.example.stushare.features.feature_leaderboard.ui[m
[32m+[m
[32m+[m[32mimport androidx.lifecycle.ViewModel[m
[32m+[m[32mimport androidx.lifecycle.viewModelScope[m
[32m+[m[32mimport com.example.stushare.core.data.models.Document[m
[32m+[m[32mimport com.example.stushare.core.data.models.UserEntity[m
[32m+[m[32mimport com.example.stushare.core.data.repository.LeaderboardRepository[m
[32m+[m[32mimport dagger.hilt.android.lifecycle.HiltViewModel[m
[32m+[m[32mimport kotlinx.coroutines.flow.SharingStarted[m
[32m+[m[32mimport kotlinx.coroutines.flow.StateFlow[m
[32m+[m[32mimport kotlinx.coroutines.flow.stateIn[m
[32m+[m[32mimport kotlinx.coroutines.launch[m
[32m+[m[32mimport javax.inject.Inject[m
[32m+[m
[32m+[m[32m@HiltViewModel[m
[32m+[m[32mclass LeaderboardViewModel @Inject constructor([m
[32m+[m[32m    private val repository: LeaderboardRepository[m
[32m+[m[32m) : ViewModel() {[m
[32m+[m
[32m+[m[32m    // Danh s√°ch Top Users (T·ª± ƒë·ªông c·∫≠p nh·∫≠t t·ª´ Room)[m
[32m+[m[32m    val topUsers: StateFlow<List<UserEntity>> = repository.getTopUsers()[m
[32m+[m[32m        .stateIn([m
[32m+[m[32m            scope = viewModelScope,[m
[32m+[m[32m            started = SharingStarted.WhileSubscribed(5000),[m
[32m+[m[32m            initialValue = emptyList()[m
[32m+[m[32m        )[m
[32m+[m
[32m+[m[32m    // Danh s√°ch Top Documents (T·ª± ƒë·ªông c·∫≠p nh·∫≠t t·ª´ Room)[m
[32m+[m[32m    val topDocuments: StateFlow<List<Document>> = repository.getTopDocuments()[m
[32m+[m[32m        .stateIn([m
[32m+[m[32m            scope = viewModelScope,[m
[32m+[m[32m            started = SharingStarted.WhileSubscribed(5000),[m
[32m+[m[32m            initialValue = emptyList()[m
[32m+[m[32m        )[m
[32m+[m
[32m+[m[32m    init {[m
[32m+[m[32m        // T·ª± ƒë·ªông t·∫£i d·ªØ li·ªáu m·ªõi nh·∫•t t·ª´ Firestore khi m·ªü m√†n h√¨nh[m
[32m+[m[32m        refreshData()[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    fun refreshData() {[m
[32m+[m[32m        viewModelScope.launch {[m
[32m+[m[32m            repository.refreshLeaderboard()[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/features/feature_notification/ui/NotificationScreen.kt b/app/src/main/java/com/example/stushare/features/feature_notification/ui/NotificationScreen.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..3ed626f[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/features/feature_notification/ui/NotificationScreen.kt[m
[36m@@ -0,0 +1,186 @@[m
[32m+[m[32mpackage com.example.stushare.features.feature_notification.ui[m
[32m+[m
[32m+[m[32mimport androidx.compose.animation.AnimatedVisibility[m
[32m+[m[32mimport androidx.compose.animation.core.tween[m
[32m+[m[32mimport androidx.compose.animation.fadeOut[m
[32m+[m[32mimport androidx.compose.animation.shrinkVertically[m
[32m+[m[32mimport androidx.compose.foundation.background[m
[32m+[m[32mimport androidx.compose.foundation.layout.*[m
[32m+[m[32mimport androidx.compose.foundation.lazy.LazyColumn[m
[32m+[m[32mimport androidx.compose.foundation.lazy.items[m
[32m+[m[32mimport androidx.compose.foundation.shape.CircleShape[m
[32m+[m[32mimport androidx.compose.foundation.shape.RoundedCornerShape[m
[32m+[m[32mimport androidx.compose.material.icons.Icons[m
[32m+[m[32mimport androidx.compose.material.icons.automirrored.filled.ArrowBack[m
[32m+[m[32mimport androidx.compose.material.icons.filled.CheckCircle[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Delete[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Download[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Notifications[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Star // üü¢ Import icon Ng√¥i sao[m
[32m+[m[32mimport androidx.compose.material3.*[m
[32m+[m[32mimport androidx.compose.runtime.*[m
[32m+[m[32mimport androidx.compose.ui.Alignment[m
[32m+[m[32mimport androidx.compose.ui.Modifier[m
[32m+[m[32mimport androidx.compose.ui.draw.clip[m
[32m+[m[32mimport androidx.compose.ui.graphics.Color[m
[32m+[m[32mimport androidx.compose.ui.text.font.FontWeight[m
[32m+[m[32mimport androidx.compose.ui.text.style.TextOverflow[m
[32m+[m[32mimport androidx.compose.ui.unit.dp[m
[32m+[m[32mimport androidx.compose.ui.unit.sp[m
[32m+[m[32mimport androidx.hilt.navigation.compose.hiltViewModel[m
[32m+[m[32mimport androidx.lifecycle.compose.collectAsStateWithLifecycle[m
[32m+[m[32mimport com.example.stushare.core.data.models.NotificationEntity[m
[32m+[m[32mimport com.example.stushare.ui.theme.PrimaryGreen[m
[32m+[m
[32m+[m[32m@OptIn(ExperimentalMaterial3Api::class)[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun NotificationScreen([m
[32m+[m[32m    onBackClick: () -> Unit,[m
[32m+[m[32m    onNotificationClick: (NotificationUIModel) -> Unit,[m
[32m+[m[32m    viewModel: NotificationViewModel = hiltViewModel()[m
[32m+[m[32m) {[m
[32m+[m[32m    val notifications by viewModel.notifications.collectAsStateWithLifecycle()[m
[32m+[m[32m    val unreadCount by viewModel.unreadCount.collectAsStateWithLifecycle()[m
[32m+[m
[32m+[m[32m    Scaffold([m
[32m+[m[32m        topBar = {[m
[32m+[m[32m            TopAppBar([m
[32m+[m[32m                title = {[m
[32m+[m[32m                    Column {[m
[32m+[m[32m                        Text([m
[32m+[m[32m                            text = "Th√¥ng b√°o",[m
[32m+[m[32m                            fontWeight = FontWeight.Bold,[m
[32m+[m[32m                            fontSize = 20.sp[m
[32m+[m[32m                        )[m
[32m+[m[32m                        if (unreadCount > 0) {[m
[32m+[m[32m                            Text([m
[32m+[m[32m                                text = "$unreadCount tin ch∆∞a ƒë·ªçc",[m
[32m+[m[32m                                style = MaterialTheme.typography.bodySmall,[m
[32m+[m[32m                                color = Color.White.copy(alpha = 0.8f)[m
[32m+[m[32m                            )[m
[32m+[m[32m                        }[m
[32m+[m[32m                    }[m
[32m+[m[32m                },[m
[32m+[m[32m                navigationIcon = {[m
[32m+[m[32m                    IconButton(onClick = onBackClick) {[m
[32m+[m[32m                        Icon(Icons.AutoMirrored.Filled.ArrowBack, contentDescription = "Back", tint = Color.White)[m
[32m+[m[32m                    }[m
[32m+[m[32m                },[m
[32m+[m[32m                actions = {[m
[32m+[m[32m                    TextButton(onClick = { viewModel.markAllAsRead() }) {[m
[32m+[m[32m                        Text("ƒê·ªçc t·∫•t c·∫£", color = Color.White, fontWeight = FontWeight.SemiBold)[m
[32m+[m[32m                    }[m
[32m+[m[32m                },[m
[32m+[m[32m                colors = TopAppBarDefaults.topAppBarColors(containerColor = PrimaryGreen, titleContentColor = Color.White)[m
[32m+[m[32m            )[m
[32m+[m[32m        },[m
[32m+[m[32m        containerColor = MaterialTheme.colorScheme.background[m
[32m+[m[32m    ) { paddingValues ->[m
[32m+[m[32m        if (notifications.isEmpty()) {[m
[32m+[m[32m            EmptyState(modifier = Modifier.padding(paddingValues))[m
[32m+[m[32m        } else {[m
[32m+[m[32m            LazyColumn([m
[32m+[m[32m                modifier = Modifier.fillMaxSize().padding(paddingValues),[m
[32m+[m[32m                contentPadding = PaddingValues(16.dp),[m
[32m+[m[32m                verticalArrangement = Arrangement.spacedBy(12.dp)[m
[32m+[m[32m            ) {[m
[32m+[m[32m                items(items = notifications, key = { it.id }) { notification ->[m
[32m+[m[32m                    SwipeToDeleteContainer([m
[32m+[m[32m                        item = notification,[m
[32m+[m[32m                        onDelete = { viewModel.deleteNotification(notification.id) }[m
[32m+[m[32m                    ) {[m
[32m+[m[32m                        NotificationItemRow([m
[32m+[m[32m                            item = notification,[m
[32m+[m[32m                            onItemClick = {[m
[32m+[m[32m                                viewModel.markAsRead(notification.id)[m
[32m+[m[32m                                onNotificationClick(notification)[m
[32m+[m[32m                            },[m
[32m+[m[32m                            onDeleteClick = { viewModel.deleteNotification(notification.id) }[m
[32m+[m[32m                        )[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun EmptyState(modifier: Modifier = Modifier) {[m
[32m+[m[32m    Box(modifier = modifier.fillMaxSize(), contentAlignment = Alignment.Center) {[m
[32m+[m[32m        Column(horizontalAlignment = Alignment.CenterHorizontally) {[m
[32m+[m[32m            Icon(Icons.Default.Notifications, contentDescription = null, modifier = Modifier.size(80.dp), tint = MaterialTheme.colorScheme.onSurfaceVariant.copy(alpha = 0.3f))[m
[32m+[m[32m            Spacer(modifier = Modifier.height(16.dp))[m
[32m+[m[32m            Text("Ch∆∞a c√≥ th√¥ng b√°o n√†o", style = MaterialTheme.typography.titleMedium, color = MaterialTheme.colorScheme.onSurfaceVariant)[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m@OptIn(ExperimentalMaterial3Api::class)[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun SwipeToDeleteContainer(item: Any, onDelete: () -> Unit, content: @Composable () -> Unit) {[m
[32m+[m[32m    var isRemoved by remember { mutableStateOf(false) }[m
[32m+[m[32m    val state = rememberSwipeToDismissBoxState([m
[32m+[m[32m        confirmValueChange = { value ->[m
[32m+[m[32m            if (value == SwipeToDismissBoxValue.EndToStart) {[m
[32m+[m[32m                isRemoved = true[m
[32m+[m[32m                onDelete()[m
[32m+[m[32m                true[m
[32m+[m[32m            } else false[m
[32m+[m[32m        }[m
[32m+[m[32m    )[m
[32m+[m[32m    AnimatedVisibility(visible = !isRemoved, exit = shrinkVertically(animationSpec = tween(300)) + fadeOut()) {[m
[32m+[m[32m        SwipeToDismissBox([m
[32m+[m[32m            state = state,[m
[32m+[m[32m            backgroundContent = {[m
[32m+[m[32m                val color = Color.Red.copy(alpha = 0.8f)[m
[32m+[m[32m                if (state.dismissDirection == SwipeToDismissBoxValue.EndToStart) {[m
[32m+[m[32m                    Box(modifier = Modifier.fillMaxSize().clip(RoundedCornerShape(12.dp)).background(color).padding(horizontal = 24.dp), contentAlignment = Alignment.CenterEnd) {[m
[32m+[m[32m                        Icon(Icons.Default.Delete, contentDescription = "Delete", tint = Color.White)[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m            },[m
[32m+[m[32m            content = { content() },[m
[32m+[m[32m            enableDismissFromStartToEnd = false[m
[32m+[m[32m        )[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun NotificationItemRow(item: NotificationUIModel, onItemClick: () -> Unit, onDeleteClick: () -> Unit) {[m
[32m+[m[32m    val backgroundColor = if (!item.isRead) PrimaryGreen.copy(alpha = 0.1f) else MaterialTheme.colorScheme.surface[m
[32m+[m[32m    val contentColor = MaterialTheme.colorScheme.onSurface[m
[32m+[m
[32m+[m[32m    // üü¢ C·∫¨P NH·∫¨T: Th√™m icon cho lo·∫°i RATING[m
[32m+[m[32m    val (iconVector, iconColor) = when (item.type) {[m
[32m+[m[32m        NotificationEntity.TYPE_UPLOAD -> Icons.Default.CheckCircle to PrimaryGreen[m
[32m+[m[32m        NotificationEntity.TYPE_DOWNLOAD -> Icons.Default.Download to Color(0xFF2196F3)[m
[32m+[m[32m        NotificationEntity.TYPE_RATING -> Icons.Default.Star to Color(0xFFFFC107) // ‚≠êÔ∏è M√†u v√†ng[m
[32m+[m[32m        else -> Icons.Default.Notifications to Color.Gray[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    Card([m
[32m+[m[32m        onClick = onItemClick,[m
[32m+[m[32m        colors = CardDefaults.cardColors(containerColor = backgroundColor),[m
[32m+[m[32m        elevation = CardDefaults.cardElevation(defaultElevation = if (!item.isRead) 2.dp else 0.5.dp),[m
[32m+[m[32m        shape = RoundedCornerShape(12.dp),[m
[32m+[m[32m        modifier = Modifier.fillMaxWidth()[m
[32m+[m[32m    ) {[m
[32m+[m[32m        Row(modifier = Modifier.fillMaxWidth().padding(16.dp), verticalAlignment = Alignment.Top) {[m
[32m+[m[32m            Box(modifier = Modifier.size(40.dp).clip(CircleShape).background(iconColor.copy(alpha = 0.15f)), contentAlignment = Alignment.Center) {[m
[32m+[m[32m                Icon(imageVector = iconVector, contentDescription = null, tint = iconColor, modifier = Modifier.size(24.dp))[m
[32m+[m[32m            }[m
[32m+[m[32m            Spacer(modifier = Modifier.width(16.dp))[m
[32m+[m[32m            Column(modifier = Modifier.weight(1f)) {[m
[32m+[m[32m                Row(horizontalArrangement = Arrangement.SpaceBetween, verticalAlignment = Alignment.CenterVertically, modifier = Modifier.fillMaxWidth()) {[m
[32m+[m[32m                    Text(text = item.title, style = MaterialTheme.typography.titleMedium, fontWeight = if (!item.isRead) FontWeight.Bold else FontWeight.Medium, color = contentColor, maxLines = 1, overflow = TextOverflow.Ellipsis, modifier = Modifier.weight(1f))[m
[32m+[m[32m                    Text(text = item.timeDisplay, style = MaterialTheme.typography.labelSmall, color = Color.Gray, modifier = Modifier.padding(start = 8.dp))[m
[32m+[m[32m                }[m
[32m+[m[32m                Spacer(modifier = Modifier.height(4.dp))[m
[32m+[m[32m                Text(text = item.message, style = MaterialTheme.typography.bodyMedium, color = contentColor.copy(alpha = 0.8f), maxLines = 2, overflow = TextOverflow.Ellipsis)[m
[32m+[m[32m            }[m
[32m+[m[32m            IconButton(onClick = onDeleteClick, modifier = Modifier.size(32.dp).padding(start = 4.dp).align(Alignment.CenterVertically)) {[m
[32m+[m[32m                Icon(imageVector = Icons.Default.Delete, contentDescription = "Delete", tint = Color.Gray.copy(alpha = 0.5f), modifier = Modifier.size(20.dp))[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/features/feature_notification/ui/NotificationViewModel.kt.kt b/app/src/main/java/com/example/stushare/features/feature_notification/ui/NotificationViewModel.kt.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..f4e8043[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/features/feature_notification/ui/NotificationViewModel.kt.kt[m
[36m@@ -0,0 +1,100 @@[m
[32m+[m[32mpackage com.example.stushare.features.feature_notification.ui[m
[32m+[m
[32m+[m[32mimport androidx.lifecycle.ViewModel[m
[32m+[m[32mimport androidx.lifecycle.viewModelScope[m
[32m+[m[32mimport com.example.stushare.core.data.repository.NotificationRepository[m
[32m+[m[32mimport dagger.hilt.android.lifecycle.HiltViewModel[m
[32m+[m[32mimport kotlinx.coroutines.flow.SharingStarted[m
[32m+[m[32mimport kotlinx.coroutines.flow.StateFlow[m
[32m+[m[32mimport kotlinx.coroutines.flow.map[m
[32m+[m[32mimport kotlinx.coroutines.flow.stateIn[m
[32m+[m[32mimport kotlinx.coroutines.launch[m
[32m+[m[32mimport java.text.SimpleDateFormat[m
[32m+[m[32mimport java.util.Locale[m
[32m+[m[32mimport javax.inject.Inject[m
[32m+[m
[32m+[m[32m// üü¢ 1. C·∫≠p nh·∫≠t Model hi·ªÉn th·ªã[m
[32m+[m[32mdata class NotificationUIModel([m
[32m+[m[32m    val id: String,[m
[32m+[m[32m    val title: String,[m
[32m+[m[32m    val message: String,[m
[32m+[m[32m    val timeDisplay: String,[m
[32m+[m[32m    val type: String,[m
[32m+[m[32m    val isRead: Boolean,[m
[32m+[m[32m    val relatedId: String? = null // üÜï M·ªöI: Th√™m tr∆∞·ªùng n√†y ƒë·ªÉ bi·∫øt c·∫ßn m·ªü t√†i li·ªáu n√†o[m
[32m+[m[32m)[m
[32m+[m
[32m+[m[32m@HiltViewModel[m
[32m+[m[32mclass NotificationViewModel @Inject constructor([m
[32m+[m[32m    private val repository: NotificationRepository[m
[32m+[m[32m) : ViewModel() {[m
[32m+[m
[32m+[m[32m    // üü¢ 2. Mapping d·ªØ li·ªáu v√† S·∫Øp x·∫øp[m
[32m+[m[32m    val notifications: StateFlow<List<NotificationUIModel>> = repository.getNotifications()[m
[32m+[m[32m        .map { entities ->[m
[32m+[m[32m            entities[m
[32m+[m[32m                .sortedByDescending { it.timestamp } // üÜï QUAN TR·ªåNG: S·∫Øp x·∫øp tin m·ªõi nh·∫•t l√™n ƒë·∫ßu[m
[32m+[m[32m                .map { entity ->[m
[32m+[m[32m                    NotificationUIModel([m
[32m+[m[32m                        id = entity.id,[m
[32m+[m[32m                        title = entity.title,[m
[32m+[m[32m                        message = entity.message,[m
[32m+[m[32m                        timeDisplay = convertTimestampToRelativeTime(entity.timestamp),[m
[32m+[m[32m                        type = entity.type,[m
[32m+[m[32m                        isRead = entity.isRead,[m
[32m+[m[32m                        relatedId = entity.relatedId // üÜï Map d·ªØ li·ªáu t·ª´ Entity sang UI[m
[32m+[m[32m                    )[m
[32m+[m[32m                }[m
[32m+[m[32m        }[m
[32m+[m[32m        .stateIn([m
[32m+[m[32m            scope = viewModelScope,[m
[32m+[m[32m            started = SharingStarted.WhileSubscribed(5000),[m
[32m+[m[32m            initialValue = emptyList()[m
[32m+[m[32m        )[m
[32m+[m
[32m+[m[32m    val unreadCount: StateFlow<Int> = repository.getUnreadCount()[m
[32m+[m[32m        .stateIn([m
[32m+[m[32m            scope = viewModelScope,[m
[32m+[m[32m            started = SharingStarted.WhileSubscribed(5000),[m
[32m+[m[32m            initialValue = 0[m
[32m+[m[32m        )[m
[32m+[m
[32m+[m[32m    // ƒê√°nh d·∫•u 1 tin ƒë√£ ƒë·ªçc[m
[32m+[m[32m    fun markAsRead(id: String) {[m
[32m+[m[32m        viewModelScope.launch {[m
[32m+[m[32m            repository.markAsRead(id)[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    // ƒê√°nh d·∫•u t·∫•t c·∫£ ƒë√£ ƒë·ªçc[m
[32m+[m[32m    fun markAllAsRead() {[m
[32m+[m[32m        viewModelScope.launch {[m
[32m+[m[32m            repository.markAllAsRead()[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    // X√≥a th√¥ng b√°o[m
[32m+[m[32m    fun deleteNotification(id: String) {[m
[32m+[m[32m        viewModelScope.launch {[m
[32m+[m[32m            repository.deleteNotification(id)[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    // H√†m ti·ªán √≠ch: Chuy·ªÉn ƒë·ªïi th·ªùi gian[m
[32m+[m[32m    private fun convertTimestampToRelativeTime(timestamp: Long): String {[m
[32m+[m[32m        val now = System.currentTimeMillis()[m
[32m+[m[32m        val diff = now - timestamp[m
[32m+[m
[32m+[m[32m        return when {[m
[32m+[m[32m            diff < 0 -> "V·ª´a xong" // X·ª≠ l√Ω tr∆∞·ªùng h·ª£p gi·ªù server b·ªã l·ªách nh·∫π[m
[32m+[m[32m            diff < 60 * 1000 -> "V·ª´a xong"[m
[32m+[m[32m            diff < 60 * 60 * 1000 -> "${diff / (60 * 1000)} ph√∫t tr∆∞·ªõc"[m
[32m+[m[32m            diff < 24 * 60 * 60 * 1000 -> "${diff / (60 * 60 * 1000)} gi·ªù tr∆∞·ªõc"[m
[32m+[m[32m            diff < 7 * 24 * 60 * 60 * 1000 -> "${diff / (24 * 60 * 60 * 1000)} ng√†y tr∆∞·ªõc"[m
[32m+[m[32m            else -> {[m
[32m+[m[32m                val sdf = SimpleDateFormat("dd/MM/yyyy", Locale.getDefault())[m
[32m+[m[32m                sdf.format(timestamp)[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/features/feature_profile/ui/account/AccountSecurityScreen.kt b/app/src/main/java/com/example/stushare/features/feature_profile/ui/account/AccountSecurityScreen.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..e0d02e6[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/features/feature_profile/ui/account/AccountSecurityScreen.kt[m
[36m@@ -0,0 +1,227 @@[m
[32m+[m[32mpackage com.example.stushare.features.feature_profile.ui.account[m
[32m+[m
[32m+[m[32mimport androidx.compose.foundation.background[m
[32m+[m[32mimport androidx.compose.foundation.clickable[m
[32m+[m[32mimport androidx.compose.foundation.layout.*[m
[32m+[m[32mimport androidx.compose.foundation.rememberScrollState[m
[32m+[m[32mimport androidx.compose.foundation.shape.CircleShape[m
[32m+[m[32mimport androidx.compose.foundation.shape.RoundedCornerShape[m
[32m+[m[32mimport androidx.compose.foundation.verticalScroll[m
[32m+[m[32mimport androidx.compose.material.icons.Icons[m
[32m+[m[32mimport androidx.compose.material.icons.automirrored.filled.ArrowBack[m
[32m+[m[32mimport androidx.compose.material.icons.automirrored.filled.KeyboardArrowRight[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Email[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Lock[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Person[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Phone[m
[32m+[m[32mimport androidx.compose.material3.*[m
[32m+[m[32mimport androidx.compose.runtime.Composable[m
[32m+[m[32mimport androidx.compose.ui.Alignment[m
[32m+[m[32mimport androidx.compose.ui.Modifier[m
[32m+[m[32mimport androidx.compose.ui.graphics.Color[m
[32m+[m[32mimport androidx.compose.ui.graphics.vector.ImageVector[m
[32m+[m[32mimport androidx.compose.ui.res.stringResource[m
[32m+[m[32mimport androidx.compose.ui.text.font.FontWeight[m
[32m+[m[32mimport androidx.compose.ui.unit.dp[m
[32m+[m[32mimport androidx.compose.ui.unit.sp[m
[32m+[m[32mimport com.example.stushare.R[m
[32m+[m[32mimport com.example.stushare.ui.theme.PrimaryGreen[m
[32m+[m
[32m+[m[32m@OptIn(ExperimentalMaterial3Api::class)[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun AccountSecurityScreen([m
[32m+[m[32m    userEmail: String, // üü¢ Nh·∫≠n Email t·ª´ b√™n ngo√†i[m
[32m+[m[32m    userPhone: String, // üü¢ Nh·∫≠n SƒêT t·ª´ b√™n ngo√†i[m
[32m+[m[32m    onBackClick: () -> Unit,[m
[32m+[m[32m    onPersonalInfoClick: () -> Unit,[m
[32m+[m[32m    onPhoneClick: () -> Unit,[m
[32m+[m[32m    onEmailClick: () -> Unit,[m
[32m+[m[32m    onPasswordClick: () -> Unit,[m
[32m+[m[32m    onDeleteAccountClick: () -> Unit[m
[32m+[m[32m) {[m
[32m+[m[32m    // M√†u n·ªÅn ƒë·ªông[m
[32m+[m[32m    val backgroundColor = MaterialTheme.colorScheme.background[m
[32m+[m[32m    val dividerColor = MaterialTheme.colorScheme.outlineVariant[m
[32m+[m
[32m+[m[32m    Scaffold([m
[32m+[m[32m        topBar = {[m
[32m+[m[32m            TopAppBar([m
[32m+[m[32m                title = {[m
[32m+[m[32m                    Text([m
[32m+[m[32m                        text = stringResource(R.string.acc_sec_header),[m
[32m+[m[32m                        color = Color.White,[m
[32m+[m[32m                        fontWeight = FontWeight.Bold,[m
[32m+[m[32m                        fontSize = 20.sp[m
[32m+[m[32m                    )[m
[32m+[m[32m                },[m
[32m+[m[32m                navigationIcon = {[m
[32m+[m[32m                    IconButton(onClick = onBackClick) {[m
[32m+[m[32m                        Icon([m
[32m+[m[32m                            imageVector = Icons.AutoMirrored.Filled.ArrowBack,[m
[32m+[m[32m                            contentDescription = null,[m
[32m+[m[32m                            tint = Color.White[m
[32m+[m[32m                        )[m
[32m+[m[32m                    }[m
[32m+[m[32m                },[m
[32m+[m[32m                colors = TopAppBarDefaults.topAppBarColors(containerColor = PrimaryGreen)[m
[32m+[m[32m            )[m
[32m+[m[32m        },[m
[32m+[m[32m        containerColor = backgroundColor[m
[32m+[m[32m    ) { innerPadding ->[m
[32m+[m[32m        Box(modifier = Modifier.fillMaxSize()) {[m
[32m+[m[32m            Column([m
[32m+[m[32m                modifier = Modifier[m
[32m+[m[32m                    .fillMaxSize()[m
[32m+[m[32m                    .padding(innerPadding)[m
[32m+[m[32m                    .verticalScroll(rememberScrollState())[m
[32m+[m[32m            ) {[m
[32m+[m[32m                // --- NH√ìM T√ÄI KHO·∫¢N ---[m
[32m+[m[32m                SectionHeader(title = stringResource(R.string.acc_sec_account_group))[m
[32m+[m
[32m+[m[32m                AccountItem([m
[32m+[m[32m                    title = stringResource(R.string.acc_sec_personal_info),[m
[32m+[m[32m                    subtitle = stringResource(R.string.acc_sec_username_label),[m
[32m+[m[32m                    iconVector = Icons.Default.Person,[m
[32m+[m[32m                    isAvatar = true,[m
[32m+[m[32m                    onClick = onPersonalInfoClick[m
[32m+[m[32m                )[m
[32m+[m
[32m+[m[32m                HorizontalDivider(thickness = 1.dp, color = dividerColor)[m
[32m+[m
[32m+[m[32m                // üü¢ Hi·ªÉn th·ªã S·ªë ƒëi·ªán tho·∫°i th·ª±c t·∫ø[m
[32m+[m[32m                AccountItem([m
[32m+[m[32m                    title = stringResource(R.string.acc_sec_phone),[m
[32m+[m[32m                    subtitle = if (userPhone.isNotBlank()) userPhone else "Ch∆∞a li√™n k·∫øt",[m
[32m+[m[32m                    iconVector = Icons.Default.Phone,[m
[32m+[m[32m                    onClick = onPhoneClick[m
[32m+[m[32m                )[m
[32m+[m
[32m+[m[32m                HorizontalDivider(thickness = 1.dp, color = dividerColor)[m
[32m+[m
[32m+[m[32m                // üü¢ Hi·ªÉn th·ªã Email th·ª±c t·∫ø[m
[32m+[m[32m                AccountItem([m
[32m+[m[32m                    title = stringResource(R.string.acc_sec_email),[m
[32m+[m[32m                    subtitle = if (userEmail.isNotBlank()) userEmail else stringResource(R.string.acc_sec_not_linked),[m
[32m+[m[32m                    iconVector = Icons.Default.Email,[m
[32m+[m[32m                    onClick = onEmailClick[m
[32m+[m[32m                )[m
[32m+[m
[32m+[m[32m                // --- NH√ìM B·∫¢O M·∫¨T ---[m
[32m+[m[32m                SectionHeader(title = stringResource(R.string.acc_sec_security_group))[m
[32m+[m
[32m+[m[32m                AccountItem([m
[32m+[m[32m                    title = stringResource(R.string.acc_sec_password),[m
[32m+[m[32m                    subtitle = "********", // ·∫®n m·∫≠t kh·∫©u[m
[32m+[m[32m                    iconVector = Icons.Default.Lock,[m
[32m+[m[32m                    onClick = onPasswordClick[m
[32m+[m[32m                )[m
[32m+[m
[32m+[m[32m                // --- NH√ìM V√î HI·ªÜU H√ìA ---[m
[32m+[m[32m                SectionHeader(title = stringResource(R.string.acc_sec_disable_group))[m
[32m+[m
[32m+[m[32m                AccountItem([m
[32m+[m[32m                    title = stringResource(R.string.acc_sec_delete_acc),[m
[32m+[m[32m                    subtitle = null,[m
[32m+[m[32m                    iconVector = null,[m
[32m+[m[32m                    onClick = onDeleteAccountClick[m
[32m+[m[32m                )[m
[32m+[m
[32m+[m[32m                Spacer(modifier = Modifier.height(100.dp))[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            // Bottom Curve (Trang tr√≠)[m
[32m+[m[32m            Box([m
[32m+[m[32m                modifier = Modifier[m
[32m+[m[32m                    .align(Alignment.BottomCenter)[m
[32m+[m[32m                    .fillMaxWidth()[m
[32m+[m[32m                    .height(120.dp)[m
[32m+[m[32m                    .offset(y = 60.dp)[m
[32m+[m[32m                    .background([m
[32m+[m[32m                        color = PrimaryGreen,[m
[32m+[m[32m                        shape = RoundedCornerShape(topStart = 1000.dp, topEnd = 1000.dp)[m
[32m+[m[32m                    )[m
[32m+[m[32m            )[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun SectionHeader(title: String) {[m
[32m+[m[32m    Text([m
[32m+[m[32m        text = title,[m
[32m+[m[32m        color = PrimaryGreen,[m
[32m+[m[32m        fontWeight = FontWeight.Bold,[m
[32m+[m[32m        fontSize = 16.sp,[m
[32m+[m[32m        modifier = Modifier.padding(start = 16.dp, top = 24.dp, bottom = 8.dp)[m
[32m+[m[32m    )[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun AccountItem([m
[32m+[m[32m    title: String,[m
[32m+[m[32m    subtitle: String?,[m
[32m+[m[32m    iconVector: ImageVector?,[m
[32m+[m[32m    isAvatar: Boolean = false,[m
[32m+[m[32m    onClick: () -> Unit[m
[32m+[m[32m) {[m
[32m+[m[32m    val surfaceColor = MaterialTheme.colorScheme.surface[m
[32m+[m[32m    val onSurfaceColor = MaterialTheme.colorScheme.onSurface[m
[32m+[m
[32m+[m[32m    Row([m
[32m+[m[32m        modifier = Modifier[m
[32m+[m[32m            .fillMaxWidth()[m
[32m+[m[32m            .background(surfaceColor)[m
[32m+[m[32m            .clickable(onClick = onClick)[m
[32m+[m[32m            .padding(horizontal = 16.dp, vertical = 12.dp),[m
[32m+[m[32m        verticalAlignment = Alignment.CenterVertically[m
[32m+[m[32m    ) {[m
[32m+[m[32m        if (iconVector != null) {[m
[32m+[m[32m            if (isAvatar) {[m
[32m+[m[32m                Surface([m
[32m+[m[32m                    modifier = Modifier.size(48.dp),[m
[32m+[m[32m                    shape = CircleShape,[m
[32m+[m[32m                    color = MaterialTheme.colorScheme.surfaceVariant[m
[32m+[m[32m                ) {[m
[32m+[m[32m                    Icon([m
[32m+[m[32m                        imageVector = iconVector,[m
[32m+[m[32m                        contentDescription = null,[m
[32m+[m[32m                        tint = onSurfaceColor.copy(alpha = 0.6f),[m
[32m+[m[32m                        modifier = Modifier.padding(10.dp)[m
[32m+[m[32m                    )[m
[32m+[m[32m                }[m
[32m+[m[32m            } else {[m
[32m+[m[32m                Icon([m
[32m+[m[32m                    imageVector = iconVector,[m
[32m+[m[32m                    contentDescription = null,[m
[32m+[m[32m                    tint = PrimaryGreen,[m
[32m+[m[32m                    modifier = Modifier.size(28.dp)[m
[32m+[m[32m                )[m
[32m+[m[32m            }[m
[32m+[m[32m            Spacer(modifier = Modifier.width(16.dp))[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        Column(modifier = Modifier.weight(1f)) {[m
[32m+[m[32m            Text([m
[32m+[m[32m                text = title,[m
[32m+[m[32m                fontSize = 16.sp,[m
[32m+[m[32m                fontWeight = if (isAvatar) FontWeight.Normal else FontWeight.Medium,[m
[32m+[m[32m                color = onSurfaceColor[m
[32m+[m[32m            )[m
[32m+[m[32m            if (subtitle != null) {[m
[32m+[m[32m                Spacer(modifier = Modifier.height(4.dp))[m
[32m+[m[32m                Text([m
[32m+[m[32m                    text = subtitle,[m
[32m+[m[32m                    fontSize = 14.sp,[m
[32m+[m[32m                    fontWeight = if (isAvatar) FontWeight.Bold else FontWeight.Normal,[m
[32m+[m[32m                    color = if (isAvatar) onSurfaceColor else onSurfaceColor.copy(alpha = 0.6f)[m
[32m+[m[32m                )[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        Icon([m
[32m+[m[32m            imageVector = Icons.AutoMirrored.Filled.KeyboardArrowRight,[m
[32m+[m[32m            contentDescription = null,[m
[32m+[m[32m            tint = onSurfaceColor.copy(alpha = 0.4f)[m
[32m+[m[32m        )[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/features/feature_profile/ui/account/ChangePasswordScreen.kt b/app/src/main/java/com/example/stushare/features/feature_profile/ui/account/ChangePasswordScreen.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..a892a7e[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/features/feature_profile/ui/account/ChangePasswordScreen.kt[m
[36m@@ -0,0 +1,181 @@[m
[32m+[m[32mpackage com.example.stushare.features.feature_profile.ui.account[m
[32m+[m
[32m+[m[32mimport android.widget.Toast[m
[32m+[m[32mimport androidx.compose.foundation.layout.*[m
[32m+[m[32mimport androidx.compose.material.icons.Icons[m
[32m+[m[32mimport androidx.compose.material.icons.automirrored.filled.ArrowBack[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Visibility[m
[32m+[m[32mimport androidx.compose.material.icons.filled.VisibilityOff[m
[32m+[m[32mimport androidx.compose.material3.*[m
[32m+[m[32mimport androidx.compose.runtime.*[m
[32m+[m[32mimport androidx.compose.ui.Alignment[m
[32m+[m[32mimport androidx.compose.ui.Modifier[m
[32m+[m[32mimport androidx.compose.ui.graphics.Color[m
[32m+[m[32mimport androidx.compose.ui.platform.LocalContext[m
[32m+[m[32mimport androidx.compose.ui.res.stringResource[m
[32m+[m[32mimport androidx.compose.ui.text.font.FontWeight[m
[32m+[m[32mimport androidx.compose.ui.text.input.PasswordVisualTransformation[m
[32m+[m[32mimport androidx.compose.ui.text.input.VisualTransformation[m
[32m+[m[32mimport androidx.compose.ui.unit.dp[m
[32m+[m[32mimport androidx.compose.ui.unit.sp[m
[32m+[m[32mimport androidx.hilt.navigation.compose.hiltViewModel[m
[32m+[m[32mimport com.example.stushare.R[m
[32m+[m[32mimport com.example.stushare.features.feature_profile.ui.main.ProfileViewModel[m
[32m+[m[32mimport com.example.stushare.ui.theme.PrimaryGreen[m
[32m+[m
[32m+[m[32m@OptIn(ExperimentalMaterial3Api::class)[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun ChangePasswordScreen([m
[32m+[m[32m    onBackClick: () -> Unit,[m
[32m+[m[32m    viewModel: ProfileViewModel = hiltViewModel() // 1. Inject ViewModel[m
[32m+[m[32m) {[m
[32m+[m[32m    val context = LocalContext.current[m
[32m+[m
[32m+[m[32m    // State cho c√°c √¥ nh·∫≠p[m
[32m+[m[32m    var currentPass by remember { mutableStateOf("") }[m
[32m+[m[32m    var newPass by remember { mutableStateOf("") }[m
[32m+[m[32m    var confirmPass by remember { mutableStateOf("") }[m
[32m+[m
[32m+[m[32m    // State hi·ªÉn th·ªã m·∫≠t kh·∫©u (·∫®n/Hi·ªán) - N√¢ng cao UX[m
[32m+[m[32m    var showCurrentPass by remember { mutableStateOf(false) }[m
[32m+[m[32m    var showNewPass by remember { mutableStateOf(false) }[m
[32m+[m
[32m+[m[32m    // State Loading (ƒë·ªÉ v√¥ hi·ªáu h√≥a n√∫t khi ƒëang g·ª≠i request)[m
[32m+[m[32m    var isLoading by remember { mutableStateOf(false) }[m
[32m+[m
[32m+[m[32m    // L·∫Øng nghe th√¥ng b√°o t·ª´ ViewModel[m
[32m+[m[32m    LaunchedEffect(Unit) {[m
[32m+[m[32m        viewModel.updateMessage.collect { message ->[m
[32m+[m[32m            isLoading = false // T·∫Øt loading khi c√≥ k·∫øt qu·∫£[m
[32m+[m[32m            Toast.makeText(context, message, Toast.LENGTH_SHORT).show()[m
[32m+[m[32m            if (message == "ƒê·ªïi m·∫≠t kh·∫©u th√†nh c√¥ng!") {[m
[32m+[m[32m                onBackClick() // T·ª± ƒë·ªông back v·ªÅ n·∫øu th√†nh c√¥ng[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    val backgroundColor = MaterialTheme.colorScheme.background[m
[32m+[m[32m    val surfaceColor = MaterialTheme.colorScheme.surface[m
[32m+[m[32m    val onSurfaceColor = MaterialTheme.colorScheme.onSurface[m
[32m+[m
[32m+[m[32m    Scaffold([m
[32m+[m[32m        topBar = {[m
[32m+[m[32m            TopAppBar([m
[32m+[m[32m                title = {[m
[32m+[m[32m                    Text([m
[32m+[m[32m                        // stringResource(R.string.cp_title), // D√πng t·∫°m chu·ªói c·ª©ng n·∫øu ch∆∞a c√≥ string[m
[32m+[m[32m                        "ƒê·ªïi m·∫≠t kh·∫©u",[m
[32m+[m[32m                        color = Color.White,[m
[32m+[m[32m                        fontWeight = FontWeight.Bold[m
[32m+[m[32m                    )[m
[32m+[m[32m                },[m
[32m+[m[32m                navigationIcon = {[m
[32m+[m[32m                    IconButton(onClick = onBackClick) {[m
[32m+[m[32m                        Icon(Icons.AutoMirrored.Filled.ArrowBack, contentDescription = null, tint = Color.White)[m
[32m+[m[32m                    }[m
[32m+[m[32m                },[m
[32m+[m[32m                colors = TopAppBarDefaults.topAppBarColors(containerColor = PrimaryGreen)[m
[32m+[m[32m            )[m
[32m+[m[32m        },[m
[32m+[m[32m        containerColor = backgroundColor[m
[32m+[m[32m    ) { innerPadding ->[m
[32m+[m[32m        Column([m
[32m+[m[32m            modifier = Modifier[m
[32m+[m[32m                .fillMaxSize()[m
[32m+[m[32m                .padding(innerPadding)[m
[32m+[m[32m                .padding(16.dp),[m
[32m+[m[32m            horizontalAlignment = Alignment.CenterHorizontally[m
[32m+[m[32m        ) {[m
[32m+[m[32m            Card([m
[32m+[m[32m                colors = CardDefaults.cardColors(containerColor = surfaceColor),[m
[32m+[m[32m                elevation = CardDefaults.cardElevation(2.dp),[m
[32m+[m[32m                modifier = Modifier.fillMaxWidth()[m
[32m+[m[32m            ) {[m
[32m+[m[32m                Column(modifier = Modifier.padding(16.dp)) {[m
[32m+[m
[32m+[m[32m                    // 1. M·∫≠t kh·∫©u hi·ªán t·∫°i[m
[32m+[m[32m                    OutlinedTextField([m
[32m+[m[32m                        value = currentPass,[m
[32m+[m[32m                        onValueChange = { currentPass = it },[m
[32m+[m[32m                        label = { Text("M·∫≠t kh·∫©u hi·ªán t·∫°i") },[m
[32m+[m[32m                        visualTransformation = if (showCurrentPass) VisualTransformation.None else PasswordVisualTransformation(),[m
[32m+[m[32m                        trailingIcon = {[m
[32m+[m[32m                            IconButton(onClick = { showCurrentPass = !showCurrentPass }) {[m
[32m+[m[32m                                Icon(if (showCurrentPass) Icons.Default.Visibility else Icons.Default.VisibilityOff, contentDescription = null)[m
[32m+[m[32m                            }[m
[32m+[m[32m                        },[m
[32m+[m[32m                        modifier = Modifier.fillMaxWidth(),[m
[32m+[m[32m                        colors = OutlinedTextFieldDefaults.colors([m
[32m+[m[32m                            focusedLabelColor = PrimaryGreen,[m
[32m+[m[32m                            focusedBorderColor = PrimaryGreen[m
[32m+[m[32m                        )[m
[32m+[m[32m                    )[m
[32m+[m[32m                    Spacer(modifier = Modifier.height(12.dp))[m
[32m+[m
[32m+[m[32m                    // 2. M·∫≠t kh·∫©u m·ªõi[m
[32m+[m[32m                    OutlinedTextField([m
[32m+[m[32m                        value = newPass,[m
[32m+[m[32m                        onValueChange = { newPass = it },[m
[32m+[m[32m                        label = { Text("M·∫≠t kh·∫©u m·ªõi") },[m
[32m+[m[32m                        visualTransformation = if (showNewPass) VisualTransformation.None else PasswordVisualTransformation(),[m
[32m+[m[32m                        trailingIcon = {[m
[32m+[m[32m                            IconButton(onClick = { showNewPass = !showNewPass }) {[m
[32m+[m[32m                                Icon(if (showNewPass) Icons.Default.Visibility else Icons.Default.VisibilityOff, contentDescription = null)[m
[32m+[m[32m                            }[m
[32m+[m[32m                        },[m
[32m+[m[32m                        modifier = Modifier.fillMaxWidth(),[m
[32m+[m[32m                        colors = OutlinedTextFieldDefaults.colors([m
[32m+[m[32m                            focusedLabelColor = PrimaryGreen,[m
[32m+[m[32m                            focusedBorderColor = PrimaryGreen[m
[32m+[m[32m                        )[m
[32m+[m[32m                    )[m
[32m+[m[32m                    Spacer(modifier = Modifier.height(12.dp))[m
[32m+[m
[32m+[m[32m                    // 3. Nh·∫≠p l·∫°i m·∫≠t kh·∫©u m·ªõi[m
[32m+[m[32m                    OutlinedTextField([m
[32m+[m[32m                        value = confirmPass,[m
[32m+[m[32m                        onValueChange = { confirmPass = it },[m
[32m+[m[32m                        label = { Text("X√°c nh·∫≠n m·∫≠t kh·∫©u m·ªõi") },[m
[32m+[m[32m                        visualTransformation = PasswordVisualTransformation(), // Lu√¥n ·∫©n √¥ n√†y[m
[32m+[m[32m                        modifier = Modifier.fillMaxWidth(),[m
[32m+[m[32m                        colors = OutlinedTextFieldDefaults.colors([m
[32m+[m[32m                            focusedLabelColor = PrimaryGreen,[m
[32m+[m[32m                            focusedBorderColor = PrimaryGreen[m
[32m+[m[32m                        ),[m
[32m+[m[32m                        isError = confirmPass.isNotEmpty() && confirmPass != newPass // B√°o ƒë·ªè n·∫øu kh√¥ng kh·ªõp[m
[32m+[m[32m                    )[m
[32m+[m[32m                    if (confirmPass.isNotEmpty() && confirmPass != newPass) {[m
[32m+[m[32m                        Text("M·∫≠t kh·∫©u kh√¥ng kh·ªõp", color = Color.Red, fontSize = 12.sp, modifier = Modifier.padding(start = 8.dp))[m
[32m+[m[32m                    }[m
[32m+[m
[32m+[m[32m                    Spacer(modifier = Modifier.height(24.dp))[m
[32m+[m
[32m+[m[32m                    // Button L∆∞u[m
[32m+[m[32m                    Button([m
[32m+[m[32m                        onClick = {[m
[32m+[m[32m                            if (currentPass.isEmpty() || newPass.isEmpty()) {[m
[32m+[m[32m                                Toast.makeText(context, "Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin", Toast.LENGTH_SHORT).show()[m
[32m+[m[32m                            } else if (newPass.length < 6) {[m
[32m+[m[32m                                Toast.makeText(context, "M·∫≠t kh·∫©u m·ªõi ph·∫£i t·ª´ 6 k√Ω t·ª±", Toast.LENGTH_SHORT).show()[m
[32m+[m[32m                            } else if (newPass != confirmPass) {[m
[32m+[m[32m                                Toast.makeText(context, "M·∫≠t kh·∫©u x√°c nh·∫≠n kh√¥ng kh·ªõp", Toast.LENGTH_SHORT).show()[m
[32m+[m[32m                            } else {[m
[32m+[m[32m                                isLoading = true[m
[32m+[m[32m                                viewModel.changePassword(currentPass, newPass)[m
[32m+[m[32m                            }[m
[32m+[m[32m                        },[m
[32m+[m[32m                        enabled = !isLoading, // Kh√≥a n√∫t khi ƒëang load[m
[32m+[m[32m                        colors = ButtonDefaults.buttonColors(containerColor = PrimaryGreen),[m
[32m+[m[32m                        modifier = Modifier.fillMaxWidth().height(50.dp)[m
[32m+[m[32m                    ) {[m
[32m+[m[32m                        if (isLoading) {[m
[32m+[m[32m                            CircularProgressIndicator(color = Color.White, modifier = Modifier.size(24.dp))[m
[32m+[m[32m                        } else {[m
[32m+[m[32m                            Text("ƒê·ªïi m·∫≠t kh·∫©u", fontWeight = FontWeight.Bold)[m
[32m+[m[32m                        }[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/features/feature_profile/ui/account/EditAttributeScreen.kt b/app/src/main/java/com/example/stushare/features/feature_profile/ui/account/EditAttributeScreen.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..0cb0fbd[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/features/feature_profile/ui/account/EditAttributeScreen.kt[m
[36m@@ -0,0 +1,83 @@[m
[32m+[m[32mpackage com.example.stushare.features.feature_profile.ui.account[m
[32m+[m
[32m+[m[32mimport android.widget.Toast[m
[32m+[m[32mimport androidx.compose.foundation.layout.*[m
[32m+[m[32mimport androidx.compose.material.icons.Icons[m
[32m+[m[32mimport androidx.compose.material.icons.automirrored.filled.ArrowBack[m
[32m+[m[32mimport androidx.compose.material3.*[m
[32m+[m[32mimport androidx.compose.runtime.*[m
[32m+[m[32mimport androidx.compose.ui.Modifier[m
[32m+[m[32mimport androidx.compose.ui.graphics.Color[m
[32m+[m[32mimport androidx.compose.ui.platform.LocalContext[m
[32m+[m[32mimport androidx.compose.ui.res.stringResource[m
[32m+[m[32mimport androidx.compose.ui.text.font.FontWeight[m
[32m+[m[32mimport androidx.compose.ui.unit.dp[m
[32m+[m[32mimport com.example.stushare.R[m
[32m+[m[32mimport com.example.stushare.ui.theme.PrimaryGreen[m
[32m+[m
[32m+[m[32m@OptIn(ExperimentalMaterial3Api::class)[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun EditAttributeScreen([m
[32m+[m[32m    title: String,[m
[32m+[m[32m    initialValue: String,[m
[32m+[m[32m    label: String,[m
[32m+[m[32m    onBackClick: () -> Unit,[m
[32m+[m[32m    onSaveClick: (String) -> Unit // üü¢ New callback to return data[m
[32m+[m[32m) {[m
[32m+[m[32m    val context = LocalContext.current[m
[32m+[m[32m    var value by remember { mutableStateOf(initialValue) }[m
[32m+[m
[32m+[m[32m    // Dynamic theme colors[m
[32m+[m[32m    val backgroundColor = MaterialTheme.colorScheme.background[m
[32m+[m[32m    val onSurfaceColor = MaterialTheme.colorScheme.onSurface[m
[32m+[m
[32m+[m[32m    Scaffold([m
[32m+[m[32m        topBar = {[m
[32m+[m[32m            TopAppBar([m
[32m+[m[32m                title = { Text(title, color = Color.White, fontWeight = FontWeight.Bold) },[m
[32m+[m[32m                navigationIcon = {[m
[32m+[m[32m                    IconButton(onClick = onBackClick) {[m
[32m+[m[32m                        Icon([m
[32m+[m[32m                            imageVector = Icons.AutoMirrored.Filled.ArrowBack,[m
[32m+[m[32m                            contentDescription = null,[m
[32m+[m[32m                            tint = Color.White[m
[32m+[m[32m                        )[m
[32m+[m[32m                    }[m
[32m+[m[32m                },[m
[32m+[m[32m                colors = TopAppBarDefaults.topAppBarColors(containerColor = PrimaryGreen)[m
[32m+[m[32m            )[m
[32m+[m[32m        },[m
[32m+[m[32m        containerColor = backgroundColor[m
[32m+[m[32m    ) { innerPadding ->[m
[32m+[m[32m        Column(modifier = Modifier.padding(innerPadding).padding(16.dp)) {[m
[32m+[m[32m            OutlinedTextField([m
[32m+[m[32m                value = value,[m
[32m+[m[32m                onValueChange = { value = it },[m
[32m+[m[32m                label = { Text(label) },[m
[32m+[m[32m                modifier = Modifier.fillMaxWidth(),[m
[32m+[m[32m                colors = OutlinedTextFieldDefaults.colors([m
[32m+[m[32m                    focusedTextColor = onSurfaceColor,[m
[32m+[m[32m                    unfocusedTextColor = onSurfaceColor,[m
[32m+[m[32m                    focusedLabelColor = PrimaryGreen,[m
[32m+[m[32m                    focusedBorderColor = PrimaryGreen[m
[32m+[m[32m                )[m
[32m+[m[32m            )[m
[32m+[m[32m            Spacer(modifier = Modifier.height(24.dp))[m
[32m+[m
[32m+[m[32m            Button([m
[32m+[m[32m                onClick = {[m
[32m+[m[32m                    if (value.isNotBlank()) {[m
[32m+[m[32m                        // üü¢ Call the callback with the new value[m
[32m+[m[32m                        onSaveClick(value)[m
[32m+[m[32m                    } else {[m
[32m+[m[32m                        Toast.makeText(context, "Vui l√≤ng nh·∫≠p th√¥ng tin", Toast.LENGTH_SHORT).show()[m
[32m+[m[32m                    }[m
[32m+[m[32m                },[m
[32m+[m[32m                colors = ButtonDefaults.buttonColors(containerColor = PrimaryGreen),[m
[32m+[m[32m                modifier = Modifier.fillMaxWidth()[m
[32m+[m[32m            ) {[m
[32m+[m[32m                Text(stringResource(R.string.edit_save_btn))[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/features/feature_profile/ui/account/PersonalInfoScreen.kt b/app/src/main/java/com/example/stushare/features/feature_profile/ui/account/PersonalInfoScreen.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..f2229f1[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/features/feature_profile/ui/account/PersonalInfoScreen.kt[m
[36m@@ -0,0 +1,300 @@[m
[32m+[m[32mpackage com.example.stushare.features.feature_profile.ui.account[m
[32m+[m
[32m+[m[32mimport android.widget.Toast[m
[32m+[m[32mimport androidx.activity.compose.rememberLauncherForActivityResult[m
[32m+[m[32mimport androidx.activity.result.PickVisualMediaRequest[m
[32m+[m[32mimport androidx.activity.result.contract.ActivityResultContracts[m
[32m+[m[32mimport androidx.compose.foundation.background[m
[32m+[m[32mimport androidx.compose.foundation.clickable[m
[32m+[m[32mimport androidx.compose.foundation.layout.*[m
[32m+[m[32mimport androidx.compose.foundation.rememberScrollState[m
[32m+[m[32mimport androidx.compose.foundation.shape.CircleShape[m
[32m+[m[32mimport androidx.compose.foundation.shape.RoundedCornerShape[m
[32m+[m[32mimport androidx.compose.foundation.text.KeyboardOptions[m
[32m+[m[32mimport androidx.compose.foundation.verticalScroll[m
[32m+[m[32mimport androidx.compose.material.icons.Icons[m
[32m+[m[32mimport androidx.compose.material.icons.automirrored.filled.ArrowBack[m
[32m+[m[32mimport androidx.compose.material.icons.filled.ArrowDropDown[m
[32m+[m[32mimport androidx.compose.material.icons.filled.CameraAlt[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Edit[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Email[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Person[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Save[m
[32m+[m[32mimport androidx.compose.material.icons.filled.School[m
[32m+[m[32mimport androidx.compose.material3.*[m
[32m+[m[32mimport androidx.compose.runtime.*[m
[32m+[m[32mimport androidx.compose.ui.Alignment[m
[32m+[m[32mimport androidx.compose.ui.Modifier[m
[32m+[m[32mimport androidx.compose.ui.draw.clip[m
[32m+[m[32mimport androidx.compose.ui.graphics.Color[m
[32m+[m[32mimport androidx.compose.ui.layout.ContentScale[m
[32m+[m[32mimport androidx.compose.ui.platform.LocalContext[m
[32m+[m[32mimport androidx.compose.ui.platform.LocalFocusManager[m
[32m+[m[32mimport androidx.compose.ui.res.stringResource[m
[32m+[m[32mimport androidx.compose.ui.text.font.FontWeight[m
[32m+[m[32mimport androidx.compose.ui.text.input.KeyboardCapitalization[m
[32m+[m[32mimport androidx.compose.ui.text.input.ImeAction[m
[32m+[m[32mimport androidx.compose.ui.unit.dp[m
[32m+[m[32mimport androidx.compose.ui.unit.sp[m
[32m+[m[32mimport androidx.hilt.navigation.compose.hiltViewModel[m
[32m+[m[32mimport androidx.lifecycle.compose.collectAsStateWithLifecycle[m
[32m+[m[32mimport coil.compose.AsyncImage[m
[32m+[m[32mimport com.example.stushare.R[m
[32m+[m[32mimport com.example.stushare.features.feature_profile.ui.main.ProfileUiState[m
[32m+[m[32mimport com.example.stushare.features.feature_profile.ui.main.ProfileViewModel[m
[32m+[m[32mimport com.example.stushare.features.feature_profile.ui.model.UserProfile[m
[32m+[m[32mimport com.example.stushare.ui.theme.PrimaryGreen[m
[32m+[m
[32m+[m[32m@OptIn(ExperimentalMaterial3Api::class)[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun PersonalInfoScreen([m
[32m+[m[32m    onBackClick: () -> Unit,[m
[32m+[m[32m    viewModel: ProfileViewModel = hiltViewModel()[m
[32m+[m[32m) {[m
[32m+[m[32m    val context = LocalContext.current[m
[32m+[m[32m    val focusManager = LocalFocusManager.current[m
[32m+[m
[32m+[m[32m    val uiState by viewModel.uiState.collectAsStateWithLifecycle()[m
[32m+[m[32m    val isUploadingAvatar by viewModel.isUploadingAvatar.collectAsStateWithLifecycle()[m
[32m+[m
[32m+[m[32m    // Local State cho c√°c tr∆∞·ªùng ch·ªânh s·ª≠a[m
[32m+[m[32m    var name by remember { mutableStateOf("") }[m
[32m+[m[32m    var major by remember { mutableStateOf("") }[m
[32m+[m[32m    var bio by remember { mutableStateOf("") }[m
[32m+[m
[32m+[m[32m    // ƒê·ªìng b·ªô d·ªØ li·ªáu khi load[m
[32m+[m[32m    LaunchedEffect(uiState) {[m
[32m+[m[32m        if (uiState is ProfileUiState.Authenticated) {[m
[32m+[m[32m            val profile = (uiState as ProfileUiState.Authenticated).profile[m
[32m+[m[32m            name = profile.fullName[m
[32m+[m[32m            major = profile.major[m
[32m+[m[32m            bio = profile.bio[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    LaunchedEffect(Unit) {[m
[32m+[m[32m        viewModel.updateMessage.collect { message ->[m
[32m+[m[32m            Toast.makeText(context, message, Toast.LENGTH_SHORT).show()[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    val imagePickerLauncher = rememberLauncherForActivityResult([m
[32m+[m[32m        contract = ActivityResultContracts.PickVisualMedia()[m
[32m+[m[32m    ) { uri ->[m
[32m+[m[32m        if (uri != null) {[m
[32m+[m[32m            viewModel.uploadAvatar(uri)[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    Scaffold([m
[32m+[m[32m        topBar = {[m
[32m+[m[32m            CenterAlignedTopAppBar([m
[32m+[m[32m                title = { Text(text = "Th√¥ng tin c√° nh√¢n", fontWeight = FontWeight.Bold, fontSize = 18.sp, color = Color.White) },[m
[32m+[m[32m                navigationIcon = {[m
[32m+[m[32m                    IconButton(onClick = onBackClick) {[m
[32m+[m[32m                        Icon(Icons.AutoMirrored.Filled.ArrowBack, contentDescription = "Back", tint = Color.White)[m
[32m+[m[32m                    }[m
[32m+[m[32m                },[m
[32m+[m[32m                colors = TopAppBarDefaults.centerAlignedTopAppBarColors(containerColor = PrimaryGreen)[m
[32m+[m[32m            )[m
[32m+[m[32m        },[m
[32m+[m[32m        containerColor = MaterialTheme.colorScheme.background[m
[32m+[m[32m    ) { innerPadding ->[m
[32m+[m[32m        Box(modifier = Modifier.fillMaxSize().padding(innerPadding)) {[m
[32m+[m[32m            when (val state = uiState) {[m
[32m+[m[32m                is ProfileUiState.Loading -> {[m
[32m+[m[32m                    Box(Modifier.fillMaxSize(), contentAlignment = Alignment.Center) {[m
[32m+[m[32m                        CircularProgressIndicator(color = PrimaryGreen)[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m                is ProfileUiState.Unauthenticated -> {[m
[32m+[m[32m                    Box(Modifier.fillMaxSize(), contentAlignment = Alignment.Center) { Text("Vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i") }[m
[32m+[m[32m                }[m
[32m+[m[32m                is ProfileUiState.Authenticated -> {[m
[32m+[m[32m                    PersonalInfoContent([m
[32m+[m[32m                        userProfile = state.profile,[m
[32m+[m[32m                        nameState = name,[m
[32m+[m[32m                        majorState = major,[m
[32m+[m[32m                        bioState = bio,[m
[32m+[m[32m                        onNameChange = { name = it },[m
[32m+[m[32m                        onMajorChange = { major = it },[m
[32m+[m[32m                        onBioChange = { bio = it },[m
[32m+[m[32m                        isUploadingAvatar = isUploadingAvatar,[m
[32m+[m[32m                        onAvatarClick = {[m
[32m+[m[32m                            imagePickerLauncher.launch([m
[32m+[m[32m                                PickVisualMediaRequest(ActivityResultContracts.PickVisualMedia.ImageOnly)[m
[32m+[m[32m                            )[m
[32m+[m[32m                        },[m
[32m+[m[32m                        onSaveClick = {[m
[32m+[m[32m                            if (name.isNotBlank()) {[m
[32m+[m[32m                                focusManager.clearFocus()[m
[32m+[m[32m                                // L∆∞u T√™n (Auth)[m
[32m+[m[32m                                if (name != state.profile.fullName) {[m
[32m+[m[32m                                    viewModel.updateUserName(name)[m
[32m+[m[32m                                }[m
[32m+[m[32m                                // L∆∞u Major & Bio (Firestore)[m
[32m+[m[32m                                viewModel.updateExtendedInfo(major, bio)[m
[32m+[m[32m                            } else {[m
[32m+[m[32m                                Toast.makeText(context, "T√™n kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng", Toast.LENGTH_SHORT).show()[m
[32m+[m[32m                            }[m
[32m+[m[32m                        }[m
[32m+[m[32m                    )[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m@OptIn(ExperimentalMaterial3Api::class)[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun PersonalInfoContent([m
[32m+[m[32m    userProfile: UserProfile,[m
[32m+[m[32m    nameState: String,[m
[32m+[m[32m    majorState: String,[m
[32m+[m[32m    bioState: String,[m
[32m+[m[32m    onNameChange: (String) -> Unit,[m
[32m+[m[32m    onMajorChange: (String) -> Unit,[m
[32m+[m[32m    onBioChange: (String) -> Unit,[m
[32m+[m[32m    isUploadingAvatar: Boolean,[m
[32m+[m[32m    onAvatarClick: () -> Unit,[m
[32m+[m[32m    onSaveClick: () -> Unit[m
[32m+[m[32m) {[m
[32m+[m[32m    // Danh s√°ch khoa[m
[32m+[m[32m    val majors = listOf([m
[32m+[m[32m        "C√¥ng ngh·ªá th√¥ng tin", "Kinh t·∫ø v·∫≠n t·∫£i", "ƒêi·ªán - ƒêi·ªán t·ª≠",[m
[32m+[m[32m        "C∆° kh√≠", "X√¢y d·ª±ng", "K·ªπ thu·∫≠t giao th√¥ng", "M√¥i tr∆∞·ªùng", "Kh√°c"[m
[32m+[m[32m    )[m
[32m+[m[32m    var expandedMajor by remember { mutableStateOf(false) }[m
[32m+[m
[32m+[m[32m    Column([m
[32m+[m[32m        modifier = Modifier[m
[32m+[m[32m            .fillMaxSize()[m
[32m+[m[32m            .verticalScroll(rememberScrollState())[m
[32m+[m[32m            .padding(16.dp),[m
[32m+[m[32m        horizontalAlignment = Alignment.CenterHorizontally[m
[32m+[m[32m    ) {[m
[32m+[m[32m        Card([m
[32m+[m[32m            modifier = Modifier.fillMaxWidth(),[m
[32m+[m[32m            shape = RoundedCornerShape(16.dp),[m
[32m+[m[32m            colors = CardDefaults.cardColors(containerColor = MaterialTheme.colorScheme.surface),[m
[32m+[m[32m            elevation = CardDefaults.cardElevation(2.dp)[m
[32m+[m[32m        ) {[m
[32m+[m[32m            Column(modifier = Modifier.padding(24.dp), horizontalAlignment = Alignment.CenterHorizontally) {[m
[32m+[m
[32m+[m[32m                // 1. AVATAR[m
[32m+[m[32m                Box(contentAlignment = Alignment.Center) {[m
[32m+[m[32m                    AsyncImage([m
[32m+[m[32m                        model = userProfile.avatarUrl ?: "https://ui-avatars.com/api/?name=${userProfile.fullName}&background=random",[m
[32m+[m[32m                        contentDescription = "Avatar",[m
[32m+[m[32m                        modifier = Modifier[m
[32m+[m[32m                            .size(100.dp)[m
[32m+[m[32m                            .clip(CircleShape)[m
[32m+[m[32m                            .background(Color.LightGray)[m
[32m+[m[32m                            .clickable(enabled = !isUploadingAvatar) { onAvatarClick() },[m
[32m+[m[32m                        contentScale = ContentScale.Crop[m
[32m+[m[32m                    )[m
[32m+[m[32m                    if (isUploadingAvatar) {[m
[32m+[m[32m                        CircularProgressIndicator(modifier = Modifier.size(100.dp), color = PrimaryGreen, strokeWidth = 3.dp)[m
[32m+[m[32m                    }[m
[32m+[m[32m                    Box([m
[32m+[m[32m                        modifier = Modifier.align(Alignment.BottomEnd).offset(x = 4.dp, y = 4.dp).size(32.dp).clip(CircleShape).background(PrimaryGreen).clickable { onAvatarClick() },[m
[32m+[m[32m                        contentAlignment = Alignment.Center[m
[32m+[m[32m                    ) {[m
[32m+[m[32m                        Icon(Icons.Default.CameraAlt, "Change", tint = Color.White, modifier = Modifier.size(18.dp))[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m
[32m+[m[32m                Spacer(modifier = Modifier.height(32.dp))[m
[32m+[m
[32m+[m[32m                // 2. EMAIL (READ-ONLY)[m
[32m+[m[32m                OutlinedTextField([m
[32m+[m[32m                    value = userProfile.email,[m
[32m+[m[32m                    onValueChange = {},[m
[32m+[m[32m                    enabled = false,[m
[32m+[m[32m                    label = { Text("Email") },[m
[32m+[m[32m                    leadingIcon = { Icon(Icons.Default.Email, null) },[m
[32m+[m[32m                    modifier = Modifier.fillMaxWidth(),[m
[32m+[m[32m                    colors = OutlinedTextFieldDefaults.colors([m
[32m+[m[32m                        disabledTextColor = MaterialTheme.colorScheme.onSurface,[m
[32m+[m[32m                        disabledBorderColor = Color.LightGray[m
[32m+[m[32m                    )[m
[32m+[m[32m                )[m
[32m+[m
[32m+[m[32m                Spacer(modifier = Modifier.height(16.dp))[m
[32m+[m
[32m+[m[32m                // 3. T√äN HI·ªÇN TH·ªä[m
[32m+[m[32m                OutlinedTextField([m
[32m+[m[32m                    value = nameState,[m
[32m+[m[32m                    onValueChange = onNameChange,[m
[32m+[m[32m                    label = { Text("H·ªç v√† t√™n") },[m
[32m+[m[32m                    leadingIcon = { Icon(Icons.Default.Person, null) },[m
[32m+[m[32m                    modifier = Modifier.fillMaxWidth(),[m
[32m+[m[32m                    singleLine = true,[m
[32m+[m[32m                    keyboardOptions = KeyboardOptions(capitalization = KeyboardCapitalization.Words, imeAction = ImeAction.Next),[m
[32m+[m[32m                    colors = OutlinedTextFieldDefaults.colors(focusedBorderColor = PrimaryGreen, focusedLabelColor = PrimaryGreen, cursorColor = PrimaryGreen)[m
[32m+[m[32m                )[m
[32m+[m
[32m+[m[32m                Spacer(modifier = Modifier.height(16.dp))[m
[32m+[m
[32m+[m[32m                // üü¢ 4. CHUY√äN NG√ÄNH (DROPDOWN)[m
[32m+[m[32m                ExposedDropdownMenuBox([m
[32m+[m[32m                    expanded = expandedMajor,[m
[32m+[m[32m                    onExpandedChange = { expandedMajor = !expandedMajor }[m
[32m+[m[32m                ) {[m
[32m+[m[32m                    OutlinedTextField([m
[32m+[m[32m                        value = majorState,[m
[32m+[m[32m                        onValueChange = {},[m
[32m+[m[32m                        readOnly = true,[m
[32m+[m[32m                        label = { Text("Khoa / Chuy√™n ng√†nh") },[m
[32m+[m[32m                        leadingIcon = { Icon(Icons.Default.School, null) },[m
[32m+[m[32m                        trailingIcon = { ExposedDropdownMenuDefaults.TrailingIcon(expanded = expandedMajor) },[m
[32m+[m[32m                        modifier = Modifier.fillMaxWidth().menuAnchor(),[m
[32m+[m[32m                        colors = OutlinedTextFieldDefaults.colors(focusedBorderColor = PrimaryGreen, focusedLabelColor = PrimaryGreen)[m
[32m+[m[32m                    )[m
[32m+[m[32m                    ExposedDropdownMenu([m
[32m+[m[32m                        expanded = expandedMajor,[m
[32m+[m[32m                        onDismissRequest = { expandedMajor = false }[m
[32m+[m[32m                    ) {[m
[32m+[m[32m                        majors.forEach { selectionOption ->[m
[32m+[m[32m                            DropdownMenuItem([m
[32m+[m[32m                                text = { Text(selectionOption) },[m
[32m+[m[32m                                onClick = {[m
[32m+[m[32m                                    onMajorChange(selectionOption)[m
[32m+[m[32m                                    expandedMajor = false[m
[32m+[m[32m                                }[m
[32m+[m[32m                            )[m
[32m+[m[32m                        }[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m
[32m+[m[32m                Spacer(modifier = Modifier.height(16.dp))[m
[32m+[m
[32m+[m[32m                // üü¢ 5. BIO / GI·ªöI THI·ªÜU[m
[32m+[m[32m                OutlinedTextField([m
[32m+[m[32m                    value = bioState,[m
[32m+[m[32m                    onValueChange = onBioChange,[m
[32m+[m[32m                    label = { Text("Gi·ªõi thi·ªáu b·∫£n th√¢n (Bio)") },[m
[32m+[m[32m                    leadingIcon = { Icon(Icons.Default.Edit, null) },[m
[32m+[m[32m                    modifier = Modifier.fillMaxWidth(),[m
[32m+[m[32m                    maxLines = 3,[m
[32m+[m[32m                    placeholder = { Text("VD: ƒêam m√™ l·∫≠p tr√¨nh Mobile...") },[m
[32m+[m[32m                    colors = OutlinedTextFieldDefaults.colors(focusedBorderColor = PrimaryGreen, focusedLabelColor = PrimaryGreen)[m
[32m+[m[32m                )[m
[32m+[m
[32m+[m[32m                Spacer(modifier = Modifier.height(32.dp))[m
[32m+[m
[32m+[m[32m                // 6. N√öT L∆ØU[m
[32m+[m[32m                Button([m
[32m+[m[32m                    onClick = onSaveClick,[m
[32m+[m[32m                    modifier = Modifier.fillMaxWidth().height(50.dp),[m
[32m+[m[32m                    shape = RoundedCornerShape(12.dp),[m
[32m+[m[32m                    colors = ButtonDefaults.buttonColors(containerColor = PrimaryGreen)[m
[32m+[m[32m                ) {[m
[32m+[m[32m                    Icon(Icons.Default.Save, null, Modifier.size(20.dp))[m
[32m+[m[32m                    Spacer(modifier = Modifier.width(8.dp))[m
[32m+[m[32m                    Text("L∆∞u thay ƒë·ªïi", fontSize = 16.sp, fontWeight = FontWeight.Bold)[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/features/feature_profile/ui/account/SwitchAccountScreen.kt b/app/src/main/java/com/example/stushare/features/feature_profile/ui/account/SwitchAccountScreen.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..9910a7b[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/features/feature_profile/ui/account/SwitchAccountScreen.kt[m
[36m@@ -0,0 +1,264 @@[m
[32m+[m[32mpackage com.example.stushare.features.feature_profile.ui.account[m
[32m+[m
[32m+[m[32mimport androidx.compose.foundation.BorderStroke[m
[32m+[m[32mimport androidx.compose.foundation.background[m
[32m+[m[32mimport androidx.compose.foundation.clickable[m
[32m+[m[32mimport androidx.compose.foundation.layout.*[m
[32m+[m[32mimport androidx.compose.foundation.shape.CircleShape[m
[32m+[m[32mimport androidx.compose.foundation.shape.RoundedCornerShape[m
[32m+[m[32mimport androidx.compose.material.icons.Icons[m
[32m+[m[32mimport androidx.compose.material.icons.automirrored.filled.ArrowBack[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Add[m
[32m+[m[32mimport androidx.compose.material.icons.filled.CheckCircle[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Person[m
[32m+[m[32mimport androidx.compose.material3.*[m
[32m+[m[32mimport androidx.compose.runtime.Composable[m
[32m+[m[32mimport androidx.compose.runtime.getValue[m
[32m+[m[32mimport androidx.compose.ui.Alignment[m
[32m+[m[32mimport androidx.compose.ui.Modifier[m
[32m+[m[32mimport androidx.compose.ui.draw.clip[m
[32m+[m[32mimport androidx.compose.ui.graphics.Color[m
[32m+[m[32mimport androidx.compose.ui.layout.ContentScale[m
[32m+[m[32mimport androidx.compose.ui.platform.LocalContext[m
[32m+[m[32mimport androidx.compose.ui.res.stringResource[m
[32m+[m[32mimport androidx.compose.ui.text.font.FontWeight[m
[32m+[m[32mimport androidx.compose.ui.unit.dp[m
[32m+[m[32mimport androidx.compose.ui.unit.sp[m
[32m+[m[32mimport androidx.hilt.navigation.compose.hiltViewModel[m
[32m+[m[32mimport androidx.lifecycle.compose.collectAsStateWithLifecycle[m
[32m+[m[32mimport coil.compose.AsyncImage[m
[32m+[m[32mimport coil.request.ImageRequest[m
[32m+[m[32mimport com.example.stushare.R[m
[32m+[m[32mimport com.example.stushare.features.feature_profile.ui.main.ProfileUiState[m
[32m+[m[32mimport com.example.stushare.features.feature_profile.ui.main.ProfileViewModel[m
[32m+[m[32mimport com.example.stushare.features.feature_profile.ui.model.UserProfile[m
[32m+[m[32mimport com.example.stushare.ui.theme.PrimaryGreen[m
[32m+[m
[32m+[m[32m@OptIn(ExperimentalMaterial3Api::class)[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun SwitchAccountScreen([m
[32m+[m[32m    onBackClick: () -> Unit,[m
[32m+[m[32m    viewModel: ProfileViewModel = hiltViewModel()[m
[32m+[m[32m) {[m
[32m+[m[32m    // 1. üü¢ L·∫ÆNG NGHE UI STATE (Thay v√¨ userProfile c≈©)[m
[32m+[m[32m    val uiState by viewModel.uiState.collectAsStateWithLifecycle()[m
[32m+[m
[32m+[m[32m    // M√†u ƒë·ªông t·ª´ Theme[m
[32m+[m[32m    val backgroundColor = MaterialTheme.colorScheme.background[m
[32m+[m[32m    val surfaceColor = MaterialTheme.colorScheme.surface[m
[32m+[m[32m    val onSurfaceColor = MaterialTheme.colorScheme.onSurface[m
[32m+[m
[32m+[m[32m    Scaffold([m
[32m+[m[32m        topBar = {[m
[32m+[m[32m            TopAppBar([m
[32m+[m[32m                title = {[m
[32m+[m[32m                    Text([m
[32m+[m[32m                        text = stringResource(R.string.switch_acc_header), // "Chuy·ªÉn t√†i kho·∫£n"[m
[32m+[m[32m                        color = Color.White,[m
[32m+[m[32m                        fontWeight = FontWeight.Bold,[m
[32m+[m[32m                        fontSize = 20.sp[m
[32m+[m[32m                    )[m
[32m+[m[32m                },[m
[32m+[m[32m                navigationIcon = {[m
[32m+[m[32m                    IconButton(onClick = onBackClick) {[m
[32m+[m[32m                        Icon([m
[32m+[m[32m                            imageVector = Icons.AutoMirrored.Filled.ArrowBack,[m
[32m+[m[32m                            contentDescription = null,[m
[32m+[m[32m                            tint = Color.White[m
[32m+[m[32m                        )[m
[32m+[m[32m                    }[m
[32m+[m[32m                },[m
[32m+[m[32m                colors = TopAppBarDefaults.topAppBarColors(containerColor = PrimaryGreen)[m
[32m+[m[32m            )[m
[32m+[m[32m        },[m
[32m+[m[32m        containerColor = backgroundColor[m
[32m+[m[32m    ) { innerPadding ->[m
[32m+[m[32m        Box(modifier = Modifier.fillMaxSize()) {[m
[32m+[m[32m            Column([m
[32m+[m[32m                modifier = Modifier[m
[32m+[m[32m                    .fillMaxSize()[m
[32m+[m[32m                    .padding(innerPadding)[m
[32m+[m[32m                    .padding(16.dp)[m
[32m+[m[32m            ) {[m
[32m+[m[32m                // --- Ph·∫ßn 1: T√†i kho·∫£n hi·ªán t·∫°i ---[m
[32m+[m[32m                Text([m
[32m+[m[32m                    text = stringResource(R.string.switch_acc_active), // "ƒêang ho·∫°t ƒë·ªông"[m
[32m+[m[32m                    style = MaterialTheme.typography.labelLarge,[m
[32m+[m[32m                    color = onSurfaceColor.copy(alpha = 0.6f),[m
[32m+[m[32m                    modifier = Modifier.padding(bottom = 12.dp, start = 4.dp)[m
[32m+[m[32m                )[m
[32m+[m
[32m+[m[32m                // Ki·ªÉm tra State ƒë·ªÉ hi·ªÉn th·ªã th√¥ng tin[m
[32m+[m[32m                when (val state = uiState) {[m
[32m+[m[32m                    is ProfileUiState.Loading -> {[m
[32m+[m[32m                        // Hi·ªÉn th·ªã Loading Card[m
[32m+[m[32m                        Card([m
[32m+[m[32m                            modifier = Modifier.fillMaxWidth().height(80.dp),[m
[32m+[m[32m                            colors = CardDefaults.cardColors(containerColor = surfaceColor)[m
[32m+[m[32m                        ) {[m
[32m+[m[32m                            Box(Modifier.fillMaxSize(), contentAlignment = Alignment.Center) {[m
[32m+[m[32m                                CircularProgressIndicator(color = PrimaryGreen)[m
[32m+[m[32m                            }[m
[32m+[m[32m                        }[m
[32m+[m[32m                    }[m
[32m+[m[32m                    is ProfileUiState.Authenticated -> {[m
[32m+[m[32m                        // Hi·ªÉn th·ªã Card th√¥ng tin User th·∫≠t[m
[32m+[m[32m                        CurrentAccountCard([m
[32m+[m[32m                            userProfile = state.profile,[m
[32m+[m[32m                            surfaceColor = surfaceColor,[m
[32m+[m[32m                            onSurfaceColor = onSurfaceColor[m
[32m+[m[32m                        )[m
[32m+[m[32m                    }[m
[32m+[m[32m                    else -> {[m
[32m+[m[32m                        // Tr∆∞·ªùng h·ª£p Unauthenticated (Hi·∫øm khi x·∫£y ra ·ªü m√†n n√†y)[m
[32m+[m[32m                        Text("Vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i", color = Color.Red)[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m
[32m+[m[32m                Spacer(modifier = Modifier.height(32.dp))[m
[32m+[m
[32m+[m[32m                // --- Ph·∫ßn 2: Th√™m t√†i kho·∫£n kh√°c ---[m
[32m+[m[32m                Text([m
[32m+[m[32m                    text = stringResource(R.string.switch_account), // "T√†i kho·∫£n kh√°c"[m
[32m+[m[32m                    style = MaterialTheme.typography.labelLarge,[m
[32m+[m[32m                    color = onSurfaceColor.copy(alpha = 0.6f),[m
[32m+[m[32m                    modifier = Modifier.padding(bottom = 12.dp, start = 4.dp)[m
[32m+[m[32m                )[m
[32m+[m
[32m+[m[32m                Card([m
[32m+[m[32m                    shape = RoundedCornerShape(12.dp),[m
[32m+[m[32m                    colors = CardDefaults.cardColors(containerColor = surfaceColor),[m
[32m+[m[32m                    elevation = CardDefaults.cardElevation(1.dp),[m
[32m+[m[32m                    modifier = Modifier[m
[32m+[m[32m                        .fillMaxWidth()[m
[32m+[m[32m                        .clickable {[m
[32m+[m[32m                            // ‚≠êÔ∏è LOGIC: ƒêƒÉng xu·∫•t ƒë·ªÉ v·ªÅ m√†n h√¨nh Login -> Nh·∫≠p tk kh√°c[m
[32m+[m[32m                            viewModel.signOut()[m
[32m+[m[32m                            // ƒêi·ªÅu h∆∞·ªõng do MainActivity/NavGraph x·ª≠ l√Ω khi authState thay ƒë·ªïi[m
[32m+[m[32m                        }[m
[32m+[m[32m                ) {[m
[32m+[m[32m                    Row([m
[32m+[m[32m                        modifier = Modifier.padding(16.dp),[m
[32m+[m[32m                        verticalAlignment = Alignment.CenterVertically[m
[32m+[m[32m                    ) {[m
[32m+[m[32m                        Box([m
[32m+[m[32m                            modifier = Modifier[m
[32m+[m[32m                                .size(40.dp)[m
[32m+[m[32m                                .clip(CircleShape)[m
[32m+[m[32m                                .background(MaterialTheme.colorScheme.surfaceVariant),[m
[32m+[m[32m                            contentAlignment = Alignment.Center[m
[32m+[m[32m                        ) {[m
[32m+[m[32m                            Icon([m
[32m+[m[32m                                imageVector = Icons.Default.Add,[m
[32m+[m[32m                                contentDescription = null,[m
[32m+[m[32m                                tint = onSurfaceColor[m
[32m+[m[32m                            )[m
[32m+[m[32m                        }[m
[32m+[m[32m                        Spacer(modifier = Modifier.width(16.dp))[m
[32m+[m[32m                        Text([m
[32m+[m[32m                            text = stringResource(R.string.switch_acc_add), // "ƒêƒÉng nh·∫≠p t√†i kho·∫£n kh√°c"[m
[32m+[m[32m                            fontSize = 15.sp,[m
[32m+[m[32m                            fontWeight = FontWeight.Medium,[m
[32m+[m[32m                            color = onSurfaceColor[m
[32m+[m[32m                        )[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            // Bottom Curve (Trang tr√≠)[m
[32m+[m[32m            Box([m
[32m+[m[32m                modifier = Modifier[m
[32m+[m[32m                    .align(Alignment.BottomCenter)[m
[32m+[m[32m                    .fillMaxWidth()[m
[32m+[m[32m                    .height(100.dp)[m
[32m+[m[32m                    .offset(y = 50.dp)[m
[32m+[m[32m                    .background([m
[32m+[m[32m                        color = PrimaryGreen,[m
[32m+[m[32m                        shape = RoundedCornerShape(topStart = 1000.dp, topEnd = 1000.dp)[m
[32m+[m[32m                    )[m
[32m+[m[32m            )[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun CurrentAccountCard([m
[32m+[m[32m    userProfile: UserProfile,[m
[32m+[m[32m    surfaceColor: Color,[m
[32m+[m[32m    onSurfaceColor: Color[m
[32m+[m[32m) {[m
[32m+[m[32m    Card([m
[32m+[m[32m        shape = RoundedCornerShape(16.dp),[m
[32m+[m[32m        colors = CardDefaults.cardColors(containerColor = surfaceColor),[m
[32m+[m[32m        elevation = CardDefaults.cardElevation(2.dp),[m
[32m+[m[32m        border = BorderStroke(1.dp, PrimaryGreen.copy(alpha = 0.5f))[m
[32m+[m[32m    ) {[m
[32m+[m[32m        Row([m
[32m+[m[32m            modifier = Modifier[m
[32m+[m[32m                .fillMaxWidth()[m
[32m+[m[32m                .padding(16.dp),[m
[32m+[m[32m            verticalAlignment = Alignment.CenterVertically[m
[32m+[m[32m        ) {[m
[32m+[m[32m            // ‚≠êÔ∏è C·∫¢I TI·∫æN: Hi·ªÉn th·ªã Avatar th·∫≠t d√πng Coil[m
[32m+[m[32m            if (userProfile.avatarUrl != null) {[m
[32m+[m[32m                AsyncImage([m
[32m+[m[32m                    model = ImageRequest.Builder(LocalContext.current)[m
[32m+[m[32m                        .data(userProfile.avatarUrl)[m
[32m+[m[32m                        .crossfade(true)[m
[32m+[m[32m                        .build(),[m
[32m+[m[32m                    contentDescription = "Avatar",[m
[32m+[m[32m                    modifier = Modifier[m
[32m+[m[32m                        .size(50.dp)[m
[32m+[m[32m                        .clip(CircleShape),[m
[32m+[m[32m                    contentScale = ContentScale.Crop[m
[32m+[m[32m                )[m
[32m+[m[32m            } else {[m
[32m+[m[32m                // Placeholder n·∫øu ch∆∞a c√≥ ·∫£nh[m
[32m+[m[32m                Surface([m
[32m+[m[32m                    modifier = Modifier.size(50.dp),[m
[32m+[m[32m                    shape = CircleShape,[m
[32m+[m[32m                    color = MaterialTheme.colorScheme.surfaceVariant[m
[32m+[m[32m                ) {[m
[32m+[m[32m                    Icon([m
[32m+[m[32m                        imageVector = Icons.Default.Person,[m
[32m+[m[32m                        contentDescription = null,[m
[32m+[m[32m                        tint = onSurfaceColor.copy(alpha = 0.5f),[m
[32m+[m[32m                        modifier = Modifier.padding(10.dp)[m
[32m+[m[32m                    )[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            Spacer(modifier = Modifier.width(16.dp))[m
[32m+[m
[32m+[m[32m            // Th√¥ng tin User[m
[32m+[m[32m            Column(modifier = Modifier.weight(1f)) {[m
[32m+[m[32m                Text([m
[32m+[m[32m                    text = userProfile.fullName,[m
[32m+[m[32m                    fontSize = 16.sp,[m
[32m+[m[32m                    fontWeight = FontWeight.Bold,[m
[32m+[m[32m                    color = onSurfaceColor[m
[32m+[m[32m                )[m
[32m+[m[32m                Text([m
[32m+[m[32m                    text = userProfile.email,[m
[32m+[m[32m                    fontSize = 13.sp,[m
[32m+[m[32m                    color = onSurfaceColor.copy(alpha = 0.6f)[m
[32m+[m[32m                )[m
[32m+[m[32m                Spacer(modifier = Modifier.height(4.dp))[m
[32m+[m[32m                Text([m
[32m+[m[32m                    text = stringResource(R.string.switch_acc_active), // "ƒêang ho·∫°t ƒë·ªông"[m
[32m+[m[32m                    fontSize = 12.sp,[m
[32m+[m[32m                    color = PrimaryGreen,[m
[32m+[m[32m                    fontWeight = FontWeight.Medium[m
[32m+[m[32m                )[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            // Icon check xanh[m
[32m+[m[32m            Icon([m
[32m+[m[32m                imageVector = Icons.Default.CheckCircle,[m
[32m+[m[32m                contentDescription = null,[m
[32m+[m[32m                tint = PrimaryGreen,[m
[32m+[m[32m                modifier = Modifier.size(24.dp)[m
[32m+[m[32m            )[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/features/feature_profile/ui/legal/AboutAppScreen.kt b/app/src/main/java/com/example/stushare/features/feature_profile/ui/legal/AboutAppScreen.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..fd4ad43[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/features/feature_profile/ui/legal/AboutAppScreen.kt[m
[36m@@ -0,0 +1,148 @@[m
[32m+[m[32mpackage com.example.stushare.features.feature_profile.ui.legal[m
[32m+[m
[32m+[m[32mimport androidx.compose.foundation.background[m
[32m+[m[32mimport androidx.compose.foundation.clickable[m
[32m+[m[32mimport androidx.compose.foundation.layout.*[m
[32m+[m[32mimport androidx.compose.foundation.shape.RoundedCornerShape[m
[32m+[m[32mimport androidx.compose.material.icons.Icons[m
[32m+[m[32mimport androidx.compose.material.icons.automirrored.filled.ArrowBack[m
[32m+[m[32mimport androidx.compose.material.icons.automirrored.filled.KeyboardArrowRight[m
[32m+[m[32mimport androidx.compose.material3.*[m
[32m+[m[32mimport androidx.compose.runtime.Composable[m
[32m+[m[32mimport androidx.compose.ui.Alignment[m
[32m+[m[32mimport androidx.compose.ui.Modifier[m
[32m+[m[32mimport androidx.compose.ui.graphics.Color[m
[32m+[m[32mimport androidx.compose.ui.res.stringResource[m
[32m+[m[32mimport androidx.compose.ui.text.font.FontWeight[m
[32m+[m[32mimport androidx.compose.ui.unit.dp[m
[32m+[m[32mimport androidx.compose.ui.unit.sp[m
[32m+[m[32m// ‚≠êÔ∏è QUAN TR·ªåNG: Import ƒë√∫ng R v√† Theme c·ªßa d·ª± √°n ch√≠nh[m
[32m+[m[32mimport com.example.stushare.R[m
[32m+[m[32mimport com.example.stushare.ui.theme.PrimaryGreen[m
[32m+[m
[32m+[m[32m@OptIn(ExperimentalMaterial3Api::class)[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun AboutAppScreen([m
[32m+[m[32m    onBackClick: () -> Unit,[m
[32m+[m[32m    onTermsClick: () -> Unit,[m
[32m+[m[32m    onPrivacyClick: () -> Unit[m
[32m+[m[32m) {[m
[32m+[m[32m    // L·∫•y m√†u ƒë·ªông t·ª´ Theme[m
[32m+[m[32m    val backgroundColor = MaterialTheme.colorScheme.background[m
[32m+[m[32m    val dividerColor = MaterialTheme.colorScheme.outlineVariant[m
[32m+[m
[32m+[m[32m    Scaffold([m
[32m+[m[32m        topBar = {[m
[32m+[m[32m            TopAppBar([m
[32m+[m[32m                title = {[m
[32m+[m[32m                    Text([m
[32m+[m[32m                        text = stringResource(R.string.about_stushare),[m
[32m+[m[32m                        color = Color.White,[m
[32m+[m[32m                        fontWeight = FontWeight.Bold,[m
[32m+[m[32m                        fontSize = 20.sp[m
[32m+[m[32m                    )[m
[32m+[m[32m                },[m
[32m+[m[32m                navigationIcon = {[m
[32m+[m[32m                    IconButton(onClick = onBackClick) {[m
[32m+[m[32m                        Icon([m
[32m+[m[32m                            imageVector = Icons.AutoMirrored.Filled.ArrowBack,[m
[32m+[m[32m                            contentDescription = "Quay v·ªÅ",[m
[32m+[m[32m                            tint = Color.White[m
[32m+[m[32m                        )[m
[32m+[m[32m                    }[m
[32m+[m[32m                },[m
[32m+[m[32m                // ‚≠êÔ∏è S·ª¨A: D√πng PrimaryGreen thay v√¨ GreenPrimary[m
[32m+[m[32m                colors = TopAppBarDefaults.topAppBarColors(containerColor = PrimaryGreen)[m
[32m+[m[32m            )[m
[32m+[m[32m        },[m
[32m+[m[32m        containerColor = backgroundColor // N·ªÅn ƒë·ªông[m
[32m+[m[32m    ) { innerPadding ->[m
[32m+[m[32m        Box(modifier = Modifier.fillMaxSize()) {[m
[32m+[m[32m            Column([m
[32m+[m[32m                modifier = Modifier[m
[32m+[m[32m                    .fillMaxSize()[m
[32m+[m[32m                    .padding(innerPadding)[m
[32m+[m[32m            ) {[m
[32m+[m[32m                // Item 1: Phi√™n b·∫£n[m
[32m+[m[32m                AboutItem([m
[32m+[m[32m                    title = stringResource(R.string.about_version_title),[m
[32m+[m[32m                    subtitle = stringResource(R.string.about_version_subtitle),[m
[32m+[m[32m                    onClick = { }[m
[32m+[m[32m                )[m
[32m+[m
[32m+[m[32m                Spacer(modifier = Modifier.height(12.dp))[m
[32m+[m
[32m+[m[32m                // Item 2: ƒêi·ªÅu kho·∫£n s·ª≠ d·ª•ng[m
[32m+[m[32m                AboutItem([m
[32m+[m[32m                    title = stringResource(R.string.about_terms),[m
[32m+[m[32m                    onClick = onTermsClick[m
[32m+[m[32m                )[m
[32m+[m
[32m+[m[32m                HorizontalDivider(thickness = 1.dp, color = dividerColor)[m
[32m+[m
[32m+[m[32m                // Item 3: Ch√≠nh s√°ch b·∫£o m·∫≠t[m
[32m+[m[32m                AboutItem([m
[32m+[m[32m                    title = stringResource(R.string.about_privacy),[m
[32m+[m[32m                    onClick = onPrivacyClick[m
[32m+[m[32m                )[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            // Bottom Curve (Trang tr√≠ d∆∞·ªõi ƒë√°y)[m
[32m+[m[32m            Box([m
[32m+[m[32m                modifier = Modifier[m
[32m+[m[32m                    .align(Alignment.BottomCenter)[m
[32m+[m[32m                    .fillMaxWidth()[m
[32m+[m[32m                    .height(120.dp)[m
[32m+[m[32m                    .offset(y = 60.dp)[m
[32m+[m[32m                    .background([m
[32m+[m[32m                        // ‚≠êÔ∏è S·ª¨A: D√πng PrimaryGreen[m
[32m+[m[32m                        color = PrimaryGreen,[m
[32m+[m[32m                        shape = RoundedCornerShape(topStart = 1000.dp, topEnd = 1000.dp)[m
[32m+[m[32m                    )[m
[32m+[m[32m            )[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun AboutItem([m
[32m+[m[32m    title: String,[m
[32m+[m[32m    subtitle: String? = null,[m
[32m+[m[32m    onClick: () -> Unit[m
[32m+[m[32m) {[m
[32m+[m[32m    // M√†u ƒë·ªông cho Item[m
[32m+[m[32m    val surfaceColor = MaterialTheme.colorScheme.surface[m
[32m+[m[32m    val onSurfaceColor = MaterialTheme.colorScheme.onSurface[m
[32m+[m
[32m+[m[32m    Row([m
[32m+[m[32m        modifier = Modifier[m
[32m+[m[32m            .fillMaxWidth()[m
[32m+[m[32m            .background(surfaceColor) // N·ªÅn Item ƒë·ªông[m
[32m+[m[32m            .clickable(onClick = onClick)[m
[32m+[m[32m            .padding(horizontal = 16.dp, vertical = 16.dp),[m
[32m+[m[32m        verticalAlignment = Alignment.CenterVertically[m
[32m+[m[32m    ) {[m
[32m+[m[32m        Column(modifier = Modifier.weight(1f)) {[m
[32m+[m[32m            Text([m
[32m+[m[32m                text = title,[m
[32m+[m[32m                fontSize = 16.sp,[m
[32m+[m[32m                fontWeight = FontWeight.Bold,[m
[32m+[m[32m                color = onSurfaceColor // Ch·ªØ ti√™u ƒë·ªÅ ƒë·ªông[m
[32m+[m[32m            )[m
[32m+[m[32m            if (subtitle != null) {[m
[32m+[m[32m                Spacer(modifier = Modifier.height(4.dp))[m
[32m+[m[32m                Text([m
[32m+[m[32m                    text = subtitle,[m
[32m+[m[32m                    fontSize = 13.sp,[m
[32m+[m[32m                    color = onSurfaceColor.copy(alpha = 0.6f) // Ch·ªØ ph·ª• ƒë·ªông (nh·∫°t h∆°n)[m
[32m+[m[32m                )[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        Icon([m
[32m+[m[32m            imageVector = Icons.AutoMirrored.Filled.KeyboardArrowRight,[m
[32m+[m[32m            contentDescription = null,[m
[32m+[m[32m            tint = onSurfaceColor.copy(alpha = 0.4f) // Icon m≈©i t√™n ƒë·ªông[m
[32m+[m[32m        )[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/features/feature_profile/ui/legal/ContactSupportScreen.kt b/app/src/main/java/com/example/stushare/features/feature_profile/ui/legal/ContactSupportScreen.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..28eb94f[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/features/feature_profile/ui/legal/ContactSupportScreen.kt[m
[36m@@ -0,0 +1,217 @@[m
[32m+[m[32mpackage com.example.stushare.features.feature_profile.ui.legal[m
[32m+[m
[32m+[m[32mimport android.content.Intent[m
[32m+[m[32mimport android.net.Uri[m
[32m+[m[32mimport androidx.compose.foundation.background[m
[32m+[m[32mimport androidx.compose.foundation.clickable[m
[32m+[m[32mimport androidx.compose.foundation.layout.*[m
[32m+[m[32mimport androidx.compose.foundation.shape.RoundedCornerShape[m
[32m+[m[32mimport androidx.compose.material.icons.Icons[m
[32m+[m[32mimport androidx.compose.material.icons.automirrored.filled.ArrowBack[m
[32m+[m[32mimport androidx.compose.material.icons.automirrored.filled.KeyboardArrowRight[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Call[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Email[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Face[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Info[m
[32m+[m[32mimport androidx.compose.material3.*[m
[32m+[m[32mimport androidx.compose.runtime.Composable[m
[32m+[m[32mimport androidx.compose.ui.Alignment[m
[32m+[m[32mimport androidx.compose.ui.Modifier[m
[32m+[m[32mimport androidx.compose.ui.graphics.Color[m
[32m+[m[32mimport androidx.compose.ui.graphics.vector.ImageVector[m
[32m+[m[32mimport androidx.compose.ui.platform.LocalContext[m
[32m+[m[32mimport androidx.compose.ui.res.stringResource[m
[32m+[m[32mimport androidx.compose.ui.text.font.FontWeight[m
[32m+[m[32mimport androidx.compose.ui.unit.dp[m
[32m+[m[32mimport androidx.compose.ui.unit.sp[m
[32m+[m[32m// ‚≠êÔ∏è Import ƒë√∫ng Resource v√† Theme c·ªßa d·ª± √°n ch√≠nh[m
[32m+[m[32mimport com.example.stushare.R[m
[32m+[m[32mimport com.example.stushare.ui.theme.PrimaryGreen[m
[32m+[m
[32m+[m[32m@OptIn(ExperimentalMaterial3Api::class)[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun ContactSupportScreen([m
[32m+[m[32m    onBackClick: () -> Unit[m
[32m+[m[32m) {[m
[32m+[m[32m    val context = LocalContext.current[m
[32m+[m
[32m+[m[32m    // L·∫•y m√†u ƒë·ªông t·ª´ Theme[m
[32m+[m[32m    val backgroundColor = MaterialTheme.colorScheme.background[m
[32m+[m[32m    val dividerColor = MaterialTheme.colorScheme.outlineVariant[m
[32m+[m
[32m+[m[32m    Scaffold([m
[32m+[m[32m        topBar = {[m
[32m+[m[32m            TopAppBar([m
[32m+[m[32m                title = {[m
[32m+[m[32m                    Text([m
[32m+[m[32m                        text = stringResource(R.string.support_header),[m
[32m+[m[32m                        color = Color.White,[m
[32m+[m[32m                        fontWeight = FontWeight.Bold,[m
[32m+[m[32m                        fontSize = 20.sp[m
[32m+[m[32m                    )[m
[32m+[m[32m                },[m
[32m+[m[32m                navigationIcon = {[m
[32m+[m[32m                    IconButton(onClick = onBackClick) {[m
[32m+[m[32m                        Icon([m
[32m+[m[32m                            imageVector = Icons.AutoMirrored.Filled.ArrowBack,[m
[32m+[m[32m                            contentDescription = null,[m
[32m+[m[32m                            tint = Color.White[m
[32m+[m[32m                        )[m
[32m+[m[32m                    }[m
[32m+[m[32m                },[m
[32m+[m[32m                // ‚≠êÔ∏è S·ª¨A: D√πng PrimaryGreen[m
[32m+[m[32m                colors = TopAppBarDefaults.topAppBarColors(containerColor = PrimaryGreen)[m
[32m+[m[32m            )[m
[32m+[m[32m        },[m
[32m+[m[32m        containerColor = backgroundColor // N·ªÅn ƒë·ªông[m
[32m+[m[32m    ) { innerPadding ->[m
[32m+[m[32m        Box(modifier = Modifier.fillMaxSize()) {[m
[32m+[m[32m            Column([m
[32m+[m[32m                modifier = Modifier[m
[32m+[m[32m                    .fillMaxSize()[m
[32m+[m[32m                    .padding(innerPadding)[m
[32m+[m[32m            ) {[m
[32m+[m[32m                // --- Section: Tr·ª±c tuy·∫øn ---[m
[32m+[m[32m                SupportSectionHeader(title = stringResource(R.string.support_online_channel))[m
[32m+[m
[32m+[m[32m                // Item 1: Chat[m
[32m+[m[32m                SupportItem([m
[32m+[m[32m                    icon = Icons.Default.Face,[m
[32m+[m[32m                    title = stringResource(R.string.support_chat_title),[m
[32m+[m[32m                    subtitle = stringResource(R.string.support_chat_desc),[m
[32m+[m[32m                    onClick = { /* TODO: Open Chat */ }[m
[32m+[m[32m                )[m
[32m+[m
[32m+[m[32m                HorizontalDivider(thickness = 1.dp, color = dividerColor)[m
[32m+[m
[32m+[m[32m                // Item 2: Email[m
[32m+[m[32m                SupportItem([m
[32m+[m[32m                    icon = Icons.Default.Email,[m
[32m+[m[32m                    title = stringResource(R.string.support_email_title),[m
[32m+[m[32m                    subtitle = "support@stushare.com",[m
[32m+[m[32m                    onClick = {[m
[32m+[m[32m                        val intent = Intent(Intent.ACTION_SENDTO).apply {[m
[32m+[m[32m                            data = Uri.parse("mailto:support@stushare.com")[m
[32m+[m[32m                            putExtra(Intent.EXTRA_SUBJECT, "H·ªó tr·ª£ StuShare")[m
[32m+[m[32m                        }[m
[32m+[m[32m                        try {[m
[32m+[m[32m                            context.startActivity(intent)[m
[32m+[m[32m                        } catch (e: Exception) {[m
[32m+[m[32m                            // Handle error (v√≠ d·ª•: thi·∫øt b·ªã kh√¥ng c√≥ app mail)[m
[32m+[m[32m                        }[m
[32m+[m[32m                    }[m
[32m+[m[32m                )[m
[32m+[m
[32m+[m[32m                // --- Section: K√™nh kh√°c ---[m
[32m+[m[32m                SupportSectionHeader(title = stringResource(R.string.support_other_channel))[m
[32m+[m
[32m+[m[32m                // Item 3: Hotline[m
[32m+[m[32m                SupportItem([m
[32m+[m[32m                    icon = Icons.Default.Call,[m
[32m+[m[32m                    title = stringResource(R.string.support_hotline_title),[m
[32m+[m[32m                    subtitle = stringResource(R.string.support_hotline_desc),[m
[32m+[m[32m                    onClick = {[m
[32m+[m[32m                        val intent = Intent(Intent.ACTION_DIAL).apply {[m
[32m+[m[32m                            data = Uri.parse("tel:19001234")[m
[32m+[m[32m                        }[m
[32m+[m[32m                        context.startActivity(intent)[m
[32m+[m[32m                    }[m
[32m+[m[32m                )[m
[32m+[m
[32m+[m[32m                HorizontalDivider(thickness = 1.dp, color = dividerColor)[m
[32m+[m
[32m+[m[32m                // Item 4: FAQ[m
[32m+[m[32m                SupportItem([m
[32m+[m[32m                    icon = Icons.Default.Info,[m
[32m+[m[32m                    title = stringResource(R.string.support_faq_title),[m
[32m+[m[32m                    subtitle = stringResource(R.string.support_faq_desc),[m
[32m+[m[32m                    onClick = { /* TODO: Open Web FAQ */ }[m
[32m+[m[32m                )[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            // --- Bottom Curve ---[m
[32m+[m[32m            Box([m
[32m+[m[32m                modifier = Modifier[m
[32m+[m[32m                    .align(Alignment.BottomCenter)[m
[32m+[m[32m                    .fillMaxWidth()[m
[32m+[m[32m                    .height(120.dp)[m
[32m+[m[32m                    .offset(y = 60.dp)[m
[32m+[m[32m                    .background([m
[32m+[m[32m                        // ‚≠êÔ∏è S·ª¨A: D√πng PrimaryGreen[m
[32m+[m[32m                        color = PrimaryGreen,[m
[32m+[m[32m                        shape = RoundedCornerShape(topStart = 1000.dp, topEnd = 1000.dp)[m
[32m+[m[32m                    )[m
[32m+[m[32m            )[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun SupportSectionHeader(title: String) {[m
[32m+[m[32m    Box([m
[32m+[m[32m        modifier = Modifier[m
[32m+[m[32m            .fillMaxWidth()[m
[32m+[m[32m            // N·ªÅn header section ƒë·ªông[m
[32m+[m[32m            .background(MaterialTheme.colorScheme.surfaceVariant)[m
[32m+[m[32m            .padding(horizontal = 16.dp, vertical = 12.dp)[m
[32m+[m[32m    ) {[m
[32m+[m[32m        Text([m
[32m+[m[32m            text = title,[m
[32m+[m[32m            // ‚≠êÔ∏è S·ª¨A: D√πng PrimaryGreen[m
[32m+[m[32m            color = PrimaryGreen,[m
[32m+[m[32m            fontWeight = FontWeight.Bold,[m
[32m+[m[32m            fontSize = 15.sp[m
[32m+[m[32m        )[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun SupportItem([m
[32m+[m[32m    icon: ImageVector,[m
[32m+[m[32m    title: String,[m
[32m+[m[32m    subtitle: String,[m
[32m+[m[32m    onClick: () -> Unit[m
[32m+[m[32m) {[m
[32m+[m[32m    val surfaceColor = MaterialTheme.colorScheme.surface[m
[32m+[m[32m    val onSurfaceColor = MaterialTheme.colorScheme.onSurface[m
[32m+[m
[32m+[m[32m    Row([m
[32m+[m[32m        modifier = Modifier[m
[32m+[m[32m            .fillMaxWidth()[m
[32m+[m[32m            .background(surfaceColor) // N·ªÅn item ƒë·ªông[m
[32m+[m[32m            .clickable(onClick = onClick)[m
[32m+[m[32m            .padding(horizontal = 16.dp, vertical = 16.dp),[m
[32m+[m[32m        verticalAlignment = Alignment.CenterVertically[m
[32m+[m[32m    ) {[m
[32m+[m[32m        Icon([m
[32m+[m[32m            imageVector = icon,[m
[32m+[m[32m            contentDescription = null,[m
[32m+[m[32m            // ‚≠êÔ∏è S·ª¨A: D√πng PrimaryGreen[m
[32m+[m[32m            tint = PrimaryGreen,[m
[32m+[m[32m            modifier = Modifier.size(28.dp)[m
[32m+[m[32m        )[m
[32m+[m
[32m+[m[32m        Spacer(modifier = Modifier.width(16.dp))[m
[32m+[m
[32m+[m[32m        Column(modifier = Modifier.weight(1f)) {[m
[32m+[m[32m            Text([m
[32m+[m[32m                text = title,[m
[32m+[m[32m                fontSize = 16.sp,[m
[32m+[m[32m                fontWeight = FontWeight.Medium,[m
[32m+[m[32m                color = onSurfaceColor // Ch·ªØ ti√™u ƒë·ªÅ ƒë·ªông[m
[32m+[m[32m            )[m
[32m+[m[32m            Spacer(modifier = Modifier.height(4.dp))[m
[32m+[m[32m            Text([m
[32m+[m[32m                text = subtitle,[m
[32m+[m[32m                fontSize = 13.sp,[m
[32m+[m[32m                color = onSurfaceColor.copy(alpha = 0.6f) // Ch·ªØ ph·ª• ƒë·ªông (nh·∫°t h∆°n)[m
[32m+[m[32m            )[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        Icon([m
[32m+[m[32m            imageVector = Icons.AutoMirrored.Filled.KeyboardArrowRight,[m
[32m+[m[32m            contentDescription = null,[m
[32m+[m[32m            tint = onSurfaceColor.copy(alpha = 0.4f) // Icon m≈©i t√™n ƒë·ªông[m
[32m+[m[32m        )[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/features/feature_profile/ui/legal/PrivacyPolicyScreen.kt b/app/src/main/java/com/example/stushare/features/feature_profile/ui/legal/PrivacyPolicyScreen.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..fada0f8[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/features/feature_profile/ui/legal/PrivacyPolicyScreen.kt[m
[36m@@ -0,0 +1,70 @@[m
[32m+[m[32mpackage com.example.stushare.features.feature_profile.ui.legal[m
[32m+[m
[32m+[m[32mimport androidx.compose.foundation.layout.*[m
[32m+[m[32mimport androidx.compose.foundation.rememberScrollState[m
[32m+[m[32mimport androidx.compose.foundation.verticalScroll[m
[32m+[m[32mimport androidx.compose.material.icons.Icons[m
[32m+[m[32mimport androidx.compose.material.icons.automirrored.filled.ArrowBack[m
[32m+[m[32mimport androidx.compose.material3.*[m
[32m+[m[32mimport androidx.compose.runtime.Composable[m
[32m+[m[32mimport androidx.compose.ui.Modifier[m
[32m+[m[32mimport androidx.compose.ui.graphics.Color[m
[32m+[m[32mimport androidx.compose.ui.res.stringResource[m
[32m+[m[32mimport androidx.compose.ui.text.font.FontWeight[m
[32m+[m[32mimport androidx.compose.ui.unit.dp[m
[32m+[m[32mimport androidx.compose.ui.unit.sp[m
[32m+[m[32m// ‚≠êÔ∏è Import ƒë√∫ng Resource v√† Theme c·ªßa d·ª± √°n ch√≠nh[m
[32m+[m[32mimport com.example.stushare.R[m
[32m+[m[32mimport com.example.stushare.ui.theme.PrimaryGreen[m
[32m+[m
[32m+[m[32m@OptIn(ExperimentalMaterial3Api::class)[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun PrivacyPolicyScreen([m
[32m+[m[32m    onBackClick: () -> Unit[m
[32m+[m[32m) {[m
[32m+[m[32m    // M√†u ƒë·ªông t·ª´ Theme[m
[32m+[m[32m    val backgroundColor = MaterialTheme.colorScheme.background[m
[32m+[m[32m    val onSurfaceColor = MaterialTheme.colorScheme.onSurface[m
[32m+[m
[32m+[m[32m    Scaffold([m
[32m+[m[32m        topBar = {[m
[32m+[m[32m            TopAppBar([m
[32m+[m[32m                title = {[m
[32m+[m[32m                    Text([m
[32m+[m[32m                        text = stringResource(R.string.privacy_header),[m
[32m+[m[32m                        color = Color.White,[m
[32m+[m[32m                        fontWeight = FontWeight.Bold,[m
[32m+[m[32m                        fontSize = 20.sp[m
[32m+[m[32m                    )[m
[32m+[m[32m                },[m
[32m+[m[32m                navigationIcon = {[m
[32m+[m[32m                    IconButton(onClick = onBackClick) {[m
[32m+[m[32m                        Icon([m
[32m+[m[32m                            imageVector = Icons.AutoMirrored.Filled.ArrowBack,[m
[32m+[m[32m                            contentDescription = "Quay v·ªÅ",[m
[32m+[m[32m                            tint = Color.White[m
[32m+[m[32m                        )[m
[32m+[m[32m                    }[m
[32m+[m[32m                },[m
[32m+[m[32m                // ‚≠êÔ∏è S·ª¨A: D√πng PrimaryGreen[m
[32m+[m[32m                colors = TopAppBarDefaults.topAppBarColors(containerColor = PrimaryGreen)[m
[32m+[m[32m            )[m
[32m+[m[32m        },[m
[32m+[m[32m        containerColor = backgroundColor[m
[32m+[m[32m    ) { innerPadding ->[m
[32m+[m[32m        Column([m
[32m+[m[32m            modifier = Modifier[m
[32m+[m[32m                .fillMaxSize()[m
[32m+[m[32m                .padding(innerPadding)[m
[32m+[m[32m                .verticalScroll(rememberScrollState()) // Cho ph√©p cu·ªôn n·ªôi dung d√†i[m
[32m+[m[32m                .padding(16.dp)[m
[32m+[m[32m        ) {[m
[32m+[m[32m            Text([m
[32m+[m[32m                text = stringResource(R.string.privacy_content),[m
[32m+[m[32m                color = onSurfaceColor,[m
[32m+[m[32m                fontSize = 16.sp,[m
[32m+[m[32m                lineHeight = 24.sp[m
[32m+[m[32m            )[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/features/feature_profile/ui/legal/ReportViolationScreen.kt b/app/src/main/java/com/example/stushare/features/feature_profile/ui/legal/ReportViolationScreen.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..589e74b[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/features/feature_profile/ui/legal/ReportViolationScreen.kt[m
[36m@@ -0,0 +1,219 @@[m
[32m+[m[32mpackage com.example.stushare.features.feature_profile.ui.legal[m
[32m+[m
[32m+[m[32mimport android.widget.Toast[m
[32m+[m[32mimport androidx.compose.foundation.background[m
[32m+[m[32mimport androidx.compose.foundation.clickable[m
[32m+[m[32mimport androidx.compose.foundation.layout.*[m
[32m+[m[32mimport androidx.compose.foundation.rememberScrollState[m
[32m+[m[32mimport androidx.compose.foundation.shape.RoundedCornerShape[m
[32m+[m[32mimport androidx.compose.foundation.verticalScroll[m
[32m+[m[32mimport androidx.compose.material.icons.Icons[m
[32m+[m[32mimport androidx.compose.material.icons.automirrored.filled.ArrowBack[m
[32m+[m[32mimport androidx.compose.material3.*[m
[32m+[m[32mimport androidx.compose.runtime.*[m
[32m+[m[32mimport androidx.compose.ui.Alignment[m
[32m+[m[32mimport androidx.compose.ui.Modifier[m
[32m+[m[32mimport androidx.compose.ui.graphics.Color[m
[32m+[m[32mimport androidx.compose.ui.platform.LocalContext[m
[32m+[m[32mimport androidx.compose.ui.res.stringResource[m
[32m+[m[32mimport androidx.compose.ui.text.font.FontWeight[m
[32m+[m[32mimport androidx.compose.ui.unit.dp[m
[32m+[m[32mimport androidx.compose.ui.unit.sp[m
[32m+[m[32m// ‚≠êÔ∏è Import ƒë√∫ng Resource v√† Theme c·ªßa d·ª± √°n ch√≠nh[m
[32m+[m[32mimport com.example.stushare.R[m
[32m+[m[32mimport com.example.stushare.ui.theme.PrimaryGreen[m
[32m+[m
[32m+[m[32m@OptIn(ExperimentalMaterial3Api::class)[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun ReportViolationScreen([m
[32m+[m[32m    onBackClick: () -> Unit[m
[32m+[m[32m) {[m
[32m+[m[32m    val context = LocalContext.current[m
[32m+[m[32m    var selectedReason by remember { mutableStateOf("") }[m
[32m+[m[32m    var description by remember { mutableStateOf("") }[m
[32m+[m
[32m+[m[32m    // L·∫•y danh s√°ch l√Ω do t·ª´ string resource[m
[32m+[m[32m    val reasons = listOf([m
[32m+[m[32m        stringResource(R.string.report_reason_spam),[m
[32m+[m[32m        stringResource(R.string.report_reason_fake),[m
[32m+[m[32m        stringResource(R.string.report_reason_copyright),[m
[32m+[m[32m        stringResource(R.string.report_reason_harassment),[m
[32m+[m[32m        stringResource(R.string.report_reason_other)[m
[32m+[m[32m    )[m
[32m+[m
[32m+[m[32m    // L·∫•y m√†u ƒë·ªông t·ª´ Theme[m
[32m+[m[32m    val backgroundColor = MaterialTheme.colorScheme.background[m
[32m+[m[32m    val surfaceColor = MaterialTheme.colorScheme.surface[m
[32m+[m[32m    val onSurfaceColor = MaterialTheme.colorScheme.onSurface[m
[32m+[m[32m    val dividerColor = MaterialTheme.colorScheme.outlineVariant[m
[32m+[m
[32m+[m[32m    Scaffold([m
[32m+[m[32m        topBar = {[m
[32m+[m[32m            TopAppBar([m
[32m+[m[32m                title = {[m
[32m+[m[32m                    Text([m
[32m+[m[32m                        text = stringResource(R.string.report_header),[m
[32m+[m[32m                        color = Color.White,[m
[32m+[m[32m                        fontWeight = FontWeight.Bold,[m
[32m+[m[32m                        fontSize = 20.sp[m
[32m+[m[32m                    )[m
[32m+[m[32m                },[m
[32m+[m[32m                navigationIcon = {[m
[32m+[m[32m                    IconButton(onClick = onBackClick) {[m
[32m+[m[32m                        Icon([m
[32m+[m[32m                            imageVector = Icons.AutoMirrored.Filled.ArrowBack,[m
[32m+[m[32m                            contentDescription = null,[m
[32m+[m[32m                            tint = Color.White[m
[32m+[m[32m                        )[m
[32m+[m[32m                    }[m
[32m+[m[32m                },[m
[32m+[m[32m                // ‚≠êÔ∏è S·ª¨A: D√πng PrimaryGreen[m
[32m+[m[32m                colors = TopAppBarDefaults.topAppBarColors(containerColor = PrimaryGreen)[m
[32m+[m[32m            )[m
[32m+[m[32m        },[m
[32m+[m[32m        containerColor = backgroundColor // N·ªÅn ƒë·ªông[m
[32m+[m[32m    ) { innerPadding ->[m
[32m+[m[32m        Box(modifier = Modifier.fillMaxSize()) {[m
[32m+[m[32m            Column([m
[32m+[m[32m                modifier = Modifier[m
[32m+[m[32m                    .fillMaxSize()[m
[32m+[m[32m                    .padding(innerPadding)[m
[32m+[m[32m                    .verticalScroll(rememberScrollState())[m
[32m+[m[32m            ) {[m
[32m+[m[32m                Spacer(modifier = Modifier.height(16.dp))[m
[32m+[m
[32m+[m[32m                // Title[m
[32m+[m[32m                Text([m
[32m+[m[32m                    text = stringResource(R.string.report_question),[m
[32m+[m[32m                    fontWeight = FontWeight.Bold,[m
[32m+[m[32m                    fontSize = 16.sp,[m
[32m+[m[32m                    // ‚≠êÔ∏è S·ª¨A: D√πng PrimaryGreen[m
[32m+[m[32m                    color = PrimaryGreen,[m
[32m+[m[32m                    modifier = Modifier.padding(horizontal = 16.dp)[m
[32m+[m[32m                )[m
[32m+[m
[32m+[m[32m                Spacer(modifier = Modifier.height(8.dp))[m
[32m+[m
[32m+[m[32m                // List Reasons (Danh s√°ch l√Ω do)[m
[32m+[m[32m                Card([m
[32m+[m[32m                    modifier = Modifier[m
[32m+[m[32m                        .fillMaxWidth()[m
[32m+[m[32m                        .padding(horizontal = 16.dp),[m
[32m+[m[32m                    colors = CardDefaults.cardColors(containerColor = surfaceColor), // Th·∫ª ƒë·ªông[m
[32m+[m[32m                    shape = RoundedCornerShape(12.dp),[m
[32m+[m[32m                    elevation = CardDefaults.cardElevation(2.dp)[m
[32m+[m[32m                ) {[m
[32m+[m[32m                    Column {[m
[32m+[m[32m                        reasons.forEachIndexed { index, reason ->[m
[32m+[m[32m                            Row([m
[32m+[m[32m                                modifier = Modifier[m
[32m+[m[32m                                    .fillMaxWidth()[m
[32m+[m[32m                                    .clickable { selectedReason = reason }[m
[32m+[m[32m                                    .padding(horizontal = 12.dp, vertical = 4.dp),[m
[32m+[m[32m                                verticalAlignment = Alignment.CenterVertically[m
[32m+[m[32m                            ) {[m
[32m+[m[32m                                RadioButton([m
[32m+[m[32m                                    selected = (selectedReason == reason),[m
[32m+[m[32m                                    onClick = { selectedReason = reason },[m
[32m+[m[32m                                    // ‚≠êÔ∏è S·ª¨A: D√πng PrimaryGreen[m
[32m+[m[32m                                    colors = RadioButtonDefaults.colors(selectedColor = PrimaryGreen)[m
[32m+[m[32m                                )[m
[32m+[m[32m                                Text([m
[32m+[m[32m                                    text = reason,[m
[32m+[m[32m                                    style = MaterialTheme.typography.bodyMedium,[m
[32m+[m[32m                                    color = onSurfaceColor // Ch·ªØ ƒë·ªông[m
[32m+[m[32m                                )[m
[32m+[m[32m                            }[m
[32m+[m[32m                            if (index < reasons.size - 1) {[m
[32m+[m[32m                                HorizontalDivider([m
[32m+[m[32m                                    modifier = Modifier.padding(horizontal = 16.dp),[m
[32m+[m[32m                                    color = dividerColor[m
[32m+[m[32m                                )[m
[32m+[m[32m                            }[m
[32m+[m[32m                        }[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m
[32m+[m[32m                Spacer(modifier = Modifier.height(24.dp))[m
[32m+[m
[32m+[m[32m                // Description (M√¥ t·∫£)[m
[32m+[m[32m                Text([m
[32m+[m[32m                    text = stringResource(R.string.report_desc_label),[m
[32m+[m[32m                    fontWeight = FontWeight.Bold,[m
[32m+[m[32m                    fontSize = 16.sp,[m
[32m+[m[32m                    // ‚≠êÔ∏è S·ª¨A: D√πng PrimaryGreen[m
[32m+[m[32m                    color = PrimaryGreen,[m
[32m+[m[32m                    modifier = Modifier.padding(horizontal = 16.dp)[m
[32m+[m[32m                )[m
[32m+[m
[32m+[m[32m                Spacer(modifier = Modifier.height(8.dp))[m
[32m+[m
[32m+[m[32m                OutlinedTextField([m
[32m+[m[32m                    value = description,[m
[32m+[m[32m                    onValueChange = { description = it },[m
[32m+[m[32m                    placeholder = {[m
[32m+[m[32m                        Text([m
[32m+[m[32m                            stringResource(R.string.report_desc_hint),[m
[32m+[m[32m                            color = onSurfaceColor.copy(alpha = 0.6f)[m
[32m+[m[32m                        )[m
[32m+[m[32m                    },[m
[32m+[m[32m                    modifier = Modifier[m
[32m+[m[32m                        .fillMaxWidth()[m
[32m+[m[32m                        .padding(horizontal = 16.dp)[m
[32m+[m[32m                        .height(150.dp)[m
[32m+[m[32m                        .background(surfaceColor, RoundedCornerShape(12.dp)), // N·ªÅn input ƒë·ªông[m
[32m+[m[32m                    shape = RoundedCornerShape(12.dp),[m
[32m+[m[32m                    colors = OutlinedTextFieldDefaults.colors([m
[32m+[m[32m                        // ‚≠êÔ∏è S·ª¨A: D√πng PrimaryGreen[m
[32m+[m[32m                        focusedBorderColor = PrimaryGreen,[m
[32m+[m[32m                        unfocusedBorderColor = dividerColor,[m
[32m+[m[32m                        focusedTextColor = onSurfaceColor,[m
[32m+[m[32m                        unfocusedTextColor = onSurfaceColor[m
[32m+[m[32m                    )[m
[32m+[m[32m                )[m
[32m+[m
[32m+[m[32m                Spacer(modifier = Modifier.height(32.dp))[m
[32m+[m
[32m+[m[32m                // Submit Button (N√∫t g·ª≠i)[m
[32m+[m[32m                val successMsg = stringResource(R.string.report_success)[m
[32m+[m[32m                val errorMsg = stringResource(R.string.report_error_select)[m
[32m+[m
[32m+[m[32m                Button([m
[32m+[m[32m                    onClick = {[m
[32m+[m[32m                        if (selectedReason.isNotEmpty()) {[m
[32m+[m[32m                            Toast.makeText(context, successMsg, Toast.LENGTH_SHORT).show()[m
[32m+[m[32m                            onBackClick()[m
[32m+[m[32m                        } else {[m
[32m+[m[32m                            Toast.makeText(context, errorMsg, Toast.LENGTH_SHORT).show()[m
[32m+[m[32m                        }[m
[32m+[m[32m                    },[m
[32m+[m[32m                    // ‚≠êÔ∏è S·ª¨A: D√πng PrimaryGreen[m
[32m+[m[32m                    colors = ButtonDefaults.buttonColors(containerColor = PrimaryGreen),[m
[32m+[m[32m                    modifier = Modifier[m
[32m+[m[32m                        .fillMaxWidth()[m
[32m+[m[32m                        .padding(horizontal = 32.dp)[m
[32m+[m[32m                        .height(50.dp),[m
[32m+[m[32m                    shape = RoundedCornerShape(25.dp)[m
[32m+[m[32m                ) {[m
[32m+[m[32m                    Text(stringResource(R.string.report_btn_submit), fontSize = 16.sp, fontWeight = FontWeight.Bold)[m
[32m+[m[32m                }[m
[32m+[m
[32m+[m[32m                Spacer(modifier = Modifier.height(100.dp))[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            // Bottom Curve[m
[32m+[m[32m            Box([m
[32m+[m[32m                modifier = Modifier[m
[32m+[m[32m                    .align(Alignment.BottomCenter)[m
[32m+[m[32m                    .fillMaxWidth()[m
[32m+[m[32m                    .height(120.dp)[m
[32m+[m[32m                    .offset(y = 60.dp)[m
[32m+[m[32m                    .background([m
[32m+[m[32m                        // ‚≠êÔ∏è S·ª¨A: D√πng PrimaryGreen[m
[32m+[m[32m                        color = PrimaryGreen,[m
[32m+[m[32m                        shape = RoundedCornerShape(topStart = 1000.dp, topEnd = 1000.dp)[m
[32m+[m[32m                    )[m
[32m+[m[32m            )[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/features/feature_profile/ui/legal/TermsOfUseScreen.kt b/app/src/main/java/com/example/stushare/features/feature_profile/ui/legal/TermsOfUseScreen.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..12add2e[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/features/feature_profile/ui/legal/TermsOfUseScreen.kt[m
[36m@@ -0,0 +1,70 @@[m
[32m+[m[32mpackage com.example.stushare.features.feature_profile.ui.legal[m
[32m+[m
[32m+[m[32mimport androidx.compose.foundation.layout.*[m
[32m+[m[32mimport androidx.compose.foundation.rememberScrollState[m
[32m+[m[32mimport androidx.compose.foundation.verticalScroll[m
[32m+[m[32mimport androidx.compose.material.icons.Icons[m
[32m+[m[32mimport androidx.compose.material.icons.automirrored.filled.ArrowBack[m
[32m+[m[32mimport androidx.compose.material3.*[m
[32m+[m[32mimport androidx.compose.runtime.Composable[m
[32m+[m[32mimport androidx.compose.ui.Modifier[m
[32m+[m[32mimport androidx.compose.ui.graphics.Color[m
[32m+[m[32mimport androidx.compose.ui.res.stringResource[m
[32m+[m[32mimport androidx.compose.ui.text.font.FontWeight[m
[32m+[m[32mimport androidx.compose.ui.unit.dp[m
[32m+[m[32mimport androidx.compose.ui.unit.sp[m
[32m+[m[32m// ‚≠êÔ∏è S·ª¨A L·∫†I IMPORT CHU·∫®N:[m
[32m+[m[32mimport com.example.stushare.R[m
[32m+[m[32mimport com.example.stushare.ui.theme.PrimaryGreen[m
[32m+[m
[32m+[m[32m@OptIn(ExperimentalMaterial3Api::class)[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun TermsOfUseScreen([m
[32m+[m[32m    onBackClick: () -> Unit[m
[32m+[m[32m) {[m
[32m+[m[32m    val backgroundColor = MaterialTheme.colorScheme.background[m
[32m+[m[32m    val onSurfaceColor = MaterialTheme.colorScheme.onSurface[m
[32m+[m
[32m+[m[32m    Scaffold([m
[32m+[m[32m        topBar = {[m
[32m+[m[32m            TopAppBar([m
[32m+[m[32m                title = {[m
[32m+[m[32m                    // ‚≠êÔ∏è S·ª¨A L·∫†I: Th√™m R.string.[m
[32m+[m[32m                    Text([m
[32m+[m[32m                        text = stringResource(R.string.terms_header),[m
[32m+[m[32m                        color = Color.White,[m
[32m+[m[32m                        fontWeight = FontWeight.Bold,[m
[32m+[m[32m                        fontSize = 20.sp[m
[32m+[m[32m                    )[m
[32m+[m[32m                },[m
[32m+[m[32m                navigationIcon = {[m
[32m+[m[32m                    IconButton(onClick = onBackClick) {[m
[32m+[m[32m                        Icon([m
[32m+[m[32m                            imageVector = Icons.AutoMirrored.Filled.ArrowBack,[m
[32m+[m[32m                            contentDescription = "Quay v·ªÅ",[m
[32m+[m[32m                            tint = Color.White[m
[32m+[m[32m                        )[m
[32m+[m[32m                    }[m
[32m+[m[32m                },[m
[32m+[m[32m                colors = TopAppBarDefaults.topAppBarColors(containerColor = PrimaryGreen)[m
[32m+[m[32m            )[m
[32m+[m[32m        },[m
[32m+[m[32m        containerColor = backgroundColor[m
[32m+[m[32m    ) { innerPadding ->[m
[32m+[m[32m        Column([m
[32m+[m[32m            modifier = Modifier[m
[32m+[m[32m                .fillMaxSize()[m
[32m+[m[32m                .padding(innerPadding)[m
[32m+[m[32m                .verticalScroll(rememberScrollState())[m
[32m+[m[32m                .padding(16.dp)[m
[32m+[m[32m        ) {[m
[32m+[m[32m            // ‚≠êÔ∏è S·ª¨A L·∫†I: Th√™m R.string.[m
[32m+[m[32m            Text([m
[32m+[m[32m                text = stringResource(R.string.terms_content),[m
[32m+[m[32m                color = onSurfaceColor,[m
[32m+[m[32m                fontSize = 16.sp,[m
[32m+[m[32m                lineHeight = 24.sp[m
[32m+[m[32m            )[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/features/feature_profile/ui/main/ProfileScreen.kt b/app/src/main/java/com/example/stushare/features/feature_profile/ui/main/ProfileScreen.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..36c2619[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/features/feature_profile/ui/main/ProfileScreen.kt[m
[36m@@ -0,0 +1,330 @@[m
[32m+[m[32mpackage com.example.stushare.features.feature_profile.ui.main[m
[32m+[m
[32m+[m[32mimport android.widget.Toast[m
[32m+[m[32mimport androidx.activity.compose.rememberLauncherForActivityResult[m
[32m+[m[32mimport androidx.activity.result.PickVisualMediaRequest[m
[32m+[m[32mimport androidx.activity.result.contract.ActivityResultContracts[m
[32m+[m[32mimport androidx.compose.animation.Crossfade[m
[32m+[m[32mimport androidx.compose.animation.core.tween[m
[32m+[m[32mimport androidx.compose.foundation.BorderStroke[m
[32m+[m[32mimport androidx.compose.foundation.Image[m
[32m+[m[32mimport androidx.compose.foundation.background[m
[32m+[m[32mimport androidx.compose.foundation.clickable[m
[32m+[m[32mimport androidx.compose.foundation.layout.*[m
[32m+[m[32mimport androidx.compose.foundation.lazy.LazyColumn[m
[32m+[m[32mimport androidx.compose.foundation.lazy.items[m
[32m+[m[32mimport androidx.compose.foundation.shape.CircleShape[m
[32m+[m[32mimport androidx.compose.foundation.shape.RoundedCornerShape[m
[32m+[m[32mimport androidx.compose.material.ExperimentalMaterialApi[m
[32m+[m[32mimport androidx.compose.material.icons.Icons[m
[32m+[m[32mimport androidx.compose.material.icons.filled.AccountCircle[m
[32m+[m[32mimport androidx.compose.material.icons.filled.CloudUpload[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Delete[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Description[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Download[m
[32m+[m[32mimport androidx.compose.material.icons.filled.MoreVert[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Search[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Security[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Settings[m
[32m+[m[32mimport androidx.compose.material.pullrefresh.PullRefreshIndicator[m
[32m+[m[32mimport androidx.compose.material.pullrefresh.pullRefresh[m
[32m+[m[32mimport androidx.compose.material.pullrefresh.rememberPullRefreshState[m
[32m+[m[32mimport androidx.compose.material3.*[m
[32m+[m[32mimport androidx.compose.material3.TabRowDefaults.tabIndicatorOffset[m
[32m+[m[32mimport androidx.compose.runtime.*[m
[32m+[m[32mimport androidx.compose.ui.Alignment[m
[32m+[m[32mimport androidx.compose.ui.Modifier[m
[32m+[m[32mimport androidx.compose.ui.draw.clip[m
[32m+[m[32mimport androidx.compose.ui.graphics.Color[m
[32m+[m[32mimport androidx.compose.ui.graphics.ColorFilter[m
[32m+[m[32mimport androidx.compose.ui.graphics.vector.ImageVector[m
[32m+[m[32mimport androidx.compose.ui.layout.ContentScale[m
[32m+[m[32mimport androidx.compose.ui.platform.LocalContext[m
[32m+[m[32mimport androidx.compose.ui.res.painterResource[m
[32m+[m[32mimport androidx.compose.ui.res.stringResource[m
[32m+[m[32mimport androidx.compose.ui.text.font.FontWeight[m
[32m+[m[32mimport androidx.compose.ui.text.style.TextAlign[m
[32m+[m[32mimport androidx.compose.ui.unit.dp[m
[32m+[m[32mimport androidx.compose.ui.unit.sp[m
[32m+[m[32mimport androidx.lifecycle.compose.collectAsStateWithLifecycle[m
[32m+[m[32mimport coil.compose.AsyncImage[m
[32m+[m[32mimport com.example.stushare.R[m
[32m+[m[32mimport com.example.stushare.features.feature_profile.ui.model.DocItem[m
[32m+[m[32mimport com.example.stushare.features.feature_profile.ui.model.UserProfile[m
[32m+[m[32mimport com.example.stushare.ui.theme.PrimaryGreen[m
[32m+[m[32mimport com.example.stushare.ui.theme.createShimmerBrush[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun ProfileScreen([m
[32m+[m[32m    viewModel: ProfileViewModel,[m
[32m+[m[32m    onNavigateToSettings: () -> Unit,[m
[32m+[m[32m    onNavigateToLeaderboard: () -> Unit,[m
[32m+[m[32m    onNavigateToLogin: () -> Unit,[m
[32m+[m[32m    onNavigateToRegister: () -> Unit,[m
[32m+[m[32m    onDocumentClick: (String) -> Unit = {},[m
[32m+[m[32m    onNavigateToUpload: () -> Unit,[m
[32m+[m[32m    onNavigateToHome: () -> Unit,[m
[32m+[m[32m    // üü¢ TH√äM: Callback v√†o Admin[m
[32m+[m[32m    onNavigateToAdmin: () -> Unit[m
[32m+[m[32m) {[m
[32m+[m[32m    val context = LocalContext.current[m
[32m+[m[32m    val uiState by viewModel.uiState.collectAsStateWithLifecycle()[m
[32m+[m[32m    val publishedDocs by viewModel.publishedDocuments.collectAsStateWithLifecycle()[m
[32m+[m[32m    val savedDocs by viewModel.savedDocuments.collectAsStateWithLifecycle()[m
[32m+[m[32m    val downloadedDocs by viewModel.downloadedDocuments.collectAsStateWithLifecycle()[m
[32m+[m[32m    val isUploadingAvatar by viewModel.isUploadingAvatar.collectAsStateWithLifecycle()[m
[32m+[m[32m    val isRefreshing by viewModel.isRefreshing.collectAsStateWithLifecycle()[m
[32m+[m
[32m+[m[32m    LaunchedEffect(Unit) {[m
[32m+[m[32m        viewModel.updateMessage.collect { msg ->[m
[32m+[m[32m            Toast.makeText(context, msg, Toast.LENGTH_SHORT).show()[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    val singlePhotoPickerLauncher = rememberLauncherForActivityResult([m
[32m+[m[32m        contract = ActivityResultContracts.PickVisualMedia(),[m
[32m+[m[32m        onResult = { uri -> if (uri != null) viewModel.uploadAvatar(uri) }[m
[32m+[m[32m    )[m
[32m+[m
[32m+[m[32m    Box([m
[32m+[m[32m        modifier = Modifier[m
[32m+[m[32m            .fillMaxSize()[m
[32m+[m[32m            .background(MaterialTheme.colorScheme.background)[m
[32m+[m[32m    ) {[m
[32m+[m[32m        Crossfade(targetState = uiState, label = "ProfileState", animationSpec = tween(400)) { state ->[m
[32m+[m[32m            when (state) {[m
[32m+[m[32m                is ProfileUiState.Loading -> ProfileSkeleton()[m
[32m+[m[32m                is ProfileUiState.Unauthenticated -> UnauthenticatedProfileContent(onNavigateToLogin, onNavigateToRegister)[m
[32m+[m[32m                is ProfileUiState.Authenticated -> AuthenticatedProfileContent([m
[32m+[m[32m                    userProfile = state.profile,[m
[32m+[m[32m                    totalDocs = state.totalDocs,[m
[32m+[m[32m                    totalDownloads = state.totalDownloads,[m
[32m+[m[32m                    memberRank = state.memberRank,[m
[32m+[m[32m                    publishedDocs = publishedDocs,[m
[32m+[m[32m                    savedDocs = savedDocs,[m
[32m+[m[32m                    downloadedDocs = downloadedDocs,[m
[32m+[m[32m                    isRefreshing = isRefreshing,[m
[32m+[m[32m                    onRefresh = { viewModel.refreshData() },[m
[32m+[m[32m                    onNavigateToSettings = onNavigateToSettings,[m
[32m+[m[32m                    onNavigateToLeaderboard = onNavigateToLeaderboard,[m
[32m+[m[32m                    onDeleteDoc = { docId -> viewModel.deletePublishedDocument(docId) },[m
[32m+[m[32m                    onAvatarClick = { singlePhotoPickerLauncher.launch(PickVisualMediaRequest(ActivityResultContracts.PickVisualMedia.ImageOnly)) },[m
[32m+[m[32m                    onDocumentClick = onDocumentClick,[m
[32m+[m[32m                    onNavigateToUpload = onNavigateToUpload,[m
[32m+[m[32m                    onNavigateToHome = onNavigateToHome,[m
[32m+[m[32m                    onNavigateToAdmin = onNavigateToAdmin // üü¢ Truy·ªÅn xu·ªëng[m
[32m+[m[32m                )[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        if (isUploadingAvatar) {[m
[32m+[m[32m            Box(Modifier.fillMaxSize().background(Color.Black.copy(alpha = 0.3f)), contentAlignment = Alignment.Center) {[m
[32m+[m[32m                CircularProgressIndicator(color = PrimaryGreen)[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m@OptIn(ExperimentalMaterialApi::class)[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun AuthenticatedProfileContent([m
[32m+[m[32m    userProfile: UserProfile,[m
[32m+[m[32m    totalDocs: Int,[m
[32m+[m[32m    totalDownloads: Int,[m
[32m+[m[32m    memberRank: String,[m
[32m+[m[32m    publishedDocs: List<DocItem>,[m
[32m+[m[32m    savedDocs: List<DocItem>,[m
[32m+[m[32m    downloadedDocs: List<DocItem>,[m
[32m+[m[32m    isRefreshing: Boolean,[m
[32m+[m[32m    onRefresh: () -> Unit,[m
[32m+[m[32m    onNavigateToSettings: () -> Unit,[m
[32m+[m[32m    onNavigateToLeaderboard: () -> Unit,[m
[32m+[m[32m    onDeleteDoc: (String) -> Unit,[m
[32m+[m[32m    onAvatarClick: () -> Unit,[m
[32m+[m[32m    onDocumentClick: (String) -> Unit,[m
[32m+[m[32m    onNavigateToUpload: () -> Unit,[m
[32m+[m[32m    onNavigateToHome: () -> Unit,[m
[32m+[m[32m    onNavigateToAdmin: () -> Unit // üü¢ Nh·∫≠n callback[m
[32m+[m[32m) {[m
[32m+[m[32m    var selectedTabIndex by remember { mutableIntStateOf(0) }[m
[32m+[m[32m    val tabTitles = listOf([m
[32m+[m[32m        stringResource(R.string.profile_tab_posted),[m
[32m+[m[32m        stringResource(R.string.profile_tab_saved),[m
[32m+[m[32m        stringResource(R.string.profile_tab_downloaded)[m
[32m+[m[32m    )[m
[32m+[m[32m    val pullRefreshState = rememberPullRefreshState(refreshing = isRefreshing, onRefresh = onRefresh)[m
[32m+[m
[32m+[m[32m    Box(modifier = Modifier.fillMaxSize().pullRefresh(pullRefreshState)) {[m
[32m+[m[32m        Column(modifier = Modifier.fillMaxSize()) {[m
[32m+[m[32m            val userName = stringResource(R.string.profile_hello, userProfile.fullName)[m
[32m+[m[32m            val displayMajor = if (userProfile.major.isNotBlank() && userProfile.major != "Ch∆∞a c·∫≠p nh·∫≠t") userProfile.major else stringResource(R.string.profile_dept)[m
[32m+[m
[32m+[m[32m            ProfileHeader(userName, displayMajor, userProfile.avatarUrl, onSettingsClick = onNavigateToSettings, onLeaderboardClick = onNavigateToLeaderboard, onAvatarClick = onAvatarClick)[m
[32m+[m
[32m+[m[32m            // üü¢ N√öT ADMIN (Ch·ªâ hi·ªán n·∫øu role l√† admin)[m
[32m+[m[32m            if (userProfile.role == "admin") {[m
[32m+[m[32m                Card([m
[32m+[m[32m                    modifier = Modifier[m
[32m+[m[32m                        .fillMaxWidth()[m
[32m+[m[32m                        .padding(horizontal = 16.dp, vertical = 8.dp)[m
[32m+[m[32m                        .clickable { onNavigateToAdmin() },[m
[32m+[m[32m                    colors = CardDefaults.cardColors(containerColor = Color(0xFFFFEBEE)), // ƒê·ªè nh·∫°t[m
[32m+[m[32m                    shape = RoundedCornerShape(12.dp)[m
[32m+[m[32m                ) {[m
[32m+[m[32m                    Row([m
[32m+[m[32m                        modifier = Modifier.padding(16.dp),[m
[32m+[m[32m                        verticalAlignment = Alignment.CenterVertically,[m
[32m+[m[32m                        horizontalArrangement = Arrangement.Center[m
[32m+[m[32m                    ) {[m
[32m+[m[32m                        Icon(Icons.Default.Security, contentDescription = null, tint = Color.Red)[m
[32m+[m[32m                        Spacer(modifier = Modifier.width(8.dp))[m
[32m+[m[32m                        Text("TRUY C·∫¨P TRANG QU·∫¢N TR·ªä", fontWeight = FontWeight.Bold, color = Color.Red)[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            StatisticsRow(totalDocs, totalDownloads, memberRank)[m
[32m+[m[32m            Divider(color = Color.LightGray.copy(alpha = 0.3f))[m
[32m+[m
[32m+[m[32m            TabRow(selectedTabIndex, containerColor = MaterialTheme.colorScheme.surface, contentColor = PrimaryGreen, indicator = { TabRowDefaults.SecondaryIndicator(Modifier.tabIndicatorOffset(it[selectedTabIndex]), color = PrimaryGreen) }) {[m
[32m+[m[32m                tabTitles.forEachIndexed { index, title ->[m
[32m+[m[32m                    Tab(selected = selectedTabIndex == index, onClick = { selectedTabIndex = index }, text = { Text(title, fontWeight = if (selectedTabIndex == index) FontWeight.Bold else FontWeight.Normal, color = if (selectedTabIndex == index) PrimaryGreen else MaterialTheme.colorScheme.onSurface) })[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            Crossfade(targetState = selectedTabIndex, animationSpec = tween(300), label = "TabContent") { tabIndex ->[m
[32m+[m[32m                val currentList = when (tabIndex) { 0 -> publishedDocs; 1 -> savedDocs; 2 -> downloadedDocs; else -> emptyList() }[m
[32m+[m[32m                if (currentList.isEmpty()) {[m
[32m+[m[32m                    Box(modifier = Modifier.fillMaxSize().padding(top = 32.dp)) {[m
[32m+[m[32m                        when (tabIndex) {[m
[32m+[m[32m                            0 -> ProfileEmptyState("B·∫°n ch∆∞a ƒëƒÉng t√†i li·ªáu n√†o", "ƒêƒÉng t√†i li·ªáu ngay", Icons.Default.CloudUpload, onNavigateToUpload)[m
[32m+[m[32m                            1 -> ProfileEmptyState("B·∫°n ch∆∞a l∆∞u t√†i li·ªáu n√†o", "Kh√°m ph√° ngay", Icons.Default.Search, onNavigateToHome)[m
[32m+[m[32m                            2 -> ProfileEmptyState("Ch∆∞a c√≥ t√†i li·ªáu t·∫£i xu·ªëng", "T√¨m t√†i li·ªáu", Icons.Default.Download, onNavigateToHome)[m
[32m+[m[32m                        }[m
[32m+[m[32m                    }[m
[32m+[m[32m                } else {[m
[32m+[m[32m                    LazyColumn(contentPadding = PaddingValues(16.dp), verticalArrangement = Arrangement.spacedBy(8.dp)) {[m
[32m+[m[32m                        items(currentList, key = { it.documentId }) { doc -> DocItemRow(doc, tabIndex == 0, { onDeleteDoc(doc.documentId) }, { onDocumentClick(doc.documentId) }) }[m
[32m+[m[32m                        item { Spacer(Modifier.height(80.dp)) }[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m        PullRefreshIndicator(isRefreshing, pullRefreshState, Modifier.align(Alignment.TopCenter), contentColor = PrimaryGreen)[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m// ... (C√°c component con ·ªü d∆∞·ªõi gi·ªØ nguy√™n nh∆∞ file c≈©, kh√¥ng thay ƒë·ªïi)[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun ProfileEmptyState(message: String, buttonText: String, icon: ImageVector, onClick: () -> Unit) {[m
[32m+[m[32m    Column(modifier = Modifier.fillMaxSize().padding(32.dp), horizontalAlignment = Alignment.CenterHorizontally, verticalArrangement = Arrangement.Center) {[m
[32m+[m[32m        Icon(imageVector = icon, contentDescription = null, modifier = Modifier.size(80.dp), tint = PrimaryGreen.copy(alpha = 0.3f))[m
[32m+[m[32m        Spacer(modifier = Modifier.height(16.dp))[m
[32m+[m[32m        Text(text = message, style = MaterialTheme.typography.bodyLarge, color = Color.Gray, textAlign = TextAlign.Center)[m
[32m+[m[32m        Spacer(modifier = Modifier.height(24.dp))[m
[32m+[m[32m        Button(onClick = onClick, colors = ButtonDefaults.buttonColors(containerColor = PrimaryGreen), shape = RoundedCornerShape(20.dp)) { Text(buttonText) }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun StatisticsRow(totalDocs: Int, totalDownloads: Int, memberRank: String, modifier: Modifier = Modifier) {[m
[32m+[m[32m    Row(modifier = modifier.fillMaxWidth().background(Color.White).padding(vertical = 16.dp), horizontalArrangement = Arrangement.SpaceEvenly, verticalAlignment = Alignment.CenterVertically) {[m
[32m+[m[32m        StatItem(count = totalDocs.toString(), label = "T√†i li·ªáu")[m
[32m+[m[32m        Divider(modifier = Modifier.height(40.dp).width(1.dp), color = Color.LightGray.copy(alpha = 0.5f))[m
[32m+[m[32m        StatItem(count = totalDownloads.toString(), label = "L∆∞·ª£t t·∫£i")[m
[32m+[m[32m        Divider(modifier = Modifier.height(40.dp).width(1.dp), color = Color.LightGray.copy(alpha = 0.5f))[m
[32m+[m[32m        StatItem(count = memberRank, label = "H·∫°ng", isRank = true)[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun StatItem(count: String, label: String, isRank: Boolean = false) {[m
[32m+[m[32m    Column(horizontalAlignment = Alignment.CenterHorizontally) {[m
[32m+[m[32m        Text(text = count, style = if (isRank) MaterialTheme.typography.titleMedium else MaterialTheme.typography.titleLarge, fontWeight = FontWeight.Bold, color = if (isRank) Color(0xFFFF9800) else PrimaryGreen)[m
[32m+[m[32m        Spacer(modifier = Modifier.height(4.dp))[m
[32m+[m[32m        Text(text = label, style = MaterialTheme.typography.bodySmall, color = Color.Gray)[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun UnauthenticatedProfileContent(onLoginClick: () -> Unit, onRegisterClick: () -> Unit) {[m
[32m+[m[32m    Column(modifier = Modifier.fillMaxSize().padding(24.dp), horizontalAlignment = Alignment.CenterHorizontally, verticalArrangement = Arrangement.Center) {[m
[32m+[m[32m        Icon(Icons.Default.AccountCircle, null, Modifier.size(120.dp), tint = MaterialTheme.colorScheme.onSurface.copy(alpha = 0.3f))[m
[32m+[m[32m        Spacer(Modifier.height(24.dp))[m
[32m+[m[32m        Text("B·∫°n ch∆∞a ƒëƒÉng nh·∫≠p", style = MaterialTheme.typography.headlineMedium, fontWeight = FontWeight.Bold)[m
[32m+[m[32m        Spacer(Modifier.height(8.dp))[m
[32m+[m[32m        Text("ƒêƒÉng nh·∫≠p ƒë·ªÉ qu·∫£n l√Ω t√†i li·ªáu, xem l·ªãch s·ª≠ t·∫£i xu·ªëng v√† tham gia b·∫£ng x·∫øp h·∫°ng.", style = MaterialTheme.typography.bodyLarge, textAlign = TextAlign.Center, color = MaterialTheme.colorScheme.onBackground.copy(alpha = 0.7f))[m
[32m+[m[32m        Spacer(Modifier.height(32.dp))[m
[32m+[m[32m        Button(onLoginClick, Modifier.fillMaxWidth().height(50.dp), shape = RoundedCornerShape(25.dp), colors = ButtonDefaults.buttonColors(containerColor = PrimaryGreen)) { Text("ƒêƒÉng Nh·∫≠p Ngay", fontSize = 16.sp, fontWeight = FontWeight.Bold, color = Color.White) }[m
[32m+[m[32m        Spacer(Modifier.height(16.dp))[m
[32m+[m[32m        OutlinedButton(onRegisterClick, Modifier.fillMaxWidth().height(50.dp), shape = RoundedCornerShape(25.dp), border = BorderStroke(1.dp, PrimaryGreen)) { Text("T·∫°o t√†i kho·∫£n m·ªõi", fontSize = 16.sp, fontWeight = FontWeight.Bold, color = PrimaryGreen) }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun ProfileHeader(userName: String, subText: String, avatarUrl: String?, onSettingsClick: () -> Unit, onLeaderboardClick: () -> Unit, onAvatarClick: () -> Unit) {[m
[32m+[m[32m    Card(colors = CardDefaults.cardColors(containerColor = MaterialTheme.colorScheme.surface), shape = RoundedCornerShape(0.dp), elevation = CardDefaults.cardElevation(2.dp), modifier = Modifier.padding(bottom = 1.dp)) {[m
[32m+[m[32m        Row(modifier = Modifier.fillMaxWidth().padding(16.dp).padding(top = 16.dp), verticalAlignment = Alignment.CenterVertically) {[m
[32m+[m[32m            Box(modifier = Modifier.size(64.dp).clip(CircleShape).clickable { onAvatarClick() }) {[m
[32m+[m[32m                if (avatarUrl != null) AsyncImage(model = avatarUrl, contentDescription = "Avatar", contentScale = ContentScale.Crop, modifier = Modifier.fillMaxSize())[m
[32m+[m[32m                else Image(painter = painterResource(id = R.drawable.ic_person), contentDescription = null, colorFilter = ColorFilter.tint(MaterialTheme.colorScheme.onSurface.copy(alpha = 0.8f)), modifier = Modifier.fillMaxSize().background(MaterialTheme.colorScheme.surfaceVariant).padding(12.dp))[m
[32m+[m[32m            }[m
[32m+[m[32m            Spacer(Modifier.width(16.dp))[m
[32m+[m[32m            Column(modifier = Modifier.weight(1f)) {[m
[32m+[m[32m                Text(userName, fontSize = 18.sp, fontWeight = FontWeight.Bold, color = MaterialTheme.colorScheme.onSurface)[m
[32m+[m[32m                Text(subText, fontSize = 14.sp, color = MaterialTheme.colorScheme.onSurface.copy(alpha = 0.6f))[m
[32m+[m[32m                Spacer(Modifier.height(8.dp))[m
[32m+[m[32m                Surface(onClick = onLeaderboardClick, shape = RoundedCornerShape(8.dp), color = Color(0xFFFFF3E0), modifier = Modifier.wrapContentWidth()) { Text(stringResource(R.string.profile_view_leaderboard), color = Color(0xFFFF9800), fontWeight = FontWeight.Bold, fontSize = 12.sp, modifier = Modifier.padding(horizontal = 8.dp, vertical = 4.dp)) }[m
[32m+[m[32m            }[m
[32m+[m[32m            IconButton(onSettingsClick) { Icon(Icons.Default.Settings, "Settings", tint = MaterialTheme.colorScheme.onSurface.copy(alpha = 0.6f)) }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun DocItemRow(item: DocItem, isDeletable: Boolean, onDelete: () -> Unit, onClick: () -> Unit) {[m
[32m+[m[32m    var showMenu by remember { mutableStateOf(false) }[m
[32m+[m[32m    Card(modifier = Modifier.fillMaxWidth().padding(vertical = 6.dp).clickable { onClick() }, shape = RoundedCornerShape(12.dp), colors = CardDefaults.cardColors(containerColor = MaterialTheme.colorScheme.surface), elevation = CardDefaults.cardElevation(2.dp)) {[m
[32m+[m[32m        Row(modifier = Modifier.padding(12.dp), verticalAlignment = Alignment.CenterVertically) {[m
[32m+[m[32m            Box(modifier = Modifier.size(48.dp).background(MaterialTheme.colorScheme.surfaceVariant, RoundedCornerShape(8.dp)), contentAlignment = Alignment.Center) { Icon(Icons.Default.Description, null, tint = PrimaryGreen) }[m
[32m+[m[32m            Spacer(Modifier.width(12.dp))[m
[32m+[m[32m            Column(modifier = Modifier.weight(1f)) {[m
[32m+[m[32m                Text(item.docTitle, fontWeight = FontWeight.Bold, fontSize = 15.sp, maxLines = 1, color = MaterialTheme.colorScheme.onSurface)[m
[32m+[m[32m                Text(item.meta, color = MaterialTheme.colorScheme.onSurface.copy(alpha = 0.6f), fontSize = 13.sp)[m
[32m+[m[32m            }[m
[32m+[m[32m            Box {[m
[32m+[m[32m                IconButton({ showMenu = true }) { Icon(Icons.Default.MoreVert, null, tint = MaterialTheme.colorScheme.onSurface.copy(alpha = 0.6f)) }[m
[32m+[m[32m                DropdownMenu(showMenu, { showMenu = false }, Modifier.background(MaterialTheme.colorScheme.surface)) {[m
[32m+[m[32m                    if (isDeletable) DropdownMenuItem({ Text(stringResource(R.string.delete), color = MaterialTheme.colorScheme.onSurface) }, { onDelete(); showMenu = false }, leadingIcon = { Icon(Icons.Default.Delete, null, tint = MaterialTheme.colorScheme.onSurface) })[m
[32m+[m[32m                    else DropdownMenuItem({ Text(stringResource(R.string.feature_not_supported), color = MaterialTheme.colorScheme.onSurface) }, { showMenu = false })[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun ProfileSkeleton() {[m
[32m+[m[32m    val brush = createShimmerBrush()[m
[32m+[m[32m    Column(modifier = Modifier.fillMaxSize()) {[m
[32m+[m[32m        Card(colors = CardDefaults.cardColors(containerColor = MaterialTheme.colorScheme.surface), shape = RoundedCornerShape(0.dp), elevation = CardDefaults.cardElevation(2.dp), modifier = Modifier.padding(bottom = 1.dp)) {[m
[32m+[m[32m            Row(modifier = Modifier.fillMaxWidth().padding(16.dp).padding(top = 16.dp), verticalAlignment = Alignment.CenterVertically) {[m
[32m+[m[32m                Box(modifier = Modifier.size(64.dp).clip(CircleShape).background(brush))[m
[32m+[m[32m                Spacer(Modifier.width(16.dp))[m
[32m+[m[32m                Column(modifier = Modifier.weight(1f)) {[m
[32m+[m[32m                    Box(modifier = Modifier.width(150.dp).height(20.dp).clip(RoundedCornerShape(4.dp)).background(brush))[m
[32m+[m[32m                    Spacer(Modifier.height(8.dp))[m
[32m+[m[32m                    Box(modifier = Modifier.width(100.dp).height(14.dp).clip(RoundedCornerShape(4.dp)).background(brush))[m
[32m+[m[32m                    Spacer(Modifier.height(8.dp))[m
[32m+[m[32m                    Box(modifier = Modifier.width(80.dp).height(24.dp).clip(RoundedCornerShape(8.dp)).background(brush))[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m        Row(modifier = Modifier.fillMaxWidth().background(Color.White).padding(vertical = 16.dp), horizontalArrangement = Arrangement.SpaceEvenly) {[m
[32m+[m[32m            repeat(3) { Column(horizontalAlignment = Alignment.CenterHorizontally) { Box(modifier = Modifier.width(30.dp).height(24.dp).clip(RoundedCornerShape(4.dp)).background(brush)); Spacer(Modifier.height(4.dp)); Box(modifier = Modifier.width(40.dp).height(12.dp).clip(RoundedCornerShape(4.dp)).background(brush)) } }[m
[32m+[m[32m        }[m
[32m+[m[32m        Divider(color = Color.LightGray.copy(alpha = 0.3f))[m
[32m+[m[32m        Row(modifier = Modifier.fillMaxWidth().padding(16.dp), horizontalArrangement = Arrangement.SpaceBetween) { repeat(3) { Box(modifier = Modifier.width(80.dp).height(20.dp).clip(RoundedCornerShape(4.dp)).background(brush)) } }[m
[32m+[m[32m        LazyColumn(contentPadding = PaddingValues(16.dp), verticalArrangement = Arrangement.spacedBy(8.dp)) { items(5) { Card(modifier = Modifier.fillMaxWidth().height(80.dp), shape = RoundedCornerShape(12.dp), colors = CardDefaults.cardColors(containerColor = Color.White), elevation = CardDefaults.cardElevation(2.dp)) { Row(modifier = Modifier.padding(12.dp), verticalAlignment = Alignment.CenterVertically) { Box(modifier = Modifier.size(48.dp).clip(RoundedCornerShape(8.dp)).background(brush)); Spacer(Modifier.width(12.dp)); Column(modifier = Modifier.weight(1f)) { Box(modifier = Modifier.fillMaxWidth(0.7f).height(16.dp).clip(RoundedCornerShape(4.dp)).background(brush)); Spacer(Modifier.height(8.dp)); Box(modifier = Modifier.fillMaxWidth(0.4f).height(12.dp).clip(RoundedCornerShape(4.dp)).background(brush)) } } } } }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/features/feature_profile/ui/main/ProfileViewModel.kt b/app/src/main/java/com/example/stushare/features/feature_profile/ui/main/ProfileViewModel.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..8c296de[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/features/feature_profile/ui/main/ProfileViewModel.kt[m
[36m@@ -0,0 +1,351 @@[m
[32m+[m[32mpackage com.example.stushare.features.feature_profile.ui.main[m
[32m+[m
[32m+[m[32mimport android.app.Activity[m
[32m+[m[32mimport android.net.Uri[m
[32m+[m[32mimport androidx.lifecycle.ViewModel[m
[32m+[m[32mimport androidx.lifecycle.viewModelScope[m
[32m+[m[32mimport com.example.stushare.core.data.repository.DocumentRepository[m
[32m+[m[32mimport com.example.stushare.features.feature_profile.ui.model.DocItem[m
[32m+[m[32mimport com.example.stushare.features.feature_profile.ui.model.UserProfile[m
[32m+[m[32mimport com.google.firebase.FirebaseException[m
[32m+[m[32mimport com.google.firebase.auth.EmailAuthProvider[m
[32m+[m[32mimport com.google.firebase.auth.FirebaseAuth[m
[32m+[m[32mimport com.google.firebase.auth.FirebaseUser[m
[32m+[m[32mimport com.google.firebase.auth.PhoneAuthCredential[m
[32m+[m[32mimport com.google.firebase.auth.PhoneAuthOptions[m
[32m+[m[32mimport com.google.firebase.auth.PhoneAuthProvider[m
[32m+[m[32mimport com.google.firebase.auth.UserProfileChangeRequest[m
[32m+[m[32mimport com.google.firebase.firestore.FirebaseFirestore[m
[32m+[m[32mimport com.google.firebase.firestore.SetOptions[m
[32m+[m[32mimport com.google.firebase.storage.FirebaseStorage[m
[32m+[m[32mimport dagger.hilt.android.lifecycle.HiltViewModel[m
[32m+[m[32mimport kotlinx.coroutines.Dispatchers[m
[32m+[m[32mimport kotlinx.coroutines.ExperimentalCoroutinesApi[m
[32m+[m[32mimport kotlinx.coroutines.channels.awaitClose[m
[32m+[m[32mimport kotlinx.coroutines.delay[m
[32m+[m[32mimport kotlinx.coroutines.flow.*[m
[32m+[m[32mimport kotlinx.coroutines.launch[m
[32m+[m[32mimport kotlinx.coroutines.tasks.await[m
[32m+[m[32mimport java.util.concurrent.TimeUnit[m
[32m+[m[32mimport javax.inject.Inject[m
[32m+[m
[32m+[m[32msealed interface ProfileUiState {[m
[32m+[m[32m    data object Loading : ProfileUiState[m
[32m+[m[32m    data object Unauthenticated : ProfileUiState[m
[32m+[m
[32m+[m[32m    data class Authenticated([m
[32m+[m[32m        val profile: UserProfile,[m
[32m+[m[32m        val totalDocs: Int = 0,[m
[32m+[m[32m        val totalDownloads: Int = 0,[m
[32m+[m[32m        val memberRank: String = "Th√†nh vi√™n m·ªõi"[m
[32m+[m[32m    ) : ProfileUiState[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m@HiltViewModel[m
[32m+[m[32mclass ProfileViewModel @Inject constructor([m
[32m+[m[32m    private val documentRepository: DocumentRepository,[m
[32m+[m[32m    private val storage: FirebaseStorage,[m
[32m+[m[32m    private val firestore: FirebaseFirestore[m
[32m+[m[32m) : ViewModel() {[m
[32m+[m
[32m+[m[32m    private val auth = FirebaseAuth.getInstance()[m
[32m+[m[32m    private val _updateMessage = MutableSharedFlow<String>()[m
[32m+[m[32m    val updateMessage = _updateMessage.asSharedFlow()[m
[32m+[m
[32m+[m[32m    private val _isUploadingAvatar = MutableStateFlow(false)[m
[32m+[m[32m    val isUploadingAvatar = _isUploadingAvatar.asStateFlow()[m
[32m+[m
[32m+[m[32m    private val _isRefreshing = MutableStateFlow(false)[m
[32m+[m[32m    val isRefreshing = _isRefreshing.asStateFlow()[m
[32m+[m
[32m+[m[32m    private var verificationId: String = ""[m
[32m+[m
[32m+[m[32m    private val authStateFlow: Flow<FirebaseUser?> = callbackFlow {[m
[32m+[m[32m        val authStateListener = FirebaseAuth.AuthStateListener { firebaseAuth ->[m
[32m+[m[32m            trySend(firebaseAuth.currentUser)[m
[32m+[m[32m        }[m
[32m+[m[32m        auth.addAuthStateListener(authStateListener)[m
[32m+[m[32m        trySend(auth.currentUser)[m
[32m+[m[32m        awaitClose { auth.removeAuthStateListener(authStateListener) }[m
[32m+[m[32m    }.flowOn(Dispatchers.IO)[m
[32m+[m
[32m+[m[32m    @OptIn(ExperimentalCoroutinesApi::class)[m
[32m+[m[32m    val uiState: StateFlow<ProfileUiState> = authStateFlow[m
[32m+[m[32m        .flatMapLatest { user ->[m
[32m+[m[32m            if (user != null) {[m
[32m+[m[32m                val userDocFlow = callbackFlow {[m
[32m+[m[32m                    val docRef = firestore.collection("users").document(user.uid)[m
[32m+[m[32m                    val listener = docRef.addSnapshotListener { snapshot, _ ->[m
[32m+[m[32m                        trySend(snapshot)[m
[32m+[m[32m                    }[m
[32m+[m[32m                    awaitClose { listener.remove() }[m
[32m+[m[32m                }[m
[32m+[m
[32m+[m[32m                val docsFlow = documentRepository.getDocumentsByAuthor(user.uid)[m
[32m+[m
[32m+[m[32m                combine(userDocFlow, docsFlow) { snapshot, documents ->[m
[32m+[m[32m                    val totalDocs = documents.size[m
[32m+[m[32m                    val totalDownloads = documents.sumOf { it.downloads }[m
[32m+[m
[32m+[m[32m                    val rank = when {[m
[32m+[m[32m                        totalDownloads > 1000 -> "Huy·ªÅn tho·∫°i"[m
[32m+[m[32m                        totalDownloads > 500 -> "Chuy√™n gia"[m
[32m+[m[32m                        totalDownloads > 100 -> "T√≠ch c·ª±c"[m
[32m+[m[32m                        totalDocs > 5 -> "Th√¢n thi·ªán"[m
[32m+[m[32m                        else -> "Th√†nh vi√™n m·ªõi"[m
[32m+[m[32m                    }[m
[32m+[m
[32m+[m[32m                    val major = snapshot?.getString("major") ?: "Ch∆∞a c·∫≠p nh·∫≠t"[m
[32m+[m[32m                    val bio = snapshot?.getString("bio") ?: ""[m
[32m+[m[32m                    val role = snapshot?.getString("role") ?: "user"[m[41m [m
[32m+[m
[32m+[m[32m                    val profile = UserProfile([m
[32m+[m[32m                        id = user.uid,[m
[32m+[m[32m                        fullName = user.displayName ?: user.email ?: "Sinh vi√™n UTH",[m
[32m+[m[32m                        email = user.email ?: "",[m
[32m+[m[32m                        avatarUrl = user.photoUrl?.toString(),[m
[32m+[m[32m                        major = major,[m
[32m+[m[32m                        bio = bio,[m
[32m+[m[32m                        role = role[m
[32m+[m[32m                    )[m
[32m+[m
[32m+[m[32m                    ProfileUiState.Authenticated([m
[32m+[m[32m                        profile = profile,[m
[32m+[m[32m                        totalDocs = totalDocs,[m
[32m+[m[32m                        totalDownloads = totalDownloads,[m
[32m+[m[32m                        memberRank = rank[m
[32m+[m[32m                    )[m
[32m+[m[32m                }[m
[32m+[m[32m            } else {[m
[32m+[m[32m                flowOf(ProfileUiState.Unauthenticated)[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m        .stateIn([m
[32m+[m[32m            viewModelScope,[m
[32m+[m[32m            SharingStarted.WhileSubscribed(5000),[m
[32m+[m[32m            ProfileUiState.Loading[m
[32m+[m[32m        )[m
[32m+[m
[32m+[m[32m    @OptIn(ExperimentalCoroutinesApi::class)[m
[32m+[m[32m    val publishedDocuments: StateFlow<List<DocItem>> = authStateFlow[m
[32m+[m[32m        .flatMapLatest { user ->[m
[32m+[m[32m            if (user != null) {[m
[32m+[m[32m                documentRepository.getDocumentsByAuthor(user.uid).map { documents ->[m
[32m+[m[32m                    documents.map { doc ->[m
[32m+[m[32m                        DocItem([m
[32m+[m[32m                            documentId = doc.id,[m
[32m+[m[32m                            docTitle = doc.title,[m
[32m+[m[32m                            meta = "ƒê√£ ƒëƒÉng ‚Ä¢ ${doc.downloads} l∆∞·ª£t t·∫£i"[m
[32m+[m[32m                        )[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m            } else {[m
[32m+[m[32m                flowOf(emptyList())[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m        .stateIn(viewModelScope, SharingStarted.WhileSubscribed(5000), emptyList())[m
[32m+[m
[32m+[m[32m    @OptIn(ExperimentalCoroutinesApi::class)[m
[32m+[m[32m    val savedDocuments: StateFlow<List<DocItem>> = authStateFlow[m
[32m+[m[32m        .flatMapLatest { user ->[m
[32m+[m[32m            if (user != null) {[m
[32m+[m[32m                documentRepository.getBookmarkedDocuments().map { documents ->[m
[32m+[m[32m                    documents.map { doc ->[m
[32m+[m[32m                        DocItem([m
[32m+[m[32m                            documentId = doc.id,[m
[32m+[m[32m                            docTitle = doc.title,[m
[32m+[m[32m                            meta = "ƒê√£ l∆∞u ‚Ä¢ ${doc.type}"[m
[32m+[m[32m                        )[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m            } else {[m
[32m+[m[32m                flowOf(emptyList())[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m        .stateIn(viewModelScope, SharingStarted.WhileSubscribed(5000), emptyList())[m
[32m+[m
[32m+[m[32m    val downloadedDocuments: StateFlow<List<DocItem>> = documentRepository.getAllDocuments()[m
[32m+[m[32m        .map { documents ->[m
[32m+[m[32m            documents.map { doc ->[m
[32m+[m[32m                DocItem([m
[32m+[m[32m                    documentId = doc.id,[m
[32m+[m[32m                    docTitle = doc.title,[m
[32m+[m[32m                    meta = "ƒê√£ t·∫£i v·ªÅ ‚Ä¢ ${doc.type.uppercase()}"[m
[32m+[m[32m                )[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m        .stateIn(viewModelScope, SharingStarted.WhileSubscribed(5000), emptyList())[m
[32m+[m
[32m+[m
[32m+[m[32m    fun refreshData() {[m
[32m+[m[32m        viewModelScope.launch {[m
[32m+[m[32m            _isRefreshing.value = true[m
[32m+[m[32m            try {[m
[32m+[m[32m                auth.currentUser?.reload()?.await()[m
[32m+[m[32m                delay(1000)[m
[32m+[m[32m            } catch (e: Exception) {[m
[32m+[m[32m                e.printStackTrace()[m
[32m+[m[32m            } finally {[m
[32m+[m[32m                _isRefreshing.value = false[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    fun updateExtendedInfo(major: String, bio: String) {[m
[32m+[m[32m        val uid = auth.currentUser?.uid ?: return[m
[32m+[m[32m        val data = hashMapOf("major" to major, "bio" to bio)[m
[32m+[m[32m        viewModelScope.launch {[m
[32m+[m[32m            try {[m
[32m+[m[32m                firestore.collection("users").document(uid).set(data, SetOptions.merge()).await()[m
[32m+[m[32m                _updateMessage.emit("ƒê√£ c·∫≠p nh·∫≠t th√¥ng tin!")[m
[32m+[m[32m            } catch (e: Exception) {[m
[32m+[m[32m                _updateMessage.emit("L·ªói: ${e.message}")[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    fun uploadAvatar(uri: Uri) {[m
[32m+[m[32m        val user = auth.currentUser ?: return[m
[32m+[m[32m        viewModelScope.launch {[m
[32m+[m[32m            _isUploadingAvatar.value = true[m
[32m+[m[32m            try {[m
[32m+[m[32m                val storageRef = storage.reference.child("avatars/${user.uid}.jpg")[m
[32m+[m[32m                storageRef.putFile(uri).await()[m
[32m+[m[32m                val downloadUrl = storageRef.downloadUrl.await()[m
[32m+[m[32m                val profileUpdates = UserProfileChangeRequest.Builder().setPhotoUri(downloadUrl).build()[m
[32m+[m[32m                user.updateProfile(profileUpdates).await()[m
[32m+[m[32m                user.reload().await()[m
[32m+[m[32m                _updateMessage.emit("ƒê√£ c·∫≠p nh·∫≠t ·∫£nh ƒë·∫°i di·ªán!")[m
[32m+[m[32m            } catch (e: Exception) {[m
[32m+[m[32m                e.printStackTrace()[m
[32m+[m[32m                _updateMessage.emit("L·ªói t·∫£i ·∫£nh: ${e.message}")[m
[32m+[m[32m            } finally {[m
[32m+[m[32m                _isUploadingAvatar.value = false[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    fun updateUserName(newName: String) {[m
[32m+[m[32m        val user = auth.currentUser ?: return[m
[32m+[m[32m        if (newName.isBlank()) {[m
[32m+[m[32m            viewModelScope.launch { _updateMessage.emit("T√™n kh√¥ng ƒë∆∞·ª£c ƒë·ªÉ tr·ªëng!") }[m
[32m+[m[32m            return[m
[32m+[m[32m        }[m
[32m+[m[32m        val profileUpdates = UserProfileChangeRequest.Builder().setDisplayName(newName).build()[m
[32m+[m[32m        user.updateProfile(profileUpdates).addOnCompleteListener { task ->[m
[32m+[m[32m            viewModelScope.launch {[m
[32m+[m[32m                if (task.isSuccessful) {[m
[32m+[m[32m                    _updateMessage.emit("C·∫≠p nh·∫≠t t√™n th√†nh c√¥ng!")[m
[32m+[m[32m                    user.reload()[m
[32m+[m[32m                } else {[m
[32m+[m[32m                    _updateMessage.emit("L·ªói: ${task.exception?.message}")[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    fun changePassword(currentPass: String, newPass: String) {[m
[32m+[m[32m        val user = auth.currentUser ?: return[m
[32m+[m[32m        if (user.email == null) return[m
[32m+[m[32m        val credential = EmailAuthProvider.getCredential(user.email!!, currentPass)[m
[32m+[m[32m        user.reauthenticate(credential).addOnCompleteListener { authTask ->[m
[32m+[m[32m            if (authTask.isSuccessful) {[m
[32m+[m[32m                user.updatePassword(newPass).addOnCompleteListener { updateTask ->[m
[32m+[m[32m                    viewModelScope.launch {[m
[32m+[m[32m                        if (updateTask.isSuccessful) _updateMessage.emit("ƒê·ªïi m·∫≠t kh·∫©u th√†nh c√¥ng!")[m
[32m+[m[32m                        else _updateMessage.emit("L·ªói: ${updateTask.exception?.message}")[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m            } else {[m
[32m+[m[32m                viewModelScope.launch { _updateMessage.emit("M·∫≠t kh·∫©u hi·ªán t·∫°i kh√¥ng ƒë√∫ng!") }[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    fun updateEmail(currentPass: String, newEmail: String) {[m
[32m+[m[32m        val user = auth.currentUser ?: return[m
[32m+[m[32m        if (user.email == null) return[m
[32m+[m[32m        val credential = EmailAuthProvider.getCredential(user.email!!, currentPass)[m
[32m+[m[32m        user.reauthenticate(credential).addOnCompleteListener { task ->[m
[32m+[m[32m            if (task.isSuccessful) {[m
[32m+[m[32m                user.updateEmail(newEmail).addOnCompleteListener { updateTask ->[m
[32m+[m[32m                    viewModelScope.launch {[m
[32m+[m[32m                        if (updateTask.isSuccessful) _updateMessage.emit("ƒê·ªïi email th√†nh c√¥ng!")[m
[32m+[m[32m                        else _updateMessage.emit("L·ªói: ${updateTask.exception?.message}")[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m            } else {[m
[32m+[m[32m                viewModelScope.launch { _updateMessage.emit("M·∫≠t kh·∫©u kh√¥ng ƒë√∫ng!") }[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    fun deletePublishedDocument(docId: String) {[m
[32m+[m[32m        viewModelScope.launch {[m
[32m+[m[32m            try {[m
[32m+[m[32m                val result = documentRepository.deleteDocument(docId)[m
[32m+[m[32m                if (result.isSuccess) _updateMessage.emit("ƒê√£ x√≥a t√†i li·ªáu") else _updateMessage.emit("X√≥a th·∫•t b·∫°i")[m
[32m+[m[32m            } catch (e: Exception) {[m
[32m+[m[32m                _updateMessage.emit("L·ªói khi x√≥a: ${e.message}")[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    fun signOut() { auth.signOut() }[m
[32m+[m
[32m+[m[32m    fun sendOtp([m
[32m+[m[32m        phoneNumber: String,[m
[32m+[m[32m        activity: Activity,[m
[32m+[m[32m        onCodeSent: () -> Unit,[m
[32m+[m[32m        onError: (String) -> Unit[m
[32m+[m[32m    ) {[m
[32m+[m[32m        val options = PhoneAuthOptions.newBuilder(auth)[m
[32m+[m[32m            .setPhoneNumber(phoneNumber)[m[41m      [m
[32m+[m[32m            .setTimeout(60L, TimeUnit.SECONDS)[m[41m [m
[32m+[m[32m            .setActivity(activity)[m[41m            [m
[32m+[m[32m            .setCallbacks(object : PhoneAuthProvider.OnVerificationStateChangedCallbacks() {[m
[32m+[m[32m                override fun onVerificationCompleted(credential: PhoneAuthCredential) {[m
[32m+[m[32m                    // Auto-retrieval or instant verification[m
[32m+[m[32m                    updatePhoneNumber(credential)[m
[32m+[m[32m                }[m
[32m+[m
[32m+[m[32m                override fun onVerificationFailed(e: FirebaseException) {[m
[32m+[m[32m                    onError(e.message ?: "G·ª≠i OTP th·∫•t b·∫°i")[m
[32m+[m[32m                }[m
[32m+[m
[32m+[m[32m                override fun onCodeSent([m
[32m+[m[32m                    vId: String,[m
[32m+[m[32m                    token: PhoneAuthProvider.ForceResendingToken[m
[32m+[m[32m                ) {[m
[32m+[m[32m                    verificationId = vId[m
[32m+[m[32m                    onCodeSent()[m
[32m+[m[32m                }[m
[32m+[m[32m            })[m
[32m+[m[32m            .build()[m
[32m+[m[32m        PhoneAuthProvider.verifyPhoneNumber(options)[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    fun verifyAndUpdatePhone(code: String) {[m
[32m+[m[32m        if (verificationId.isEmpty()) return[m
[32m+[m[32m        val credential = PhoneAuthProvider.getCredential(verificationId, code)[m
[32m+[m[32m        updatePhoneNumber(credential)[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    private fun updatePhoneNumber(credential: PhoneAuthCredential) {[m
[32m+[m[32m        val user = auth.currentUser ?: return[m
[32m+[m[32m        viewModelScope.launch {[m
[32m+[m[32m            try {[m
[32m+[m[32m                user.updatePhoneNumber(credential).await()[m
[32m+[m[32m                user.reload().await()[m
[32m+[m
[32m+[m[32m                firestore.collection("users").document(user.uid)[m
[32m+[m[32m                    .update("phone", user.phoneNumber)[m
[32m+[m[32m                    .await()[m
[32m+[m
[32m+[m[32m                _updateMessage.emit("C·∫≠p nh·∫≠t s·ªë ƒëi·ªán tho·∫°i th√†nh c√¥ng! ‚úÖ")[m
[32m+[m[32m            } catch (e: Exception) {[m
[32m+[m[32m                _updateMessage.emit("L·ªói: ${e.message}")[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/features/feature_profile/ui/model/DocItem.kt b/app/src/main/java/com/example/stushare/features/feature_profile/ui/model/DocItem.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..7a0c262[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/features/feature_profile/ui/model/DocItem.kt[m
[36m@@ -0,0 +1,7 @@[m
[32m+[m[32mpackage com.example.stushare.features.feature_profile.ui.model[m
[32m+[m
[32m+[m[32mdata class DocItem([m
[32m+[m[32m    val documentId: String,[m
[32m+[m[32m    val docTitle: String,[m
[32m+[m[32m    val meta: String[m
[32m+[m[32m)[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/features/feature_profile/ui/model/UserProfile.kt b/app/src/main/java/com/example/stushare/features/feature_profile/ui/model/UserProfile.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..68f40ab[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/features/feature_profile/ui/model/UserProfile.kt[m
[36m@@ -0,0 +1,13 @@[m
[32m+[m[32mpackage com.example.stushare.features.feature_profile.ui.model[m
[32m+[m
[32m+[m[32mdata class UserProfile([m
[32m+[m[32m    val id: String,[m
[32m+[m[32m    val fullName: String,[m
[32m+[m[32m    val email: String,[m
[32m+[m[32m    val avatarUrl: String? = null,[m
[32m+[m[32m    val major: String = "Ch∆∞a c·∫≠p nh·∫≠t",[m
[32m+[m[32m    val bio: String = "",[m
[32m+[m
[32m+[m[32m    // üü¢ M·ªöI: Ph√¢n quy·ªÅn (m·∫∑c ƒë·ªãnh l√† 'user', admin s·∫Ω l√† 'admin')[m
[32m+[m[32m    val role: String = "user"[m
[32m+[m[32m)[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/features/feature_profile/ui/settings/SettingsScreen.kt b/app/src/main/java/com/example/stushare/features/feature_profile/ui/settings/SettingsScreen.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..b073e7a[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/features/feature_profile/ui/settings/SettingsScreen.kt[m
[36m@@ -0,0 +1,217 @@[m
[32m+[m[32mpackage com.example.stushare.features.feature_profile.ui.settings[m
[32m+[m
[32m+[m[32mimport androidx.compose.foundation.background[m
[32m+[m[32mimport androidx.compose.foundation.clickable[m
[32m+[m[32mimport androidx.compose.foundation.layout.*[m
[32m+[m[32mimport androidx.compose.foundation.rememberScrollState[m
[32m+[m[32mimport androidx.compose.foundation.shape.RoundedCornerShape[m
[32m+[m[32mimport androidx.compose.foundation.verticalScroll[m
[32m+[m[32mimport androidx.compose.material.icons.Icons[m
[32m+[m[32mimport androidx.compose.material.icons.automirrored.filled.ArrowBack[m
[32m+[m[32mimport androidx.compose.material.icons.automirrored.filled.ExitToApp[m
[32m+[m[32mimport androidx.compose.material.icons.automirrored.filled.KeyboardArrowRight[m
[32m+[m[32mimport androidx.compose.material.icons.filled.*[m
[32m+[m[32mimport androidx.compose.material3.*[m
[32m+[m[32mimport androidx.compose.runtime.Composable[m
[32m+[m[32mimport androidx.compose.ui.Alignment[m
[32m+[m[32mimport androidx.compose.ui.Modifier[m
[32m+[m[32mimport androidx.compose.ui.graphics.Color[m
[32m+[m[32mimport androidx.compose.ui.graphics.vector.ImageVector[m
[32m+[m[32mimport androidx.compose.ui.platform.LocalContext[m
[32m+[m[32mimport androidx.compose.ui.res.stringResource[m
[32m+[m[32mimport androidx.compose.ui.text.font.FontWeight[m
[32m+[m[32mimport androidx.compose.ui.unit.dp[m
[32m+[m[32mimport androidx.compose.ui.unit.sp[m
[32m+[m[32m// Import Resource v√† Theme[m
[32m+[m[32mimport com.example.stushare.R[m
[32m+[m[32mimport com.example.stushare.ui.theme.PrimaryGreen[m
[32m+[m
[32m+[m[32m@OptIn(ExperimentalMaterial3Api::class)[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun SettingsScreen([m
[32m+[m[32m    onBackClick: () -> Unit,[m
[32m+[m[32m    onAccountSecurityClick: () -> Unit,[m
[32m+[m[32m    onNotificationSettingsClick: () -> Unit,[m
[32m+[m[32m    onAppearanceSettingsClick: () -> Unit,[m
[32m+[m[32m    onAboutAppClick: () -> Unit,[m
[32m+[m[32m    onContactSupportClick: () -> Unit,[m
[32m+[m[32m    onReportViolationClick: () -> Unit,[m
[32m+[m[32m    onSwitchAccountClick: () -> Unit,[m
[32m+[m[32m    onLogoutClick: () -> Unit // ‚≠êÔ∏è TH√äM: Callback ƒëƒÉng xu·∫•t[m
[32m+[m[32m) {[m
[32m+[m[32m    val context = LocalContext.current[m
[32m+[m[32m    val backgroundColor = MaterialTheme.colorScheme.background[m
[32m+[m
[32m+[m[32m    Scaffold([m
[32m+[m[32m        topBar = {[m
[32m+[m[32m            TopAppBar([m
[32m+[m[32m                title = {[m
[32m+[m[32m                    Text([m
[32m+[m[32m                        text = stringResource(R.string.settings_title),[m
[32m+[m[32m                        color = Color.White,[m
[32m+[m[32m                        fontWeight = FontWeight.Bold,[m
[32m+[m[32m                        fontSize = 20.sp[m
[32m+[m[32m                    )[m
[32m+[m[32m                },[m
[32m+[m[32m                navigationIcon = {[m
[32m+[m[32m                    IconButton(onClick = onBackClick) {[m
[32m+[m[32m                        Icon([m
[32m+[m[32m                            imageVector = Icons.AutoMirrored.Filled.ArrowBack,[m
[32m+[m[32m                            contentDescription = null,[m
[32m+[m[32m                            tint = Color.White[m
[32m+[m[32m                        )[m
[32m+[m[32m                    }[m
[32m+[m[32m                },[m
[32m+[m[32m                colors = TopAppBarDefaults.topAppBarColors(containerColor = PrimaryGreen)[m
[32m+[m[32m            )[m
[32m+[m[32m        },[m
[32m+[m[32m        containerColor = backgroundColor[m
[32m+[m[32m    ) { innerPadding ->[m
[32m+[m[32m        Column([m
[32m+[m[32m            modifier = Modifier[m
[32m+[m[32m                .fillMaxSize()[m
[32m+[m[32m                .padding(innerPadding)[m
[32m+[m[32m                .verticalScroll(rememberScrollState())[m
[32m+[m[32m                .padding(top = 12.dp),[m
[32m+[m[32m            horizontalAlignment = Alignment.CenterHorizontally[m
[32m+[m[32m        ) {[m
[32m+[m[32m            // --- C√ÅC M·ª§C C√ÄI ƒê·∫∂T ---[m
[32m+[m[32m            Column(modifier = Modifier.fillMaxWidth()) {[m
[32m+[m[32m                // 1. T√†i kho·∫£n[m
[32m+[m[32m                SettingsItem([m
[32m+[m[32m                    icon = Icons.Default.Person,[m
[32m+[m[32m                    title = stringResource(R.string.acc_security),[m
[32m+[m[32m                    onClick = onAccountSecurityClick[m
[32m+[m[32m                )[m
[32m+[m[32m                Spacer(modifier = Modifier.height(2.dp))[m
[32m+[m
[32m+[m[32m                // 2. Th√¥ng b√°o[m
[32m+[m[32m                SettingsItem([m
[32m+[m[32m                    icon = Icons.Default.Notifications,[m
[32m+[m[32m                    title = stringResource(R.string.notifications),[m
[32m+[m[32m                    onClick = onNotificationSettingsClick[m
[32m+[m[32m                )[m
[32m+[m[32m                Spacer(modifier = Modifier.height(12.dp))[m
[32m+[m
[32m+[m[32m                // 3. Giao di·ªán[m
[32m+[m[32m                SettingsItem([m
[32m+[m[32m                    icon = Icons.Default.Face,[m
[32m+[m[32m                    title = stringResource(R.string.appearance_language),[m
[32m+[m[32m                    onClick = onAppearanceSettingsClick[m
[32m+[m[32m                )[m
[32m+[m[32m                Spacer(modifier = Modifier.height(2.dp))[m
[32m+[m
[32m+[m[32m                // 4. Th√¥ng tin[m
[32m+[m[32m                SettingsItem([m
[32m+[m[32m                    icon = Icons.Default.Info,[m
[32m+[m[32m                    title = stringResource(R.string.about_stushare),[m
[32m+[m[32m                    onClick = onAboutAppClick[m
[32m+[m[32m                )[m
[32m+[m[32m                Spacer(modifier = Modifier.height(12.dp))[m
[32m+[m
[32m+[m[32m                // 5. H·ªó tr·ª£[m
[32m+[m[32m                SettingsItem([m
[32m+[m[32m                    icon = Icons.Default.Call,[m
[32m+[m[32m                    title = stringResource(R.string.contact_support),[m
[32m+[m[32m                    onClick = onContactSupportClick[m
[32m+[m[32m                )[m
[32m+[m[32m                Spacer(modifier = Modifier.height(2.dp))[m
[32m+[m
[32m+[m[32m                // 6. B√°o c√°o[m
[32m+[m[32m                SettingsItem([m
[32m+[m[32m                    icon = Icons.Default.Warning,[m
[32m+[m[32m                    title = stringResource(R.string.report_violation),[m
[32m+[m[32m                    onClick = onReportViolationClick[m
[32m+[m[32m                )[m
[32m+[m[32m                Spacer(modifier = Modifier.height(12.dp))[m
[32m+[m
[32m+[m[32m                // 7. Chuy·ªÉn t√†i kho·∫£n[m
[32m+[m[32m                SettingsItem([m
[32m+[m[32m                    icon = Icons.Default.AccountBox,[m
[32m+[m[32m                    title = stringResource(R.string.switch_account),[m
[32m+[m[32m                    onClick = onSwitchAccountClick[m
[32m+[m[32m                )[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            Spacer(modifier = Modifier.height(40.dp))[m
[32m+[m
[32m+[m[32m            // --- N√öT ƒêƒÇNG XU·∫§T ---[m
[32m+[m[32m            Button([m
[32m+[m[32m                onClick = onLogoutClick, // ‚≠êÔ∏è G·ªçi callback t·ª´ b√™n ngo√†i[m
[32m+[m[32m                colors = ButtonDefaults.buttonColors(containerColor = Color(0xFFFF6B6B)),[m
[32m+[m[32m                shape = RoundedCornerShape(24.dp),[m
[32m+[m[32m                modifier = Modifier[m
[32m+[m[32m                    .width(220.dp)[m
[32m+[m[32m                    .height(48.dp)[m
[32m+[m[32m            ) {[m
[32m+[m[32m                Icon([m
[32m+[m[32m                    imageVector = Icons.AutoMirrored.Filled.ExitToApp,[m
[32m+[m[32m                    contentDescription = null,[m
[32m+[m[32m                    modifier = Modifier.size(20.dp),[m
[32m+[m[32m                    tint = Color.White[m
[32m+[m[32m                )[m
[32m+[m[32m                Spacer(modifier = Modifier.width(8.dp))[m
[32m+[m[32m                Text([m
[32m+[m[32m                    text = stringResource(R.string.logout),[m
[32m+[m[32m                    color = Color.White,[m
[32m+[m[32m                    fontWeight = FontWeight.Bold,[m
[32m+[m[32m                    fontSize = 16.sp[m
[32m+[m[32m                )[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            Spacer(modifier = Modifier.height(24.dp))[m
[32m+[m
[32m+[m[32m            // --- TH√îNG TIN VERSION ---[m
[32m+[m[32m            Text([m
[32m+[m[32m                text = "Phi√™n b·∫£n 1.0.0",[m
[32m+[m[32m                style = MaterialTheme.typography.bodySmall,[m
[32m+[m[32m                color = MaterialTheme.colorScheme.onSurface.copy(alpha = 0.5f)[m
[32m+[m[32m            )[m
[32m+[m
[32m+[m[32m            Spacer(modifier = Modifier.height(32.dp))[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun SettingsItem([m
[32m+[m[32m    icon: ImageVector,[m
[32m+[m[32m    title: String,[m
[32m+[m[32m    onClick: () -> Unit[m
[32m+[m[32m) {[m
[32m+[m[32m    val surfaceColor = MaterialTheme.colorScheme.surface[m
[32m+[m[32m    val onSurfaceColor = MaterialTheme.colorScheme.onSurface[m
[32m+[m
[32m+[m[32m    Row([m
[32m+[m[32m        modifier = Modifier[m
[32m+[m[32m            .fillMaxWidth()[m
[32m+[m[32m            .background(surfaceColor)[m
[32m+[m[32m            .clickable(onClick = onClick)[m
[32m+[m[32m            .padding(horizontal = 16.dp, vertical = 16.dp),[m
[32m+[m[32m        verticalAlignment = Alignment.CenterVertically[m
[32m+[m[32m    ) {[m
[32m+[m[32m        Icon([m
[32m+[m[32m            imageVector = icon,[m
[32m+[m[32m            contentDescription = null,[m
[32m+[m[32m            tint = PrimaryGreen,[m
[32m+[m[32m            modifier = Modifier.size(24.dp)[m
[32m+[m[32m        )[m
[32m+[m
[32m+[m[32m        Spacer(modifier = Modifier.width(16.dp))[m
[32m+[m
[32m+[m[32m        Text([m
[32m+[m[32m            text = title,[m
[32m+[m[32m            fontSize = 16.sp,[m
[32m+[m[32m            fontWeight = FontWeight.Medium,[m
[32m+[m[32m            color = onSurfaceColor,[m
[32m+[m[32m            modifier = Modifier.weight(1f)[m
[32m+[m[32m        )[m
[32m+[m
[32m+[m[32m        Icon([m
[32m+[m[32m            imageVector = Icons.AutoMirrored.Filled.KeyboardArrowRight,[m
[32m+[m[32m            contentDescription = null,[m
[32m+[m[32m            tint = onSurfaceColor.copy(alpha = 0.5f),[m
[32m+[m[32m            modifier = Modifier.size(24.dp)[m
[32m+[m[32m        )[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/features/feature_profile/ui/settings/SettingsViewModel.kt b/app/src/main/java/com/example/stushare/features/feature_profile/ui/settings/SettingsViewModel.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..3d2ad44[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/features/feature_profile/ui/settings/SettingsViewModel.kt[m
[36m@@ -0,0 +1,32 @@[m
[32m+[m[32mpackage com.example.stushare.features.feature_settings[m
[32m+[m
[32m+[m[32mimport androidx.lifecycle.ViewModel[m
[32m+[m[32mimport androidx.lifecycle.viewModelScope[m
[32m+[m[32mimport com.example.stushare.core.data.repository.SettingsRepository[m
[32m+[m[32mimport dagger.hilt.android.lifecycle.HiltViewModel[m
[32m+[m[32mimport kotlinx.coroutines.flow.SharingStarted[m
[32m+[m[32mimport kotlinx.coroutines.flow.stateIn[m
[32m+[m[32mimport kotlinx.coroutines.launch[m
[32m+[m[32mimport javax.inject.Inject[m
[32m+[m
[32m+[m[32m@HiltViewModel[m
[32m+[m[32mclass SettingsViewModel @Inject constructor([m
[32m+[m[32m    private val settingsRepository: SettingsRepository[m
[32m+[m[32m) : ViewModel() {[m
[32m+[m
[32m+[m[32m    // 1. L·∫•y ng√¥n ng·ªØ hi·ªán t·∫°i ƒë·ªÉ hi·ªÉn th·ªã d·∫•u t√≠ch (‚úì)[m
[32m+[m[32m    val currentLanguage = settingsRepository.languageCode[m
[32m+[m[32m        .stateIn([m
[32m+[m[32m            scope = viewModelScope,[m
[32m+[m[32m            started = SharingStarted.WhileSubscribed(5000),[m
[32m+[m[32m            initialValue = "vi"[m
[32m+[m[32m        )[m
[32m+[m
[32m+[m[32m    // 2. H√†m thay ƒë·ªïi ng√¥n ng·ªØ[m
[32m+[m[32m    fun changeLanguage(code: String) {[m
[32m+[m[32m        viewModelScope.launch {[m
[32m+[m[32m            settingsRepository.setLanguage(code)[m
[32m+[m[32m            // L∆∞u xong, DataStore s·∫Ω b√°o v·ªÅ MainActivity -> MainActivity t·ª± ƒë·ªïi ng√¥n ng·ªØ[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/features/feature_profile/ui/settings/appearance/AppearanceSettingsScreen.kt b/app/src/main/java/com/example/stushare/features/feature_profile/ui/settings/appearance/AppearanceSettingsScreen.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..ae6e702[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/features/feature_profile/ui/settings/appearance/AppearanceSettingsScreen.kt[m
[36m@@ -0,0 +1,353 @@[m
[32m+[m[32mpackage com.example.stushare.features.feature_profile.ui.settings.appearance[m
[32m+[m
[32m+[m[32mimport androidx.compose.foundation.background[m
[32m+[m[32mimport androidx.compose.foundation.clickable[m
[32m+[m[32mimport androidx.compose.foundation.layout.*[m
[32m+[m[32mimport androidx.compose.foundation.shape.RoundedCornerShape[m
[32m+[m[32mimport androidx.compose.material.icons.Icons[m
[32m+[m[32mimport androidx.compose.material.icons.automirrored.filled.ArrowBack[m
[32m+[m[32mimport androidx.compose.material.icons.automirrored.filled.KeyboardArrowRight[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Info[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Settings[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Refresh // Icon cho Dialog Restart[m
[32m+[m[32mimport androidx.compose.material3.*[m
[32m+[m[32mimport androidx.compose.runtime.*[m
[32m+[m[32mimport androidx.compose.ui.Alignment[m
[32m+[m[32mimport androidx.compose.ui.Modifier[m
[32m+[m[32mimport androidx.compose.ui.graphics.Color[m
[32m+[m[32mimport androidx.compose.ui.platform.LocalContext[m
[32m+[m[32mimport androidx.compose.ui.res.stringResource[m
[32m+[m[32mimport androidx.compose.ui.text.font.FontWeight[m
[32m+[m[32mimport androidx.compose.ui.unit.dp[m
[32m+[m[32mimport androidx.compose.ui.unit.sp[m
[32m+[m[32mimport androidx.hilt.navigation.compose.hiltViewModel[m
[32m+[m[32mimport androidx.lifecycle.compose.collectAsStateWithLifecycle[m
[32m+[m[32mimport com.example.stushare.R[m
[32m+[m[32mimport com.example.stushare.core.utils.restartApp // üëà Import h√†m ti·ªán √≠ch restart[m
[32m+[m[32mimport com.example.stushare.ui.theme.PrimaryGreen[m
[32m+[m
[32m+[m[32m@OptIn(ExperimentalMaterial3Api::class)[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun AppearanceSettingsScreen([m
[32m+[m[32m    onBackClick: () -> Unit,[m
[32m+[m[32m    viewModel: AppearanceViewModel = hiltViewModel()[m
[32m+[m[32m) {[m
[32m+[m[32m    val context = LocalContext.current[m
[32m+[m
[32m+[m[32m    // L·∫•y d·ªØ li·ªáu t·ª´ ViewModel[m
[32m+[m[32m    val isDarkTheme by viewModel.isDarkTheme.collectAsStateWithLifecycle()[m
[32m+[m[32m    val currentLang by viewModel.language.collectAsStateWithLifecycle()[m
[32m+[m[32m    val currentFontScale by viewModel.fontScale.collectAsStateWithLifecycle()[m
[32m+[m
[32m+[m[32m    // State hi·ªÉn th·ªã Dialog[m
[32m+[m[32m    var showLanguageDialog by remember { mutableStateOf(false) }[m
[32m+[m[32m    var showFontDialog by remember { mutableStateOf(false) }[m
[32m+[m
[32m+[m[32m    // ‚≠êÔ∏è State m·ªõi: Dialog x√°c nh·∫≠n kh·ªüi ƒë·ªông l·∫°i[m
[32m+[m[32m    var showRestartDialog by remember { mutableStateOf(false) }[m
[32m+[m[32m    var pendingLanguage by remember { mutableStateOf("") } // L∆∞u ng√¥n ng·ªØ user ƒë·ªãnh ch·ªçn[m
[32m+[m
[32m+[m[32m    // M√†u s·∫Øc t·ª´ Theme[m
[32m+[m[32m    val backgroundColor = MaterialTheme.colorScheme.background[m
[32m+[m[32m    val surfaceColor = MaterialTheme.colorScheme.surface[m
[32m+[m[32m    val onSurfaceColor = MaterialTheme.colorScheme.onSurface[m
[32m+[m[32m    val dividerColor = MaterialTheme.colorScheme.outlineVariant[m
[32m+[m
[32m+[m[32m    Scaffold([m
[32m+[m[32m        topBar = {[m
[32m+[m[32m            TopAppBar([m
[32m+[m[32m                title = {[m
[32m+[m[32m                    Text([m
[32m+[m[32m                        text = stringResource(R.string.appearance_language),[m
[32m+[m[32m                        color = Color.White,[m
[32m+[m[32m                        fontWeight = FontWeight.Bold,[m
[32m+[m[32m                        fontSize = 20.sp[m
[32m+[m[32m                    )[m
[32m+[m[32m                },[m
[32m+[m[32m                navigationIcon = {[m
[32m+[m[32m                    IconButton(onClick = onBackClick) {[m
[32m+[m[32m                        Icon(Icons.AutoMirrored.Filled.ArrowBack, contentDescription = null, tint = Color.White)[m
[32m+[m[32m                    }[m
[32m+[m[32m                },[m
[32m+[m[32m                colors = TopAppBarDefaults.topAppBarColors(containerColor = PrimaryGreen)[m
[32m+[m[32m            )[m
[32m+[m[32m        },[m
[32m+[m[32m        containerColor = backgroundColor[m
[32m+[m[32m    ) { innerPadding ->[m
[32m+[m[32m        Box(modifier = Modifier.fillMaxSize()) {[m
[32m+[m[32m            Column([m
[32m+[m[32m                modifier = Modifier[m
[32m+[m[32m                    .fillMaxSize()[m
[32m+[m[32m                    .padding(innerPadding)[m
[32m+[m[32m            ) {[m
[32m+[m[32m                Spacer(modifier = Modifier.height(12.dp))[m
[32m+[m
[32m+[m[32m                // --- 1. Giao di·ªán S√°ng/T·ªëi ---[m
[32m+[m[32m                Row([m
[32m+[m[32m                    modifier = Modifier[m
[32m+[m[32m                        .fillMaxWidth()[m
[32m+[m[32m                        .background(surfaceColor)[m
[32m+[m[32m                        .padding(horizontal = 16.dp, vertical = 12.dp),[m
[32m+[m[32m                    verticalAlignment = Alignment.CenterVertically[m
[32m+[m[32m                ) {[m
[32m+[m[32m                    Icon([m
[32m+[m[32m                        imageVector = Icons.Default.Settings,[m
[32m+[m[32m                        contentDescription = null,[m
[32m+[m[32m                        tint = PrimaryGreen,[m
[32m+[m[32m                        modifier = Modifier.size(24.dp)[m
[32m+[m[32m                    )[m
[32m+[m[32m                    Spacer(modifier = Modifier.width(16.dp))[m
[32m+[m[32m                    Text([m
[32m+[m[32m                        text = stringResource(R.string.appearance_dark_mode),[m
[32m+[m[32m                        fontSize = 16.sp,[m
[32m+[m[32m                        fontWeight = FontWeight.Medium,[m
[32m+[m[32m                        color = onSurfaceColor,[m
[32m+[m[32m                        modifier = Modifier.weight(1f)[m
[32m+[m[32m                    )[m
[32m+[m[32m                    Switch([m
[32m+[m[32m                        checked = isDarkTheme,[m
[32m+[m[32m                        onCheckedChange = { viewModel.toggleTheme(it) },[m
[32m+[m[32m                        colors = SwitchDefaults.colors([m
[32m+[m[32m                            checkedThumbColor = Color.White,[m
[32m+[m[32m                            checkedTrackColor = PrimaryGreen,[m
[32m+[m[32m                            uncheckedTrackColor = MaterialTheme.colorScheme.surfaceVariant[m
[32m+[m[32m                        )[m
[32m+[m[32m                    )[m
[32m+[m[32m                }[m
[32m+[m
[32m+[m[32m                HorizontalDivider(color = dividerColor)[m
[32m+[m
[32m+[m[32m                // --- 2. ƒê·ªïi c·ª° ch·ªØ ---[m
[32m+[m[32m                Row([m
[32m+[m[32m                    modifier = Modifier[m
[32m+[m[32m                        .fillMaxWidth()[m
[32m+[m[32m                        .background(surfaceColor)[m
[32m+[m[32m                        .clickable { showFontDialog = true }[m
[32m+[m[32m                        .padding(horizontal = 16.dp, vertical = 16.dp),[m
[32m+[m[32m                    verticalAlignment = Alignment.CenterVertically[m
[32m+[m[32m                ) {[m
[32m+[m[32m                    Text([m
[32m+[m[32m                        text = stringResource(R.string.appearance_font_size),[m
[32m+[m[32m                        fontSize = 16.sp,[m
[32m+[m[32m                        fontWeight = FontWeight.Bold,[m
[32m+[m[32m                        color = onSurfaceColor,[m
[32m+[m[32m                        modifier = Modifier.weight(1f)[m
[32m+[m[32m                    )[m
[32m+[m
[32m+[m[32m                    val fontSizeLabel = when (currentFontScale) {[m
[32m+[m[32m                        0.85f -> stringResource(R.string.font_small)[m
[32m+[m[32m                        1.15f -> stringResource(R.string.font_large)[m
[32m+[m[32m                        else -> stringResource(R.string.font_medium)[m
[32m+[m[32m                    }[m
[32m+[m
[32m+[m[32m                    Text([m
[32m+[m[32m                        text = fontSizeLabel,[m
[32m+[m[32m                        color = onSurfaceColor.copy(alpha = 0.7f),[m
[32m+[m[32m                        fontSize = 14.sp[m
[32m+[m[32m                    )[m
[32m+[m[32m                    Spacer(modifier = Modifier.width(8.dp))[m
[32m+[m[32m                    Icon([m
[32m+[m[32m                        imageVector = Icons.AutoMirrored.Filled.KeyboardArrowRight,[m
[32m+[m[32m                        contentDescription = null,[m
[32m+[m[32m                        tint = onSurfaceColor.copy(alpha = 0.5f)[m
[32m+[m[32m                    )[m
[32m+[m[32m                }[m
[32m+[m
[32m+[m[32m                // --- 3. Header Ng√¥n ng·ªØ ---[m
[32m+[m[32m                Box([m
[32m+[m[32m                    modifier = Modifier[m
[32m+[m[32m                        .fillMaxWidth()[m
[32m+[m[32m                        .background(MaterialTheme.colorScheme.surfaceVariant.copy(alpha = 0.5f))[m
[32m+[m[32m                        .padding(horizontal = 16.dp, vertical = 8.dp)[m
[32m+[m[32m                ) {[m
[32m+[m[32m                    Text([m
[32m+[m[32m                        text = stringResource(R.string.appearance_language_header),[m
[32m+[m[32m                        color = PrimaryGreen,[m
[32m+[m[32m                        fontWeight = FontWeight.Bold,[m
[32m+[m[32m                        fontSize = 14.sp[m
[32m+[m[32m                    )[m
[32m+[m[32m                }[m
[32m+[m
[32m+[m[32m                // --- Item Thay ƒë·ªïi ng√¥n ng·ªØ ---[m
[32m+[m[32m                Row([m
[32m+[m[32m                    modifier = Modifier[m
[32m+[m[32m                        .fillMaxWidth()[m
[32m+[m[32m                        .background(surfaceColor)[m
[32m+[m[32m                        .clickable { showLanguageDialog = true }[m
[32m+[m[32m                        .padding(horizontal = 16.dp, vertical = 16.dp),[m
[32m+[m[32m                    verticalAlignment = Alignment.CenterVertically[m
[32m+[m[32m                ) {[m
[32m+[m[32m                    Text([m
[32m+[m[32m                        text = stringResource(R.string.appearance_change_language),[m
[32m+[m[32m                        fontSize = 16.sp,[m
[32m+[m[32m                        fontWeight = FontWeight.Medium,[m
[32m+[m[32m                        color = onSurfaceColor,[m
[32m+[m[32m                        modifier = Modifier.weight(1f)[m
[32m+[m[32m                    )[m
[32m+[m
[32m+[m[32m                    Icon([m
[32m+[m[32m                        imageVector = Icons.Default.Info,[m
[32m+[m[32m                        contentDescription = null,[m
[32m+[m[32m                        tint = onSurfaceColor.copy(alpha = 0.5f),[m
[32m+[m[32m                        modifier = Modifier.size(20.dp)[m
[32m+[m[32m                    )[m
[32m+[m[32m                    Spacer(modifier = Modifier.width(8.dp))[m
[32m+[m
[32m+[m[32m                    val currentLangLabel = if (currentLang == "vi") "Ti·∫øng Vi·ªát" else "English"[m
[32m+[m[32m                    Text([m
[32m+[m[32m                        text = currentLangLabel,[m
[32m+[m[32m                        fontSize = 15.sp,[m
[32m+[m[32m                        fontWeight = FontWeight.SemiBold,[m
[32m+[m[32m                        color = PrimaryGreen[m
[32m+[m[32m                    )[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            // --- Bottom Curve ---[m
[32m+[m[32m            Box([m
[32m+[m[32m                modifier = Modifier[m
[32m+[m[32m                    .align(Alignment.BottomCenter)[m
[32m+[m[32m                    .fillMaxWidth()[m
[32m+[m[32m                    .height(100.dp)[m
[32m+[m[32m                    .offset(y = 50.dp)[m
[32m+[m[32m                    .background([m
[32m+[m[32m                        color = PrimaryGreen,[m
[32m+[m[32m                        shape = RoundedCornerShape(topStart = 1000.dp, topEnd = 1000.dp)[m
[32m+[m[32m                    )[m
[32m+[m[32m            )[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    // --- Dialog Ch·ªçn Ng√¥n Ng·ªØ ---[m
[32m+[m[32m    if (showLanguageDialog) {[m
[32m+[m[32m        AlertDialog([m
[32m+[m[32m            onDismissRequest = { showLanguageDialog = false },[m
[32m+[m[32m            title = { Text(stringResource(R.string.appearance_change_language), fontWeight = FontWeight.Bold) },[m
[32m+[m[32m            text = {[m
[32m+[m[32m                Column {[m
[32m+[m[32m                    LanguageOption("Ti·∫øng Vi·ªát", selected = currentLang == "vi") {[m
[32m+[m[32m                        if (currentLang != "vi") {[m
[32m+[m[32m                            pendingLanguage = "vi"[m
[32m+[m[32m                            showLanguageDialog = false[m
[32m+[m[32m                            showRestartDialog = true // üëâ K√≠ch ho·∫°t Dialog Restart[m
[32m+[m[32m                        } else {[m
[32m+[m[32m                            showLanguageDialog = false[m
[32m+[m[32m                        }[m
[32m+[m[32m                    }[m
[32m+[m[32m                    LanguageOption("English", selected = currentLang == "en") {[m
[32m+[m[32m                        if (currentLang != "en") {[m
[32m+[m[32m                            pendingLanguage = "en"[m
[32m+[m[32m                            showLanguageDialog = false[m
[32m+[m[32m                            showRestartDialog = true // üëâ K√≠ch ho·∫°t Dialog Restart[m
[32m+[m[32m                        } else {[m
[32m+[m[32m                            showLanguageDialog = false[m
[32m+[m[32m                        }[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m            },[m
[32m+[m[32m            confirmButton = {[m
[32m+[m[32m                TextButton(onClick = { showLanguageDialog = false }) {[m
[32m+[m[32m                    Text(stringResource(R.string.cancel), color = PrimaryGreen, fontWeight = FontWeight.Bold)[m
[32m+[m[32m                }[m
[32m+[m[32m            },[m
[32m+[m[32m            containerColor = surfaceColor,[m
[32m+[m[32m            titleContentColor = onSurfaceColor,[m
[32m+[m[32m            textContentColor = onSurfaceColor[m
[32m+[m[32m        )[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    // ‚≠êÔ∏è DIALOG X√ÅC NH·∫¨N KH·ªûI ƒê·ªòNG L·∫†I APP (M·ªöI)[m
[32m+[m[32m    if (showRestartDialog) {[m
[32m+[m[32m        AlertDialog([m
[32m+[m[32m            onDismissRequest = { showRestartDialog = false },[m
[32m+[m[32m            icon = { Icon(Icons.Default.Refresh, contentDescription = null, tint = PrimaryGreen) },[m
[32m+[m[32m            title = { Text("C·∫ßn kh·ªüi ƒë·ªông l·∫°i") },[m
[32m+[m[32m            text = {[m
[32m+[m[32m                Text("ƒê·ªÉ thay ƒë·ªïi ng√¥n ng·ªØ ho√†n t·∫•t, ·ª©ng d·ª•ng c·∫ßn ƒë∆∞·ª£c kh·ªüi ƒë·ªông l·∫°i. B·∫°n c√≥ mu·ªën ti·∫øp t·ª•c?")[m
[32m+[m[32m            },[m
[32m+[m[32m            confirmButton = {[m
[32m+[m[32m                Button([m
[32m+[m[32m                    onClick = {[m
[32m+[m[32m                        showRestartDialog = false[m
[32m+[m[32m                        // G·ªçi ViewModel ƒë·ªÉ l∆∞u v√† restart[m
[32m+[m[32m                        viewModel.setLanguageAndRestart(pendingLanguage) {[m
[32m+[m[32m                            context.restartApp() // G·ªçi h√†m extension[m
[32m+[m[32m                        }[m
[32m+[m[32m                    },[m
[32m+[m[32m                    colors = ButtonDefaults.buttonColors(containerColor = PrimaryGreen)[m
[32m+[m[32m                ) {[m
[32m+[m[32m                    Text("ƒê·ªìng √Ω", color = Color.White, fontWeight = FontWeight.Bold)[m
[32m+[m[32m                }[m
[32m+[m[32m            },[m
[32m+[m[32m            dismissButton = {[m
[32m+[m[32m                TextButton(onClick = { showRestartDialog = false }) {[m
[32m+[m[32m                    Text(stringResource(R.string.cancel), color = onSurfaceColor)[m
[32m+[m[32m                }[m
[32m+[m[32m            },[m
[32m+[m[32m            containerColor = surfaceColor,[m
[32m+[m[32m            titleContentColor = onSurfaceColor,[m
[32m+[m[32m            textContentColor = onSurfaceColor[m
[32m+[m[32m        )[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    // --- Dialog Ch·ªçn C·ª° Ch·ªØ ---[m
[32m+[m[32m    if (showFontDialog) {[m
[32m+[m[32m        AlertDialog([m
[32m+[m[32m            onDismissRequest = { showFontDialog = false },[m
[32m+[m[32m            title = { Text(stringResource(R.string.appearance_font_size), fontWeight = FontWeight.Bold) },[m
[32m+[m[32m            text = {[m
[32m+[m[32m                Column {[m
[32m+[m[32m                    FontOption(stringResource(R.string.font_small), selected = currentFontScale == 0.85f) {[m
[32m+[m[32m                        viewModel.setFontScale(0.85f)[m
[32m+[m[32m                        showFontDialog = false[m
[32m+[m[32m                    }[m
[32m+[m[32m                    FontOption(stringResource(R.string.font_medium), selected = currentFontScale == 1.0f) {[m
[32m+[m[32m                        viewModel.setFontScale(1.0f)[m
[32m+[m[32m                        showFontDialog = false[m
[32m+[m[32m                    }[m
[32m+[m[32m                    FontOption(stringResource(R.string.font_large), selected = currentFontScale == 1.15f) {[m
[32m+[m[32m                        viewModel.setFontScale(1.15f)[m
[32m+[m[32m                        showFontDialog = false[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m            },[m
[32m+[m[32m            confirmButton = {[m
[32m+[m[32m                TextButton(onClick = { showFontDialog = false }) {[m
[32m+[m[32m                    Text(stringResource(R.string.cancel), color = PrimaryGreen, fontWeight = FontWeight.Bold)[m
[32m+[m[32m                }[m
[32m+[m[32m            },[m
[32m+[m[32m            containerColor = surfaceColor,[m
[32m+[m[32m            titleContentColor = onSurfaceColor,[m
[32m+[m[32m            textContentColor = onSurfaceColor[m
[32m+[m[32m        )[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun LanguageOption(text: String, selected: Boolean, onClick: () -> Unit) {[m
[32m+[m[32m    Row([m
[32m+[m[32m        modifier = Modifier[m
[32m+[m[32m            .fillMaxWidth()[m
[32m+[m[32m            .clickable(onClick = onClick)[m
[32m+[m[32m            .padding(vertical = 12.dp, horizontal = 8.dp),[m
[32m+[m[32m        verticalAlignment = Alignment.CenterVertically[m
[32m+[m[32m    ) {[m
[32m+[m[32m        RadioButton([m
[32m+[m[32m            selected = selected,[m
[32m+[m[32m            onClick = onClick,[m
[32m+[m[32m            colors = RadioButtonDefaults.colors(selectedColor = PrimaryGreen)[m
[32m+[m[32m        )[m
[32m+[m[32m        Text([m
[32m+[m[32m            text,[m
[32m+[m[32m            modifier = Modifier.padding(start = 12.dp),[m
[32m+[m[32m            style = MaterialTheme.typography.bodyLarge,[m
[32m+[m[32m            color = MaterialTheme.colorScheme.onSurface,[m
[32m+[m[32m            fontWeight = if (selected) FontWeight.Bold else FontWeight.Normal[m
[32m+[m[32m        )[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun FontOption(text: String, selected: Boolean, onClick: () -> Unit) {[m
[32m+[m[32m    LanguageOption(text, selected, onClick)[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/features/feature_profile/ui/settings/appearance/AppearanceViewModel.kt b/app/src/main/java/com/example/stushare/features/feature_profile/ui/settings/appearance/AppearanceViewModel.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..c04588d[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/features/feature_profile/ui/settings/appearance/AppearanceViewModel.kt[m
[36m@@ -0,0 +1,69 @@[m
[32m+[m[32mpackage com.example.stushare.features.feature_profile.ui.settings.appearance[m
[32m+[m
[32m+[m[32mimport androidx.lifecycle.ViewModel[m
[32m+[m[32mimport androidx.lifecycle.viewModelScope[m
[32m+[m[32mimport com.example.stushare.core.data.repository.SettingsRepository[m
[32m+[m[32mimport dagger.hilt.android.lifecycle.HiltViewModel[m
[32m+[m[32mimport kotlinx.coroutines.flow.SharingStarted[m
[32m+[m[32mimport kotlinx.coroutines.flow.StateFlow[m
[32m+[m[32mimport kotlinx.coroutines.flow.stateIn[m
[32m+[m[32mimport kotlinx.coroutines.launch[m
[32m+[m[32mimport javax.inject.Inject[m
[32m+[m
[32m+[m[32m@HiltViewModel[m
[32m+[m[32mclass AppearanceViewModel @Inject constructor([m
[32m+[m[32m    private val settingsRepository: SettingsRepository[m
[32m+[m[32m) : ViewModel() {[m
[32m+[m
[32m+[m[32m    // 1. L·∫•y tr·∫°ng th√°i Dark Mode[m
[32m+[m[32m    val isDarkTheme: StateFlow<Boolean> = settingsRepository.isDarkTheme[m
[32m+[m[32m        .stateIn([m
[32m+[m[32m            scope = viewModelScope,[m
[32m+[m[32m            started = SharingStarted.WhileSubscribed(5000),[m
[32m+[m[32m            initialValue = false[m
[32m+[m[32m        )[m
[32m+[m
[32m+[m[32m    // 2. L·∫•y Ng√¥n ng·ªØ hi·ªán t·∫°i[m
[32m+[m[32m    val language: StateFlow<String> = settingsRepository.languageCode[m
[32m+[m[32m        .stateIn([m
[32m+[m[32m            scope = viewModelScope,[m
[32m+[m[32m            started = SharingStarted.WhileSubscribed(5000),[m
[32m+[m[32m            initialValue = "vi"[m
[32m+[m[32m        )[m
[32m+[m
[32m+[m[32m    // 3. L·∫•y C·ª° ch·ªØ[m
[32m+[m[32m    val fontScale: StateFlow<Float> = settingsRepository.fontScale[m
[32m+[m[32m        .stateIn([m
[32m+[m[32m            scope = viewModelScope,[m
[32m+[m[32m            started = SharingStarted.WhileSubscribed(5000),[m
[32m+[m[32m            initialValue = 1.0f[m
[32m+[m[32m        )[m
[32m+[m
[32m+[m[32m    // --- C√ÅC H√ÄM C·∫¨P NH·∫¨T ---[m
[32m+[m
[32m+[m[32m    // B·∫≠t/T·∫Øt Dark Mode (C√≥ hi·ªáu l·ª±c ngay l·∫≠p t·ª©c)[m
[32m+[m[32m    fun toggleTheme(isDark: Boolean) {[m
[32m+[m[32m        viewModelScope.launch {[m
[32m+[m[32m            settingsRepository.setDarkTheme(isDark)[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    // ƒê·ªïi C·ª° ch·ªØ (C√≥ hi·ªáu l·ª±c ngay l·∫≠p t·ª©c)[m
[32m+[m[32m    fun setFontScale(scale: Float) {[m
[32m+[m[32m        viewModelScope.launch {[m
[32m+[m[32m            settingsRepository.setFontScale(scale)[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    // ‚≠êÔ∏è QUAN TR·ªåNG: ƒê·ªïi Ng√¥n ng·ªØ v√† y√™u c·∫ßu Restart[m
[32m+[m[32m    // H√†m n√†y nh·∫≠n v√†o m·ªôt h√†nh ƒë·ªông (onRestart) ƒë·ªÉ UI g·ªçi l·ªánh kh·ªüi ƒë·ªông l·∫°i app[m
[32m+[m[32m    fun setLanguageAndRestart(lang: String, onRestart: () -> Unit) {[m
[32m+[m[32m        viewModelScope.launch {[m
[32m+[m[32m            // 1. L∆∞u ng√¥n ng·ªØ m·ªõi v√†o DataStore[m
[32m+[m[32m            settingsRepository.setLanguage(lang)[m
[32m+[m
[32m+[m[32m            // 2. Sau khi l∆∞u xong, g·ªçi callback ƒë·ªÉ UI th·ª±c hi·ªán Restart[m
[32m+[m[32m            onRestart()[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/features/feature_profile/ui/settings/notification/NotificationSettingsScreen.kt b/app/src/main/java/com/example/stushare/features/feature_profile/ui/settings/notification/NotificationSettingsScreen.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..1500d86[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/features/feature_profile/ui/settings/notification/NotificationSettingsScreen.kt[m
[36m@@ -0,0 +1,181 @@[m
[32m+[m[32mpackage com.example.stushare.features.feature_profile.ui.settings.notification[m
[32m+[m
[32m+[m[32mimport androidx.compose.foundation.background[m
[32m+[m[32mimport androidx.compose.foundation.layout.*[m
[32m+[m[32mimport androidx.compose.foundation.shape.RoundedCornerShape[m
[32m+[m[32mimport androidx.compose.material.icons.Icons[m
[32m+[m[32mimport androidx.compose.material.icons.automirrored.filled.ArrowBack[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Notifications[m
[32m+[m[32mimport androidx.compose.material3.*[m
[32m+[m[32mimport androidx.compose.runtime.*[m
[32m+[m[32mimport androidx.compose.ui.Alignment[m
[32m+[m[32mimport androidx.compose.ui.Modifier[m
[32m+[m[32mimport androidx.compose.ui.graphics.Color[m
[32m+[m[32mimport androidx.compose.ui.graphics.vector.ImageVector[m
[32m+[m[32mimport androidx.compose.ui.res.stringResource[m
[32m+[m[32mimport androidx.compose.ui.text.font.FontWeight[m
[32m+[m[32mimport androidx.compose.ui.unit.dp[m
[32m+[m[32mimport androidx.compose.ui.unit.sp[m
[32m+[m[32m// ‚≠êÔ∏è Import ƒë√∫ng Resource v√† Theme c·ªßa d·ª± √°n ch√≠nh[m
[32m+[m[32mimport com.example.stushare.R[m
[32m+[m[32mimport com.example.stushare.ui.theme.PrimaryGreen[m
[32m+[m
[32m+[m[32m@OptIn(ExperimentalMaterial3Api::class)[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun NotificationSettingsScreen([m
[32m+[m[32m    onBackClick: () -> Unit[m
[32m+[m[32m) {[m
[32m+[m[32m    var isNotificationEnabled by remember { mutableStateOf(true) }[m
[32m+[m[32m    var isSoundEnabled by remember { mutableStateOf(true) }[m
[32m+[m[32m    var isVibrateEnabled by remember { mutableStateOf(true) }[m
[32m+[m
[32m+[m[32m    val backgroundColor = MaterialTheme.colorScheme.background[m
[32m+[m[32m    val dividerColor = MaterialTheme.colorScheme.outlineVariant[m
[32m+[m
[32m+[m[32m    Scaffold([m
[32m+[m[32m        topBar = {[m
[32m+[m[32m            TopAppBar([m
[32m+[m[32m                title = {[m
[32m+[m[32m                    Text([m
[32m+[m[32m                        text = stringResource(R.string.notifications),[m
[32m+[m[32m                        color = Color.White,[m
[32m+[m[32m                        fontWeight = FontWeight.Bold,[m
[32m+[m[32m                        fontSize = 20.sp[m
[32m+[m[32m                    )[m
[32m+[m[32m                },[m
[32m+[m[32m                navigationIcon = {[m
[32m+[m[32m                    IconButton(onClick = onBackClick) {[m
[32m+[m[32m                        Icon([m
[32m+[m[32m                            imageVector = Icons.AutoMirrored.Filled.ArrowBack,[m
[32m+[m[32m                            contentDescription = null,[m
[32m+[m[32m                            tint = Color.White[m
[32m+[m[32m                        )[m
[32m+[m[32m                    }[m
[32m+[m[32m                },[m
[32m+[m[32m                // ‚≠êÔ∏è S·ª¨A: D√πng PrimaryGreen[m
[32m+[m[32m                colors = TopAppBarDefaults.topAppBarColors(containerColor = PrimaryGreen)[m
[32m+[m[32m            )[m
[32m+[m[32m        },[m
[32m+[m[32m        containerColor = backgroundColor[m
[32m+[m[32m    ) { innerPadding ->[m
[32m+[m[32m        Box(modifier = Modifier.fillMaxSize()) {[m
[32m+[m[32m            Column([m
[32m+[m[32m                modifier = Modifier[m
[32m+[m[32m                    .fillMaxSize()[m
[32m+[m[32m                    .padding(innerPadding)[m
[32m+[m[32m            ) {[m
[32m+[m[32m                // --- Section 1 ---[m
[32m+[m[32m                SettingsSectionHeader(title = stringResource(R.string.noti_set_section_enable))[m
[32m+[m
[32m+[m[32m                SwitchItem([m
[32m+[m[32m                    title = stringResource(R.string.notifications),[m
[32m+[m[32m                    icon = Icons.Default.Notifications,[m
[32m+[m[32m                    checked = isNotificationEnabled,[m
[32m+[m[32m                    onCheckedChange = { isNotificationEnabled = it }[m
[32m+[m[32m                )[m
[32m+[m
[32m+[m[32m                // --- Section 2 ---[m
[32m+[m[32m                SettingsSectionHeader(title = stringResource(R.string.noti_set_section_in_app))[m
[32m+[m
[32m+[m[32m                SwitchItem([m
[32m+[m[32m                    title = stringResource(R.string.noti_set_sound),[m
[32m+[m[32m                    icon = null,[m
[32m+[m[32m                    checked = isSoundEnabled,[m
[32m+[m[32m                    onCheckedChange = { isSoundEnabled = it }[m
[32m+[m[32m                )[m
[32m+[m
[32m+[m[32m                HorizontalDivider(thickness = 1.dp, color = dividerColor)[m
[32m+[m
[32m+[m[32m                SwitchItem([m
[32m+[m[32m                    title = stringResource(R.string.noti_set_vibrate),[m
[32m+[m[32m                    icon = null,[m
[32m+[m[32m                    checked = isVibrateEnabled,[m
[32m+[m[32m                    onCheckedChange = { isVibrateEnabled = it }[m
[32m+[m[32m                )[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            // Bottom Curve[m
[32m+[m[32m            Box([m
[32m+[m[32m                modifier = Modifier[m
[32m+[m[32m                    .align(Alignment.BottomCenter)[m
[32m+[m[32m                    .fillMaxWidth()[m
[32m+[m[32m                    .height(120.dp)[m
[32m+[m[32m                    .offset(y = 60.dp)[m
[32m+[m[32m                    .background([m
[32m+[m[32m                        // ‚≠êÔ∏è S·ª¨A: D√πng PrimaryGreen[m
[32m+[m[32m                        color = PrimaryGreen,[m
[32m+[m[32m                        shape = RoundedCornerShape(topStart = 1000.dp, topEnd = 1000.dp)[m
[32m+[m[32m                    )[m
[32m+[m[32m            )[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun SettingsSectionHeader(title: String) {[m
[32m+[m[32m    Box([m
[32m+[m[32m        modifier = Modifier[m
[32m+[m[32m            .fillMaxWidth()[m
[32m+[m[32m            .background(MaterialTheme.colorScheme.surfaceVariant)[m
[32m+[m[32m            .padding(horizontal = 16.dp, vertical = 12.dp)[m
[32m+[m[32m    ) {[m
[32m+[m[32m        Text([m
[32m+[m[32m            text = title,[m
[32m+[m[32m            // ‚≠êÔ∏è S·ª¨A: D√πng PrimaryGreen[m
[32m+[m[32m            color = PrimaryGreen,[m
[32m+[m[32m            fontWeight = FontWeight.Bold,[m
[32m+[m[32m            fontSize = 15.sp[m
[32m+[m[32m        )[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun SwitchItem([m
[32m+[m[32m    title: String,[m
[32m+[m[32m    icon: ImageVector?,[m
[32m+[m[32m    checked: Boolean,[m
[32m+[m[32m    onCheckedChange: (Boolean) -> Unit[m
[32m+[m[32m) {[m
[32m+[m[32m    val onSurfaceColor = MaterialTheme.colorScheme.onSurface[m
[32m+[m[32m    val surfaceColor = MaterialTheme.colorScheme.surface[m
[32m+[m
[32m+[m[32m    Row([m
[32m+[m[32m        modifier = Modifier[m
[32m+[m[32m            .fillMaxWidth()[m
[32m+[m[32m            .background(surfaceColor)[m
[32m+[m[32m            .padding(horizontal = 16.dp, vertical = 12.dp),[m
[32m+[m[32m        verticalAlignment = Alignment.CenterVertically[m
[32m+[m[32m    ) {[m
[32m+[m[32m        if (icon != null) {[m
[32m+[m[32m            Icon([m
[32m+[m[32m                imageVector = icon,[m
[32m+[m[32m                contentDescription = null,[m
[32m+[m[32m                // ‚≠êÔ∏è S·ª¨A: D√πng PrimaryGreen[m
[32m+[m[32m                tint = PrimaryGreen,[m
[32m+[m[32m                modifier = Modifier.size(24.dp)[m
[32m+[m[32m            )[m
[32m+[m[32m            Spacer(modifier = Modifier.width(16.dp))[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        Text([m
[32m+[m[32m            text = title,[m
[32m+[m[32m            fontSize = 16.sp,[m
[32m+[m[32m            fontWeight = FontWeight.Medium,[m
[32m+[m[32m            color = onSurfaceColor,[m
[32m+[m[32m            modifier = Modifier.weight(1f)[m
[32m+[m[32m        )[m
[32m+[m
[32m+[m[32m        Switch([m
[32m+[m[32m            checked = checked,[m
[32m+[m[32m            onCheckedChange = onCheckedChange,[m
[32m+[m[32m            colors = SwitchDefaults.colors([m
[32m+[m[32m                checkedThumbColor = Color.White,[m
[32m+[m[32m                // ‚≠êÔ∏è S·ª¨A: D√πng PrimaryGreen[m
[32m+[m[32m                checkedTrackColor = PrimaryGreen,[m
[32m+[m[32m                uncheckedThumbColor = Color.Gray,[m
[32m+[m[32m                uncheckedTrackColor = MaterialTheme.colorScheme.surfaceVariant,[m
[32m+[m[32m                uncheckedBorderColor = Color.Gray[m
[32m+[m[32m            )[m
[32m+[m[32m        )[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/features/feature_upload/ui/UploadScreen.kt b/app/src/main/java/com/example/stushare/features/feature_upload/ui/UploadScreen.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..01c7b2d[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/features/feature_upload/ui/UploadScreen.kt[m
[36m@@ -0,0 +1,310 @@[m
[32m+[m[32mpackage com.example.stushare.features.feature_upload.ui[m
[32m+[m
[32m+[m[32mimport android.net.Uri[m
[32m+[m[32mimport android.provider.OpenableColumns[m
[32m+[m[32mimport android.widget.Toast[m
[32m+[m[32mimport androidx.activity.compose.rememberLauncherForActivityResult[m
[32m+[m[32mimport androidx.activity.result.PickVisualMediaRequest[m
[32m+[m[32mimport androidx.activity.result.contract.ActivityResultContracts[m
[32m+[m[32mimport androidx.compose.foundation.background[m
[32m+[m[32mimport androidx.compose.foundation.clickable[m
[32m+[m[32mimport androidx.compose.foundation.layout.*[m
[32m+[m[32mimport androidx.compose.foundation.rememberScrollState[m
[32m+[m[32mimport androidx.compose.foundation.shape.RoundedCornerShape[m
[32m+[m[32mimport androidx.compose.foundation.verticalScroll[m
[32m+[m[32mimport androidx.compose.material.icons.Icons[m
[32m+[m[32mimport androidx.compose.material.icons.filled.ArrowBack[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Description[m
[32m+[m[32mimport androidx.compose.material.icons.filled.Image[m
[32m+[m[32mimport androidx.compose.material3.*[m
[32m+[m[32mimport androidx.compose.runtime.*[m
[32m+[m[32mimport androidx.compose.ui.Alignment[m
[32m+[m[32mimport androidx.compose.ui.Modifier[m
[32m+[m[32mimport androidx.compose.ui.draw.clip[m
[32m+[m[32mimport androidx.compose.ui.graphics.Color[m
[32m+[m[32mimport androidx.compose.ui.layout.ContentScale[m
[32m+[m[32mimport androidx.compose.ui.platform.LocalContext[m
[32m+[m[32mimport androidx.compose.ui.text.font.FontWeight[m
[32m+[m[32mimport androidx.compose.ui.unit.dp[m
[32m+[m[32mimport androidx.compose.ui.unit.sp[m
[32m+[m[32mimport androidx.lifecycle.compose.collectAsStateWithLifecycle[m
[32m+[m[32mimport coil.compose.AsyncImage[m
[32m+[m[32mimport com.example.stushare.ui.theme.PrimaryGreen[m
[32m+[m
[32m+[m[32m@OptIn(ExperimentalMaterial3Api::class) // C·∫ßn thi·∫øt cho DropdownMenu[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun UploadScreen([m
[32m+[m[32m    viewModel: UploadViewModel,[m
[32m+[m[32m    onBackClick: () -> Unit[m
[32m+[m[32m) {[m
[32m+[m[32m    val context = LocalContext.current[m
[32m+[m[32m    val isUploading by viewModel.isUploading.collectAsStateWithLifecycle()[m
[32m+[m
[32m+[m[32m    var title by remember { mutableStateOf("") }[m
[32m+[m[32m    var author by remember { mutableStateOf("") }[m
[32m+[m[32m    var description by remember { mutableStateOf("") }[m
[32m+[m
[32m+[m[32m    // --- üü¢ M·ªöI: C·∫§U H√åNH DANH S√ÅCH LO·∫†I T√ÄI LI·ªÜU ---[m
[32m+[m[32m    // Pair: "T√™n hi·ªÉn th·ªã" to "M√£ l∆∞u trong DB"[m
[32m+[m[32m    val categories = listOf([m
[32m+[m[32m        "T√†i li·ªáu √¥n thi" to "exam_review",[m
[32m+[m[32m        "S√°ch / Gi√°o tr√¨nh" to "book",[m
[32m+[m[32m        "B√†i gi·∫£ng / Slide" to "lecture"[m
[32m+[m[32m    )[m
[32m+[m[32m    // M·∫∑c ƒë·ªãnh ch·ªçn c√°i ƒë·∫ßu ti√™n[m
[32m+[m[32m    var selectedCategoryPair by remember { mutableStateOf(categories[0]) }[m
[32m+[m[32m    var expanded by remember { mutableStateOf(false) } // Tr·∫°ng th√°i m·ªü/ƒë√≥ng menu[m
[32m+[m
[32m+[m[32m    // File t√†i li·ªáu[m
[32m+[m[32m    var selectedFileName by remember { mutableStateOf("") }[m
[32m+[m[32m    var selectedFileUri by remember { mutableStateOf<Uri?>(null) }[m
[32m+[m
[32m+[m[32m    // ·∫¢nh b√¨a[m
[32m+[m[32m    var selectedCoverUri by remember { mutableStateOf<Uri?>(null) }[m
[32m+[m
[32m+[m[32m    // Launcher ch·ªçn FILE[m
[32m+[m[32m    val filePickerLauncher = rememberLauncherForActivityResult([m
[32m+[m[32m        contract = ActivityResultContracts.OpenDocument()[m
[32m+[m[32m    ) { uri: Uri? ->[m
[32m+[m[32m        uri?.let {[m
[32m+[m[32m            selectedFileUri = it[m
[32m+[m[32m            val cursor = context.contentResolver.query(it, null, null, null, null)[m
[32m+[m[32m            cursor?.use { c ->[m
[32m+[m[32m                if (c.moveToFirst()) {[m
[32m+[m[32m                    val nameIndex = c.getColumnIndex(OpenableColumns.DISPLAY_NAME)[m
[32m+[m[32m                    if (nameIndex >= 0) selectedFileName = c.getString(nameIndex)[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m[32m            if (title.isEmpty()) {[m
[32m+[m[32m                title = selectedFileName.substringBeforeLast(".")[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    // Launcher ch·ªçn ·∫¢NH[m
[32m+[m[32m    val imagePickerLauncher = rememberLauncherForActivityResult([m
[32m+[m[32m        contract = ActivityResultContracts.PickVisualMedia()[m
[32m+[m[32m    ) { uri -> selectedCoverUri = uri }[m
[32m+[m
[32m+[m[32m    LaunchedEffect(Unit) {[m
[32m+[m[32m        viewModel.uploadEvent.collect { result ->[m
[32m+[m[32m            when (result) {[m
[32m+[m[32m                is UploadViewModel.UploadResult.Success -> {[m
[32m+[m[32m                    Toast.makeText(context, result.message, Toast.LENGTH_SHORT).show()[m
[32m+[m[32m                    onBackClick()[m
[32m+[m[32m                }[m
[32m+[m[32m                is UploadViewModel.UploadResult.Error -> {[m
[32m+[m[32m                    Toast.makeText(context, result.message, Toast.LENGTH_SHORT).show()[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    Box(modifier = Modifier.fillMaxSize().background(MaterialTheme.colorScheme.background)) {[m
[32m+[m[32m        Column([m
[32m+[m[32m            modifier = Modifier.fillMaxSize().verticalScroll(rememberScrollState())[m
[32m+[m[32m        ) {[m
[32m+[m[32m            // --- HEADER ---[m
[32m+[m[32m            Box([m
[32m+[m[32m                modifier = Modifier[m
[32m+[m[32m                    .fillMaxWidth()[m
[32m+[m[32m                    .height(120.dp)[m
[32m+[m[32m                    .background(PrimaryGreen, RoundedCornerShape(bottomStart = 24.dp, bottomEnd = 24.dp))[m
[32m+[m[32m            ) {[m
[32m+[m[32m                IconButton([m
[32m+[m[32m                    onClick = onBackClick,[m
[32m+[m[32m                    modifier = Modifier.padding(top = 40.dp, start = 16.dp).align(Alignment.TopStart)[m
[32m+[m[32m                ) {[m
[32m+[m[32m                    Icon(Icons.Default.ArrowBack, contentDescription = "Back", tint = Color.White)[m
[32m+[m[32m                }[m
[32m+[m[32m                Text([m
[32m+[m[32m                    text = "T·∫£i t√†i li·ªáu l√™n",[m
[32m+[m[32m                    fontSize = 20.sp,[m
[32m+[m[32m                    fontWeight = FontWeight.Bold,[m
[32m+[m[32m                    color = Color.White,[m
[32m+[m[32m                    modifier = Modifier.align(Alignment.Center).padding(top = 20.dp)[m
[32m+[m[32m                )[m
[32m+[m[32m            }[m
[32m+[m
[32m+[m[32m            // --- FORM CARD ---[m
[32m+[m[32m            Card([m
[32m+[m[32m                modifier = Modifier.padding(16.dp).offset(y = (-20).dp),[m
[32m+[m[32m                elevation = CardDefaults.cardElevation(4.dp),[m
[32m+[m[32m                colors = CardDefaults.cardColors(containerColor = MaterialTheme.colorScheme.surface),[m
[32m+[m[32m                shape = RoundedCornerShape(16.dp)[m
[32m+[m[32m            ) {[m
[32m+[m[32m                Column(modifier = Modifier.padding(20.dp)) {[m
[32m+[m
[32m+[m[32m                    // 1. ·∫¢NH B√åA[m
[32m+[m[32m                    Text("·∫¢nh b√¨a (T√πy ch·ªçn)", fontWeight = FontWeight.SemiBold, fontSize = 14.sp)[m
[32m+[m[32m                    Spacer(modifier = Modifier.height(8.dp))[m
[32m+[m[32m                    Box([m
[32m+[m[32m                        modifier = Modifier[m
[32m+[m[32m                            .size(100.dp, 140.dp)[m
[32m+[m[32m                            .clip(RoundedCornerShape(12.dp))[m
[32m+[m[32m                            .background(Color.LightGray.copy(alpha = 0.3f))[m
[32m+[m[32m                            .clickable { imagePickerLauncher.launch(PickVisualMediaRequest(ActivityResultContracts.PickVisualMedia.ImageOnly)) },[m
[32m+[m[32m                        contentAlignment = Alignment.Center[m
[32m+[m[32m                    ) {[m
[32m+[m[32m                        if (selectedCoverUri != null) {[m
[32m+[m[32m                            AsyncImage([m
[32m+[m[32m                                model = selectedCoverUri,[m
[32m+[m[32m                                contentDescription = null,[m
[32m+[m[32m                                modifier = Modifier.fillMaxSize(),[m
[32m+[m[32m                                contentScale = ContentScale.Crop[m
[32m+[m[32m                            )[m
[32m+[m[32m                        } else {[m
[32m+[m[32m                            Column(horizontalAlignment = Alignment.CenterHorizontally) {[m
[32m+[m[32m                                Icon(Icons.Default.Image, contentDescription = null, tint = Color.Gray)[m
[32m+[m[32m                                Text("Ch·ªçn ·∫£nh", fontSize = 12.sp, color = Color.Gray)[m
[32m+[m[32m                            }[m
[32m+[m[32m                        }[m
[32m+[m[32m                    }[m
[32m+[m
[32m+[m[32m                    Spacer(modifier = Modifier.height(20.dp))[m
[32m+[m
[32m+[m[32m                    // 2. FILE T√ÄI LI·ªÜU[m
[32m+[m[32m                    Text("T·ªáp ƒë√≠nh k√®m *", fontWeight = FontWeight.SemiBold, fontSize = 14.sp)[m
[32m+[m[32m                    Spacer(modifier = Modifier.height(8.dp))[m
[32m+[m[32m                    Row([m
[32m+[m[32m                        modifier = Modifier[m
[32m+[m[32m                            .fillMaxWidth()[m
[32m+[m[32m                            .background(MaterialTheme.colorScheme.surfaceVariant.copy(alpha = 0.5f), RoundedCornerShape(8.dp))[m
[32m+[m[32m                            .padding(12.dp),[m
[32m+[m[32m                        verticalAlignment = Alignment.CenterVertically[m
[32m+[m[32m                    ) {[m
[32m+[m[32m                        Icon(Icons.Default.Description, contentDescription = null, tint = PrimaryGreen)[m
[32m+[m[32m                        Spacer(modifier = Modifier.width(12.dp))[m
[32m+[m[32m                        Text([m
[32m+[m[32m                            text = if (selectedFileName.isNotEmpty()) selectedFileName else "Ch∆∞a ch·ªçn file n√†o",[m
[32m+[m[32m                            maxLines = 1,[m
[32m+[m[32m                            color = MaterialTheme.colorScheme.onSurface,[m
[32m+[m[32m                            modifier = Modifier.weight(1f)[m
[32m+[m[32m                        )[m
[32m+[m[32m                    }[m
[32m+[m[32m                    Spacer(modifier = Modifier.height(12.dp))[m
[32m+[m[32m                    Button([m
[32m+[m[32m                        onClick = { filePickerLauncher.launch(arrayOf("application/pdf", "application/msword", "application/vnd.openxmlformats-officedocument.wordprocessingml.document")) },[m
[32m+[m[32m                        colors = ButtonDefaults.buttonColors(containerColor = Color.DarkGray),[m
[32m+[m[32m                        shape = RoundedCornerShape(10.dp),[m
[32m+[m[32m                        modifier = Modifier.fillMaxWidth()[m
[32m+[m[32m                    ) { Text("Ch·ªçn file t√†i li·ªáu (PDF/Word)") }[m
[32m+[m
[32m+[m[32m                    Spacer(modifier = Modifier.height(24.dp))[m
[32m+[m
[32m+[m[32m                    // --- üü¢ M·ªöI: DROPDOWN MENU CH·ªåN LO·∫†I T√ÄI LI·ªÜU ---[m
[32m+[m[32m                    Text("Ph√¢n lo·∫°i *", fontWeight = FontWeight.SemiBold, fontSize = 14.sp)[m
[32m+[m[32m                    Spacer(modifier = Modifier.height(8.dp))[m
[32m+[m
[32m+[m[32m                    ExposedDropdownMenuBox([m
[32m+[m[32m                        expanded = expanded,[m
[32m+[m[32m                        onExpandedChange = { expanded = !expanded },[m
[32m+[m[32m                        modifier = Modifier.fillMaxWidth()[m
[32m+[m[32m                    ) {[m
[32m+[m[32m                        OutlinedTextField([m
[32m+[m[32m                            value = selectedCategoryPair.first, // Hi·ªÉn th·ªã t√™n ti·∫øng Vi·ªát[m
[32m+[m[32m                            onValueChange = {},[m
[32m+[m[32m                            readOnly = true, // Kh√¥ng cho g√µ tay[m
[32m+[m[32m                            trailingIcon = { ExposedDropdownMenuDefaults.TrailingIcon(expanded = expanded) },[m
[32m+[m[32m                            colors = ExposedDropdownMenuDefaults.outlinedTextFieldColors([m
[32m+[m[32m                                focusedBorderColor = PrimaryGreen,[m
[32m+[m[32m                                focusedLabelColor = PrimaryGreen[m
[32m+[m[32m                            ),[m
[32m+[m[32m                            modifier = Modifier.menuAnchor().fillMaxWidth(),[m
[32m+[m[32m                            shape = RoundedCornerShape(12.dp)[m
[32m+[m[32m                        )[m
[32m+[m
[32m+[m[32m                        ExposedDropdownMenu([m
[32m+[m[32m                            expanded = expanded,[m
[32m+[m[32m                            onDismissRequest = { expanded = false }[m
[32m+[m[32m                        ) {[m
[32m+[m[32m                            categories.forEach { item ->[m
[32m+[m[32m                                DropdownMenuItem([m
[32m+[m[32m                                    text = { Text(item.first) },[m
[32m+[m[32m                                    onClick = {[m
[32m+[m[32m                                        selectedCategoryPair = item[m
[32m+[m[32m                                        expanded = false[m
[32m+[m[32m                                    }[m
[32m+[m[32m                                )[m
[32m+[m[32m                            }[m
[32m+[m[32m                        }[m
[32m+[m[32m                    }[m
[32m+[m
[32m+[m[32m                    Spacer(modifier = Modifier.height(16.dp))[m
[32m+[m
[32m+[m[32m                    // 3. TI√äU ƒê·ªÄ[m
[32m+[m[32m                    OutlinedTextField([m
[32m+[m[32m                        value = title,[m
[32m+[m[32m                        onValueChange = { title = it },[m
[32m+[m[32m                        label = { Text("T√™n t√†i li·ªáu *") },[m
[32m+[m[32m                        modifier = Modifier.fillMaxWidth(),[m
[32m+[m[32m                        shape = RoundedCornerShape(12.dp),[m
[32m+[m[32m                        colors = OutlinedTextFieldDefaults.colors(focusedBorderColor = PrimaryGreen, focusedLabelColor = PrimaryGreen)[m
[32m+[m[32m                    )[m
[32m+[m
[32m+[m[32m                    Spacer(modifier = Modifier.height(16.dp))[m
[32m+[m
[32m+[m[32m                    // 4. T√ÅC GI·∫¢[m
[32m+[m[32m                    OutlinedTextField([m
[32m+[m[32m                        value = author,[m
[32m+[m[32m                        onValueChange = { author = it },[m
[32m+[m[32m                        label = { Text("T√™n t√°c gi·∫£ *") },[m
[32m+[m[32m                        modifier = Modifier.fillMaxWidth(),[m
[32m+[m[32m                        shape = RoundedCornerShape(12.dp),[m
[32m+[m[32m                        colors = OutlinedTextFieldDefaults.colors(focusedBorderColor = PrimaryGreen, focusedLabelColor = PrimaryGreen)[m
[32m+[m[32m                    )[m
[32m+[m
[32m+[m[32m                    Spacer(modifier = Modifier.height(16.dp))[m
[32m+[m
[32m+[m[32m                    // 5. M√î T·∫¢[m
[32m+[m[32m                    OutlinedTextField([m
[32m+[m[32m                        value = description,[m
[32m+[m[32m                        onValueChange = { description = it },[m
[32m+[m[32m                        label = { Text("M√¥ t·∫£ chi ti·∫øt") },[m
[32m+[m[32m                        modifier = Modifier.fillMaxWidth(),[m
[32m+[m[32m                        minLines = 3,[m
[32m+[m[32m                        maxLines = 5,[m
[32m+[m[32m                        shape = RoundedCornerShape(12.dp),[m
[32m+[m[32m                        colors = OutlinedTextFieldDefaults.colors(focusedBorderColor = PrimaryGreen, focusedLabelColor = PrimaryGreen)[m
[32m+[m[32m                    )[m
[32m+[m
[32m+[m[32m                    Spacer(modifier = Modifier.height(32.dp))[m
[32m+[m
[32m+[m[32m                    // 6. N√öT ƒêƒÇNG[m
[32m+[m[32m                    Button([m
[32m+[m[32m                        onClick = {[m
[32m+[m[32m                            if (selectedFileUri != null && title.isNotBlank() && author.isNotBlank()) {[m
[32m+[m[32m                                val mimeType = context.contentResolver.getType(selectedFileUri!!) ?: "application/octet-stream"[m
[32m+[m
[32m+[m[32m                                // üü¢ G·ª≠i th√™m tham s·ªë type[m
[32m+[m[32m                                viewModel.handleUploadClick([m
[32m+[m[32m                                    title = title,[m
[32m+[m[32m                                    description = description,[m
[32m+[m[32m                                    fileUri = selectedFileUri,[m
[32m+[m[32m                                    mimeType = mimeType,[m
[32m+[m[32m                                    coverUri = selectedCoverUri,[m
[32m+[m[32m                                    author = author,[m
[32m+[m[32m                                    type = selectedCategoryPair.second // G·ª≠i m√£ (exam_review) ƒëi[m
[32m+[m[32m                                )[m
[32m+[m[32m                            } else {[m
[32m+[m[32m                                Toast.makeText(context, "Vui l√≤ng nh·∫≠p ƒë·ªß th√¥ng tin", Toast.LENGTH_SHORT).show()[m
[32m+[m[32m                            }[m
[32m+[m[32m                        },[m
[32m+[m[32m                        enabled = !isUploading, // Disable khi ƒëang t·∫£i[m
[32m+[m[32m                        colors = ButtonDefaults.buttonColors(containerColor = PrimaryGreen),[m
[32m+[m[32m                        modifier = Modifier.fillMaxWidth().height(50.dp),[m
[32m+[m[32m                        shape = RoundedCornerShape(12.dp)[m
[32m+[m[32m                    ) {[m
[32m+[m[32m                        if (isUploading) {[m
[32m+[m[32m                            CircularProgressIndicator(color = Color.White, modifier = Modifier.size(24.dp))[m
[32m+[m[32m                            Spacer(Modifier.width(8.dp))[m
[32m+[m[32m                            Text("ƒêang t·∫£i l√™n...")[m
[32m+[m[32m                        } else {[m
[32m+[m[32m                            Text("ƒêƒÉng t√†i li·ªáu", fontSize = 16.sp, fontWeight = FontWeight.Bold)[m
[32m+[m[32m                        }[m
[32m+[m[32m                    }[m
[32m+[m[32m                }[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/features/feature_upload/ui/UploadViewModel.kt b/app/src/main/java/com/example/stushare/features/feature_upload/ui/UploadViewModel.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..f2d1893[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/features/feature_upload/ui/UploadViewModel.kt[m
[36m@@ -0,0 +1,81 @@[m
[32m+[m[32mpackage com.example.stushare.features.feature_upload.ui[m
[32m+[m
[32m+[m[32mimport android.net.Uri[m
[32m+[m[32mimport androidx.lifecycle.ViewModel[m
[32m+[m[32mimport androidx.lifecycle.viewModelScope[m
[32m+[m[32mimport com.example.stushare.core.data.repository.DocumentRepository[m
[32m+[m[32mimport dagger.hilt.android.lifecycle.HiltViewModel[m
[32m+[m[32mimport kotlinx.coroutines.flow.MutableSharedFlow[m
[32m+[m[32mimport kotlinx.coroutines.flow.MutableStateFlow[m
[32m+[m[32mimport kotlinx.coroutines.flow.asSharedFlow[m
[32m+[m[32mimport kotlinx.coroutines.flow.asStateFlow[m
[32m+[m[32mimport kotlinx.coroutines.launch[m
[32m+[m[32mimport javax.inject.Inject[m
[32m+[m
[32m+[m[32m@HiltViewModel[m
[32m+[m[32mclass UploadViewModel @Inject constructor([m
[32m+[m[32m    private val documentRepository: DocumentRepository[m
[32m+[m[32m) : ViewModel() {[m
[32m+[m
[32m+[m[32m    private val _isUploading = MutableStateFlow(false)[m
[32m+[m[32m    val isUploading = _isUploading.asStateFlow()[m
[32m+[m
[32m+[m[32m    private val _uploadEvent = MutableSharedFlow<UploadResult>()[m
[32m+[m[32m    val uploadEvent = _uploadEvent.asSharedFlow()[m
[32m+[m
[32m+[m[32m    sealed class UploadResult {[m
[32m+[m[32m        data class Success(val message: String) : UploadResult()[m
[32m+[m[32m        data class Error(val message: String) : UploadResult()[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    fun handleUploadClick([m
[32m+[m[32m        title: String,[m
[32m+[m[32m        description: String,[m
[32m+[m[32m        fileUri: Uri?,[m
[32m+[m[32m        mimeType: String,[m
[32m+[m[32m        coverUri: Uri?,[m
[32m+[m[32m        author: String,[m
[32m+[m[32m        type: String // üü¢ M·ªöI: Nh·∫≠n lo·∫°i t√†i li·ªáu (exam_review, book...)[m
[32m+[m[32m    ) {[m
[32m+[m[32m        if (fileUri == null) {[m
[32m+[m[32m            viewModelScope.launch { _uploadEvent.emit(UploadResult.Error("Vui l√≤ng ch·ªçn file t√†i li·ªáu!")) }[m
[32m+[m[32m            return[m
[32m+[m[32m        }[m
[32m+[m[32m        if (title.isBlank()) {[m
[32m+[m[32m            viewModelScope.launch { _uploadEvent.emit(UploadResult.Error("Vui l√≤ng nh·∫≠p ti√™u ƒë·ªÅ!")) }[m
[32m+[m[32m            return[m
[32m+[m[32m        }[m
[32m+[m[32m        if (author.isBlank()) {[m
[32m+[m[32m            viewModelScope.launch { _uploadEvent.emit(UploadResult.Error("Vui l√≤ng nh·∫≠p t√™n t√°c gi·∫£!")) }[m
[32m+[m[32m            return[m
[32m+[m[32m        }[m
[32m+[m
[32m+[m[32m        viewModelScope.launch {[m
[32m+[m[32m            _isUploading.value = true[m
[32m+[m[32m            try {[m
[32m+[m[32m                // G·ªçi Repository[m
[32m+[m[32m                val result = documentRepository.uploadDocument([m
[32m+[m[32m                    title = title,[m
[32m+[m[32m                    description = description,[m
[32m+[m[32m                    fileUri = fileUri,[m
[32m+[m[32m                    mimeType = mimeType,[m
[32m+[m[32m                    coverUri = coverUri,[m
[32m+[m[32m                    author = author,[m
[32m+[m[32m                    type = type // üü¢ Truy·ªÅn type xu·ªëng Repository[m
[32m+[m[32m                )[m
[32m+[m
[32m+[m[32m                if (result.isSuccess) {[m
[32m+[m[32m                    _uploadEvent.emit(UploadResult.Success("Upload th√†nh c√¥ng!"))[m
[32m+[m[32m                } else {[m
[32m+[m[32m                    val errorMsg = result.exceptionOrNull()?.message ?: "L·ªói kh√¥ng x√°c ƒë·ªãnh"[m
[32m+[m[32m                    _uploadEvent.emit(UploadResult.Error("L·ªói: $errorMsg"))[m
[32m+[m[32m                }[m
[32m+[m
[32m+[m[32m            } catch (e: Exception) {[m
[32m+[m[32m                _uploadEvent.emit(UploadResult.Error(e.message ?: "ƒê√£ x·∫£y ra l·ªói khi upload"))[m
[32m+[m[32m            } finally {[m
[32m+[m[32m                _isUploading.value = false[m
[32m+[m[32m            }[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/ui/theme/Color.kt b/app/src/main/java/com/example/stushare/ui/theme/Color.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..b4d6c57[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/ui/theme/Color.kt[m
[36m@@ -0,0 +1,29 @@[m
[32m+[m[32mpackage com.example.stushare.ui.theme[m
[32m+[m
[32m+[m[32mimport androidx.compose.ui.graphics.Color[m
[32m+[m
[32m+[m[32m// C√°c m√†u ch√≠nh (Gi·ªØ nguy√™n c·ªßa b·∫°n)[m
[32m+[m[32mval Purple80 = Color(0xFFD0BCFF)[m
[32m+[m[32mval PurpleGrey80 = Color(0xFFCCC2DC)[m
[32m+[m[32mval Pink80 = Color(0xFFEFB8C8)[m
[32m+[m
[32m+[m[32mval Purple40 = Color(0xFF6650a4)[m
[32m+[m[32mval PurpleGrey40 = Color(0xFF625b71)[m
[32m+[m[32mval Pink40 = Color(0xFF7D5260)[m
[32m+[m
[32m+[m
[32m+[m[32mval PrimaryGreen = Color(0xFF4CAF50)[m
[32m+[m[32mval LightGreen = Color(0xFFE6F5F0)[m
[32m+[m
[32m+[m[32m// --- TH√äM M·ªöI: H·ªÜ TH·ªêNG M√ÄU CHO VƒÇN B·∫¢N (Theo chu·∫©n UX) ---[m
[32m+[m
[32m+[m[32m// Thay v√¨ d√πng Color.Black (#000000), h√£y d√πng m√†u "Off-Black" n√†y cho Ti√™u ƒë·ªÅ[m
[32m+[m[32mval TextBlack = Color(0xFF1A1A1A)[m
[32m+[m
[32m+[m[32m// D√πng m√†u x√°m n√†y cho n·ªôi dung ph·ª•, m√¥ t·∫£ (Body text)[m
[32m+[m[32mval TextGrey = Color(0xFF626262)[m
[32m+[m
[32m+[m[32m// D√πng m√†u x√°m nh·∫°t h∆°n cho c√°c ch√∫ th√≠ch nh·ªè ho·∫∑c placeholder[m
[32m+[m[32mval TextLightGrey = Color(0xFF9F9F9F)[m
[32m+[m
[32m+[m[32mval GreenPrimary = PrimaryGreen[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/ui/theme/Shimmer.kt b/app/src/main/java/com/example/stushare/ui/theme/Shimmer.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..9fed441[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/ui/theme/Shimmer.kt[m
[36m@@ -0,0 +1,54 @@[m
[32m+[m[32mpackage com.example.stushare.ui.theme[m
[32m+[m
[32m+[m[32mimport androidx.compose.animation.core.FastOutSlowInEasing[m
[32m+[m[32mimport androidx.compose.animation.core.RepeatMode[m
[32m+[m[32mimport androidx.compose.animation.core.animateFloat[m
[32m+[m[32mimport androidx.compose.animation.core.infiniteRepeatable[m
[32m+[m[32mimport androidx.compose.animation.core.rememberInfiniteTransition[m
[32m+[m[32mimport androidx.compose.animation.core.tween[m
[32m+[m[32mimport androidx.compose.runtime.Composable[m
[32m+[m[32mimport androidx.compose.ui.geometry.Offset[m
[32m+[m[32mimport androidx.compose.ui.graphics.Brush[m
[32m+[m[32mimport androidx.compose.ui.graphics.Color[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun createShimmerBrush([m
[32m+[m[32m    showShimmer: Boolean = true,[m
[32m+[m[32m    targetValue: Float = 1000f[m
[32m+[m[32m): Brush {[m
[32m+[m[32m    return if (showShimmer) {[m
[32m+[m[32m        val shimmerColors = listOf([m
[32m+[m[32m            Color.LightGray.copy(alpha = 0.6f),[m
[32m+[m[32m            Color.LightGray.copy(alpha = 0.2f),[m
[32m+[m[32m            Color.LightGray.copy(alpha = 0.6f),[m
[32m+[m[32m        )[m
[32m+[m
[32m+[m[32m        val transition = rememberInfiniteTransition(label = "ShimmerTransition")[m
[32m+[m
[32m+[m[32m        val translateAnimation = transition.animateFloat([m
[32m+[m[32m            initialValue = 0f,[m
[32m+[m[32m            targetValue = targetValue,[m
[32m+[m[32m            animationSpec = infiniteRepeatable([m
[32m+[m[32m                animation = tween([m
[32m+[m[32m                    durationMillis = 1000, // T·ªëc ƒë·ªô qu√©t (ms)[m
[32m+[m[32m                    easing = FastOutSlowInEasing[m
[32m+[m[32m                ),[m
[32m+[m[32m                repeatMode = RepeatMode.Restart // Qu√©t l·∫∑p l·∫°i t·ª´ ƒë·∫ßu[m
[32m+[m[32m            ),[m
[32m+[m[32m            label = "ShimmerTranslate"[m
[32m+[m[32m        )[m
[32m+[m
[32m+[m[32m        Brush.linearGradient([m
[32m+[m[32m            colors = shimmerColors,[m
[32m+[m[32m            start = Offset(x = translateAnimation.value - targetValue, y = 0f),[m
[32m+[m[32m            end = Offset(x = translateAnimation.value, y = 0f)[m
[32m+[m[32m        )[m
[32m+[m[32m    } else {[m
[32m+[m[32m        // Tr·∫£ v·ªÅ Brush trong su·ªët n·∫øu kh√¥ng hi·ªÉn th·ªã shimmer[m
[32m+[m[32m        Brush.linearGradient([m
[32m+[m[32m            colors = listOf(Color.Transparent, Color.Transparent),[m
[32m+[m[32m            start = Offset.Zero,[m
[32m+[m[32m            end = Offset.Zero[m
[32m+[m[32m        )[m
[32m+[m[32m    }[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/ui/theme/Theme.kt b/app/src/main/java/com/example/stushare/ui/theme/Theme.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..597c683[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/ui/theme/Theme.kt[m
[36m@@ -0,0 +1,145 @@[m
[32m+[m[32mpackage com.example.stushare.ui.theme[m
[32m+[m
[32m+[m[32mimport android.app.Activity[m
[32m+[m[32mimport android.os.Build[m
[32m+[m[32mimport androidx.compose.foundation.isSystemInDarkTheme[m
[32m+[m[32mimport androidx.compose.material3.*[m
[32m+[m[32mimport androidx.compose.runtime.Composable[m
[32m+[m[32mimport androidx.compose.runtime.SideEffect[m
[32m+[m[32mimport androidx.compose.ui.graphics.Color[m
[32m+[m[32mimport androidx.compose.ui.graphics.toArgb[m
[32m+[m[32mimport androidx.compose.ui.platform.LocalContext[m
[32m+[m[32mimport androidx.compose.ui.platform.LocalView[m
[32m+[m[32mimport androidx.core.view.WindowCompat[m
[32m+[m
[32m+[m[32m// 1. ƒê·ªãnh nghƒ©a m√†u Xanh ch·ªß ƒë·∫°o[m
[32m+[m[32m// (N·∫øu file Color.kt c·ªßa b·∫°n ƒë√£ c√≥ PrimaryGreen th√¨ x√≥a d√≤ng n√†y ƒëi)[m
[32m+[m[32m//val PrimaryGreen = Color(0xFF4CAF50)[m
[32m+[m
[32m+[m[32m// 2. B·∫£ng m√†u T·ªêI (Dark Mode)[m
[32m+[m[32mprivate val DarkColorScheme = darkColorScheme([m
[32m+[m[32m    primary = PrimaryGreen,[m
[32m+[m[32m    onPrimary = Color.Black,[m
[32m+[m[32m    secondary = Color(0xFF81C784),[m
[32m+[m[32m    tertiary = Color(0xFF4DD0E1),[m
[32m+[m
[32m+[m[32m    // N·ªÅn t·ªëi chu·∫©n[m
[32m+[m[32m    background = Color(0xFF121212),[m
[32m+[m[32m    surface = Color(0xFF1E1E1E),[m
[32m+[m[32m    onBackground = Color(0xFFE0E0E0), // Ch·ªØ tr·∫Øng x√°m[m
[32m+[m[32m    onSurface = Color(0xFFE0E0E0)[m
[32m+[m[32m)[m
[32m+[m
[32m+[m[32m// 3. B·∫£ng m√†u S√ÅNG (Light Mode)[m
[32m+[m[32mprivate val LightColorScheme = lightColorScheme([m
[32m+[m[32m    primary = PrimaryGreen,[m
[32m+[m[32m    onPrimary = Color.White,[m
[32m+[m[32m    secondary = Color(0xFF4CAF50),[m
[32m+[m[32m    tertiary = Color(0xFF00BCD4),[m
[32m+[m
[32m+[m[32m    // N·ªÅn s√°ng chu·∫©n[m
[32m+[m[32m    background = Color(0xFFF5F5F5),[m
[32m+[m[32m    surface = Color.White,[m
[32m+[m[32m    onBackground = Color.Black, // Ch·ªØ ƒëen[m
[32m+[m[32m    onSurface = Color.Black[m
[32m+[m[32m)[m
[32m+[m
[32m+[m[32m@Composable[m
[32m+[m[32mfun StuShareTheme([m
[32m+[m[32m    darkTheme: Boolean = isSystemInDarkTheme(),[m
[32m+[m[32m    dynamicColor: Boolean = false,[m
[32m+[m[32m    // ‚≠êÔ∏è TH√äM THAM S·ªê fontScale (M·∫∑c ƒë·ªãnh 1.0f)[m
[32m+[m[32m    fontScale: Float = 1.0f,[m
[32m+[m[32m    content: @Composable () -> Unit[m
[32m+[m[32m) {[m
[32m+[m[32m    val colorScheme = when {[m
[32m+[m[32m        dynamicColor && Build.VERSION.SDK_INT >= Build.VERSION_CODES.S -> {[m
[32m+[m[32m            val context = LocalContext.current[m
[32m+[m[32m            if (darkTheme) dynamicDarkColorScheme(context) else dynamicLightColorScheme(context)[m
[32m+[m[32m        }[m
[32m+[m[32m        darkTheme -> DarkColorScheme[m
[32m+[m[32m        else -> LightColorScheme[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    val view = LocalView.current[m
[32m+[m[32m    if (!view.isInEditMode) {[m
[32m+[m[32m        SideEffect {[m
[32m+[m[32m            val window = (view.context as Activity).window[m
[32m+[m[32m            window.statusBarColor = if (darkTheme) Color.Black.toArgb() else colorScheme.primary.toArgb()[m
[32m+[m[32m            WindowCompat.getInsetsController(window, view).isAppearanceLightStatusBars = false[m
[32m+[m[32m        }[m
[32m+[m[32m    }[m
[32m+[m
[32m+[m[32m    // ‚≠êÔ∏è LOGIC PH√ìNG TO CH·ªÆ (Magic happens here)[m
[32m+[m[32m    // L·∫•y Typography g·ªëc v√† nh√¢n fontSize, lineHeight v·ªõi fontScale[m
[32m+[m[32m    val defaultTypography = Typography // L·∫•y t·ª´ file Type.kt[m
[32m+[m
[32m+[m[32m    val scaledTypography = Typography([m
[32m+[m[32m        displayLarge = defaultTypography.displayLarge.copy([m
[32m+[m[32m            fontSize = defaultTypography.displayLarge.fontSize * fontScale,[m
[32m+[m[32m            lineHeight = defaultTypography.displayLarge.lineHeight * fontScale[m
[32m+[m[32m        ),[m
[32m+[m[32m        displayMedium = defaultTypography.displayMedium.copy([m
[32m+[m[32m            fontSize = defaultTypography.displayMedium.fontSize * fontScale,[m
[32m+[m[32m            lineHeight = defaultTypography.displayMedium.lineHeight * fontScale[m
[32m+[m[32m        ),[m
[32m+[m[32m        displaySmall = defaultTypography.displaySmall.copy([m
[32m+[m[32m            fontSize = defaultTypography.displaySmall.fontSize * fontScale,[m
[32m+[m[32m            lineHeight = defaultTypography.displaySmall.lineHeight * fontScale[m
[32m+[m[32m        ),[m
[32m+[m[32m        headlineLarge = defaultTypography.headlineLarge.copy([m
[32m+[m[32m            fontSize = defaultTypography.headlineLarge.fontSize * fontScale,[m
[32m+[m[32m            lineHeight = defaultTypography.headlineLarge.lineHeight * fontScale[m
[32m+[m[32m        ),[m
[32m+[m[32m        headlineMedium = defaultTypography.headlineMedium.copy([m
[32m+[m[32m            fontSize = defaultTypography.headlineMedium.fontSize * fontScale,[m
[32m+[m[32m            lineHeight = defaultTypography.headlineMedium.lineHeight * fontScale[m
[32m+[m[32m        ),[m
[32m+[m[32m        headlineSmall = defaultTypography.headlineSmall.copy([m
[32m+[m[32m            fontSize = defaultTypography.headlineSmall.fontSize * fontScale,[m
[32m+[m[32m            lineHeight = defaultTypography.headlineSmall.lineHeight * fontScale[m
[32m+[m[32m        ),[m
[32m+[m[32m        titleLarge = defaultTypography.titleLarge.copy([m
[32m+[m[32m            fontSize = defaultTypography.titleLarge.fontSize * fontScale,[m
[32m+[m[32m            lineHeight = defaultTypography.titleLarge.lineHeight * fontScale[m
[32m+[m[32m        ),[m
[32m+[m[32m        titleMedium = defaultTypography.titleMedium.copy([m
[32m+[m[32m            fontSize = defaultTypography.titleMedium.fontSize * fontScale,[m
[32m+[m[32m            lineHeight = defaultTypography.titleMedium.lineHeight * fontScale[m
[32m+[m[32m        ),[m
[32m+[m[32m        titleSmall = defaultTypography.titleSmall.copy([m
[32m+[m[32m            fontSize = defaultTypography.titleSmall.fontSize * fontScale,[m
[32m+[m[32m            lineHeight = defaultTypography.titleSmall.lineHeight * fontScale[m
[32m+[m[32m        ),[m
[32m+[m[32m        bodyLarge = defaultTypography.bodyLarge.copy([m
[32m+[m[32m            fontSize = defaultTypography.bodyLarge.fontSize * fontScale,[m
[32m+[m[32m            lineHeight = defaultTypography.bodyLarge.lineHeight * fontScale[m
[32m+[m[32m        ),[m
[32m+[m[32m        bodyMedium = defaultTypography.bodyMedium.copy([m
[32m+[m[32m            fontSize = defaultTypography.bodyMedium.fontSize * fontScale,[m
[32m+[m[32m            lineHeight = defaultTypography.bodyMedium.lineHeight * fontScale[m
[32m+[m[32m        ),[m
[32m+[m[32m        bodySmall = defaultTypography.bodySmall.copy([m
[32m+[m[32m            fontSize = defaultTypography.bodySmall.fontSize * fontScale,[m
[32m+[m[32m            lineHeight = defaultTypography.bodySmall.lineHeight * fontScale[m
[32m+[m[32m        ),[m
[32m+[m[32m        labelLarge = defaultTypography.labelLarge.copy([m
[32m+[m[32m            fontSize = defaultTypography.labelLarge.fontSize * fontScale,[m
[32m+[m[32m            lineHeight = defaultTypography.labelLarge.lineHeight * fontScale[m
[32m+[m[32m        ),[m
[32m+[m[32m        labelMedium = defaultTypography.labelMedium.copy([m
[32m+[m[32m            fontSize = defaultTypography.labelMedium.fontSize * fontScale,[m
[32m+[m[32m            lineHeight = defaultTypography.labelMedium.lineHeight * fontScale[m
[32m+[m[32m        ),[m
[32m+[m[32m        labelSmall = defaultTypography.labelSmall.copy([m
[32m+[m[32m            fontSize = defaultTypography.labelSmall.fontSize * fontScale,[m
[32m+[m[32m            lineHeight = defaultTypography.labelSmall.lineHeight * fontScale[m
[32m+[m[32m        )[m
[32m+[m[32m    )[m
[32m+[m
[32m+[m[32m    MaterialTheme([m
[32m+[m[32m        colorScheme = colorScheme,[m
[32m+[m[32m        typography = scaledTypography, // üëà Truy·ªÅn b·ªô font ƒë√£ ph√≥ng to v√†o Theme[m
[32m+[m[32m        content = content[m
[32m+[m[32m    )[m
[32m+[m[32m}[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/java/com/example/stushare/ui/theme/Type.kt b/app/src/main/java/com/example/stushare/ui/theme/Type.kt[m
[1mnew file mode 100644[m
[1mindex 0000000..69219ee[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/java/com/example/stushare/ui/theme/Type.kt[m
[36m@@ -0,0 +1,72 @@[m
[32m+[m[32mpackage com.example.stushare.ui.theme[m
[32m+[m
[32m+[m[32mimport androidx.compose.material3.Typography[m
[32m+[m[32mimport androidx.compose.ui.text.TextStyle[m
[32m+[m[32mimport androidx.compose.ui.text.font.FontFamily[m
[32m+[m[32mimport androidx.compose.ui.text.font.FontWeight[m
[32m+[m[32mimport androidx.compose.ui.unit.sp[m
[32m+[m
[32m+[m[32mval Typography = Typography([m
[32m+[m[32m    // 1. HEADLINE (D√πng cho t√™n ng∆∞·ªùi d√πng, ti√™u ƒë·ªÅ l·ªõn nh·∫•t trang)[m
[32m+[m[32m    headlineSmall = TextStyle([m
[32m+[m[32m        fontFamily = FontFamily.Default,[m
[32m+[m[32m        fontWeight = FontWeight.Bold,[m
[32m+[m[32m        fontSize = 24.sp,[m
[32m+[m[32m        lineHeight = 32.sp,[m
[32m+[m[32m        letterSpacing = 0.sp[m
[32m+[m[32m    ),[m
[32m+[m
[32m+[m[32m    // 2. TITLE LARGE (D√πng cho ti√™u ƒë·ªÅ Section: "M·ªõi t·∫£i l√™n", Header m√†n h√¨nh)[m
[32m+[m[32m    titleLarge = TextStyle([m
[32m+[m[32m        fontFamily = FontFamily.Default,[m
[32m+[m[32m        fontWeight = FontWeight.Bold,[m
[32m+[m[32m        fontSize = 20.sp, // TƒÉng ƒë·ªô ƒë·∫≠m[m
[32m+[m[32m        lineHeight = 28.sp,[m
[32m+[m[32m        letterSpacing = 0.sp[m
[32m+[m[32m    ),[m
[32m+[m
[32m+[m[32m    // 3. TITLE MEDIUM (D√πng cho t√™n T√†i li·ªáu trong Card)[m
[32m+[m[32m    titleMedium = TextStyle([m
[32m+[m[32m        fontFamily = FontFamily.Default,[m
[32m+[m[32m        fontWeight = FontWeight.SemiBold, // ƒê·∫≠m v·ª´a ph·∫£i ƒë·ªÉ d·ªÖ ƒë·ªçc t√™n s√°ch[m
[32m+[m[32m        fontSize = 16.sp,[m
[32m+[m[32m        lineHeight = 24.sp,[m
[32m+[m[32m        letterSpacing = 0.15.sp[m
[32m+[m[32m    ),[m
[32m+[m
[32m+[m[32m    // 4. TITLE SMALL (D√πng cho c√°c m·ª•c ph·ª•, sub-header)[m
[32m+[m[32m    titleSmall = TextStyle([m
[32m+[m[32m        fontFamily = FontFamily.Default,[m
[32m+[m[32m        fontWeight = FontWeight.Medium,[m
[32m+[m[32m        fontSize = 14.sp,[m
[32m+[m[32m        lineHeight = 20.sp,[m
[32m+[m[32m        letterSpacing = 0.1.sp[m
[32m+[m[32m    ),[m
[32m+[m
[32m+[m[32m    // 5. BODY LARGE (D√πng cho l·ªùi ch√†o "Xin ch√†o", ho·∫∑c vƒÉn b·∫£n ch√≠nh)[m
[32m+[m[32m    bodyLarge = TextStyle([m
[32m+[m[32m        fontFamily = FontFamily.Default,[m
[32m+[m[32m        fontWeight = FontWeight.Normal,[m
[32m+[m[32m        fontSize = 16.sp,[m
[32m+[m[32m        lineHeight = 24.sp,[m
[32m+[m[32m        letterSpacing = 0.5.sp[m
[32m+[m[32m    ),[m
[32m+[m
[32m+[m[32m    // 6. BODY MEDIUM (N·ªôi dung ph·ª•, m√¥ t·∫£ ng·∫Øn)[m
[32m+[m[32m    bodyMedium = TextStyle([m
[32m+[m[32m        fontFamily = FontFamily.Default,[m
[32m+[m[32m        fontWeight = FontWeight.Normal,[m
[32m+[m[32m        fontSize = 14.sp,[m
[32m+[m[32m        lineHeight = 20.sp,[m
[32m+[m[32m        letterSpacing = 0.25.sp[m
[32m+[m[32m    ),[m
[32m+[m
[32m+[m[32m    // 7. LABEL SMALL (Caption, s·ªë l∆∞·ª£t t·∫£i, rating)[m
[32m+[m[32m    labelSmall = TextStyle([m
[32m+[m[32m        fontFamily = FontFamily.Default,[m
[32m+[m[32m        fontWeight = FontWeight.Medium,[m
[32m+[m[32m        fontSize = 11.sp, // Nh·ªè g·ªçn tinh t·∫ø[m
[32m+[m[32m        lineHeight = 16.sp,[m
[32m+[m[32m        letterSpacing = 0.5.sp[m
[32m+[m[32m    )[m
[32m+[m[32m)[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/new.sh b/app/src/main/new.sh[m
[1mnew file mode 100644[m
[1mindex 0000000..24813c3[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/new.sh[m
[36m@@ -0,0 +1,3 @@[m
[32m+[m[32mbash[m
[32m+[m[32m    ./gradlew clean build[m
[32m+[m[41m    [m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/res/drawable/avatar_circle_bg.xml b/app/src/main/res/drawable/avatar_circle_bg.xml[m
[1mnew file mode 100644[m
[1mindex 0000000..003b0a1[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/res/drawable/avatar_circle_bg.xml[m
[36m@@ -0,0 +1,3 @@[m
[32m+[m[32m<shape xmlns:android="http://schemas.android.com/apk/res/android" android:shape="oval">[m
[32m+[m[32m    <solid android:color="#50FFFFFF"/>[m
[32m+[m[32m</shape>[m
[1mdiff --git a/app/src/main/res/drawable/badge_green.xml b/app/src/main/res/drawable/badge_green.xml[m
[1mnew file mode 100644[m
[1mindex 0000000..85faf6d[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/res/drawable/badge_green.xml[m
[36m@@ -0,0 +1,4 @@[m
[32m+[m[32m<shape xmlns:android="http://schemas.android.com/apk/res/android" android:shape="rectangle">[m
[32m+[m[32m    <solid android:color="#2DC18A"/>[m
[32m+[m[32m    <corners android:radius="20dp"/>[m
[32m+[m[32m</shape>[m
[1mdiff --git a/app/src/main/res/drawable/bg_dashed_border.xml b/app/src/main/res/drawable/bg_dashed_border.xml[m
[1mnew file mode 100644[m
[1mindex 0000000..39d6f2c[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/res/drawable/bg_dashed_border.xml[m
[36m@@ -0,0 +1,9 @@[m
[32m+[m[32m<?xml version="1.0" encoding="utf-8"?>[m
[32m+[m[32m<shape xmlns:android="http://schemas.android.com/apk/res/android"[m
[32m+[m[32m    android:shape="rectangle">[m
[32m+[m[32m    <solid android:color="#F5F5F5" /> <corners android:radius="12dp" />[m
[32m+[m[32m    <stroke[m
[32m+[m[32m        android:width="2dp"[m
[32m+[m[32m        android:color="#BDBDBD"[m
[32m+[m[32m        android:dashWidth="6dp"[m
[32m+[m[32m        android:dashGap="4dp" /> </shape>[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/res/drawable/bg_setting_item.xml b/app/src/main/res/drawable/bg_setting_item.xml[m
[1mnew file mode 100644[m
[1mindex 0000000..b31e15c[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/res/drawable/bg_setting_item.xml[m
[36m@@ -0,0 +1,9 @@[m
[32m+[m[32m<?xml version="1.0" encoding="utf-8"?>[m
[32m+[m[32m<ripple xmlns:android="http://schemas.android.com/apk/res/android"[m
[32m+[m[32m    android:color="#E0E0E0"> <item>[m
[32m+[m[32m    <shape android:shape="rectangle">[m
[32m+[m[32m        <solid android:color="@android:color/white" />[m
[32m+[m[32m        <corners android:radius="12dp" />[m
[32m+[m[32m    </shape>[m
[32m+[m[32m</item>[m
[32m+[m[32m</ripple>[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/res/drawable/bottom_bar_bg.xml b/app/src/main/res/drawable/bottom_bar_bg.xml[m
[1mnew file mode 100644[m
[1mindex 0000000..b98d1a2[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/res/drawable/bottom_bar_bg.xml[m
[36m@@ -0,0 +1,10 @@[m
[32m+[m[32m<?xml version="1.0" encoding="utf-8"?>[m
[32m+[m[32m<shape xmlns:android="http://schemas.android.com/apk/res/android"[m
[32m+[m[32m    android:shape="rectangle">[m
[32m+[m[32m    <solid android:color="#27AE60" />[m
[32m+[m[32m    <corners[m
[32m+[m[32m        android:topLeftRadius="16dp"[m
[32m+[m[32m        android:topRightRadius="16dp"[m
[32m+[m[32m        android:bottomLeftRadius="0dp"[m
[32m+[m[32m        android:bottomRightRadius="0dp" />[m
[32m+[m[32m</shape>[m
[1mdiff --git a/app/src/main/res/drawable/box_choose_bg.xml b/app/src/main/res/drawable/box_choose_bg.xml[m
[1mnew file mode 100644[m
[1mindex 0000000..324c643[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/res/drawable/box_choose_bg.xml[m
[36m@@ -0,0 +1,15 @@[m
[32m+[m[32m<?xml version="1.0" encoding="utf-8"?>[m
[32m+[m[32m<shape xmlns:android="http://schemas.android.com/apk/res/android"[m
[32m+[m[32m    android:shape="rectangle">[m
[32m+[m
[32m+[m[32m    <!-- M√†u n·ªÅn -->[m
[32m+[m[32m    <solid android:color="#E5D9D9" />[m
[32m+[m
[32m+[m[32m    <!-- Bo tr√≤n 4 g√≥c -->[m
[32m+[m[32m    <corners android:radius="20dp" />[m
[32m+[m
[32m+[m[32m    <!-- Vi·ªÅn nh·∫π (t√πy ch·ªçn) -->[m
[32m+[m[32m    <stroke[m
[32m+[m[32m        android:width="1dp"[m
[32m+[m[32m        android:color="#D0C4C4" />[m
[32m+[m[32m</shape>[m
[1mdiff --git a/app/src/main/res/drawable/fab_inner_circle.xml b/app/src/main/res/drawable/fab_inner_circle.xml[m
[1mnew file mode 100644[m
[1mindex 0000000..dbc7894[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/res/drawable/fab_inner_circle.xml[m
[36m@@ -0,0 +1,7 @@[m
[32m+[m[32m<?xml version="1.0" encoding="utf-8"?>[m
[32m+[m[32m<shape xmlns:android="http://schemas.android.com/apk/res/android"[m
[32m+[m[32m    android:shape="oval">[m
[32m+[m
[32m+[m[32m    <size android:width="56dp" android:height="56dp" />[m
[32m+[m[32m    <solid android:color="#27AE60" />[m
[32m+[m[32m</shape>[m
[1mdiff --git a/app/src/main/res/drawable/fab_outer_circle.xml b/app/src/main/res/drawable/fab_outer_circle.xml[m
[1mnew file mode 100644[m
[1mindex 0000000..71537ef[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/res/drawable/fab_outer_circle.xml[m
[36m@@ -0,0 +1,14 @@[m
[32m+[m[32m<?xml version="1.0" encoding="utf-8"?>[m
[32m+[m[32m<shape xmlns:android="http://schemas.android.com/apk/res/android"[m
[32m+[m[32m    android:shape="oval">[m
[32m+[m
[32m+[m[32m    <size android:width="72dp" android:height="72dp" />[m
[32m+[m
[32m+[m[32m    <!-- n·ªÅn tr·∫Øng -->[m
[32m+[m[32m    <solid android:color="#FFFFFF" />[m
[32m+[m
[32m+[m[32m    <!-- vi·ªÅn m·ªèng (n·∫øu mu·ªën) -->[m
[32m+[m[32m    <stroke[m
[32m+[m[32m        android:width="2dp"[m
[32m+[m[32m        android:color="#80FFFFFF" />[m
[32m+[m[32m</shape>[m
[1mdiff --git a/app/src/main/res/drawable/fab_outer_layer.xml b/app/src/main/res/drawable/fab_outer_layer.xml[m
[1mnew file mode 100644[m
[1mindex 0000000..5e48223[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/res/drawable/fab_outer_layer.xml[m
[36m@@ -0,0 +1,19 @@[m
[32m+[m[32m<?xml version="1.0" encoding="utf-8"?>[m
[32m+[m[32m<layer-list xmlns:android="http://schemas.android.com/apk/res/android">[m
[32m+[m
[32m+[m[32m    <!-- outer white circle -->[m
[32m+[m[32m    <item>[m
[32m+[m[32m        <shape android:shape="oval">[m
[32m+[m[32m            <size android:width="72dp" android:height="72dp"/>[m
[32m+[m[32m            <solid android:color="#FFFFFF"/>[m
[32m+[m[32m        </shape>[m
[32m+[m[32m    </item>[m
[32m+[m
[32m+[m[32m    <!-- inner green circle (inset to create visible white ring) -->[m
[32m+[m[32m    <item android:left="6dp" android:top="6dp" android:right="6dp" android:bottom="6dp">[m
[32m+[m[32m        <shape android:shape="oval">[m
[32m+[m[32m            <size android:width="60dp" android:height="60dp"/>[m
[32m+[m[32m            <solid android:color="#27AE60"/>[m
[32m+[m[32m        </shape>[m
[32m+[m[32m    </item>[m
[32m+[m[32m</layer-list>[m
[1mdiff --git a/app/src/main/res/drawable/fab_outer_layer_active.xml b/app/src/main/res/drawable/fab_outer_layer_active.xml[m
[1mnew file mode 100644[m
[1mindex 0000000..0e920e6[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/res/drawable/fab_outer_layer_active.xml[m
[36m@@ -0,0 +1,16 @@[m
[32m+[m[32m<?xml version="1.0" encoding="utf-8"?>[m
[32m+[m[32m<layer-list xmlns:android="http://schemas.android.com/apk/res/android">[m
[32m+[m[32m    <item>[m
[32m+[m[32m        <shape android:shape="oval">[m
[32m+[m[32m            <size android:width="72dp" android:height="72dp"/>[m
[32m+[m[32m            <solid android:color="#FFFFFF"/>[m
[32m+[m[32m        </shape>[m
[32m+[m[32m    </item>[m
[32m+[m
[32m+[m[32m    <item android:left="6dp" android:top="6dp" android:right="6dp" android:bottom="6dp">[m
[32m+[m[32m        <shape android:shape="oval">[m
[32m+[m[32m            <size android:width="60dp" android:height="60dp"/>[m
[32m+[m[32m            <solid android:color="#2DC18A"/> <!-- v√≠ d·ª• m√†u active -->[m
[32m+[m[32m        </shape>[m
[32m+[m[32m    </item>[m
[32m+[m[32m</layer-list>[m
[1mdiff --git a/app/src/main/res/drawable/gradient_background.xml b/app/src/main/res/drawable/gradient_background.xml[m
[1mnew file mode 100644[m
[1mindex 0000000..1b9d69c[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/res/drawable/gradient_background.xml[m
[36m@@ -0,0 +1,10 @@[m
[32m+[m[32m<?xml version="1.0" encoding="utf-8"?>[m
[32m+[m[32m<shape xmlns:android="http://schemas.android.com/apk/res/android"[m
[32m+[m[32m    android:shape="rectangle">[m
[32m+[m[32m    <gradient[m
[32m+[m[32m        android:type="linear"[m
[32m+[m[32m        android:angle="270"[m
[32m+[m[32m        android:startColor="#27AE60"[m
[32m+[m[32m        android:centerColor="#0F824A"[m
[32m+[m[32m        android:endColor="#D2F4E6" />[m
[32m+[m[32m</shape>[m
[1mdiff --git a/app/src/main/res/drawable/ic_add_circle.xml b/app/src/main/res/drawable/ic_add_circle.xml[m
[1mnew file mode 100644[m
[1mindex 0000000..bca0ef8[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/res/drawable/ic_add_circle.xml[m
[36m@@ -0,0 +1,7 @@[m
[32m+[m[32m<vector xmlns:android="http://schemas.android.com/apk/res/android"[m
[32m+[m[32m    android:width="24dp" android:height="24dp"[m
[32m+[m[32m    android:viewportWidth="24" android:viewportHeight="24"[m
[32m+[m[32m    android:tint="#27AE60">[m
[32m+[m[32m    <path android:fillColor="@android:color/white"[m
[32m+[m[32m        android:pathData="M12,2C6.48,2 2,6.48 2,12s4.48,10 10,10 10,-4.48 10,-10S17.52,2 12,2zM17,13h-4v4h-2v-4H7v-2h4V7h2v4h4v2z"/>[m
[32m+[m[32m</vector>[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/res/drawable/ic_arrow_down.xml b/app/src/main/res/drawable/ic_arrow_down.xml[m
[1mnew file mode 100644[m
[1mindex 0000000..f67135f[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/res/drawable/ic_arrow_down.xml[m
[36m@@ -0,0 +1,7 @@[m
[32m+[m[32m<vector xmlns:android="http://schemas.android.com/apk/res/android"[m
[32m+[m[32m    android:width="24dp" android:height="24dp"[m
[32m+[m[32m    android:viewportWidth="24" android:viewportHeight="24"[m
[32m+[m[32m    android:tint="#757575">[m
[32m+[m[32m    <path android:fillColor="@android:color/white"[m
[32m+[m[32m        android:pathData="M7.41,8.59L12,13.17l4.59,-4.58L18,10l-6,6 -6,-6 1.41,-1.41z"/>[m
[32m+[m[32m</vector>[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/res/drawable/ic_arrow_right.xml b/app/src/main/res/drawable/ic_arrow_right.xml[m
[1mnew file mode 100644[m
[1mindex 0000000..6cd918f[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/res/drawable/ic_arrow_right.xml[m
[36m@@ -0,0 +1,5 @@[m
[32m+[m[32m<vector xmlns:android="http://schemas.android.com/apk/res/android"[m
[32m+[m[32m    android:width="24dp" android:height="24dp"[m
[32m+[m[32m    android:viewportWidth="24" android:viewportHeight="24">[m
[32m+[m[32m    <path android:fillColor="#808080" android:pathData="M8.59,16.59L13.17,12 8.59,7.41 10,6l6,6 -6,6 -1.41,-1.41z"/>[m
[32m+[m[32m</vector>[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/res/drawable/ic_camera_alt.xml b/app/src/main/res/drawable/ic_camera_alt.xml[m
[1mnew file mode 100644[m
[1mindex 0000000..6041b05[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/res/drawable/ic_camera_alt.xml[m
[36m@@ -0,0 +1,7 @@[m
[32m+[m[32m<vector xmlns:android="http://schemas.android.com/apk/res/android"[m
[32m+[m[32m    android:width="24dp" android:height="24dp"[m
[32m+[m[32m    android:viewportWidth="24" android:viewportHeight="24"[m
[32m+[m[32m    android:tint="#757575">[m
[32m+[m[32m    <path android:fillColor="@android:color/white"[m
[32m+[m[32m        android:pathData="M12,12m-3.2,0a3.2,3.2 0,1 1,6.4 0a3.2,3.2 0,1 1,-6.4 0zM9,2L7.17,4H4c-1.1,0 -2,0.9 -2,2v12c0,1.1 0.9,2 2,2h16c1.1,0 2,-0.9 2,-2V6c0,-1.1 -0.9,-2 -2,-2h-3.17L15,2H9zM12,17c-2.76,0 -5,-2.24 -5,-5s2.24,-5 5,-5 5,2.24 5,5 -2.24,5 -5,5z"/>[m
[32m+[m[32m</vector>[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/res/drawable/ic_chat_bubble.xml b/app/src/main/res/drawable/ic_chat_bubble.xml[m
[1mnew file mode 100644[m
[1mindex 0000000..eb857c0[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/res/drawable/ic_chat_bubble.xml[m
[36m@@ -0,0 +1,7 @@[m
[32m+[m[32m<vector xmlns:android="http://schemas.android.com/apk/res/android"[m
[32m+[m[32m    android:width="24dp" android:height="24dp"[m
[32m+[m[32m    android:viewportWidth="24" android:viewportHeight="24"[m
[32m+[m[32m    android:tint="#757575">[m
[32m+[m[32m    <path android:fillColor="@android:color/white"[m
[32m+[m[32m        android:pathData="M20,2H4c-1.1,0 -2,0.9 -2,2v18l4,-4h14c1.1,0 2,-0.9 2,-2V4c0,-1.1 -0.9,-2 -2,-2z"/>[m
[32m+[m[32m</vector>[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/res/drawable/ic_check_circle.xml b/app/src/main/res/drawable/ic_check_circle.xml[m
[1mnew file mode 100644[m
[1mindex 0000000..397cd6f[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/res/drawable/ic_check_circle.xml[m
[36m@@ -0,0 +1,9 @@[m
[32m+[m[32m<vector xmlns:android="http://schemas.android.com/apk/res/android"[m
[32m+[m[32m    android:width="24dp"[m
[32m+[m[32m    android:height="24dp"[m
[32m+[m[32m    android:viewportWidth="24"[m
[32m+[m[32m    android:viewportHeight="24">[m
[32m+[m[32m    <path[m
[32m+[m[32m        android:fillColor="#000000"[m
[32m+[m[32m        android:pathData="M12,2C6.48,2 2,6.48 2,12s4.48,10 10,10 10,-4.48 10,-10S17.52,2 12,2zM10,17l-5,-5 1.41,-1.41L10,14.17l7.59,-7.59L19,8l-9,9z"/>[m
[32m+[m[32m</vector>[m
[1mdiff --git a/app/src/main/res/drawable/ic_dienthoai1.png b/app/src/main/res/drawable/ic_dienthoai1.png[m
[1mnew file mode 100644[m
[1mindex 0000000..af3a715[m
Binary files /dev/null and b/app/src/main/res/drawable/ic_dienthoai1.png differ
[1mdiff --git a/app/src/main/res/drawable/ic_document.xml b/app/src/main/res/drawable/ic_document.xml[m
[1mnew file mode 100644[m
[1mindex 0000000..65e33bf[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/res/drawable/ic_document.xml[m
[36m@@ -0,0 +1,7 @@[m
[32m+[m[32m<vector xmlns:android="http://schemas.android.com/apk/res/android"[m
[32m+[m[32m    android:width="24dp" android:height="24dp"[m
[32m+[m[32m    android:viewportWidth="24" android:viewportHeight="24"[m
[32m+[m[32m    android:tint="#27AE60">[m
[32m+[m[32m    <path android:fillColor="@android:color/white"[m
[32m+[m[32m        android:pathData="M14,2H6C4.9,2 4,2.9 4,4v16c0,1.1 0.89,2 1.99,2H18c1.1,0 2,-0.9 2,-2V8l-6,-6zM16,18H8v-2h8v2zM16,14H8v-2h8v2zM13,9V3.5L18.5,9H13z"/>[m
[32m+[m[32m</vector>[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/res/drawable/ic_email.xml b/app/src/main/res/drawable/ic_email.xml[m
[1mnew file mode 100644[m
[1mindex 0000000..36bdd0c[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/res/drawable/ic_email.xml[m
[36m@@ -0,0 +1,7 @@[m
[32m+[m[32m<vector xmlns:android="http://schemas.android.com/apk/res/android"[m
[32m+[m[32m    android:width="24dp" android:height="24dp"[m
[32m+[m[32m    android:viewportWidth="24" android:viewportHeight="24"[m
[32m+[m[32m    android:tint="#27AE60">[m
[32m+[m[32m    <path android:fillColor="@android:color/white"[m
[32m+[m[32m        android:pathData="M20,4H4C2.9,4 2,4.9 2,6v12c0,1.1 0.9,2 2,2h16c1.1,0 2,-0.9 2,-2V6C22,4.9 21.1,4 20,4zM20,8l-8,5L4,8V6l8,5l8,-5V8z"/>[m
[32m+[m[32m</vector>[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/res/drawable/ic_fab_chat.xml b/app/src/main/res/drawable/ic_fab_chat.xml[m
[1mnew file mode 100644[m
[1mindex 0000000..08ccd04[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/res/drawable/ic_fab_chat.xml[m
[36m@@ -0,0 +1,7 @@[m
[32m+[m[32m<vector xmlns:android="http://schemas.android.com/apk/res/android"[m
[32m+[m[32m    android:width="24dp" android:height="24dp"[m
[32m+[m[32m    android:viewportWidth="24" android:viewportHeight="24"[m
[32m+[m[32m    android:tint="#FFFFFF">[m
[32m+[m[32m    <path android:fillColor="@android:color/white"[m
[32m+[m[32m        android:pathData="M20,2H4c-1.1,0 -2,0.9 -2,2v18l4,-4h14c1.1,0 2,-0.9 2,-2V4c0,-1.1 -0.9,-2 -2,-2z"/>[m
[32m+[m[32m</vector>[m
\ No newline at end of file[m
[1mdiff --git a/app/src/main/res/drawable/ic_flag_uk.xml b/app/src/main/res/drawable/ic_flag_uk.xml[m
[1mnew file mode 100644[m
[1mindex 0000000..e06a1ec[m
[1m--- /dev/null[m
[1m+++ b/app/src/main/res/drawable/ic_flag_uk.xml[m
[36m@@ -0,0 +1,7 @@[m
[32m+[m[32m<vector xmlns:android="http://schemas.android.com/apk/res/android"[m
[32m+[m[32m    android:width="24dp" android:height="24dp"[m
[32m+[m[32m    android:viewportWidth="24" android:viewportHeight="24">[m
[32m+[m[32m    <path android:fillColor="#012169" android:pathData="M2,4h20v16H2z"/>[m
[32m+[m[32m    <path android:fillColor="#FFFFFF" android:pathData="M10,4h4v16h-4z M2,10h20v4H2z"/>[m
[32m+[m[32m    <path android:fill